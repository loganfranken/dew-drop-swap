!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,n,r){if(0!==e.width&&0!==e.height){var a=e.frame,h=a.width,o=a.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,a.glTexture,h,o,e.x,e.y,h/e.style.resolution,o/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,h,o,l(e._tintTL,n.alpha*e._alphaTL),l(e._tintTR,n.alpha*e._alphaTR),l(e._tintBL,n.alpha*e._alphaBL),l(e._tintBR,n.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,n,r)}}},function(t,e){t.exports=function(t,e,i,s,n){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,s,n)}},function(t,e,i){var s;!function(){function n(t,e,i){return t.call.apply(t.bind,arguments)}function r(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function a(t,e,i){return(a=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:r).apply(null,arguments)}var h=Date.now||function(){return+new Date};function o(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var l=!!window.FontFace;function d(t,e,i,s){if(e=t.c.createElement(e),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return s&&e.appendChild(t.c.createTextNode(s)),e}function u(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function c(t){t.parentNode&&t.parentNode.removeChild(t)}function p(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var r=!1,a=0;a<s.length;a+=1)if(e[n]===s[a]){r=!0;break}r||s.push(e[n])}for(e=[],n=0;n<s.length;n+=1){for(r=!1,a=0;a<i.length;a+=1)if(s[n]===i[a]){r=!0;break}r||e.push(s[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function g(t,e){for(var i=t.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==e)return!0;return!1}function f(t,e,i){function s(){h&&n&&r&&(h(a),h=null)}e=d(t,"link",{rel:"stylesheet",href:e,media:"all"});var n=!1,r=!0,a=null,h=i||null;l?(e.onload=function(){n=!0,s()},e.onerror=function(){n=!0,a=Error("Stylesheet failed to load"),s()}):setTimeout((function(){n=!0,s()}),0),u(t,"head",e)}function m(t,e,i,s){var n=t.c.getElementsByTagName("head")[0];if(n){var r=d(t,"script",{src:e}),a=!1;return r.onload=r.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,i&&i(null),r.onload=r.onreadystatechange=null,"HEAD"==r.parentNode.tagName&&n.removeChild(r))},n.appendChild(r),setTimeout((function(){a||(a=!0,i&&i(Error("Script load timeout")))}),s||5e3),r}return null}function v(){this.a=0,this.c=null}function y(t){return t.a++,function(){t.a--,w(t)}}function x(t,e){t.c=e,w(t)}function w(t){0==t.a&&t.c&&(t.c(),t.c=null)}function T(t){this.a=t||"-"}function S(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function b(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function k(t){return t.a+t.f}function P(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function O(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function M(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new T("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function _(t){if(t.g){var e=g(t.f,t.a.c("wf","active")),i=[],s=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),p(t.f,i,s)}C(t,"inactive")}function C(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,k(i)):t.h[e]())}function G(){this.c={}}function E(t,e){this.c=t,this.f=e,this.a=d(this.c,"span",{"aria-hidden":"true"},this.f)}function A(t){u(t.c,"body",t.a)}function L(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(t.c)+";font-style:"+P(t)+";font-weight:"+t.f+"00;"}function I(t,e,i,s,n,r){this.g=t,this.j=e,this.a=s,this.c=i,this.f=n||3e3,this.h=r||void 0}function W(t,e,i,s,n,r,a){this.v=t,this.B=e,this.c=i,this.a=s,this.s=a||"BESbswy",this.f={},this.w=n||3e3,this.u=r||null,this.m=this.j=this.h=this.g=null,this.g=new E(this.c,this.s),this.h=new E(this.c,this.s),this.j=new E(this.c,this.s),this.m=new E(this.c,this.s),t=L(t=new S(this.a.c+",serif",k(this.a))),this.g.a.style.cssText=t,t=L(t=new S(this.a.c+",sans-serif",k(this.a))),this.h.a.style.cssText=t,t=L(t=new S("serif",k(this.a))),this.j.a.style.cssText=t,t=L(t=new S("sans-serif",k(this.a))),this.m.a.style.cssText=t,A(this.g),A(this.h),A(this.j),A(this.m)}T.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},I.prototype.start=function(){var t=this.c.o.document,e=this,i=h(),s=new Promise((function(s,n){!function r(){h()-i>=e.f?n():t.fonts.load(function(t){return P(t)+" "+t.f+"00 300px "+b(t.c)}(e.a),e.h).then((function(t){1<=t.length?s():setTimeout(r,25)}),(function(){n()}))}()})),n=null,r=new Promise((function(t,i){n=setTimeout(i,e.f)}));Promise.race([r,s]).then((function(){n&&(clearTimeout(n),n=null),e.g(e.a)}),(function(){e.j(e.a)}))};var F={D:"serif",C:"sans-serif"},R=null;function j(){if(null===R){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);R=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return R}function B(t,e,i){for(var s in F)if(F.hasOwnProperty(s)&&e===t.f[F[s]]&&i===t.f[F[s]])return!0;return!1}function N(t){var e,i=t.g.a.offsetWidth,s=t.h.a.offsetWidth;(e=i===t.f.serif&&s===t.f["sans-serif"])||(e=j()&&B(t,i,s)),e?h()-t.A>=t.w?j()&&B(t,i,s)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?z(t,t.v):z(t,t.B):function(t){setTimeout(a((function(){N(this)}),t),50)}(t):z(t,t.v)}function z(t,e){setTimeout(a((function(){c(this.g.a),c(this.h.a),c(this.j.a),c(this.m.a),e(this.a)}),t),0)}function D(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}W.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=h(),N(this)};var Y=null;function X(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&p(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),C(t,"active")):_(t.a))}function H(t){this.j=t,this.a=new G,this.h=0,this.f=this.g=!0}function q(t,e,i,s,n){var r=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=n||null,h=s||{};if(0===i.length&&r)_(e.a);else{e.f+=i.length,r&&(e.j=r);var o,l=[];for(o=0;o<i.length;o++){var d=i[o],u=h[d.c],c=e.a,g=d;if(c.g&&p(c.f,[c.a.c("wf",g.c,k(g).toString(),"loading")]),C(c,"fontloading",g),c=null,null===Y)if(window.FontFace){g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Y=g?42<parseInt(g[1],10):!f}else Y=!1;c=Y?new I(a(e.g,e),a(e.h,e),e.c,d,e.s,u):new W(a(e.g,e),a(e.h,e),e.c,d,e.s,t,u),l.push(c)}for(o=0;o<l.length;o++)l[o].start()}}),0)}function U(t,e){this.c=t,this.a=e}function K(t,e){this.c=t,this.a=e}function V(t,e){this.c=t||J,this.a=[],this.f=[],this.g=e||""}D.prototype.g=function(t){var e=this.a;e.g&&p(e.f,[e.a.c("wf",t.c,k(t).toString(),"active")],[e.a.c("wf",t.c,k(t).toString(),"loading"),e.a.c("wf",t.c,k(t).toString(),"inactive")]),C(e,"fontactive",t),this.m=!0,X(this)},D.prototype.h=function(t){var e=this.a;if(e.g){var i=g(e.f,e.a.c("wf",t.c,k(t).toString(),"active")),s=[],n=[e.a.c("wf",t.c,k(t).toString(),"loading")];i||s.push(e.a.c("wf",t.c,k(t).toString(),"inactive")),p(e.f,s,n)}C(e,"fontinactive",t),X(this)},H.prototype.load=function(t){this.c=new o(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var s=[],n=i.timeout;!function(t){t.g&&p(t.f,[t.a.c("wf","loading")]),C(t,"loading")}(e);s=function(t,e,i){var s,n=[];for(s in e)if(e.hasOwnProperty(s)){var r=t.c[s];r&&n.push(r(e[s],i))}return n}(t.a,i,t.c);var r=new D(t.c,e,n);for(t.h=s.length,e=0,i=s.length;e<i;e++)s[e].load((function(e,i,s){q(t,r,e,i,s)}))}(this,new M(this.c,t),t)},U.prototype.load=function(t){var e=this,i=e.a.projectId,s=e.a.version;if(i){var n=e.c.o;m(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),(function(s){s?t([]):(n["__MonotypeConfiguration__"+i]=function(){return e.a},function e(){if(n["__mti_fntLst"+i]){var s,r=n["__mti_fntLst"+i](),a=[];if(r)for(var h=0;h<r.length;h++){var o=r[h].fontfamily;null!=r[h].fontStyle&&null!=r[h].fontWeight?(s=r[h].fontStyle+r[h].fontWeight,a.push(new S(o,s))):a.push(new S(o))}t(a)}else setTimeout((function(){e()}),50)}())})).id="__MonotypeAPIScript__"+i}else t([])},K.prototype.load=function(t){var e,i,s=this.a.urls||[],n=this.a.families||[],r=this.a.testStrings||{},a=new v;for(e=0,i=s.length;e<i;e++)f(this.c,s[e],y(a));var h=[];for(e=0,i=n.length;e<i;e++)if((s=n[e].split(":"))[1])for(var o=s[1].split(","),l=0;l<o.length;l+=1)h.push(new S(s[0],o[l]));else h.push(new S(s[0]));x(a,(function(){t(h,r)}))};var J="https://fonts.googleapis.com/css";function $(t){this.f=t,this.a=[],this.c={}}var Q={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},tt={i:"i",italic:"i",n:"n",normal:"n"},et=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function it(t,e){this.c=t,this.a=e}var st={Arimo:!0,Cousine:!0,Tinos:!0};function nt(t,e){this.c=t,this.a=e}function rt(t,e){this.c=t,this.f=e,this.a=[]}it.prototype.load=function(t){var e=new v,i=this.c,s=new V(this.a.api,this.a.text),n=this.a.families;!function(t,e){for(var i=e.length,s=0;s<i;s++){var n=e[s].split(":");3==n.length&&t.f.push(n.pop());var r="";2==n.length&&""!=n[1]&&(r=":"),t.a.push(n.join(r))}}(s,n);var r=new $(n);!function(t){for(var e=t.f.length,i=0;i<e;i++){var s=t.f[i].split(":"),n=s[0].replace(/\+/g," "),r=["n4"];if(2<=s.length){var a;if(a=[],h=s[1])for(var h,o=(h=h.split(",")).length,l=0;l<o;l++){var d;if((d=h[l]).match(/^[\w-]+$/))if(null==(c=et.exec(d.toLowerCase())))d="";else{if(d=null==(d=c[2])||""==d?"n":tt[d],null==(c=c[1])||""==c)c="4";else var u=Z[c],c=u||(isNaN(c)?"4":c.substr(0,1));d=[d,c].join("")}else d="";d&&a.push(d)}0<a.length&&(r=a),3==s.length&&(a=[],0<(s=(s=s[2])?s.split(","):a).length&&(s=Q[s[0]])&&(t.c[n]=s))}for(t.c[n]||(s=Q[n])&&(t.c[n]=s),s=0;s<r.length;s+=1)t.a.push(new S(n,r[s]))}}(r),f(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],s=0;s<e;s++)i.push(t.a[s].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(s),y(e)),x(e,(function(){t(r.a,r.c,st)}))},nt.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],n=0;n<e.length;n+=2)for(var r=e[n],a=e[n+1],h=0;h<a.length;h++)s.push(new S(r,a[h]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(s)}}),2e3):t([])},rt.prototype.load=function(t){var e=this.f.id,i=this.c.o,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,r=i.fonts.length;n<r;++n){var a=i.fonts[n];s.a.push(new S(a.name,O("font-weight:"+a.weight+";font-style:"+a.style)))}t(s.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var at=new H(window);at.a.c.custom=function(t,e){return new K(e,t)},at.a.c.fontdeck=function(t,e){return new rt(e,t)},at.a.c.monotype=function(t,e){return new U(e,t)},at.a.c.typekit=function(t,e){return new nt(e,t)},at.a.c.google=function(t,e){return new it(e,t)};var ht={load:a(at.load,at)};void 0===(s=function(){return ht}.call(e,i,e,t))||(t.exports=s)}()},function(t,e,i){"use strict";i.r(e);var s=class extends Phaser.Scene{constructor(){super("TitleScene")}preload(){this.load.image("background","assets/images/background.png"),this.load.image("title","assets/images/title.png"),this.load.image("start","assets/images/start.png"),this.load.image("start-active","assets/images/start_active.png"),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.audio("select","assets/sounds/select.wav")}create(){const t=this;this.add.image(400,330,"background");const e=this.add.graphics({fillStyle:{color:16777215}});e.setAlpha(0);const i=new Phaser.Geom.Rectangle(0,0,800,700);e.fillRectShape(i);const s=[];s.push({imageKey:"tile_01",xChange:"+=180",yChange:"+=180",angle:15,scale:.8}),s.push({imageKey:"tile_02",xChange:"+=200",yChange:"-=180",angle:15,scale:1}),s.push({imageKey:"tile_03",xChange:"-=180",yChange:"+=180",angle:-15,scale:.9}),s.push({imageKey:"tile_04",xChange:"-=200",yChange:"-=180",angle:-5,scale:.8}),s.push({imageKey:"tile_01",xChange:"+=0",yChange:"-=180",angle:-15,scale:.7}),s.push({imageKey:"tile_02",xChange:"+=0",yChange:"+=180",angle:-15,scale:1}),s.push({imageKey:"tile_03",xChange:"+=290",yChange:"+=30",angle:15,scale:.8}),s.push({imageKey:"tile_01",xChange:"-=290",yChange:"+=40",angle:-15,scale:.9}),s.forEach(e=>{e.tile=t.add.image(400,230,e.imageKey),e.tile.setAlpha(0),e.tile.setScale(.5,.5)});const n=this.add.image(400,230,"title");n.setAlpha(0),n.setScale(2,2);const r=this.add.image(400,550,"start");r.setInteractive({cursor:"pointer"}),r.setAlpha(0);const a=this.add.image(400,550,"start");a.setAlpha(0),a.setTintFill(16777215);const h=this.add.image(400,550,"start-active");h.setAlpha(0),r.on("pointerover",()=>{t.tweens.add({targets:h,alpha:1,duration:100,ease:"Sine.easeInOut"})}),r.on("pointerout",()=>{t.tweens.add({targets:h,alpha:0,duration:100,ease:"Sine.easeInOut"})}),this.selectSound=this.sound.add("select"),r.on("pointerdown",()=>{this.selectSound.play(),t.scene.transition({target:"RoundScene",data:{level:0},remove:!0})});const o=this.tweens.createTimeline();o.add({delay:400,targets:n,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Quad.easeIn"}),s.forEach((t,e)=>{o.add({targets:t.tile,x:t.xChange,y:t.yChange,scaleX:1,scaleY:1,alpha:1,scaleX:t.scale,scaleY:t.scale,angle:t.angle,duration:300,ease:"Quad.easeOut",offset:0===e?"-=0":"-=300"})}),o.add({targets:e,alpha:1,duration:30,offset:"-=300"}),o.add({targets:e,alpha:0,duration:700,offset:1500,ease:"Quad.easeIn"}),o.add({targets:[r,a],alpha:1,offset:2200,duration:100}),o.add({targets:a,alpha:0,duration:300,offset:2300,ease:"Quad.easeOut"}),o.play()}},n={getScript(t){switch(t){case 0:return["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)",{do:"updateGuideExpression",value:"sadness"},"The Dew Drop Kingdom is in trouble!",{do:"updateGuideExpression",value:"despair"},"We lost all of our dew drops and now we'll starve!",{do:"updateGuideExpression",value:"surprise"},{do:"dropTiles"},"But you can help us by collecting as many dew drops as you can!",{do:"updateGuideExpression",value:"default"},"If you match three or more dew drops of the same color, we can collect them!",{do:"unblockTileGrid"},"To make a match, select two dew drops and swap their places!",{on:"firstMatch",actions:["You got it! That's it!","See if you can collect 100 dew drops!"]}];case 1:return["*Oh, doozle!* You're so good at this!","But, we'll have to hurry this time!",{do:"dropTiles"},"We only have two minutes before the sun dries up all the dew drops!","Collect at least 200 dew drops in two minutes!",{do:"unblockTileGrid"},{do:"startTimer"}];case 2:return["Wow, we're so proud of you!","This round you'll only have 30 seconds to collect at least 300 dew drops!",{on:"gameOver",actions:["Wait, wait, sorry, hold on.",'It\'s too early for the *"Lose in a Panic"* scenario.',"So sorry about that.","You've been really great so far, honestly.","You know, what, let's just go to the next round and we'll take it from the top."]}]}}},r={color:"#000",fontFamily:'"Baloo Thambi 2"',googleFontName:"Baloo Thambi 2:500;700",fontSize:"30px"},a=class{constructor(){this.subscriptions=[]}on(t,e){this.subscriptions.push({eventName:t,callback:e})}emit(t){this.subscriptions.filter(e=>e.eventName===t).forEach(t=>{t.callback&&t.callback(),t.callback=null})}},h=i(0),o=i.n(h),l=i(1),d=i.n(l),u={renderWebGL:o.a,renderCanvas:d.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const c=Phaser.Display.Canvas.CanvasPool;var p=function(t){var e=c.create(this),i=e.getContext("2d");t.syncFont(e,i);var s=Math.ceil(i.measureText(t.testString).width*t.baselineX),n=s,r=2*n;n=n*t.baselineY|0,e.width=s,e.height=r,i.fillStyle="#f00",i.fillRect(0,0,s,r),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,n);var a={ascent:0,descent:0,fontSize:0};if(!i.getImageData(0,0,s,r))return a.ascent=n,a.descent=n+6,a.fontSize=a.ascent+a.descent,c.remove(e),a;var h,o,l=i.getImageData(0,0,s,r).data,d=l.length,u=4*s,p=0,g=!1;for(h=0;h<n;h++){for(o=0;o<u;o+=4)if(255!==l[p+o]){g=!0;break}if(g)break;p+=u}for(a.ascent=n-h,p=d-u,g=!1,h=r;h>n;h--){for(o=0;o<u;o+=4)if(255!==l[p+o]){g=!0;break}if(g)break;p-=u}return a.descent=h-n,a.fontSize=a.ascent+a.descent,c.remove(e),a},g={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const f=Phaser.Utils.Objects.GetAdvancedValue,m=Phaser.Utils.Objects.GetValue;var v={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const y={none:g.NO_WRAP,word:g.WORD_WRAP,char:g.CHAR_WRAP,character:g.CHAR_WRAP};var x=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=m(e,"metrics",!1);this.metrics=i?{ascent:m(i,"ascent",0),descent:m(i,"descent",0),fontSize:m(i,"fontSize",0)}:p(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=y[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var n in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),v)this[n]="wrapCallback"===n||"wrapCallbackScope"===n?m(t,v[n][0],v[n][1]):f(t,v[n][0],v[n][1]);var r=m(t,"font",null);this._font=null===r?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:r;var a=m(t,"fill",null);return null!==a&&(this.color=a),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=p(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=m(t,"fontFamily","Courier"),this.fontSize=m(t,"fontSize","16px"),this.fontStyle=m(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,s,n,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===n&&(n=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=n,this.shadowFill=r,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=y[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in v)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}},w={draw(t,e,i,s){var n=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save(),this.drawBackground(this.defatultStyle.backgroundColor);var a=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var h,o,l,d,u,c,p=a.halign,g=a.valign,f=a.lineHeight,m=n.lines,v=m.length,y=a.maxLines;y>0&&v>y?(o=y,l="center"===g?Math.floor((v-o)/2):"bottom"===g?v-o:0):(o=v,l=0),d=l+o,c="center"===g?Math.max((s-o*f)/2,0):"bottom"===g?Math.max(s-o*f-2,0):0,c+=e;for(var x=l;x<d;x++)if(0!==(h=n.getLineWidth(x))){u="center"===p?(i-h)/2:"right"===p?i-h:0,u+=t;for(var w=m[x],T=0,S=w.length;T<S;T++)this.drawPen(w[T],u,c)}r.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var s=this.canvas,n=this.context;n.save();var r=this.parser.propToContextStyle(this.defatultStyle,t.prop);r.buildFont(),r.syncFont(s,n),r.syncStyle(s,n),r.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,r),t.isTextPen&&this.drawText(e,i,t.text,r),t.isImagePen&&this.drawImage(e,i,t.prop.img,r),n.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,s){e+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context,r=n.lineCap;n.lineCap="butt",n.beginPath(),n.strokeStyle=s.underlineColor,n.lineWidth=s.underlineThickness,n.moveTo(t,e),n.lineTo(t+i,e),n.stroke(),n.lineCap=r},drawText(t,e,i,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context;s.strokeThickness&&(s.syncShadow(n,s.shadowStroke),n.strokeText(i,t,e)),s.color&&"none"!==s.color&&(s.syncShadow(n,s.shadowFill),n.fillText(i,t,e))},drawImage(t,e,i,s){var n=this.parent.imageManager,r=n.get(i),a=n.getFrame(i);t+=r.left,e+=-this.startYOffset+r.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,t,e,r.width,r.height)}};var T=class{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}};const S=Phaser.Utils.Objects.GetValue,b=g.NO_NEWLINE,k=g.RAW_NEWLINE;var P=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=S(t,"text",""),this.x=S(t,"x",0),this.y=S(t,"y",0),this.width=S(t,"width",0);var e=S(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=S(t,"newLineMode",0),this.startIndex=S(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===k&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==b&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===k&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},O=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]},M=function(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:O(e),i){e.length=t.length;for(var s=0,n=t.length;s<n;s++)e[s]=t[s]}else for(var r in t)e[r]=t[r];return e},_=function(){};const C=Phaser.Utils.Objects.GetFastValue,G=g.NO_NEWLINE,E=g.WRAPPED_NEWLINE;var A=new T,L=new T;class I{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=C(t,"pensPool",A),this.LinesPool=C(t,"linesPool",L),this.tagToText=C(t,"tagToText",_),this.tagToTextScope=C(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,s,n,r){var a=this.PensPool.pop();return null==a&&(a=new P),W.text=t,W.x=e,W.y=i,W.width=s,W.prop=n,W.newLineMode=r,a.resetFromJSON(W),this.addPen(a),this}addImagePen(t,e,i,s){return this.addTextPen("",t,e,i,s,G),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,s=t?M(t.prop):null;return this.addTextPen("",e,i,0,s,E),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==G&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new I),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var s=this.lines[e],n=0,r=s.length;n<r;n++){var a=s[n];t.addPen(a.text,a.x,a.y,a.width,M(a.prop),a.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,s=!1;for(e=t;e>=0&&!(s=null!=(i=this.lines[e])&&i.length>0);e--);return s?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,s=this.lines.length;i<s;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,s=e.length;i<s;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,s=this.pens.length;i<s;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var s=this.lastPen;if(null==s)return"";e=s.endIndex}void 0===i&&(i=!1);for(var n,r,a,h,o,l,d="",u=0,c=this.pens.length;u<c&&((h=(n=this.pens[u]).endIndex)<=t||(n=this.pens[u],r=i?n.wrapText:n.plainText,o=n.prop,(a=n.startIndex)>=t&&h<=e||(r=r.substring(t-a,e-a)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,r,o,l):d+=this.tagToText(r,o,l),l=o,!(h>=e)));u++);return d}}var W={},F=I;const R=Phaser.Geom.Rectangle;var j=new T;var B=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return j.pushMultiple(this.hitAreas),this}add(t,e,i,s,n){var r=j.pop();return null===r?r=new R(e,i,s,n):r.setTo(e,i,s,n),r.key=t,this.hitAreas.push(r),this}getFirstHitArea(t,e){for(var i,s=this.hitAreas,n=0,r=s.length;n<r;n++)if((i=s[n]).contains(t,e))return i;return null}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,n=this.hitAreas,r=0,a=n.length;r<a;r++)s=n[r],t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height);return i&&t.restore(),this}},N=function(t,e,i,s){var n=this.hitAreaManager.getFirstHitArea(i,s);if(null!==n){var r=n.key;this.parent.emit(`${t}-${r}`,e,i,s),this.parent.emit(t,r,e,i,s)}},z=function(){this.parent.on("pointerdown",(function(t,e,i,s){N.call(this,"areadown",t,e,i)}),this).on("pointerup",(function(t,e,i,s){N.call(this,"areaup",t,e,i)}),this)};const D=g.NO_NEWLINE,Y=g.RAW_NEWLINE,X=g.WRAPPED_NEWLINE,H=g.NO_WRAP,q=g.WORD_WRAP,U=g.SPLITREGEXP;var K=[],V=new T;V.newline=function(t,e,i){var s=this.pop();return null===s&&(s={}),s.text=t,s.width=e,s.newLineMode=i,s};var J=function(t,e,i,s,n){s<=0&&(i=H);var r=K;if(V.pushMultiple(r),!t||!t.length)return r;for(var a,h,o,l=t.split(U),d=0,u=l.length;d<u;d++)if(a=l[d],o=d===u-1?D:Y,i!==H){var c,p;if(h=0===d?s-n:s,a.length<=100)if((w=e(a))<=h){r.push(V.newline(a,w,o));continue}for(var g,f="",m="",v=0,y=0,x=(c=i===q?a.split(" "):a).length;y<x;y++)p=c[y],i===q?(f+=p,y<x-1&&(f+=" ")):f+=p,(g=e(f))>h&&(0===y?r.push(V.newline("",0,X)):(r.push(V.newline(m,v,X)),f=p,i===q&&y<x-1&&(f+=" "),g=e(f)),h=s),m=f,v=g;r.push(V.newline(m,v,o))}else{var w=e(a);r.push(V.newline(a,w,o))}return r};const $=Phaser.Utils.Objects.GetValue,Q=g.NO_WRAP,Z=g.NO_NEWLINE;class tt{constructor(t){this.parent=t.parent,this.context=$(t,"context",null),this.canvas=this.context.canvas,this.parser=$(t,"parser",null),this.defatultStyle=$(t,"style",null),this.autoRound=!0,this.pensPool=$(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new B;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,s,n){if(void 0===n&&(n=this.penManager),n.freePens(),""===t)return n;for(var r,a,h,o,l,d=this.canvas,u=this.context,c=0,p=0,g=this.parser.splitText(t),f=0,m=g.length;f<m;f++)if(r=(o=this.parser.tagTextToProp(g[f],a)).plainText,(a=o.prop).img){var v=this.imageManager.getOuterWidth(a.img);i>0&&e!==Q&&i<c+v&&(n.addNewLinePen(),p+=s,c=0),n.addImagePen(c,p,v,M(a)),c+=v}else if(""!==r){var y;this.context.save(),(h=this.parser.propToContextStyle(this.defatultStyle,a)).buildFont(),h.syncFont(d,u),h.syncStyle(d,u);for(var x=0,w=(l=J(r,this.getTextWidth,e,i,c)).length;x<w;x++)y=l[x],n.addTextPen(y.text,c,p,y.width,M(a),y.newLineMode),y.newLineMode!==Z?(c=0,p+=s):c+=y.width;this.context.restore()}return n}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new F({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var s;if(null==t)s=this.penManager.plainText;else{var n=this.parser.splitText(t,1);s="";for(var r=0,a=n.length;r<a;r++)s+=n[r]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=s.length),s=s.substring(e,i)),s}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,s){if(null==t)return this.penManager.getSliceTagText(e,i,s);var n=this.tmpPenManager,r=this.defatultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,n),n.getSliceTagText(e,i,s)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var et={setInteractive:z};Object.assign(tt.prototype,w,et);var it=tt;const st=Phaser.Utils.Objects.GetValue;var nt,rt=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,s=(n=t).length;i<s;i++)this._add(n[i]);else{var n=t;for(var t in n)this._add(t,n[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,s=e.frame,n=e.width,r=e.height;if(void 0===n||void 0===r){var a=this.textureManager.getFrame(i,s),h=a?a.cutWidth:0,o=a?a.cutHeight:0;void 0===n&&void 0===r?(n=h,r=o):void 0===n?n=h*(r/o):void 0===r&&(r=o*(n/h))}this.images[t]={key:i,frame:s,width:n,height:r,y:st(e,"y",0),left:st(e,"left",0),right:st(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}};const at=Phaser.DOM.AddToDOM,ht=Phaser.Display.Canvas.CanvasPool,ot=Phaser.GameObjects.GameObject,lt=Phaser.Utils.Objects.GetValue,dt=Phaser.DOM.RemoveFromDOM,ut=g.SPLITREGEXP;var ct={};class pt extends ot{constructor(t,e,i,s,n,r,a){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,r),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=ht.create(this),this.context=this.canvas.getContext("2d"),n){if(n.hasOwnProperty("align")){var h=n.align;delete n.align,n.halign=h}n.hasOwnProperty("stroke")&&!n.hasOwnProperty("strokeThickness")&&(n.strokeThickness=1)}this.style=new x(this,n),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),ct.hasOwnProperty(r)||(ct[r]=new T),this.canvasText=new it({parent:this,context:this.context,parser:a,style:this.style,pensPool:ct[r]}),n&&n.padding&&this.setPadding(n.padding),this.setText(s),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",at(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,s,n,r){return this.style.setShadow(t,e,i,s,n,r)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,s){if("object"==typeof t){var n=t,r=lt(n,"x",null);null!==r?(t=r,i=r):(t=lt(n,"left",0),i=lt(n,"right",t));var a=lt(n,"y",null);null!==a?(e=a,s=a):(e=lt(n,"top",0),s=lt(n,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===s&&(s=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,n,r=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+r.left+r.right,s=e.linesWidth):(this.width=i.fixedWidth,(s=this.width-r.left-r.right)<e.linesWidth&&(s=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,n=e.linesHeight):(this.height=i.fixedHeight,(n=this.height-r.top-r.bottom)<e.linesHeight&&(n=e.linesHeight));var a=this.width,h=this.height;this.updateDisplayOrigin();var o=i.resolution;a*=o,h*=o,a=Math.max(Math.ceil(a),1),h=Math.max(Math.ceil(h),1);var l=this.canvas,d=this.context;l.width!==a||l.height!==h?(l.width=a,l.height=h,this.frame.setSize(a,h)):d.clearRect(0,0,a,h),d.save(),d.scale(o,o),e.draw(r.left,r.top,s,n),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=gt.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&dt(this.canvas),ht.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return ot.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(ut)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return t=this.scene.textures,void 0===nt&&(nt=new rt(t)),nt;var t}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const gt=Phaser.GameObjects.Components;Phaser.Class.mixin(pt,[gt.Alpha,gt.BlendMode,gt.ComputedSize,gt.Crop,gt.Depth,gt.Flip,gt.GetBounds,gt.Mask,gt.Origin,gt.Pipeline,gt.ScrollFactor,gt.Tint,gt.Transform,gt.Visible,u]);var ft=pt,mt={plainText:null,prevProp:null},vt=new x;var yt=function(t){for(var e,i,s,n={},r=0,a=(t=t.split(";")).length;r<a;r++)if(i=(e=t[r].split(":"))[0],s=e[1],!xt(i)&&!xt(s)){switch(i){case"stroke":var h=s.split(" ");s={},(l=h.length)>=1&&(s.color=h[0]),l>=2&&(s.thinkness=parseInt(h[1].replace("px","")));break;case"shadow":var o=s.split(" ");s={},(l=o.length)>=1&&(s.color=o[0]),l>=2&&(s.offsetX=parseInt(o[1].replace("px",""))),l>=3&&(s.offsetY=parseInt(o[2].replace("px",""))),l>=4&&(s.blur=parseInt(o[3].replace("px","")));break;case"u":case"underline":var l,d=s.split(" ");s={},(l=d.length)>=1&&(s.color=d[0]),l>=2&&(s.thinkness=parseInt(d[1].replace("px",""))),l>=3&&(s.offset=parseInt(d[2].replace("px","")))}n[i]=s}return n},xt=function(t){return 0===(t=t.replace(Pt,"")).length},wt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Tt=/<\s*class=/i,St=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,bt=/<\s*style=/i,kt=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Pt=/^\s+|\s+$/,Ot=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,s,n,r=[],a=0,h=t.length,o=h;i=wt.exec(t);)s=i[0],a<(o=wt.lastIndex-s.length)&&r.push(t.substring(a,o)),void 0===e?r.push(s):1===e&&(Tt.test(s)?(n=s.match(St),r.push(n[2])):bt.test(s)&&(n=s.match(kt),r.push(n[2]))),a=wt.lastIndex;return a<h&&r.push(t.substring(a,h)),r}tagTextToProp(t,e){var i,s;if(Tt.test(t)){if(null!=(a=t.match(St))){var n=a[1],r=this.tags;(s=r.hasOwnProperty(n)?r[n]:{})._class=n,i=a[2]}}else if(bt.test(t)){var a;if(null!=(a=t.match(kt))){var h=a[1];(s=yt(h))._style=h,i=a[2]}}null==i&&(i=t),null==s&&(s={});var o=mt;return o.plainText=i,o.prop=s,o}propToContextStyle(t,e){var i=vt;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var s=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=s}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var n=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof n&&(n=n.toString()+"px"),i.fontSize=n}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var r=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=r}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){var a=e.hasOwnProperty("color")?e.color:e["font-color"];i.color=a}else i.color=t.color;if(e.hasOwnProperty("stroke")){var h=e.stroke;i.stroke=h.hasOwnProperty("color")?h.color:t.stroke,i.strokeThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var o=e.shadow;i.shadowColor=o.hasOwnProperty("color")?o.color:t.shadowColor,i.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:t.shadowOffsetX,i.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:t.shadowOffsetY,i.shadowBlur=o.hasOwnProperty("blur")?o.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var l=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=l.hasOwnProperty("color")?l.color:t.underlineColor,i.underlineThickness=l.hasOwnProperty("thinkness")?l.thinkness:t.underlineThickness,i.underlineOffset=l.hasOwnProperty("offset")?l.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const Mt=Phaser.Utils.Objects.GetValue;var _t=class extends ft{constructor(t,e,i,s,n){var r=Mt(n,"tags",void 0),a=new Ot(r);super(t,e,i,s,n,"rexTagText",a),this.parser=a}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const Ct=Phaser.Utils.Objects.GetAdvancedValue,Gt=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(t,e,i,s){var n=new _t(this.scene,t,e,i,s);return this.scene.add.existing(n),n})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(t,e){var i=Ct(t,"text",""),s=Ct(t,"style",null),n=Ct(t,"padding",null);null!==n&&(s.padding=n),void 0!==e&&(t.add=e);var r=new _t(this.scene,0,0,i,s);return Gt(this.scene,r,t),r.autoRound=Ct(t,"autoRound",!0),r.resolution=Ct(t,"resolution",1),r}));var Et=_t,At={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const Lt=Phaser.Scene;var It=function(t){return t instanceof Lt},Wt=function(t){return It(t)?t:t.scene&&It(t.scene)?t.scene:t.parent&&t.parent.scene&&It(t.parent.scene)?t.parent.scene:void 0};const Ft=Phaser.Utils.Objects.GetFastValue,Rt=Phaser.Utils.Objects.GetValue;class jt{constructor(t,e){this.gameObject=t,this.scene=Wt(t),this.setEventEmitter(Rt(e,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(Rt(t,"typeMode",0)),this.setTypeSpeed(Rt(t,"speed",333)),this.setTextCallback=Ft(t,"setTextCallback",null),this.setTextCallbackScope=Ft(t,"setTextCallbackScope",null),this.typingIdx=Ft(t,"typingIdx",0),this.text=Bt(Ft(t,"text","")),this.textLen=Ft(t,"textLen",0),this.insertIdx=Ft(t,"insertIdx",null);var e=Ft(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.on("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=Nt[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,i,s){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(s),this}appendText(t){var e=this.text.concat(Bt(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=Bt(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,i,s){var n;if(0===s){var r=0,a=e;this.insertIdx=a,n=this.getSubString(t,r,a)}else if(1===s){r=(a=i)-e;this.insertIdx=0,n=this.getSubString(t,r,a)}else if(2===s){var h=i/2;a=(r=Math.floor(h-e/2))+e;this.insertIdx=e%2?e:0,n=this.getSubString(t,r,a)}else if(3===s){var o,l=Math.floor(e/2);if(l>0){r=(a=i)-l;o=this.getSubString(t,r,a)}else o="";var d,u=e-l;if(u>0){a=(r=0)+u;this.insertIdx=a,d=this.getSubString(t,r,a)}else d="",this.insertIdx=0;n=d+o}return n}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?(0,e=0):(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,i){var s=this.gameObject;return s.getSubString?s.getSubString(t,e,i):t.slice(e,i)}}Object.assign(jt.prototype,At);var Bt=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const Nt={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var zt=jt,Dt=class extends a{constructor(t,e,i){super(),this.x=t,this.y=e,this.isIntro=i,this.queuedActions=null,this.isPaused=!1,this.isBlockingGameplay=!1,this.endDialogueMarkerGraphics=null,this.characterExpression=null,this.expressions={},this.expressions.default={y:-90},this.expressions.surprise={y:-100},this.expressions.sadness={y:-80},this.expressions.despair={y:-70}}create(t){const e=this,i=t.add.graphics({fillStyle:{color:16777215}});this.isIntro&&i.setAlpha(0);const s=this.isIntro?this.y-40:this.y,n=this.isIntro?this.y+130+20-40:this.y+130+20,a=this.isIntro?this.y+130-40:this.y+130;i.setDepth(1),i.fillRoundedRect(this.x,s,760,130,10),i.fillTriangle(this.x+120,n,this.x+105,a,this.x+135,a),this.endDialogueMarkerGraphics=t.add.graphics({fillStyle:{color:13421772}}),this.endDialogueMarkerGraphics.setDepth(1),this.hideEndDialogueMarker();const h=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(h),t.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const o=r;o.wrap={mode:"word",width:730},o.tags={exclamation:{fontStyle:"bold"}},this.speechBubbleText=new Et(t,this.x+15,this.y+15,"",o),this.speechBubbleText.setDepth(1),t.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new zt(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{e.messageCompleted.call(e)});const l=this.isIntro?this.x-250:this.x+125,d=t.add.container(l,this.y+130+230),u=t.add.image(0,0,"guide_character");d.add(u);const c=this.isIntro?"expression_surprise":"expression_default",p=this.isIntro?this.expressions.surprise.y:this.expressions.default.y;this.characterExpression=t.add.sprite(-10,p,c),d.add(this.characterExpression);const g=t.tweens.createTimeline();this.isIntro?(g.add({delay:200,targets:d,x:this.x+125,duration:400,angle:15,ease:"Power1"}),g.add({targets:d,duration:400,angle:-7,ease:"Power1"}),g.add({targets:d,duration:400,angle:0,ease:"Power1"}),g.add({offset:"-=300",targets:i,props:{y:{value:"+=40",duration:500,ease:"Bounce.easeOut"},alpha:{value:1,duration:300,ease:"Linear"}},onComplete:()=>{this.emit("ready")}})):g.add({targets:i,duration:100,onComplete:()=>{this.emit("ready")}}),g.play()}displayMessage(t){this.hideEndDialogueMarker();const e=this.convertDialogToTagText(t);this.speechBubbleTextTyping.start(e)}messageCompleted(){this.showEndDialogueMarker()}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}updateExpression(t,e){this.characterExpression.setTexture("expression_"+t);const i=this.expressions[t];e.tweens.add({targets:this.characterExpression,y:i.y,duration:200,ease:"Power1"})}convertDialogToTagText(t){const e=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let i="",s="";for(let n=0;n<t.length;n++){const r=t[n],a=e.some(t=>t.token===r);if(0!==n||a||(i+='<class="normal">',s="normal"),n!==t.length-1||!a)if(a){const t=e.find(t=>t.token===r);s===t.className?(i+="</class>",i+='<class="normal">',s="normal"):(0!==n&&(i+="</class>"),i+=`<class="${t.className}">`,s=t.className)}else i+=t[n]}return i+="</class>",i}},Yt=0,Xt=1,Ht=2,qt=[{score:100,behavior:Yt},{score:200,timer:120,behavior:Yt},{score:300,timer:30,behavior:Ht},{score:300,timer:120,behavior:Xt},{score:400,timer:300,behavior:Xt,handler:t=>{t.tileGrid.TileGenerationBehavior!==Ht&&t.score>qt[t.level]/2&&(t.tileGrid.tileGenerationBehavior=Ht)}},{score:1e3,timer:300,behavior:Ht},{score:1e3,timer:300,behavior:Ht},{score:1e3,timer:300,behavior:Xt},{score:1e3,timer:300,behavior:Yt}];const Ut=t=>t[Math.floor(Math.random()*t.length)];var Kt=0,Vt=1,Jt=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],$t=class extends a{constructor(t,e,i,s,n,r,a,h,o){super(),this.isInitialized=!1,this.isBlocked=!0,this.offsetX=s,this.offsetY=n,this.tileSize=i,this.tileGridHeight=e,this.tileGridWidth=t,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=r,this.onTileMatch=a,this.tileGenerationBehavior=h,this.matchSound=null,this.queue=o;for(let i=0;i<2*e;i++){this.tileGrid[i]=[];for(let e=0;e<t;e++)this.tileGrid[i][e]=null}}create(t){this.tileImageContainer=t.add.container();const e=t.make.graphics();e.fillStyle(16777215,1),e.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(t,e),this.matchSound=t.sound.add("match")}update(t){const e=this;if(!e.isInitialized)return;const i=e.getMatches();i.length>0&&(e.onTileMatch(t,i),e.emit("match"));let s=[];if(i.forEach(e=>{s.push(e.destroy(t,this.tileImageContainer))}),s.length>0&&(e.matchSound.play(),e.queue.push(()=>Promise.all(s))),e.forEachTile((t,i,s)=>{null!==t&&t.state===Vt&&(e.tileGrid[s][i]=null)}),s.length>0)return;let n=[];for(let i=0;i<this.tileGridWidth;i++){let s=2*this.tileGridHeight-1;for(;s>=0;){if(null===e.tileGrid[s][i]){let r=s-1;for(;r>=0;){let a=e.tileGrid[r][i];null!==a&&(e.tileGrid[s][i]=a,e.tileGrid[r][i]=null,n.push(this.getTileDrop(t,a,i,s)),s--),r--}}s--}}e.forEachPlayableTile((i,s,n)=>{if(null===i){const i=n-e.tileGridHeight,r=e.createTile(e.getTileType(s,n,e.tileGenerationBehavior),s,i,!1);e.tileGrid[i][s]=r,r.create(t),e.tileImageContainer.add(r.image)}}),n.length>0&&e.queue.push(()=>Promise.all(n))}swapTiles(t,e,i){let s=this;s.queue.push(()=>{let n=e.x,r=e.y,a=e.tileGridX,h=e.tileGridY,o=i.x,l=i.y,d=i.tileGridX,u=i.tileGridY,c=i.updatePosition(t,n,r,a,h);s.tileGrid[h][a]=i;let p=e.updatePosition(t,o,l,d,u);return s.tileGrid[u][d]=e,Promise.all([c,p])})}hasMatches(t,e){return this.getMatches(t,e).length>0}getMatches(t,e){const i=this,s=[];return i.forEachTile((n,r,a)=>{if(void 0!==t&&r!==t&&void 0!==e&&a!==e)return;if(!this.isPlayable(n))return;const h=n.tileType,o=[],l=[];let d=r+1;for(;d<i.tileGridWidth;){const t=i.tileGrid[a][d];if(null==t||h.name!==t.tileType.name)break;o.push(t),d++}for(d=r-1;d>0;){const t=i.tileGrid[a][d];if(null==t||h.name!==t.tileType.name)break;o.push(t),d--}let u=a+1;for(;u<i.tileGridHeight;){const t=i.tileGrid[u][r];if(null==t||h.name!==t.tileType.name)break;l.push(t),u++}for(u=a-1;u>0;){const t=i.tileGrid[u][r];if(null==t||h!==t.tileType)break;l.push(t),u--}l.length>1&&s.push(...l),o.length>1&&s.push(...o),(l.length>1||o.length>1)&&s.push(n)}),s}forEachTile(t){for(let e=0;e<2*this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++)t(this.tileGrid[e][i],i,e)}forEachPlayableTile(t){for(let e=this.tileGridHeight;e<2*this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++)t(this.tileGrid[e][i],i,e)}createTile(t,e,i,s){return new class{constructor(t,e,i,s,n,r,a){this.tileType=t,this.x=e,this.y=i,this.tileGridX=s,this.tileGridY=n,this.onTileSelect=a,this.image=null,this.state=Kt,this.isActivated=!1,this.isDestroying=!1,this.isBlocked=r}create(t){this.image=t.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(t,this)}),this.isBlocked&&this.image.setAlpha(.5)}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(t,e,i,s,n,r){const a=this,h=Math.abs(a.y-i);return new Promise((o,l)=>{a.x=e,a.y=i,a.tileGridX=s,a.tileGridY=n,t.tweens.add({targets:a.image,x:e,y:i,ease:r?"Linear":"Power1",duration:r?Math.max(h,150):500,onComplete:()=>{o()}})})}destroy(t,e){let i=this;if(i.isDestroying)return;i.isDestroying=!0;const s=t.add.image(i.x,i.y,i.tileType.imageKey);s.setTintFill(16777215),s.alpha=0;const n=[];for(let e=0;e<8;e++){const e=t.add.graphics({fillStyle:{color:16777215},alpha:0}),i=new Phaser.Geom.Circle(this.x,this.y,Phaser.Math.Between(0,10));e.fillCircleShape(i),n.push(e)}return new Promise((r,a)=>{e.remove(i.image),i.image.destroy(),s.setAlpha(1),t.tweens.add({targets:s,alpha:0,duration:250,ease:"Cubic.easeOut",onComplete:()=>{i.state=Vt,e.remove(s),s.destroy(),n.forEach(t=>{e.remove(t),t.destroy()}),r()}}),n.forEach((e,i)=>{e.setAlpha(1);let s=null,n=null;switch(i){case 0:n="-";case 1:s="+",n="-";break;case 2:s="+";break;case 3:s="+",n="+";break;case 4:n="+";break;case 5:n="+",s="-";case 6:s="-";break;case 7:n="-",s="-"}const r={targets:e,alpha:0,duration:250,ease:"Cubic.easeOut"};null!=s&&(r.x=s+"=45"),null!=n&&(r.y=n+"=45"),t.tweens.add(r)})})}block(t){this.isBlocked=!0,t.tweens.add({targets:this.image,alpha:.5,duration:100})}unblock(t){this.isBlocked=!1,t.tweens.add({targets:this.image,alpha:1,duration:100})}}(t,this.getTileX(e),this.getTileY(i),e,i,s,this.onTileSelect)}getTileDrop(t,e,i,s){return e.updatePosition(t,this.getTileX(i),this.getTileY(s),i,s,!0)}getTileX(t){return this.offsetX+this.tileSize*t}getTileY(t){return this.offsetY+this.tileSize*t}canSelect(t){return!this.isBlocked&&this.isPlayable(t)}isPlayable(t){return null!=t&&t.tileGridY>this.tileGridHeight-1}getTileType(t,e,i){const s=e<1?null:this.tileGrid[e-1][t],n=e>self.tileGridHeight-1||!this.tileGrid[e+1]?null:this.tileGrid[e+1][t],r=t<1?null:this.tileGrid[e][t-1],a=t>self.tileGridWidth-1?null:this.tileGrid[e][t+1];return Ut(i!==Xt||null==s&&null==n&&null==r&&null==a?i===Ht?Jt.filter(t=>!(null!==n&&t.name===n.tileType.name||null!==a&&t.name===a.tileType.name||null!==r&&t.name===r.tileType.name)):Jt.filter(t=>!(null!==s&&t.name===s.tileType.name||null!==r&&t.name===r.tileType.name)):[s,n,r,a].filter(t=>null!=t).map(t=>t.tileType))}block(t){this.isBlocked=!0,this.forEachTile(e=>e&&e.block(t))}unblock(t){this.isBlocked=!1,this.forEachTile(e=>e&&e.unblock(t))}fill(t){for(let e=0;e<this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++){let s=this.createTile(this.getTileType(i,e,Yt),i,e,!0);s.create(t),this.tileGrid[e][i]=s}this.isBlocked=!0,this.isInitialized=!0}},Qt=i(2),Zt=i.n(Qt),te=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.isReadyForRoundTransition=!1,this.isTransitioningRounds=!1,this.score=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.levelClearMessage=null,this.levelClearMessageHighlight=null,this.director=null,this.guide=null,this.level=null,this.totalMatches=null}preload(){Zt.a.load({google:{families:[r.googleFontName]}}),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.image("guide_character","assets/images/guide.png"),this.load.image("background","assets/images/background.png"),this.load.image("round_clear","assets/images/round_clear.png"),this.load.image("icon_tile","assets/images/icon_tile.png"),this.load.image("icon_timer","assets/images/icon_timer.png"),this.load.image("expression_default","assets/images/expression_default.png"),this.load.image("expression_surprise","assets/images/expression_surprise.png"),this.load.image("expression_sadness","assets/images/expression_sadness.png"),this.load.image("expression_despair","assets/images/expression_despair.png"),this.load.audio("match","assets/sounds/match.wav")}init(t){this.level=t.level||0}create(){this.isTransitioningRounds=!1,this.isRoundTransitionComplete=!1,this.score=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(t){var e=this;e.queuedActions.push(()=>{t().then(()=>{e.currentAction=null})})}},this.add.image(400,330,"background");const t=qt[this.level].behavior;this.selectedTiles=[],this.tileGrid=new $t(6,6,80,325,-265,this.onTileSelect,this.onTileMatch,t,this.queue),this.scoreDisplay=new class{constructor(t,e){this.x=t,this.y=e,this.scoreText=null,this.score=0}create(t){t.add.graphics({fillStyle:{color:14414079}}).setAlpha(.5).fillRoundedRect(this.x-150,this.y-10,300,90,10),t.add.image(this.x+15,this.y+15,"icon_tile").setAlpha(.7),this.scoreText=t.add.text(this.x+40,this.y,this.score,r),this.updateScore(this.score)}updateScore(t){this.score=t,this.scoreText.setText(t)}}(110,585);const e=qt[this.level].timer;this.timer=e>0?new class{constructor(t,e,i){this.x=t,this.y=e,this.text=null,this.ticks=i,this.isPaused=!0}create(t){t.add.image(this.x+15,this.y+15,"icon_timer").setAlpha(.7),this.text=t.add.text(this.x+40,this.y,this.getTimeOutput(this.ticks),r),this.tick(),t.time.addEvent({delay:1e3,callback:this.tick,callbackScope:this,loop:!0})}tick(){this.ticks<=0||this.isPaused||(this.ticks--,this.text.setText(this.getTimeOutput(this.ticks)))}start(){this.isPaused=!1}getTimeOutput(t){let e=t%60;return e<10&&(e="0"+e),`${Math.floor(t/60)}:${e}`}}(110,625,e):null,this.guide=new Dt(20,20,0===this.level),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this),this.levelClearMessage=this.add.image(400,400,"round_clear"),this.levelClearMessage.setAlpha(0),this.levelClearMessage.setDepth(1),this.levelClearMessageHighlight=this.add.image(400,400,"round_clear"),this.levelClearMessageHighlight.setAlpha(0),this.levelClearMessageHighlight.setDepth(1),this.levelClearMessageHighlight.setTintFill(16777215);const i=n.getScript(this.level);this.director=new class{constructor(t,e,i,s){this.guide=e,this.timer=i,this.tileGrid=s,this.queuedActions=null,this.isGuideReady=!1;const n=this;this.guide.on("ready",()=>{n.isGuideReady=!0,n.next()}),this.queueActions(t)}queueActions(t){if(!t)return;const e=this;null===e.queuedActions&&(e.queuedActions=[]),e.queuedActions.push(...t),e.next()}next(t){if(!this.isGuideReady)return;if(0===this.queuedActions.length)return;const e=this.queuedActions.shift();"string"==typeof e?this.handleMessage(e):e.hasOwnProperty("do")?(this.handleAction(e.do,e.value,t),this.next(t)):e.hasOwnProperty("on")&&(this.handleEvent(e.on,e.actions),this.next(t))}handleMessage(t){this.guide.displayMessage(t)}handleAction(t,e,i){switch(t){case"dropTiles":this.tileGrid.fill(i);break;case"updateGuideExpression":this.guide.updateExpression(e,i);break;case"unblockTileGrid":this.tileGrid.unblock(i);break;case"startTimer":this.timer.start()}}handleEvent(t,e){const i=this;switch(t){case"firstMatch":this.tileGrid.on("match",()=>i.queueActions(e));break;case"gameOver":this.tileGrid.on("gameOver",()=>i.queueActions(e))}}}(i,this.guide,this.timer,this.tileGrid);const s=this;this.input.on("pointerdown",()=>{s.director.next(s)})}update(){this.isTransitioningRounds||(this.isRoundTransitionComplete?this.nextLevel():(this.handleSpecialLevelBehavior(),null!=this.timer&&this.timer.seconds<=0?this.guide.displayGameOverMessage():this.isLevelComplete()?this.endLevel():this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this))))}onTileSelect(t,e){if(!t.queue.isActionRunning()&&!t.guide.isBlockingGameplay&&t.tileGrid.canSelect(e)){if(e.isActivated)return t.selectedTiles=[],void e.deactivate();if(0===t.selectedTiles.length)return t.selectedTiles.push(e),void e.activate();if(1===t.selectedTiles.length){const i=t.selectedTiles[0],s=Math.abs(i.tileGridX-e.tileGridX),n=Math.abs(i.tileGridY-e.tileGridY);if(1===s&&0===n||0===s&&1===n){t.selectedTiles.push(e);let i=t.selectedTiles[0],s=t.selectedTiles[1];t.tileGrid.swapTiles(t,i,s),t.queue.push(()=>(t.tileGrid.hasMatches(i.tileGridX,i.tileGridY)||t.tileGrid.hasMatches(s.tileGridX,s.tileGridY)||t.tileGrid.swapTiles(t,i,s),Promise.resolve())),t.selectedTiles.forEach(t=>{t.deactivate()}),t.selectedTiles=[]}}}}onTileMatch(t,e){t.totalMatches++,t.score+=e.length,t.scoreDisplay.updateScore(t.score)}isLevelComplete(){return this.score>=qt[this.level].score}handleSpecialLevelBehavior(){const t=qt[this.level].handler;t&&t({tileGrid:this.tileGrid,score:this.score,level:this.level})}endLevel(){const t=this;t.isTransitioningRounds=!0,t.levelClearMessageHighlight.setAlpha(1),t.tweens.add({targets:t.levelClearMessageHighlight,alpha:0,duration:1e3}),t.tweens.add({targets:t.levelClearMessage,alpha:1,duration:1e3,completeDelay:2e3,onComplete:()=>{t.isRoundTransitionComplete=!0,t.isTransitioningRounds=!1}})}nextLevel(){this.scene.restart({level:this.level+1})}};const ee={type:Phaser.AUTO,width:800,height:700,scene:[s,te]};new Phaser.Game(ee)}]);
//# sourceMappingURL=bundle.js.map