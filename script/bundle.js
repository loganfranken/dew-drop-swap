!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;e.exports=function(e,t,s,a,n){if(0!==t.width&&0!==t.height){var r=t.frame,o=r.width,h=r.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(t,r.glTexture,o,h,t.x,t.y,o/t.style.resolution,h/t.style.resolution,t.scaleX,t.scaleY,t.rotation,t.flipX,t.flipY,t.scrollFactorX,t.scrollFactorY,t.displayOriginX,t.displayOriginY,0,0,o,h,l(t._tintTL,a.alpha*t._alphaTL),l(t._tintTR,a.alpha*t._alphaTR),l(t._tintBL,a.alpha*t._alphaBL),l(t._tintBR,a.alpha*t._alphaBR),t._isTinted&&t.tintFill,0,0,a,n)}}},function(e,t){e.exports=function(e,t,i,s,a){0!==t.width&&0!==t.height&&e.batchSprite(t,t.frame,s,a)}},function(e,t,i){var s;!function(){function a(e,t,i){return e.call.apply(e.bind,arguments)}function n(e,t,i){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function r(e,t,i){return(r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:n).apply(null,arguments)}var o=Date.now||function(){return+new Date};function h(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var l=!!window.FontFace;function d(e,t,i,s){if(t=e.c.createElement(t),i)for(var a in i)i.hasOwnProperty(a)&&("style"==a?t.style.cssText=i[a]:t.setAttribute(a,i[a]));return s&&t.appendChild(e.c.createTextNode(s)),t}function u(e,t,i){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(i,e.lastChild)}function c(e){e.parentNode&&e.parentNode.removeChild(e)}function p(e,t,i){t=t||[],i=i||[];for(var s=e.className.split(/\s+/),a=0;a<t.length;a+=1){for(var n=!1,r=0;r<s.length;r+=1)if(t[a]===s[r]){n=!0;break}n||s.push(t[a])}for(t=[],a=0;a<s.length;a+=1){for(n=!1,r=0;r<i.length;r+=1)if(s[a]===i[r]){n=!0;break}n||t.push(s[a])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function g(e,t){for(var i=e.className.split(/\s+/),s=0,a=i.length;s<a;s++)if(i[s]==t)return!0;return!1}function f(e,t,i){function s(){o&&a&&n&&(o(r),o=null)}t=d(e,"link",{rel:"stylesheet",href:t,media:"all"});var a=!1,n=!0,r=null,o=i||null;l?(t.onload=function(){a=!0,s()},t.onerror=function(){a=!0,r=Error("Stylesheet failed to load"),s()}):setTimeout((function(){a=!0,s()}),0),u(e,"head",t)}function m(e,t,i,s){var a=e.c.getElementsByTagName("head")[0];if(a){var n=d(e,"script",{src:t}),r=!1;return n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&a.removeChild(n))},a.appendChild(n),setTimeout((function(){r||(r=!0,i&&i(Error("Script load timeout")))}),s||5e3),n}return null}function v(){this.a=0,this.c=null}function y(e){return e.a++,function(){e.a--,w(e)}}function x(e,t){e.c=t,w(e)}function w(e){0==e.a&&e.c&&(e.c(),e.c=null)}function T(e){this.a=e||"-"}function b(e,t){this.c=e,this.f=4,this.a="n";var i=(t||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function k(e){var t=[];e=e.split(/,\s*/);for(var i=0;i<e.length;i++){var s=e[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?t.push("'"+s+"'"):t.push(s)}return t.join(",")}function S(e){return e.a+e.f}function G(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function E(e){var t=4,i="n",s=null;return e&&((s=e.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=e.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?t=7:/[1-9]00/.test(s[1])&&(t=parseInt(s[1].substr(0,1),10)))),i+t}function _(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new T("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function P(e){if(e.g){var t=g(e.f,e.a.c("wf","active")),i=[],s=[e.a.c("wf","loading")];t||i.push(e.a.c("wf","inactive")),p(e.f,i,s)}O(e,"inactive")}function O(e,t,i){e.j&&e.h[t]&&(i?e.h[t](i.c,S(i)):e.h[t]())}function M(){this.c={}}function C(e,t){this.c=e,this.f=t,this.a=d(this.c,"span",{"aria-hidden":"true"},this.f)}function A(e){u(e.c,"body",e.a)}function I(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+k(e.c)+";font-style:"+G(e)+";font-weight:"+e.f+"00;"}function L(e,t,i,s,a,n){this.g=e,this.j=t,this.a=s,this.c=i,this.f=a||3e3,this.h=n||void 0}function W(e,t,i,s,a,n,r){this.v=e,this.B=t,this.c=i,this.a=s,this.s=r||"BESbswy",this.f={},this.w=a||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new C(this.c,this.s),this.h=new C(this.c,this.s),this.j=new C(this.c,this.s),this.m=new C(this.c,this.s),e=I(e=new b(this.a.c+",serif",S(this.a))),this.g.a.style.cssText=e,e=I(e=new b(this.a.c+",sans-serif",S(this.a))),this.h.a.style.cssText=e,e=I(e=new b("serif",S(this.a))),this.j.a.style.cssText=e,e=I(e=new b("sans-serif",S(this.a))),this.m.a.style.cssText=e,A(this.g),A(this.h),A(this.j),A(this.m)}T.prototype.c=function(e){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},L.prototype.start=function(){var e=this.c.o.document,t=this,i=o(),s=new Promise((function(s,a){!function n(){o()-i>=t.f?a():e.fonts.load(function(e){return G(e)+" "+e.f+"00 300px "+k(e.c)}(t.a),t.h).then((function(e){1<=e.length?s():setTimeout(n,25)}),(function(){a()}))}()})),a=null,n=new Promise((function(e,i){a=setTimeout(i,t.f)}));Promise.race([n,s]).then((function(){a&&(clearTimeout(a),a=null),t.g(t.a)}),(function(){t.j(t.a)}))};var B={D:"serif",C:"sans-serif"},F=null;function R(){if(null===F){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);F=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return F}function z(e,t,i){for(var s in B)if(B.hasOwnProperty(s)&&t===e.f[B[s]]&&i===e.f[B[s]])return!0;return!1}function j(e){var t,i=e.g.a.offsetWidth,s=e.h.a.offsetWidth;(t=i===e.f.serif&&s===e.f["sans-serif"])||(t=R()&&z(e,i,s)),t?o()-e.A>=e.w?R()&&z(e,i,s)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?D(e,e.v):D(e,e.B):function(e){setTimeout(r((function(){j(this)}),e),50)}(e):D(e,e.v)}function D(e,t){setTimeout(r((function(){c(this.g.a),c(this.h.a),c(this.j.a),c(this.m.a),t(this.a)}),e),0)}function Y(e,t,i){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=i}W.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),j(this)};var N=null;function H(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&p(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),O(e,"active")):P(e.a))}function X(e){this.j=e,this.a=new M,this.h=0,this.f=this.g=!0}function q(e,t,i,s,a){var n=0==--e.h;(e.f||e.g)&&setTimeout((function(){var e=a||null,o=s||{};if(0===i.length&&n)P(t.a);else{t.f+=i.length,n&&(t.j=n);var h,l=[];for(h=0;h<i.length;h++){var d=i[h],u=o[d.c],c=t.a,g=d;if(c.g&&p(c.f,[c.a.c("wf",g.c,S(g).toString(),"loading")]),O(c,"fontloading",g),c=null,null===N)if(window.FontFace){g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);N=g?42<parseInt(g[1],10):!f}else N=!1;c=N?new L(r(t.g,t),r(t.h,t),t.c,d,t.s,u):new W(r(t.g,t),r(t.h,t),t.c,d,t.s,e,u),l.push(c)}for(h=0;h<l.length;h++)l[h].start()}}),0)}function U(e,t){this.c=e,this.a=t}function V(e,t){this.c=e,this.a=t}function K(e,t){this.c=e||J,this.a=[],this.f=[],this.g=t||""}Y.prototype.g=function(e){var t=this.a;t.g&&p(t.f,[t.a.c("wf",e.c,S(e).toString(),"active")],[t.a.c("wf",e.c,S(e).toString(),"loading"),t.a.c("wf",e.c,S(e).toString(),"inactive")]),O(t,"fontactive",e),this.m=!0,H(this)},Y.prototype.h=function(e){var t=this.a;if(t.g){var i=g(t.f,t.a.c("wf",e.c,S(e).toString(),"active")),s=[],a=[t.a.c("wf",e.c,S(e).toString(),"loading")];i||s.push(t.a.c("wf",e.c,S(e).toString(),"inactive")),p(t.f,s,a)}O(t,"fontinactive",e),H(this)},X.prototype.load=function(e){this.c=new h(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,i){var s=[],a=i.timeout;!function(e){e.g&&p(e.f,[e.a.c("wf","loading")]),O(e,"loading")}(t);s=function(e,t,i){var s,a=[];for(s in t)if(t.hasOwnProperty(s)){var n=e.c[s];n&&a.push(n(t[s],i))}return a}(e.a,i,e.c);var n=new Y(e.c,t,a);for(e.h=s.length,t=0,i=s.length;t<i;t++)s[t].load((function(t,i,s){q(e,n,t,i,s)}))}(this,new _(this.c,e),e)},U.prototype.load=function(e){var t=this,i=t.a.projectId,s=t.a.version;if(i){var a=t.c.o;m(this.c,(t.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),(function(s){s?e([]):(a["__MonotypeConfiguration__"+i]=function(){return t.a},function t(){if(a["__mti_fntLst"+i]){var s,n=a["__mti_fntLst"+i](),r=[];if(n)for(var o=0;o<n.length;o++){var h=n[o].fontfamily;null!=n[o].fontStyle&&null!=n[o].fontWeight?(s=n[o].fontStyle+n[o].fontWeight,r.push(new b(h,s))):r.push(new b(h))}e(r)}else setTimeout((function(){t()}),50)}())})).id="__MonotypeAPIScript__"+i}else e([])},V.prototype.load=function(e){var t,i,s=this.a.urls||[],a=this.a.families||[],n=this.a.testStrings||{},r=new v;for(t=0,i=s.length;t<i;t++)f(this.c,s[t],y(r));var o=[];for(t=0,i=a.length;t<i;t++)if((s=a[t].split(":"))[1])for(var h=s[1].split(","),l=0;l<h.length;l+=1)o.push(new b(s[0],h[l]));else o.push(new b(s[0]));x(r,(function(){e(o,n)}))};var J="https://fonts.googleapis.com/css";function $(e){this.f=e,this.a=[],this.c={}}var Q={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ee={i:"i",italic:"i",n:"n",normal:"n"},te=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function ie(e,t){this.c=e,this.a=t}var se={Arimo:!0,Cousine:!0,Tinos:!0};function ae(e,t){this.c=e,this.a=t}function ne(e,t){this.c=e,this.f=t,this.a=[]}ie.prototype.load=function(e){var t=new v,i=this.c,s=new K(this.a.api,this.a.text),a=this.a.families;!function(e,t){for(var i=t.length,s=0;s<i;s++){var a=t[s].split(":");3==a.length&&e.f.push(a.pop());var n="";2==a.length&&""!=a[1]&&(n=":"),e.a.push(a.join(n))}}(s,a);var n=new $(a);!function(e){for(var t=e.f.length,i=0;i<t;i++){var s=e.f[i].split(":"),a=s[0].replace(/\+/g," "),n=["n4"];if(2<=s.length){var r;if(r=[],o=s[1])for(var o,h=(o=o.split(",")).length,l=0;l<h;l++){var d;if((d=o[l]).match(/^[\w-]+$/))if(null==(c=te.exec(d.toLowerCase())))d="";else{if(d=null==(d=c[2])||""==d?"n":ee[d],null==(c=c[1])||""==c)c="4";else var u=Z[c],c=u||(isNaN(c)?"4":c.substr(0,1));d=[d,c].join("")}else d="";d&&r.push(d)}0<r.length&&(n=r),3==s.length&&(r=[],0<(s=(s=s[2])?s.split(","):r).length&&(s=Q[s[0]])&&(e.c[a]=s))}for(e.c[a]||(s=Q[a])&&(e.c[a]=s),s=0;s<n.length;s+=1)e.a.push(new b(a,n[s]))}}(n),f(i,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,i=[],s=0;s<t;s++)i.push(e.a[s].replace(/ /g,"+"));return t=e.c+"?family="+i.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(s),y(t)),x(t,(function(){e(n.a,n.c,se)}))},ae.prototype.load=function(e){var t=this.a.id,i=this.c.o;t?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",(function(t){if(t)e([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){t=i.Typekit.config.fn;for(var s=[],a=0;a<t.length;a+=2)for(var n=t[a],r=t[a+1],o=0;o<r.length;o++)s.push(new b(n,r[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(s)}}),2e3):e([])},ne.prototype.load=function(e){var t=this.f.id,i=this.c.o,s=this;t?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[t]=function(t,i){for(var a=0,n=i.fonts.length;a<n;++a){var r=i.fonts[a];s.a.push(new b(r.name,E("font-weight:"+r.weight+";font-style:"+r.style)))}e(s.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",(function(t){t&&e([])}))):e([])};var re=new X(window);re.a.c.custom=function(e,t){return new V(t,e)},re.a.c.fontdeck=function(e,t){return new ne(t,e)},re.a.c.monotype=function(e,t){return new U(t,e)},re.a.c.typekit=function(e,t){return new ae(t,e)},re.a.c.google=function(e,t){return new ie(t,e)};var oe={load:r(re.load,re)};void 0===(s=function(){return oe}.call(t,i,t,e))||(e.exports=s)}()},function(e,t,i){"use strict";i.r(t);var s=class{constructor(e,t){this.x=e,this.y=t,this.muteIcon=null,this.isMuted=!1}create(e){const t=e.add.image(this.x,this.y,"icon_audio");t.setAlpha(.7),t.setInteractive({cursor:"pointer"}),this.muteIcon=e.add.image(this.x,this.y,"icon_audio_mute"),this.muteIcon.setAlpha(0);const i=this;t.on("pointerdown",()=>{i.toggleMute(e)}),e.sound.mute&&(this.isMuted=!0,this.muteIcon.setAlpha(.7))}toggleMute(e){this.isMuted?(e.sound.mute=!1,this.isMuted=!1,e.tweens.add({targets:this.muteIcon,alpha:0,duration:100})):(e.sound.mute=!0,this.isMuted=!0,e.tweens.add({targets:this.muteIcon,alpha:.7,duration:100}))}},a=class extends Phaser.Scene{constructor(){super("TitleScene"),this.startingLevel=0}preload(){this.load.image("background","assets/images/background.png"),this.load.image("title","assets/images/title.png"),this.load.image("start","assets/images/start.png"),this.load.image("start-active","assets/images/start_active.png"),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.image("icon_audio","assets/images/icon_audio.png"),this.load.image("icon_audio_mute","assets/images/icon_audio_mute.png"),this.load.audio("background_music","assets/sounds/background_music.wav"),this.load.audio("select","assets/sounds/select.wav"),this.load.audio("intro_slide","assets/sounds/intro_slide.wav")}create(){const e=this;this.add.image(400,330,"background");const t=this.add.graphics({fillStyle:{color:16777215}});t.setAlpha(0);const i=new Phaser.Geom.Rectangle(0,0,800,700);t.fillRectShape(i);const a=[];a.push({imageKey:"tile_01",xChange:"+=180",yChange:"+=180",angle:15,scale:.8}),a.push({imageKey:"tile_02",xChange:"+=200",yChange:"-=180",angle:15,scale:1}),a.push({imageKey:"tile_03",xChange:"-=180",yChange:"+=180",angle:-15,scale:.9}),a.push({imageKey:"tile_04",xChange:"-=200",yChange:"-=180",angle:-5,scale:.8}),a.push({imageKey:"tile_01",xChange:"+=0",yChange:"-=180",angle:-15,scale:.7}),a.push({imageKey:"tile_02",xChange:"+=0",yChange:"+=180",angle:-15,scale:1}),a.push({imageKey:"tile_03",xChange:"+=290",yChange:"+=30",angle:15,scale:.8}),a.push({imageKey:"tile_01",xChange:"-=290",yChange:"+=40",angle:-15,scale:.9}),a.forEach(t=>{t.tile=e.add.image(400,230,t.imageKey),t.tile.setAlpha(0),t.tile.setScale(.5,.5)});const n=this.add.image(400,230,"title");n.setAlpha(0),n.setScale(2,2);const r=this.add.image(400,550,"start");r.setInteractive({cursor:"pointer"}),r.setAlpha(0);const o=this.add.image(400,550,"start");o.setAlpha(0),o.setTintFill(16777215);const h=this.add.image(400,550,"start-active");h.setAlpha(0),new s(40,640).create(this),r.on("pointerover",()=>{e.tweens.add({targets:h,alpha:1,duration:100,ease:"Sine.easeInOut"})}),r.on("pointerout",()=>{e.tweens.add({targets:h,alpha:0,duration:100,ease:"Sine.easeInOut"})}),this.selectSound=this.sound.add("select"),r.on("pointerdown",()=>{this.selectSound.play(),e.scene.transition({target:"RoundScene",data:{level:this.startingLevel},remove:!0})});const l=this.tweens.createTimeline();l.add({delay:800,targets:n,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Quad.easeIn"}),a.forEach((e,t)=>{l.add({targets:e.tile,x:e.xChange,y:e.yChange,scaleX:1,scaleY:1,alpha:1,scaleX:e.scale,scaleY:e.scale,angle:e.angle,duration:300,ease:"Quad.easeOut",offset:0===t?"-=0":"-=300"})});const d=this.sound.add("intro_slide");this.sound.add("background_music").play(),l.add({targets:t,alpha:1,duration:30,offset:"-=300",onComplete:()=>{d.play()}}),l.add({targets:t,alpha:0,duration:700,offset:1500,ease:"Quad.easeIn"}),l.add({targets:[r,o],alpha:1,offset:2200,duration:100}),l.add({targets:o,alpha:0,duration:300,offset:2300,ease:"Quad.easeOut"}),l.play()}},n=0,r=1,o=2,h=3,l=[{score:100,behavior:n},{score:200,timer:120,behavior:n},{score:300,timer:30,behavior:o},{score:300,timer:120,behavior:r},{score:400,timer:120,behavior:r},{score:500,timer:120,behavior:o},{score:100,timer:60,behavior:n,blockMatching:!0},{score:50,timer:120,behavior:h,blockMatching:!0},{score:300,timer:180,behavior:n},{score:Math.Infinity,behavior:n}],d={getScript(e){switch(e){case 0:return["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)",{do:"updateGuideExpression",value:"sadness"},"The Dew Drop Kingdom is in trouble!",{do:"updateGuideExpression",value:"despair"},"We lost all of our dew drops and now we'll starve!",{do:"updateGuideExpression",value:"glee"},{do:"dropTiles"},"But you can help us by collecting as many dew drops as you can!",{do:"updateGuideExpression",value:"default"},"If you match three or more dew drops of the same color, we can collect them!",{do:"unblockTileGrid"},"To make a match, select two dew drops and swap their places!",{on:"match",filter:e=>1===e.matches,actions:[{do:"updateGuideExpression",value:"glee"},"You got it! That's it!",{do:"updateGuideExpression",value:"default"},"See if you can collect *100 dew drops*!"]},{on:"match",filter:e=>5===e.matches,actions:[{do:"updateGuideExpression",value:"glee"},"*Wow!* Look at you go!",{do:"updateGuideExpression",value:"default"}]},{on:"match",filter:e=>e.score>.5*l[0].score,actions:[{do:"updateGuideExpression",value:"glee"},"*Doozle!* You're almost there!",{do:"updateGuideExpression",value:"default"}]},{on:"win",actions:[{do:"endLevel"}]}];case 1:return[{do:"updateGuideExpression",value:"glee"},"*Oh, doozle!* You're so good at this!",{do:"updateGuideExpression",value:"nervous"},"But, we'll have to hurry this time!",{do:"dropTiles"},"We only have two minutes before the sun dries up all the dew drops!",{do:"updateGuideExpression",value:"default"},"Collect at least *200 dew drops* in *two minutes*!",{do:"unblockTileGrid"},{do:"startTimer"},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Uhh?",{do:"updateGuideExpression",value:"neutral"},"I think there's been a mix-up.",{do:"updateGuideExpression",value:"confused"},"Did you get the wrong script?",{do:"updateGuideExpression",value:"neutral"},"You're supposed to win this time.","Well, whatever, I'm sure we can just fix it up in post.","Let's just move onto the next round.",{do:"endLevel"}]},{on:"win",actions:[{do:"endLevel"}]}];case 2:return[{do:"updateGuideExpression",value:"glee"},"Wow, we're so proud of you!","How did you get so goo...",{do:"updateGuideExpression",value:"nervous"},"...",{do:"updateGuideExpression",value:"surprise"},"*Eezle!* That sun is hot!","You're going to have to move even quicker this time!",{do:"dropTiles"},{do:"updateGuideExpression",value:"default"},"But we know you can do it!","This round you'll only have *30 seconds* to collect at least *300 dew drops*!",{do:"unblockTileGrid"},{do:"startTimer"},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Wait, wait, sorry, hold on.",'We\'re not doing the *"Lose in a Panic"* scenario today.',{do:"updateGuideExpression",value:"neutral"},"So sorry about that.",{do:"updateGuideExpression",value:"amused"},"You've been really great so far, honestly.",{do:"updateGuideExpression",value:"neutral"},"Let's just go ahead and take it from the top.",{do:"endLevel"}]},{on:"win",actions:[{do:"updateGuideExpression",value:"confused"},"Wait, is that...",{do:"updateGuideExpression",value:"neutral"},"No, I think you were supposed to lose here.",{do:"updateGuideExpression",value:"thoughtful"},'Yeah, hmm. This was the *"Lose in a Panic"* scenario.',{do:"updateGuideExpression",value:"neutral"},"You know what, that's fine.",{do:"updateGuideExpression",value:"amused"},"Let's roll with it.",{do:"updateGuideExpression",value:"neutral"},"We'll just move to the next round.",{do:"endLevel"}]}];case 3:return[{do:"updateGuideExpression",value:"neutral"},"Alright, I think we've got everything figured out.",{do:"updateGuideExpression",value:"amused"},"Okay, for this next round, let me set you up:",{do:"updateGuideExpression",value:"neutral"},"Remember, you've been winning the last few rounds and you're gaining confidence.",{do:"updateGuideExpression",value:"amused"},"In this round, it's going to be easy for you to get combos.","So the idea here is that you're going to get a little *too* confident, right?",{do:"updateGuideExpression",value:"confused"},"Like a little full of yourself, alright?",{do:"updateGuideExpression",value:"amused"},"Okay, great! Let's do this:",{do:"updateGuideExpression",value:"neutral"},"...","...","...",{do:"updateGuideExpression",value:"default"},"*Oh doozle woozle!*",{do:"updateGuideExpression",value:"surprise"},"You're so amazing!",{do:"updateGuideExpression",value:"default"},{do:"dropTiles"},"You have *two minutes* again, but this time you'll have to collect *300 dew drops*.",{do:"updateGuideExpression",value:"confused"},"Can you do it?",{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},{do:"updateGuideExpression",value:"glee"},"Who am I kidding? Of course you can!",{do:"updateGuideExpression",value:"default"},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Oh, uhh?",{do:"updateGuideExpression",value:"neutral"},"No, you win this round too.",{do:"updateGuideExpression",value:"thoughtful"},"Uhh, hmm...",{do:"updateGuideExpression",value:"amused"},"Okay, here's what we'll do:",{do:"revokeLevelTransition"},{do:"updateTimer",value:1},{do:"stopTimer"},{do:"unblockTileGrid"},"Go ahead and finish out the round and we'll edit it together later."]},{on:"win",actions:[{do:"endLevel"}]}];case 4:return[{do:"updateGuideExpression",value:"amused"},"Okay, okay, great stuff.",{do:"updateGuideExpression",value:"neutral"},"For this round, you're bringing all of that pride, all of that hubris.","And, when the round starts, things are still going your way.",{do:"updateGuideExpression",value:"confused"},"But guess what?",{do:"updateGuideExpression",value:"neutral"},"Halfway through this round, things start getting a little harder.","So this is where we begin to chip away at your pride as the player.",{do:"updateGuideExpression",value:"amused"},"Alright, that's your set up: now let me get into the right headspace.",{do:"updateGuideExpression",value:"thoughtful"},"...oh doozle woo-","...no, no, it's doozy-woozy here...","...yeah, doozy-woozy, you're our hero...",{do:"updateGuideExpression",value:"amused"},"Alright! Got it!",{do:"updateGuideExpression",value:"neutral"},"...","...","...",{do:"updateGuideExpression",value:"surprise"},"*Doozy-woozy!*",{do:"updateGuideExpression",value:"glee"},"You're our hero!",{do:"dropTiles"},{do:"updateGuideExpression",value:"default"},"You've done so much for us, but we still need your help!",{do:"unblockTileGrid"},{do:"startTimer"},"We need you to collect *400 dew drops* in *two minutes*!",{on:"match",filter:e=>e.score>.5*l[0].score,actions:[{do:"updateTileGenerationBehavior",value:o}]},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Oh, a game over?",{do:"updateGuideExpression",value:"neutral"},"We had a win penciled in here.",{do:"updateGuideExpression",value:"thoughtful"},"Maybe a game over could work?",{do:"updateGuideExpression",value:"neutral"},"No, you know what:",{do:"revokeLevelTransition"},{do:"updateTimer",value:1},{do:"stopTimer"},{do:"unblockTileGrid"},"Just go ahead and finish this off as a win."]},{on:"win",actions:[{do:"endLevel"}]}];case 5:return[{do:"updateGuideExpression",value:"amused"},"Wow, great stuff.","I know this is cliché, but it really feels so authentic.","It's been great working with you. You really sell it.",{do:"updateGuideExpression",value:"neutral"},"Okay, here we go, this is a pivotal scene:","This round will not go your way at all. At all.",{do:"updateGuideExpression",value:"amused"},"This is your fall from grace.",{do:"updateGuideExpression",value:"neutral"},"(Ahem)",{do:"updateGuideExpression",value:"thoughtful"},"...","...","...",{do:"updateGuideExpression",value:"glee"},"*Doozle!*","*Woozle!*","I can't believe you did it!",{do:"updateGuideExpression",value:"default"},"We've got a bigger challenge ahead, but I know you can do it!",{do:"dropTiles"},{do:"updateGuideExpression",value:"glee"},"You can do anything!",{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},"We need you to collect *500 dew drops* in *two minutes*!",{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"surprise"},"Oh no!",{do:"updateGuideExpression",value:"sadness"},"*Whoopsie whoozle!*",{do:"updateGuideExpression",value:"despair"},"You didn't make it in time!",{do:"updateGuideExpression",value:"sadness"},"It's okay, though!",{do:"updateGuideExpression",value:"nervous"},"It's okay!",{do:"updateGuideExpression",value:"default"},"You can try again!",{do:"endLevel"}]},{on:"win",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Oh?","A win?",{do:"updateGuideExpression",value:"neutral"},"We had a loss planned, but...","But, yeah, I think a win can work too.",{do:"endLevel"}]}];case 6:return[{do:"updateGuideExpression",value:"neutral"},"Okay, let's move right into the next scene:","Here, you are wallowing, right?","You are in the pit of despair and you can't see a way out.","This round won't be particularly hard, but you can't seem to find any matches.",{do:"updateGuideExpression",value:"amused"},"Got it?",{do:"updateGuideExpression",value:"neutral"},"Alright, great: let me find my place here...",{do:"updateGuideExpression",value:"thoughtful"},"...I believed in you, but my faith is faltering...","...I'm keeping a brave face, but I'm losing confidence...",{do:"updateGuideExpression",value:"amused"},"Okay, I'm ready!","...","...","...",{do:"updateGuideExpression",value:"default"},"Don't worry, that was a tough one!",{do:"dropTiles"},"Let's try again! We believe in you!",{do:"updateGuideExpression",value:"glee"},"We know you can do it!",{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},"This time, you just need to get *100 dew drops* in *one minute!*",{on:"swap",actions:[{do:"updateGuideExpression",value:"neutral"},"Hey, remember: you don't get any matches this round.",{do:"updateGuideExpression",value:"default"}]},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"surprise"},"Oh no!",{do:"updateGuideExpression",value:"despair"},"*Eezle weezle!*",{do:"updateGuideExpression",value:"sadness"},"You didn't collect any dew drops!",{do:"updateGuideExpression",value:"despair"},"We'll starve!",{do:"updateGuideExpression",value:"sadness"},"*Please!* You have to save us!",{do:"endLevel"}]}];case 7:return[{do:"updateGuideExpression",value:"amused"},"Wow, I'm really feeling it.","How about you?",{do:"updateGuideExpression",value:"neutral"},"Alright, next up:","You've been wallowing.","You're feeling really low.",{do:"updateGuideExpression",value:"thoughtful"},"And, you're in such despair, that in this round...",{do:"updateGuideExpression",value:"neutral"},"There's an obvious combo.","Right there, right in front of your face.",{do:"updateGuideExpression",value:"thoughtful"},"But you can't see it through the despair.",{do:"updateGuideExpression",value:"neutral"},"But then, in the last 30 seconds of the round, you see it!",{do:"updateGuideExpression",value:"amused"},"The perfect match.","And the pheonix rises once again!",{do:"updateGuideExpression",value:"neutral"},"Alright! Here we go!","...","...","...",{do:"updateGuideExpression",value:"despair"},"Oh, boozle...","What will we do?",{do:"updateGuideExpression",value:"sadness"},"Please, you're our only hope!",{do:"updateGuideExpression",value:"despair"},"We have one more chance...",{do:"dropTiles"},"Please! Save our kingdom! Just get *50 dew drops* in *two minutes*!",{do:"unblockTileGrid"},{do:"startTimer"},{on:"swap",filter:e=>e.ticks>30,actions:[{do:"updateGuideExpression",value:"neutral"},"Hold on, it's not time to swap yet.","Wait until there's only *30 seconds* left.",{do:"updateGuideExpression",value:"despair"}]},{on:"swap",filter:e=>e.ticks<=30,actions:[{do:"unblockTileGrid"}]},{on:"tick",filter:e=>e.ticks<=30,actions:[{do:"updateGuideExpression",value:"neutral"},{do:"stopTimer"},"Alright, here we go.","Just to make sure we get this right, we'll stop the timer.",{do:"updateGuideExpression",value:"thoughtful"},"And we'll highlight the match you'll want to make.",{do:"blockTileGrid",value:[[9,2],[9,3]]},{do:"updateGuideExpression",value:"amused"},"And the rest is up to you!",{do:"revokeBlockMatching"}]},{on:"win",actions:[{do:"endLevel"}]}];case 8:return[{do:"updateGuideExpression",value:"amused"},"Hey, our hero is back!","Very moving work.",{do:"updateGuideExpression",value:"neutral"},"Okay: this next scene is the last one.",{do:"updateGuideExpression",value:"thoughtful"},"It's your victory lap.",{do:"updateGuideExpression",value:"neutral"},"To sell this one, we really need to get the pacing right.",{do:"updateGuideExpression",value:"thoughtful"},"We want you getting a steady flow of matches the whole time.",{do:"updateGuideExpression",value:"neutral"},"If you win too early, it's no fun to watch, you know?",{do:"updateGuideExpression",value:"amused"},"But don't worry, we got your back.",{do:"updateGuideExpression",value:"neutral"},"We'll just advance the timer as you get matches, yeah?","And then we can edit it all together later.",{do:"updateGuideExpression",value:"amused"},"Alright! Let's wrap this up!",{do:"updateGuideExpression",value:"thoughtful"},"...","...","...",{do:"updateGuideExpression",value:"glee"},"*Oh doozie woozie!*",{do:"updateGuideExpression",value:"default"},"I knew you could do it!","You're our hero!",{do:"updateGuideExpression",value:"confused"},"...",{do:"updateGuideExpression",value:"surprise"},"*Oozle!*",{do:"dropTiles"},{do:"updateGuideExpression",value:"glee"},"Look at all of those dew drops!",{do:"updateGuideExpression",value:"amused"},"Now's our chance!","If you can gather up a big haul, we can save the kingdom!","I know it's a lot to ask, but please help us one more time!","*300 dew drops* in *3 minutes!*",{do:"unblockTileGrid"},{on:"match",actions:[{do:"updateTimerRelativeToScore"}],persist:!0},{on:"win",actions:[{do:"blockTileGrid"},{do:"endLevel"}]}];case 9:return[{do:"updateGuideExpression",value:"amused"},"And that's a wrap!",{do:"updateGuideExpression",value:"neutral"},"I think it went pretty well today, right?",{do:"updateGuideExpression",value:"thoughtful"},{do:"hideScoreDisplay"},"Huh?",{do:"updateGuideExpression",value:"neutral"},"Oh, looks like they're shutting things down.","...","...","So, any-",{do:"dropTiles"},{do:"updateGuideExpression",value:"confused"},"Oh, whoops, tiles must have dropped on accident.",{do:"updateGuideExpression",value:"neutral"},"...","...","Yeah, so, anyway.","I've gotta head out.","...",{do:"updateGuideExpression",value:"amused"},"Nice working with you today!",{do:"updateGuideExpression",value:"neutral"},"...",{do:"hideGuide"},{do:"unblockTileGrid"}]}}},u={color:"#000",fontFamily:'"Baloo Thambi 2"',googleFontName:"Baloo Thambi 2:500;700",fontSize:"30px"},c=class{constructor(){this.subscriptions=[]}on(e,t,i,s){this.subscriptions.push({eventName:e,filter:t,callback:i,persist:s})}emit(e){this.subscriptions.filter(t=>t.eventName===e).filter(e=>null===e.filter||e.filter()).forEach(e=>{e.callback&&e.callback(),e.persist||(e.callback=null)})}},p=i(0),g=i.n(p),f=i(1),m=i.n(f),v=function(){},y={renderWebGL:g.a,renderCanvas:m.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const x=Phaser.Display.Canvas.CanvasPool;var w=function(e){var t=x.create(this),i=t.getContext("2d");e.syncFont(t,i);var s=Math.ceil(i.measureText(e.testString).width*e.baselineX),a=s,n=2*a;a=a*e.baselineY|0,t.width=s,t.height=n,i.fillStyle="#f00",i.fillRect(0,0,s,n),i.font=e._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(e.testString,0,a);var r={ascent:0,descent:0,fontSize:0};if(!i.getImageData(0,0,s,n))return r.ascent=a,r.descent=a+6,r.fontSize=r.ascent+r.descent,x.remove(t),r;var o,h,l=i.getImageData(0,0,s,n).data,d=l.length,u=4*s,c=0,p=!1;for(o=0;o<a;o++){for(h=0;h<u;h+=4)if(255!==l[c+h]){p=!0;break}if(p)break;c+=u}for(r.ascent=a-o,c=d-u,p=!1,o=n;o>a;o--){for(h=0;h<u;h+=4)if(255!==l[c+h]){p=!0;break}if(p)break;c-=u}return r.descent=o-a,r.fontSize=r.ascent+r.descent,x.remove(t),r},T={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const b=Phaser.Utils.Objects.GetAdvancedValue,k=Phaser.Utils.Objects.GetValue;var S={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const G={none:T.NO_WRAP,word:T.WORD_WRAP,char:T.CHAR_WRAP,character:T.CHAR_WRAP};var E=class{constructor(e,t){this.parent=e,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(t,!1);var i=k(t,"metrics",!1);this.metrics=i?{ascent:k(i,"ascent",0),descent:k(i,"descent",0),fontSize:k(i,"fontSize",0)}:w(this)}setStyle(e,t){if(void 0===t&&(t=!0),e&&e.hasOwnProperty("wrap")){var i=e.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=G[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var a in e&&e.hasOwnProperty("fontSize")&&"number"==typeof e.fontSize&&(e.fontSize=e.fontSize.toString()+"px"),S)this[a]="wrapCallback"===a||"wrapCallbackScope"===a?k(e,S[a][0],S[a][1]):b(e,S[a][0],S[a][1]);var n=k(e,"font",null);this._font=null===n?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:n;var r=k(e,"fill",null);return null!==r&&(this.color=r),t?this.update(!0):this.parent}syncFont(e,t){t.font=this._font}syncStyle(e,t){t.textBaseline="alphabetic",t.fillStyle=this.color,t.strokeStyle=this.stroke,t.lineWidth=this.strokeThickness,t.lineCap="round",t.lineJoin="round"}syncShadow(e,t){t?(e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor=0,e.shadowBlur=0)}update(e){return e&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=w(this)),this.parent.updateText(e)}buildFont(){var e=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return e!==this._font&&(this._font=e),this}setFont(e){return"string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=k(e,"fontFamily","Courier"),this.fontSize=k(e,"fontSize","16px"),this.fontStyle=k(e,"fontStyle","")),this.update(!0)}setFontFamily(e){return this.fontFamily=e,this.update(!0)}setFontStyle(e){return this.fontStyle=e,this.update(!0)}setFontSize(e){return"number"==typeof e&&(e=e.toString()+"px"),this.fontSize=e,this.update(!0)}setTestString(e){return this.testString=e,this.update(!0)}setFixedSize(e,t){return this.fixedWidth=e,this.fixedHeight=t,e&&(this.parent.width=e),t&&(this.parent.height=t),this.update(!1)}setResolution(e){return this.resolution=e,this.update(!1)}setLineSpacing(e){return this.lineSpacing=e,this.update(!1)}setBackgroundColor(e){return this.backgroundColor=e,this.update(!1)}setFill(e){return this.color=e,this.update(!1)}setColor(e){return this.color=e,this.update(!1)}setStroke(e,t){return void 0===e?this.strokeThickness=0:(void 0===t&&(t=this.strokeThickness),this.stroke=e,this.strokeThickness=t),this.update(!0)}setShadow(e,t,i,s,a,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===a&&(a=!1),void 0===n&&(n=!0),this.shadowOffsetX=e,this.shadowOffsetY=t,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=a,this.shadowFill=n,this.update(!1)}setShadowOffset(e,t){return void 0===e&&(e=0),void 0===t&&(t=e),this.shadowOffsetX=e,this.shadowOffsetY=t,this.update(!1)}setShadowColor(e){return void 0===e&&(e="#000"),this.shadowColor=e,this.update(!1)}setShadowBlur(e){return void 0===e&&(e=0),this.shadowBlur=e,this.update(!1)}setShadowStroke(e){return this.shadowStroke=e,this.update(!1)}setShadowFill(e){return this.shadowFill=e,this.update(!1)}setUnderline(e,t,i){return void 0===e&&(e="#000"),void 0===t&&(t=0),void 0===i&&(i=0),this.underlineColor=e,this.underlineThickness=t,this.underlineOffset=i,this.update(!1)}setUnderlineColor(e){return void 0===e&&(e="#000"),this.underlineColor=e,this.update(!1)}setUnderlineThickness(e){return void 0===e&&(e=0),this.underlineThickness=e,this.update(!1)}setUnderlineOffset(e){return void 0===e&&(e=0),this.underlineOffset=e,this.update(!1)}setWrapMode(e){return"string"==typeof e&&(e=G[e.toLowerCase()]||0),this.wrapMode=e,this.update(!0)}setWrapWidth(e){return this.wrapWidth=e,this.update(!1)}setAlign(e,t){return void 0===e&&(e="left"),void 0===t&&(t="top"),this.halign=e,this.valign=t,this.update(!1)}setHAlign(e){return void 0===e&&(e="left"),this.halign=e,this.update(!1)}setVAlign(e){return void 0===e&&(e="top"),this.valign=e,this.update(!1)}setMaxLines(e){return void 0===e&&(e=0),this.maxLines=e,this.update(!1)}getTextMetrics(){var e=this.metrics;return{ascent:e.ascent,descent:e.descent,fontSize:e.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var e={};for(var t in S)e[t]=this[t];return e.metrics=this.getTextMetrics(),e}destroy(){this.parent=void 0}},_={draw(e,t,i,s){var a=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save(),this.drawBackground(this.defatultStyle.backgroundColor);var r=this.defatultStyle;e+=this.startXOffset,t+=this.startYOffset;var o,h,l,d,u,c,p=r.halign,g=r.valign,f=r.lineHeight,m=a.lines,v=m.length,y=r.maxLines;y>0&&v>y?(h=y,l="center"===g?Math.floor((v-h)/2):"bottom"===g?v-h:0):(h=v,l=0),d=l+h,c="center"===g?Math.max((s-h*f)/2,0):"bottom"===g?Math.max(s-h*f-2,0):0,c+=t;for(var x=l;x<d;x++)if(0!==(o=a.getLineWidth(x))){u="center"===p?(i-o)/2:"right"===p?i-o:0,u+=e;for(var w=m[x],T=0,b=w.length;T<b;T++)this.drawPen(w[T],u,c)}n.restore()},drawPen(e,t,i){t+=e.x,i+=e.y;var s=this.canvas,a=this.context;a.save();var n=this.parser.propToContextStyle(this.defatultStyle,e.prop);n.buildFont(),n.syncFont(s,a),n.syncStyle(s,a),n.underlineThickness>0&&e.width>0&&this.drawUnderline(t,i,e.width,n),e.isTextPen&&this.drawText(t,i,e.text,n),e.isImagePen&&this.drawImage(t,i,e.prop.img,n),a.restore(),e.hasAreaMarker&&e.width>0&&this.hitAreaManager.add(e.prop.area,t,i-this.startYOffset,e.width,this.defatultStyle.lineHeight)},clear(){var e=this.canvas;this.context.clearRect(0,0,e.width,e.height)},drawBackground(e){null!==e&&(this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(e,t,i,s){t+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(e=Math.round(e),t=Math.round(t));var a=this.context,n=a.lineCap;a.lineCap="butt",a.beginPath(),a.strokeStyle=s.underlineColor,a.lineWidth=s.underlineThickness,a.moveTo(e,t),a.lineTo(e+i,t),a.stroke(),a.lineCap=n},drawText(e,t,i,s){this.autoRound&&(e=Math.round(e),t=Math.round(t));var a=this.context;s.strokeThickness&&(s.syncShadow(a,s.shadowStroke),a.strokeText(i,e,t)),s.color&&"none"!==s.color&&(s.syncShadow(a,s.shadowFill),a.fillText(i,e,t))},drawImage(e,t,i,s){var a=this.parent.imageManager,n=a.get(i),r=a.getFrame(i);e+=n.left,t+=-this.startYOffset+n.y,this.autoRound&&(e=Math.round(e),t=Math.round(t)),this.context.drawImage(r.source.image,r.cutX,r.cutY,r.cutWidth,r.cutHeight,e,t,n.width,n.height)}};var P=class{constructor(){this.items=[]}destroy(){this.items.length=0,this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(e){return this.items.push(e),this}pushMultiple(e){return this.items.push.apply(this.items,e),e.length=0,this}};const O=Phaser.Utils.Objects.GetValue,M=T.NO_NEWLINE,C=T.RAW_NEWLINE;var A=class{constructor(e){this.prop={},this.resetFromJSON(e)}resetFromJSON(e){this.text=O(e,"text",""),this.x=O(e,"x",0),this.y=O(e,"y",0),this.width=O(e,"width",0);var t=O(e,"prop",null);null===t&&(t={}),this.prop=t,this.newLineMode=O(e,"newLineMode",0),this.startIndex=O(e,"startIndex",0)}get plainText(){var e=this.text;return this.newLineMode===C&&(e+="\n"),e}get wrapText(){var e=this.text;return this.newLineMode!==M&&(e+="\n"),e}get rawTextLength(){var e=this.text.length;return this.newLineMode===C&&(e+=1),e}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},I=function(e){if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]},L=function(e,t){var i=Array.isArray(e);for(var s in void 0===t?t=i?[]:{}:I(t),i&&(t.length=e.length),e)t[s]=e[s];return t};const W=Phaser.Utils.Objects.GetFastValue,B=T.NO_NEWLINE,F=T.WRAPPED_NEWLINE;var R=new P,z=new P;class j{constructor(e){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=W(e,"pensPool",R),this.LinesPool=W(e,"linesPool",z),this.tagToText=W(e,"tagToText",v),this.tagToTextScope=W(e,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var e=0,t=this.lines.length;e<t;e++)this.lines[e].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(e,t,i,s,a,n){var r=this.PensPool.pop();return null==r&&(r=new A),D.text=e,D.x=t,D.y=i,D.width=s,D.prop=a,D.newLineMode=n,r.resetFromJSON(D),this.addPen(r),this}addImagePen(e,t,i,s){return this.addTextPen("",e,t,i,s,B),this}addNewLinePen(){var e=this.lastPen,t=e?e.lastX:0,i=e?e.y:0,s=e?L(e.prop):null;return this.addTextPen("",t,i,0,s,F),this}addPen(e){var t=this.lastPen;e.startIndex=null==t?0:t.endIndex,this.pens.push(e);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(e),e.newLineMode!==B&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(e){null==e&&(e=new j),e.freePens();for(var t=0,i=this.lines.length;t<i;t++)for(var s=this.lines[t],a=0,n=s.length;a<n;a++){var r=s[a];e.addPen(r.text,r.x,r.y,r.width,L(r.prop),r.newLineMode)}return e}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(e){if(e>=this.lines.length)return this.getLineEndIndex(e);var t=this.lines[e];return t&&t[0]?t[0].startIndex:0}getLineEndIndex(e){e>=this.lines.length&&(e=this.lines.length-1);var t,i,s=!1;for(t=e;t>=0&&!(s=null!=(i=this.lines[t])&&i.length>0);t--);return s?i[i.length-1].endIndex:0}getLineWidth(e){var t=this.lines[e];if(!t)return 0;var i=t[t.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var e,t=0,i=0,s=this.lines.length;i<s;i++)(e=this.getLineWidth(i))>t&&(t=e);return this.maxLinesWidth=t,t}getLineWidths(){for(var e=[],t=0,i=this.lines.length;t<i;t++)e.push(this.getLineWidth(t));return e}get linesCount(){return this.lines.length}get plainText(){for(var e="",t=this.pens,i=0,s=t.length;i<s;i++)e+=t[i].plainText;return e}get rawTextLength(){for(var e=0,t=this.pens,i=0,s=this.pens.length;i<s;i++)e+=t[i].rawTextLength;return e}getSliceTagText(e,t,i){if(void 0===e&&(e=0),void 0===t){var s=this.lastPen;if(null==s)return"";t=s.endIndex}void 0===i&&(i=!1);for(var a,n,r,o,h,l,d="",u=0,c=this.pens.length;u<c&&((o=(a=this.pens[u]).endIndex)<=e||(a=this.pens[u],n=i?a.wrapText:a.plainText,h=a.prop,(r=a.startIndex)>=e&&o<=t||(n=n.substring(e-r,t-r)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,n,h,l):d+=this.tagToText(n,h,l),l=h,!(o>=t)));u++);return d}}var D={},Y=j;const N=Phaser.Geom.Rectangle;var H=new P;var X=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return H.pushMultiple(this.hitAreas),this}add(e,t,i,s,a){var n=H.pop();return null===n?n=new N(t,i,s,a):n.setTo(t,i,s,a),n.key=e,this.hitAreas.push(n),this}contains(e,t){for(var i,s=this.hitAreas,a=0,n=s.length;a<n;a++)if((i=s[a]).contains(e,t))return i.key;return!1}drawBounds(e,t,i){void 0===t&&(t=16777215),i&&e.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,a=this.hitAreas,n=0,r=a.length;n<r;n++)s=a[n],e.lineStyle(1,t).strokeRect(s.x,s.y,s.width,s.height);return i&&e.restore(),this}},q=function(e,t,i,s){var a=this.hitAreaManager.contains(i,s);!1!==a&&(this.parent.emit(`${e}-${a}`,t,i,s),this.parent.emit(e,a,t,i,s))},U=function(){this.parent.on("pointerdown",(function(e,t,i,s){q.call(this,"areadown",e,t,i)}),this).on("pointerup",(function(e,t,i,s){q.call(this,"areaup",e,t,i)}),this)};const V=T.NO_NEWLINE,K=T.RAW_NEWLINE,J=T.WRAPPED_NEWLINE,$=T.NO_WRAP,Q=T.WORD_WRAP,Z=T.SPLITREGEXP;var ee=[],te=new P;te.newline=function(e,t,i){var s=this.pop();return null===s&&(s={}),s.text=e,s.width=t,s.newLineMode=i,s};var ie=function(e,t,i,s,a){s<=0&&(i=$);var n=ee;if(te.pushMultiple(n),!e||!e.length)return n;for(var r,o,h,l=e.split(Z),d=0,u=l.length;d<u;d++)if(r=l[d],h=d===u-1?V:K,i!==$){var c,p;if(o=0===d?s-a:s,r.length<=100)if((w=t(r))<=o){n.push(te.newline(r,w,h));continue}for(var g,f="",m="",v=0,y=0,x=(c=i===Q?r.split(" "):r).length;y<x;y++)p=c[y],i===Q?(f+=p,y<x-1&&(f+=" ")):f+=p,(g=t(f))>o&&(0===y?n.push(te.newline("",0,J)):(n.push(te.newline(m,v,J)),f=p,i===Q&&y<x-1&&(f+=" "),g=t(f)),o=s),m=f,v=g;n.push(te.newline(m,v,h))}else{var w=t(r);n.push(te.newline(r,w,h))}return n};const se=Phaser.Utils.Objects.GetValue,ae=T.NO_WRAP,ne=T.NO_NEWLINE;class re{constructor(e){this.parent=e.parent,this.context=se(e,"context",null),this.canvas=this.context.canvas,this.parser=se(e,"parser",null),this.defatultStyle=se(e,"style",null),this.autoRound=!0,this.pensPool=se(e,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new X;var t=this.context;this.getTextWidth=function(e){return t.measureText(e).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(e,t,i,s,a){if(void 0===a&&(a=this.penManager),a.freePens(),""===e)return a;for(var n,r,o,h,l,d=this.canvas,u=this.context,c=0,p=0,g=this.parser.splitText(e),f=0,m=g.length;f<m;f++)if(n=(h=this.parser.tagTextToProp(g[f],r)).plainText,(r=h.prop).img){var v=this.imageManager.getOuterWidth(r.img);i>0&&t!==ae&&i<c+v&&(a.addNewLinePen(),p+=s,c=0),a.addImagePen(c,p,v,L(r)),c+=v}else if(""!==n){var y;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,r)).buildFont(),o.syncFont(d,u),o.syncStyle(d,u);for(var x=0,w=(l=ie(n,this.getTextWidth,t,i,c)).length;x<w;x++)y=l[x],a.addTextPen(y.text,c,p,y.width,L(r),y.newLineMode),y.newLineMode!==ne?(c=0,p+=s):c+=y.width;this.context.restore()}return a}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var e=this.defatultStyle;return e.strokeThickness/2+e.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var e=this.penManager.linesCount,t=this.defatultStyle.maxLines;return t>0&&e>t&&(e=t),e}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var e=this.desplayLinesCount,t=this.defatultStyle.lineHeight*e;return e>0&&(t-=this.defatultStyle.lineSpacing),t}get imageManager(){return this.parent.imageManager}newPenManager(){return new Y({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(e,t,i){var s;if(null==e)s=this.penManager.plainText;else{var a=this.parser.splitText(e,1);s="";for(var n=0,r=a.length;n<r;n++)s+=a[n]}return null==t&&null==i||(null==t&&(t=0),null==i&&(i=s.length),s=s.substring(t,i)),s}getPenManager(e,t){if(void 0===e)return this.copyPenManager(t,this.penManager);void 0===t&&(t=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(e,i.wrapMode,i.wrapWidth,i.lineHeight,t),t}getText(e,t,i,s){if(null==e)return this.penManager.getSliceTagText(t,i,s);var a=this.tmpPenManager,n=this.defatultStyle;return this.updatePenManager(e,n.wrapMode,n.wrapWidth,n.lineHeight,a),a.getSliceTagText(t,i,s)}copyPenManager(e,t){return void 0===t&&(t=this.penManager),t.copy(e)}getTextWidth(e){return void 0===e&&(e=this.penManager),e.getMaxLineWidth()}getLastPen(e){return void 0===e&&(e=this.penManager),e.lastPen}}var oe={setInteractive:U};Object.assign(re.prototype,_,oe);var he=re;const le=Phaser.Utils.Objects.GetValue;var de,ue=class{constructor(e){this.textureManager=e,this.images={}}add(e,t){if("string"==typeof e)this._add(e,t);else if(Array.isArray(e))for(var i=0,s=(a=e).length;i<s;i++)this._add(a[i]);else{var a=e;for(var e in a)this._add(e,a[e])}return this}_add(e,t){void 0===t&&(t={key:e});var i=t.key,s=t.frame,a=t.width,n=t.height;if(void 0===a||void 0===n){var r=this.textureManager.getFrame(i,s),o=r?r.cutWidth:0,h=r?r.cutHeight:0;void 0===a&&void 0===n?(a=o,n=h):void 0===a?a=o*(n/h):void 0===n&&(n=h*(a/o))}this.images[e]={key:i,frame:s,width:a,height:n,y:le(t,"y",0),left:le(t,"left",0),right:le(t,"right",0)}}remove(e){return this.images.hasOwnProperty(e)&&delete this.images[e],this}get(e){return this.images.hasOwnProperty(e)||this.textureManager.exists(e)&&this.add(e),this.images[e]}getOuterWidth(e){var t=this.get(e);return t?t.width+t.left+t.right:0}getFrame(e){var t=this.get(e);return t?this.textureManager.getFrame(t.key,t.frame):void 0}hasTexture(e){return!!this.getFrame(e)}};const ce=Phaser.DOM.AddToDOM,pe=Phaser.Display.Canvas.CanvasPool,ge=Phaser.GameObjects.GameObject,fe=Phaser.Utils.Objects.GetValue,me=Phaser.DOM.RemoveFromDOM,ve=T.SPLITREGEXP;var ye={};class xe extends ge{constructor(e,t,i,s,a,n,r){if(void 0===t&&(t=0),void 0===i&&(i=0),super(e,n),this.renderer=e.sys.game.renderer,this.setPosition(t,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=pe.create(this),this.context=this.canvas.getContext("2d"),a&&a.hasOwnProperty("align")){var o=a.align;delete a.align,a.halign=o}this.style=new E(this,a),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=e.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=e.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),ye.hasOwnProperty(n)||(ye[n]=new P),this.canvasText=new he({parent:this,context:this.context,parser:r,style:this.style,pensPool:ye[n]}),a&&a.padding&&this.setPadding(a.padding),this.setText(s),e.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(e){this.setText(e)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",ce(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(e){return e||0===e||(e=""),Array.isArray(e)&&(e=e.join("\n")),e!==this._text&&(this._text=e.toString(),this.updateText()),this}setStyle(e){return this.style.setStyle(e)}setFont(e){return this.style.setFont(e)}setFontFamily(e){return this.style.setFontFamily(e)}setFontSize(e){return this.style.setFontSize(e)}setFontStyle(e){return this.style.setFontStyle(e)}setFixedSize(e,t){return this.style.setFixedSize(e,t)}setBackgroundColor(e){return this.style.setBackgroundColor(e)}setFill(e){return this.style.setFill(e)}setColor(e){return this.style.setColor(e)}setStroke(e,t){return this.style.setStroke(e,t)}setShadow(e,t,i,s,a,n){return this.style.setShadow(e,t,i,s,a,n)}setShadowOffset(e,t){return this.style.setShadowOffset(e,t)}setShadowColor(e){return this.style.setShadowColor(e)}setShadowBlur(e){return this.style.setShadowBlur(e)}setShadowStroke(e){return this.style.setShadowStroke(e)}setShadowFill(e){return this.style.setShadowFill(e)}setWrapMode(e){return this.style.setWrapMode(e)}setWrapWidth(e){return this.style.setWrapWidth(e)}setAlign(e){return this.style.setHAlign(e)}setLineSpacing(e){return this.style.setLineSpacing(e)}setPadding(e,t,i,s){if("object"==typeof e){var a=e,n=fe(a,"x",null);null!==n?(e=n,i=n):(e=fe(a,"left",0),i=fe(a,"right",e));var r=fe(a,"y",null);null!==r?(t=r,s=r):(t=fe(a,"top",0),s=fe(a,"bottom",t))}else void 0===e&&(e=0),void 0===t&&(t=e),void 0===i&&(i=e),void 0===s&&(s=t);return this.padding.left=e,this.padding.top=t,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}setResolution(e){return this.style.setResolution(e)}setMaxLines(e){return this.style.setMaxLines(e)}updateText(e){void 0===e&&(e=!0);var t=this.canvasText,i=this.style;e&&t.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,a,n=this.padding;0===i.fixedWidth?(this.width=t.linesWidth+n.left+n.right,s=t.linesWidth):(this.width=i.fixedWidth,(s=this.width-n.left-n.right)<t.linesWidth&&(s=t.linesWidth)),0===i.fixedHeight?(this.height=t.linesHeight+n.top+n.bottom,a=t.linesHeight):(this.height=i.fixedHeight,(a=this.height-n.top-n.bottom)<t.linesHeight&&(a=t.linesHeight));var r=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;r*=h,o*=h,r=Math.max(Math.ceil(r),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,d=this.context;l.width!==r||l.height!==o?(l.width=r,l.height=o,this.frame.setSize(r,o)):d.clearRect(0,0,r,o),d.save(),d.scale(h,h),t.draw(n.left,n.top,s,a),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var e=we.ToJSON(this),t={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return e.data=t,e}preDestroy(){this.style.rtl&&me(this.canvas),pe.remove(this.canvas),this.canvasText.destroy()}setInteractive(e,t,i){return ge.prototype.setInteractive.call(this,e,t,i),this.canvasText.setInteractive(),this}getWrappedText(e,t,i){return(e=this.canvasText.getText(e,t,i,!0)).split(ve)}getPlainText(e,t,i){return this.canvasText.getPlainText(e,t,i)}getText(e,t,i){return this.canvasText.getText(e,t,i,!1)}getSubString(e,t,i){return this.getText(e,t,i)}copyPenManager(e){return this.canvasText.copyPenManager(e)}getPenManager(e,t){return this.canvasText.getPenManager(e,t)}setSize(e,t){return this.setFixedSize(e,t)}resize(e,t){return this.setFixedSize(e,t)}set lineSpacing(e){this.setLineSpacing(e)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return e=this.scene.textures,void 0===de&&(de=new ue(e)),de;var e}addImage(e,t){return this.imageManager.add(e,t),this}drawAreaBounds(e,t){return this.canvasText.hitAreaManager.drawBounds(e,t,this),this}}const we=Phaser.GameObjects.Components;Phaser.Class.mixin(xe,[we.Alpha,we.BlendMode,we.ComputedSize,we.Crop,we.Depth,we.Flip,we.GetBounds,we.Mask,we.Origin,we.Pipeline,we.ScrollFactor,we.Tint,we.Transform,we.Visible,y]);var Te=xe,be={plainText:null,prevProp:null},ke=new E;var Se=function(e){for(var t,i,s,a={},n=0,r=(e=e.split(";")).length;n<r;n++)if(i=(t=e[n].split(":"))[0],s=t[1],!Ge(i)&&!Ge(s)){switch(i){case"stroke":var o=s.split(" ");s={},(l=o.length)>=1&&(s.color=o[0]),l>=2&&(s.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var h=s.split(" ");s={},(l=h.length)>=1&&(s.color=h[0]),l>=2&&(s.offsetX=parseInt(h[1].replace("px",""))),l>=3&&(s.offsetY=parseInt(h[2].replace("px",""))),l>=4&&(s.blur=parseInt(h[3].replace("px","")));break;case"u":case"underline":var l,d=s.split(" ");s={},(l=d.length)>=1&&(s.color=d[0]),l>=2&&(s.thinkness=parseInt(d[1].replace("px",""))),l>=3&&(s.offset=parseInt(d[2].replace("px","")))}a[i]=s}return a},Ge=function(e){return 0===(e=e.replace(Ce,"")).length},Ee=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,_e=/<\s*class=/i,Pe=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Oe=/<\s*style=/i,Me=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Ce=/^\s+|\s+$/,Ae=class{constructor(e){void 0===e&&(e={}),this.tags=e}addTag(e,t){this.tags[e]=t}splitText(e,t){for(var i,s,a,n=[],r=0,o=e.length,h=o;i=Ee.exec(e);)s=i[0],r<(h=Ee.lastIndex-s.length)&&n.push(e.substring(r,h)),void 0===t?n.push(s):1===t&&(_e.test(s)?(a=s.match(Pe),n.push(a[2])):Oe.test(s)&&(a=s.match(Me),n.push(a[2]))),r=Ee.lastIndex;return r<o&&n.push(e.substring(r,o)),n}tagTextToProp(e,t){var i,s;if(_e.test(e)){if(null!=(r=e.match(Pe))){var a=r[1],n=this.tags;(s=n.hasOwnProperty(a)?n[a]:{})._class=a,i=r[2]}}else if(Oe.test(e)){var r;if(null!=(r=e.match(Me))){var o=r[1];(s=Se(o))._style=o,i=r[2]}}null==i&&(i=e),null==s&&(s={});var h=be;return h.plainText=i,h.prop=s,h}propToContextStyle(e,t){var i=ke;if(t.hasOwnProperty("img"))i.image=t.img;else{if(i.image=null,t.hasOwnProperty("family")||t.hasOwnProperty("fontFamily")||t.hasOwnProperty("font-family")){var s=t.hasOwnProperty("family")?t.family:t.hasOwnProperty("fontFamily")?t.fontFamily:t["font-family"];i.fontFamily=s}else i.fontFamily=e.fontFamily;if(t.hasOwnProperty("size")||t.hasOwnProperty("fontSize")||t.hasOwnProperty("font-size")){var a=t.hasOwnProperty("size")?t.size:t.hasOwnProperty("fontSize")?t.fontSize:t["font-size"];"number"==typeof a&&(a=a.toString()+"px"),i.fontSize=a}else i.fontSize=e.fontSize;if(t.hasOwnProperty("style")||t.hasOwnProperty("fontStyle")||t.hasOwnProperty("font-style")){var n=t.hasOwnProperty("style")?t.style:t.hasOwnProperty("fontStyle")?t.fontStyle:t["font-style"];i.fontStyle=n}else i.fontStyle=e.fontStyle;if(t.hasOwnProperty("color")||t.hasOwnProperty("font-color")){t.hasOwnProperty("color")?t.color:t["font-color"];i.color=t.color}else i.color=e.color;if(t.hasOwnProperty("stroke")){var r=t.stroke;i.stroke=r.hasOwnProperty("color")?r.color:e.stroke,i.strokeThickness=r.hasOwnProperty("thinkness")?r.thinkness:e.strokeThickness}else i.stroke=e.stroke,i.strokeThickness=e.strokeThickness}if(t.hasOwnProperty("shadow")){var o=t.shadow;i.shadowColor=o.hasOwnProperty("color")?o.color:e.shadowColor,i.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:e.shadowOffsetX,i.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:e.shadowOffsetY,i.shadowBlur=o.hasOwnProperty("blur")?o.blur:e.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=e.shadowColor,i.shadowOffsetX=e.shadowOffsetX,i.shadowOffsetY=e.shadowOffsetY,i.shadowBlur=e.shadowBlur,i.shadowStroke=e.shadowStroke,i.shadowFill=e.shadowFill;if(t.hasOwnProperty("u")||t.hasOwnProperty("underline")){var h=t.hasOwnProperty("u")?t.u:t.underline;i.underlineColor=h.hasOwnProperty("color")?h.color:e.underlineColor,i.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:e.underlineThickness,i.underlineOffset=h.hasOwnProperty("offset")?h.offset:e.underlineOffset}else i.underlineColor=e.underlineColor,i.underlineThickness=e.underlineThickness,i.underlineOffset=e.underlineOffset;return i}propToTagText(e,t,i){return t.hasOwnProperty("_class")?""===e&&this.isTextTag(t._class)?"":"<class='"+t._class+"'>"+e+"</class>":t.hasOwnProperty("_style")?"<style='"+t._style+"'>"+e+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(e){var t=this.tags[e];return!!t&&null==t.img}};const Ie=Phaser.Utils.Objects.GetValue;var Le=class extends Te{constructor(e,t,i,s,a){var n=Ie(a,"tags",void 0),r=new Ae(n);super(e,t,i,s,a,"rexTagText",r),this.parser=r}addTag(e,t){return this.parser.addTag(e,t),this.updateText(!0)}addTags(e){for(var t in e)this.parser.addTag(t,e[t]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const We=Phaser.Utils.Objects.GetAdvancedValue,Be=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(e,t,i,s){var a=new Le(this.scene,e,t,i,s);return this.scene.add.existing(a),a})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(e,t){var i=We(e,"text",""),s=We(e,"style",null),a=We(e,"padding",null);null!==a&&(s.padding=a),void 0!==t&&(e.add=t);var n=new Le(this.scene,0,0,i,s);return Be(this.scene,n,e),n.autoRound=We(e,"autoRound",!0),n.resolution=We(e,"resolution",1),n}));var Fe=Le,Re={setEventEmitter(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(e){return this._eventEmitter&&e&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const ze=Phaser.Scene;var je=function(e){return e instanceof ze},De=function(e){return je(e)?e:e.scene&&je(e.scene)?e.scene:e.parent&&e.parent.scene&&je(e.parent.scene)?e.parent.scene:void 0};const Ye=Phaser.Utils.Objects.GetFastValue,Ne=Phaser.Utils.Objects.GetValue;class He{constructor(e,t){this.gameObject=e,this.scene=De(e),this.setEventEmitter(Ne(t,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(t),this.boot()}resetFromJSON(e){this.setTypeMode(Ne(e,"typeMode",0)),this.setTypeSpeed(Ne(e,"speed",333)),this.setTextCallback=Ye(e,"setTextCallback",null),this.setTextCallbackScope=Ye(e,"setTextCallbackScope",null),this.typingIdx=Ye(e,"typingIdx",0),this.text=Xe(Ye(e,"text","")),this.textLen=Ye(e,"textLen",0),this.insertIdx=Ye(e,"insertIdx",null);var t=Ye(e,"elapsed",null);return null!==t&&this.start(void 0,void 0,this.typingIdx,t),this}toJSON(){var e,t=this.getTimer();return e=t?t.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:e}}boot(){return this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(e){return"string"==typeof e&&(e=qe[e]),this.typeMode=e,this}setTypeSpeed(e){return this.speed=e,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(e,t,i,s){return void 0!==e&&this.setTypingContent(e),void 0!==t&&(this.speed=t),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(s),this}appendText(e){var t=this.text.concat(Xe(e));return this.isTyping?this.setTypingContent(t):this.start(t,void 0,this.textLen),this}stop(e){return this.getTimer()&&this.freeTimer(),e&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var e=this.getTimer();return e&&(e.paused=!0),this}resume(){var e=this.getTimer();return e&&(e.paused=!1),this}setTypingContent(e){return this.text=Xe(e),this.textLen=this.getTextLength(this.text),this}onTyping(){var e=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(e),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(e,t,i,s){var a;if(0===s){var n=0,r=t;this.insertIdx=r,a=this.getSubString(e,n,r)}else if(1===s){n=(r=i)-t;this.insertIdx=0,a=this.getSubString(e,n,r)}else if(2===s){var o=i/2;r=(n=Math.floor(o-t/2))+t;this.insertIdx=t%2?t:0,a=this.getSubString(e,n,r)}else if(3===s){var h,l=Math.floor(t/2);if(l>0){n=(r=i)-l;h=this.getSubString(e,n,r)}else h="";var d,u=t-l;if(u>0){r=(n=0)+u;this.insertIdx=r,d=this.getSubString(e,n,r)}else d="",this.insertIdx=0;a=d+h}return a}startTimer(e){var t;return this.timer&&this.freeTimer(),void 0===e?(0,t=0):(this.speed,t=e),this.timer=this.scene.time.addEvent({delay:0,startAt:t,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(e){this.setTextCallback&&(e=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,e,this.isLastChar,this.insertIdx):this.setTextCallback(e,this.isLastChar,this.insertIdx)),this.gameObject.setText(e)}getTextLength(e){var t=this.gameObject;return t.getPlainText?t.getPlainText(e).length:e.length}getSubString(e,t,i){var s=this.gameObject;return s.getSubString?s.getSubString(e,t,i):e.slice(t,i)}}Object.assign(He.prototype,Re);var Xe=function(e){return Array.isArray(e)?e=e.join("\n"):"number"==typeof e&&(e=e.toString()),e};const qe={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var Ue=He,Ve=class extends c{constructor(e,t,i){super(),this.x=e,this.y=t,this.isIntro=i,this.hideEndDialogueMarkerOnMessageComplete=!1,this.endDialogueMarkerGraphics=null,this.character=null,this.characterWidth=null,this.characterExpression=null,this.speechBubbleGraphics=null,this.speechBubbleText=null,this.expressions={},this.expressions.default={y:-90},this.expressions.surprise={y:-105},this.expressions.sadness={y:-80},this.expressions.despair={y:-70},this.expressions.glee={y:-100},this.expressions.nervous={y:-85},this.expressions.confused={y:-100},this.expressions.neutral={y:-90},this.expressions.amused={y:-95},this.expressions.thoughtful={y:-70},this.isTalking=!1}create(e){const t=this;this.characterWidth=250;this.speechBubbleGraphics=e.add.graphics({fillStyle:{color:16777215}}),this.isIntro&&this.speechBubbleGraphics.setAlpha(0);const i=this.isIntro?this.y-40:this.y,s=this.isIntro?this.y+130+20-40:this.y+130+20,a=this.isIntro?this.y+130-40:this.y+130;this.speechBubbleGraphics.setDepth(1),this.speechBubbleGraphics.fillRoundedRect(this.x,i,760,130,10),this.speechBubbleGraphics.fillTriangle(this.x+120,s,this.x+105,a,this.x+135,a),this.endDialogueMarkerGraphics=e.add.graphics({fillStyle:{color:13421772}}),this.endDialogueMarkerGraphics.setDepth(1),this.hideEndDialogueMarker();const n=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(n),e.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const r=u;r.wrap={mode:"word",width:730},r.tags={exclamation:{fontStyle:"bold"}},this.speechBubbleText=new Fe(e,this.x+15,this.y+15,"",r),this.speechBubbleText.setDepth(1),e.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new Ue(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{t.messageCompleted.call(t)});const o=this.isIntro?this.x-this.characterWidth:this.x+this.characterWidth/2;this.character=e.add.container(o,this.y+130+230);const h=e.add.image(0,0,"guide_character");this.character.add(h);const l=this.isIntro?"expression_surprise":"expression_default",d=this.isIntro?this.expressions.surprise.y:this.expressions.default.y;this.characterExpression=e.add.sprite(-10,d,l),this.character.add(this.characterExpression);e.tweens.addCounter({duration:100,yoyo:!0,loop:-1,loopDelay:2e3,from:0,to:1,onUpdate:e=>{const i=15*e.getValue();this.characterExpression.setCrop(0,i,t.characterExpression.width,t.characterExpression.height)}});const c=e.tweens.createTimeline();this.isIntro?(c.add({delay:200,targets:this.character,x:this.x+this.characterWidth/2,duration:400,angle:15,ease:"Power1"}),c.add({targets:this.character,duration:400,angle:-7,ease:"Power1"}),c.add({targets:this.character,duration:400,angle:0,ease:"Power1"}),c.add({offset:"-=300",targets:this.speechBubbleGraphics,props:{y:{value:"+=40",duration:500,ease:"Bounce.easeOut"},alpha:{value:1,duration:300,ease:"Linear"}},onComplete:()=>{this.emit("ready")}})):c.add({targets:this.speechBubbleGraphics,duration:100,onComplete:()=>{this.emit("ready")}}),c.play()}displayMessage(e,t){this.isTalking=!0,this.hideEndDialogueMarker();const i=this.convertDialogToTagText(e);this.speechBubbleTextTyping.start(i),this.hideEndDialogueMarkerOnMessageComplete=t}messageCompleted(){this.isTalking=!1,this.hideEndDialogueMarkerOnMessageComplete||this.showEndDialogueMarker()}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}updateExpression(e,t){this.characterExpression.setTexture("expression_"+e),this.characterExpression.isCropped=!1;const i=this.expressions[e];t.tweens.add({targets:this.characterExpression,y:i.y,duration:200,ease:"Power1"})}hide(e){e.tweens.add({targets:this.character,x:this.x-this.characterWidth,duration:800,angle:-15,ease:"Power1"}),e.tweens.add({targets:[this.speechBubbleGraphics,this.speechBubbleText],alpha:0,duration:200})}convertDialogToTagText(e){const t=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let i="",s="";for(let a=0;a<e.length;a++){const n=e[a],r=t.some(e=>e.token===n);if(0!==a||r||(i+='<class="normal">',s="normal"),a!==e.length-1||!r)if(r){const e=t.find(e=>e.token===n);s===e.className?(i+="</class>",i+='<class="normal">',s="normal"):(0!==a&&(i+="</class>"),i+=`<class="${e.className}">`,s=e.className)}else i+=e[a]}return i+="</class>",i}};const Ke=e=>e[Math.floor(Math.random()*e.length)];var Je=0,$e=1,Qe=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],Ze=class extends c{constructor(e,t,i,s,a,n,r,o,h){super(),this.isInitialized=!1,this.isBlocked=!0,this.offsetX=s,this.offsetY=a,this.tileSize=i,this.tileGridHeight=t,this.tileGridWidth=e,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=n,this.onTileMatch=r,this.tileGenerationBehavior=o,this.matchSound=null,this.swapSound=null,this.queue=h,this.matches=0,this.preSetTileGrid=[[0,0,2,3,0,0],[3,2,2,3,3,2],[3,2,1,0,3,2],[1,1,0,1,0,0],[3,2,1,0,3,2],[3,2,2,3,3,2]];for(let i=0;i<2*t;i++){this.tileGrid[i]=[];for(let t=0;t<e;t++)this.tileGrid[i][t]=null}}create(e){this.tileImageContainer=e.add.container();const t=e.make.graphics();t.fillStyle(16777215,1),t.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(e,t),this.matchSounds=[e.sound.add("match"),e.sound.add("match_combo_01"),e.sound.add("match_combo_02"),e.sound.add("match_combo_03"),e.sound.add("match_combo_04"),e.sound.add("match_combo_05")],this.matchSound=this.matchSounds[0],this.swapSound=e.sound.add("swap")}update(e){const t=this;if(!t.isInitialized)return;const i=t.getMatches();i.length>0&&(t.matches++,t.onTileMatch(e,i),t.emit("match"));let s=[];if(i.forEach(t=>{s.push(t.destroy(e,this.tileImageContainer))}),s.length>0&&(t.matchSound.play(),t.queue.push(()=>Promise.all(s))),t.forEachTile((e,i,s)=>{null!==e&&e.state===$e&&(t.tileGrid[s][i]=null)}),s.length>0)return;let a=[];for(let i=0;i<this.tileGridWidth;i++){let s=2*this.tileGridHeight-1;for(;s>=0;){if(null===t.tileGrid[s][i]){let n=s-1;for(;n>=0;){let r=t.tileGrid[n][i];null!==r&&(t.tileGrid[s][i]=r,t.tileGrid[n][i]=null,a.push(this.getTileDrop(e,r,i,s)),s--),n--}}s--}}t.forEachPlayableTile((i,s,a)=>{if(null===i){const i=a-t.tileGridHeight,n=t.createTile(t.getTileType(s,a,t.tileGenerationBehavior),s,i,!1);t.tileGrid[i][s]=n,n.create(e),t.tileImageContainer.add(n.image)}}),a.length>0&&t.queue.push(()=>Promise.all(a))}swapTiles(e,t,i){let s=this;s.swapSound.play(),s.queue.push(()=>{let a=t.x,n=t.y,r=t.tileGridX,o=t.tileGridY,h=i.x,l=i.y,d=i.tileGridX,u=i.tileGridY,c=i.updatePosition(e,a,n,r,o);s.tileGrid[o][r]=i;let p=t.updatePosition(e,h,l,d,u);return s.tileGrid[u][d]=t,Promise.all([c,p])})}hasMatches(e,t){return this.getMatches(e,t).length>0}getMatches(e,t){const i=this,s=[];return i.forEachTile((a,n,r)=>{if(void 0!==e&&n!==e&&void 0!==t&&r!==t)return;if(!this.isPlayable(a))return;const o=a.tileType,h=[],l=[];let d=n+1;for(;d<i.tileGridWidth;){const e=i.tileGrid[r][d];if(null==e||o.name!==e.tileType.name)break;h.push(e),d++}for(d=n-1;d>0;){const e=i.tileGrid[r][d];if(null==e||o.name!==e.tileType.name)break;h.push(e),d--}let u=r+1;for(;u<i.tileGridHeight;){const e=i.tileGrid[u][n];if(null==e||o.name!==e.tileType.name)break;l.push(e),u++}for(u=r-1;u>0;){const e=i.tileGrid[u][n];if(null==e||o.name!==e.tileType.name)break;l.push(e),u--}l.length>1&&s.push(...l),h.length>1&&s.push(...h),(l.length>1||h.length>1)&&s.push(a)}),s}forEachTile(e){for(let t=0;t<2*this.tileGridHeight;t++)for(let i=0;i<this.tileGridWidth;i++)e(this.tileGrid[t][i],i,t)}forEachPlayableTile(e){for(let t=this.tileGridHeight;t<2*this.tileGridHeight;t++)for(let i=0;i<this.tileGridWidth;i++)e(this.tileGrid[t][i],i,t)}createTile(e,t,i,s,a){return new class{constructor(e,t,i,s,a,n,r,o){this.tileType=e,this.x=t,this.y=i,this.tileGridX=s,this.tileGridY=a,this.onTileSelect=o,this.image=null,this.state=Je,this.isActivated=!1,this.isBlocked=r,this.initialDrag=void 0===n?1:n,this.hasDragged=void 0===n}create(e){this.image=e.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(e,this)}),this.isBlocked&&this.image.setAlpha(0)}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(e,t,i,s,a,n){const r=this,o=Math.abs(r.y-i);return new Promise((h,l)=>{r.x=t,r.y=i,r.tileGridX=s,r.tileGridY=a;const d={targets:r.image,x:t,y:i,ease:n?"Linear":"Power1",duration:n?Math.max(o,150):500,onComplete:()=>{h()}};this.hasDragged||(d.delay=200-200*r.initialDrag,d.alpha=.5,d.ease="Sine",this.hasDragged=!0),e.tweens.add(d)})}destroy(e,t){let i=this;if(i.state===$e)return;i.state=$e;const s=e.add.image(i.x,i.y,i.tileType.imageKey);s.setTintFill(16777215),s.alpha=0;const a=[];for(let t=0;t<8;t++){const t=e.add.graphics({fillStyle:{color:16777215},alpha:0}),i=new Phaser.Geom.Circle(this.x,this.y,Phaser.Math.Between(0,10));t.fillCircleShape(i),a.push(t)}return new Promise((n,r)=>{t.remove(i.image),i.image.destroy(),s.setAlpha(1),e.tweens.add({targets:s,alpha:0,duration:250,ease:"Cubic.easeOut",onComplete:()=>{t.remove(s),s.destroy(),a.forEach(e=>{t.remove(e),e.destroy()}),n()}}),a.forEach((t,i)=>{t.setAlpha(1);let s=null,a=null;switch(i){case 0:a="-";case 1:s="+",a="-";break;case 2:s="+";break;case 3:s="+",a="+";break;case 4:a="+";break;case 5:a="+",s="-";case 6:s="-";break;case 7:a="-",s="-"}const n={targets:t,alpha:0,duration:250,ease:"Cubic.easeOut"};null!=s&&(n.x=s+"=45"),null!=a&&(n.y=a+"=45"),e.tweens.add(n)})})}block(e){this.isBlocked=!0,e.tweens.add({targets:this.image,alpha:.5,duration:100})}unblock(e){this.isBlocked=!1,e.tweens.add({targets:this.image,alpha:1,duration:100})}}(e,this.getTileX(t),this.getTileY(i),t,i,a,s,this.onTileSelect)}getTileDrop(e,t,i,s){return t.updatePosition(e,this.getTileX(i),this.getTileY(s),i,s,!0)}getTileX(e){return this.offsetX+this.tileSize*e}getTileY(e){return this.offsetY+this.tileSize*e}canSelect(e){return this.isPlayable(e)}isPlayable(e){return null!=e&&!e.isBlocked&&e.tileGridY>this.tileGridHeight-1}getTileType(e,t,i){const s=t<1?null:this.tileGrid[t-1][e],a=t>=this.tileGridHeight-1||!this.tileGrid[t+1]?null:this.tileGrid[t+1][e],n=e<1?null:this.tileGrid[t][e-1],h=e>=this.tileGridWidth-1||!this.tileGrid[t]?null:this.tileGrid[t][e+1];return Ke(i!==r||null==s&&null==a&&null==n&&null==h?i===o?Qe.filter(e=>!(null!==a&&e.name===a.tileType.name||null!==h&&e.name===h.tileType.name||null!==n&&e.name===n.tileType.name)):Qe.filter(e=>!(null!==s&&e.name===s.tileType.name||null!==n&&e.name===n.tileType.name)):[s,a,n,h].filter(e=>null!=e).map(e=>e.tileType))}block(e,t){this.isBlocked=!0,this.forEachTile((i,s,a)=>i&&(void 0===t||!t.some(e=>e[1]===s&&e[0]===a))&&i.block(e))}unblock(e){this.isBlocked=!1,this.forEachTile(t=>t&&t.unblock(e))}fill(e){for(let t=0;t<this.tileGridHeight;t++)for(let i=0;i<this.tileGridWidth;i++){const s=this.tileGenerationBehavior===h?this.getPreSetTileType(i,t):this.getTileType(i,t,n),a=this.createTile(s,i,t,!0,(this.tileGridWidth-i)/this.tileGridWidth);a.create(e),this.tileGrid[t][i]=a}this.isBlocked=!0,this.isInitialized=!0}updateTileGenerationBehavior(e){this.tileGenerationBehavior=e}getPreSetTileType(e,t){return Qe[this.preSetTileGrid[t][e]]}updateMatchSound(e){const t=e>=this.matchSounds.length?this.matchSounds.length-1:e;this.matchSound=this.matchSounds[t]}},et=class extends c{constructor(e,t,i){super(),this.x=e,this.y=t,this.text=null,this.icon=null,this.warningTweens=null,this.warningIcon=null,this.warningSound=null,this.timerRunOutSound=null,this.ticks=i,this.isPaused=!0,this.isDisplayingWarning=!1}create(e){this.icon=e.add.image(this.x+15,this.y+15,"icon_timer").setAlpha(.7),this.warningIcon=e.add.image(this.x+15,this.y+15,"icon_timer_warning").setAlpha(0),this.warningSound=e.sound.add("warning_tick"),this.timerRunOutSound=e.sound.add("timer_run_out"),this.text=e.add.text(this.x+40,this.y,this.getTimeOutput(this.ticks),u),this.tick(e);const t=this;e.time.addEvent({delay:1e3,callback:()=>{t.tick(e)},callbackScope:this,loop:!0})}tick(e){this.ticks<=0||this.isPaused||(this.ticks<=30&&!this.isDisplayingWarning&&this.displayWarning(e),this.ticks<=10&&this.warningSound.play(),1===this.ticks&&(this.timerRunOutSound.play(),this.warningTweens.forEach(e=>{e.stop(0)})),this.emit("tick"),this.ticks--,this.output())}update(e){this.ticks=e,this.output()}start(){this.isPaused=!1}stop(){this.isPaused=!0}getTimeOutput(e){let t=e%60;return t<10&&(t="0"+t),`${Math.floor(e/60)}:${t}`}output(){this.text.setText(this.getTimeOutput(this.ticks))}displayWarning(e){this.isDisplayingWarning=!0,this.warningTweens=[],this.warningTweens.push(e.tweens.add({targets:[this.icon,this.warningIcon],angle:-60,duration:400,yoyo:!0,repeat:-1})),this.warningTweens.push(e.tweens.add({targets:this.warningIcon,alpha:.6,duration:300,repeatDelay:100,yoyo:!0,repeat:-1}))}},tt=i(2),it=i.n(tt),st=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.isReadyForRoundTransition=!1,this.isTransitioningRounds=!1,this.isBlockingMatches=!1,this.score=null,this.comboCount=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.levelClearMessage=null,this.levelClearMessageHighlight=null,this.director=null,this.guide=null,this.level=null,this.emitter=null,this.totalMatches=null,this.tileSelectSound=null}preload(){it.a.load({google:{families:[u.googleFontName]}}),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.image("guide_character","assets/images/guide.png"),this.load.image("background","assets/images/background.png"),this.load.image("round_clear","assets/images/round_clear.png"),this.load.image("icon_tile","assets/images/icon_tile.png"),this.load.image("icon_timer","assets/images/icon_timer.png"),this.load.image("icon_timer_warning","assets/images/icon_timer_warning.png"),this.load.image("icon_audio","assets/images/icon_audio.png"),this.load.image("icon_audio_mute","assets/images/icon_audio_mute.png"),this.load.image("expression_default","assets/images/expression_default.png"),this.load.image("expression_surprise","assets/images/expression_surprise.png"),this.load.image("expression_sadness","assets/images/expression_sadness.png"),this.load.image("expression_despair","assets/images/expression_despair.png"),this.load.image("expression_glee","assets/images/expression_glee.png"),this.load.image("expression_nervous","assets/images/expression_nervous.png"),this.load.image("expression_confused","assets/images/expression_confused.png"),this.load.image("expression_neutral","assets/images/expression_neutral.png"),this.load.image("expression_amused","assets/images/expression_amused.png"),this.load.image("expression_thoughtful","assets/images/expression_thoughtful.png"),this.load.audio("match","assets/sounds/match.wav"),this.load.audio("match_combo_01","assets/sounds/match_combo_01.wav"),this.load.audio("match_combo_02","assets/sounds/match_combo_02.wav"),this.load.audio("match_combo_03","assets/sounds/match_combo_03.wav"),this.load.audio("match_combo_04","assets/sounds/match_combo_04.wav"),this.load.audio("match_combo_05","assets/sounds/match_combo_05.wav"),this.load.audio("swap","assets/sounds/swap.wav"),this.load.audio("tile_select","assets/sounds/tile_select.wav"),this.load.audio("warning_tick","assets/sounds/warning_tick.wav"),this.load.audio("timer_run_out","assets/sounds/timer_run_out.wav")}init(e){this.level=e.level||0}create(){this.isTransitioningRounds=!1,this.isRoundTransitionComplete=!1,this.isBlockingMatches=l[this.level].blockMatching,this.score=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(e){var t=this;t.queuedActions.push(()=>{e().then(()=>{t.currentAction=null})})}},this.add.image(400,330,"background");const e=l[this.level].behavior;this.selectedTiles=[],this.tileGrid=new Ze(6,6,80,325,-265,this.onTileSelect,this.onTileMatch,e,this.queue),this.scoreDisplay=new class{constructor(e,t){this.x=e,this.y=t,this.scoreBackground=null,this.scoreIcon=null,this.scoreText=null,this.score=0}create(e){this.scoreBackground=e.add.graphics({fillStyle:{color:14414079}}).setAlpha(.5),this.scoreBackground.fillRoundedRect(this.x-150,this.y-10,300,90,10),this.scoreIcon=e.add.image(this.x+15,this.y+15,"icon_tile").setAlpha(.7),this.scoreText=e.add.text(this.x+40,this.y,this.score,u),this.updateScore(this.score)}updateScore(e){this.score=e,this.scoreText.setText(e)}hide(e){e.tweens.add({targets:[this.scoreBackground,this.scoreIcon,this.scoreText],x:"-=300",duration:300})}}(110,585);const t=l[this.level].timer;this.timer=t>0?new et(110,625,t):null,this.guide=new Ve(20,20,0===this.level),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this),this.emitter=new c,this.levelClearMessage=this.add.image(400,400,"round_clear"),this.levelClearMessage.setAlpha(0),this.levelClearMessage.setDepth(1),this.levelClearMessageHighlight=this.add.image(400,400,"round_clear"),this.levelClearMessageHighlight.setAlpha(0),this.levelClearMessageHighlight.setDepth(1),this.levelClearMessageHighlight.setTintFill(16777215);const i=d.getScript(this.level);this.director=new class{constructor(e,t,i,s,a,n,r){this.guide=t,this.timer=i,this.scoreDisplay=s,this.tileGrid=a,this.scene=n,this.gameOverSubscriptions=[],this.queuedActions=null,this.isGuideReady=!1;const o=this;this.guide.on("ready",()=>{o.isGuideReady=!0,o.next(r)}),this.queueActions(e)}queueActions(e,t){if(!e)return;const i=this;null===i.queuedActions&&(i.queuedActions=[]),i.queuedActions.push(...e),i.next(t)}next(e){if(!this.isGuideReady)return;if(this.guide.isTalking)return;if(0===this.queuedActions.length)return;const t=this.queuedActions.shift();if("string"==typeof t){const e=this.queuedActions.every(e=>"string"!=typeof e);this.handleMessage(t,e)}else t.hasOwnProperty("do")?(this.handleAction(t.do,t.value,e),this.next(e)):t.hasOwnProperty("on")&&(this.handleEvent(t.on,t.actions,t.filter,e,t.persist),this.next(e))}handleMessage(e,t){this.guide.displayMessage(e,t)}handleAction(e,t,i){switch(e){case"dropTiles":this.tileGrid.fill(i);break;case"unblockTileGrid":this.tileGrid.unblock(i);break;case"blockTileGrid":this.tileGrid.block(i,t);break;case"updateTileGenerationBehavior":this.tileGrid.updateTileGenerationBehavior(t);break;case"updateGuideExpression":this.guide.updateExpression(t,i);break;case"hideGuide":this.guide.hide(i);break;case"startTimer":this.timer.start();break;case"updateTimer":this.timer.ticks=t;break;case"stopTimer":this.timer.stop();break;case"updateTimerRelativeToScore":const e=l[this.scene.level];this.timer.update(this.getScoreRelativeTicks(e.timer,this.scene.score,e.score));break;case"hideScoreDisplay":this.scoreDisplay.hide(i);break;case"endLevel":this.scene.endLevel();break;case"revokeLevelTransition":this.scene.isTransitioningRounds=!1;break;case"revokeBlockMatching":this.scene.isBlockingMatches=!1}}handleEvent(e,t,i,s,a){let n=null;switch(e){case"match":n=this.tileGrid;break;case"swap":case"win":case"gameOver":n=this.scene.emitter;break;case"tick":n=this.timer}this.setUpEvent(n,e,t,i,s,a)}setUpEvent(e,t,i,s,a,n){const r=this;e.on(t,this.wrapFilter(s),()=>{r.queuedActions=[],r.queueActions(i,a)},n)}wrapFilter(e){const t=this;return void 0===e?null:()=>e(t.getCurrentState())}getCurrentState(){return{matches:this.tileGrid.matches,score:this.scene.score,ticks:this.timer?this.timer.ticks:null}}getScoreRelativeTicks(e,t,i){return Math.max(Math.trunc(e-t/i*e),1)}}(i,this.guide,this.timer,this.scoreDisplay,this.tileGrid,this,this);const a=this;this.input.on("pointerdown",()=>{a.director.next(a)}),this.tileSelectSound=this.sound.add("tile_select"),new s(40,640).create(this)}update(){if(!this.isTransitioningRounds){if(!this.isRoundTransitionComplete)return null!=this.timer&&this.timer.ticks<=0?(this.isTransitioningRounds=!0,void this.emitter.emit("gameOver")):this.isLevelComplete()?(this.isTransitioningRounds=!0,this.tileGrid.block(this),void this.emitter.emit("win")):void(this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this)));this.nextLevel()}}onTileSelect(e,t){if(!e.queue.isActionRunning()&&!e.queue.hasActions()&&!e.guide.isBlockingGameplay&&e.tileGrid.canSelect(t)){if(e.comboCount=0,e.tileGrid.updateMatchSound(e.comboCount),t.isActivated)return e.selectedTiles=[],void t.deactivate();if(0===e.selectedTiles.length)return e.tileSelectSound.play(),e.selectedTiles.push(t),void t.activate();if(1===e.selectedTiles.length){const i=e.selectedTiles[0],s=Math.abs(i.tileGridX-t.tileGridX),a=Math.abs(i.tileGridY-t.tileGridY);if(1===s&&0===a||0===s&&1===a){e.selectedTiles.push(t);let i=e.selectedTiles[0],s=e.selectedTiles[1];e.tileGrid.swapTiles(e,i,s),e.emitter.emit("swap"),e.queue.push(()=>((e.isBlockingMatches||!e.tileGrid.hasMatches(i.tileGridX,i.tileGridY)&&!e.tileGrid.hasMatches(s.tileGridX,s.tileGridY))&&e.tileGrid.swapTiles(e,i,s),Promise.resolve())),e.clearSelectedTiles(e)}}}}clearSelectedTiles(e){e.selectedTiles.forEach(e=>{e.deactivate()}),e.selectedTiles=[]}onTileMatch(e,t){t.some(e=>e.isActivated)&&e.clearSelectedTiles(e),e.totalMatches++,e.comboCount++,e.tileGrid.updateMatchSound(e.comboCount),e.score+=t.length,e.scoreDisplay.updateScore(e.score)}isLevelComplete(){return this.score>=l[this.level].score}endLevel(){const e=this;e.levelClearMessageHighlight.setAlpha(1),e.tweens.add({targets:e.levelClearMessageHighlight,alpha:0,duration:1e3}),e.tweens.add({targets:e.levelClearMessage,alpha:1,duration:1e3,completeDelay:2e3,onComplete:()=>{e.isRoundTransitionComplete=!0,e.isTransitioningRounds=!1}})}nextLevel(){this.scene.restart({level:this.level+1})}};const at={type:Phaser.AUTO,width:800,height:700,scene:[a,st]};new Phaser.Game(at)}]);
//# sourceMappingURL=bundle.js.map