!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const i=e=>e[Math.floor(Math.random()*e.length)];var r=0,o=1,l=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}];n(1);const u={type:Phaser.AUTO,width:800,height:1200,scene:{preload:function(){this.load.image("tile_01","assets/tile_01.png"),this.load.image("tile_02","assets/tile_02.png"),this.load.image("tile_03","assets/tile_03.png"),this.load.image("tile_04","assets/tile_04.png")},create:function(){a.create(this)},update:function(){if(s.isActionRunning())return;if(s.hasActions())return void s.next();a.update(this)}}},s=(new Phaser.Game(u),new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(e){var t=this;t.queuedActions.push(()=>{e().then(()=>{t.currentAction=null})})}});let c=[];const a=new class{constructor(e,t,n,r,o,u,s){this.offsetX=r,this.offsetY=o,this.tileSize=n,this.tileGridHeight=t,this.tileGridWidth=e,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=u,this.queue=s;for(let n=0;n<2*t;n++){this.tileGrid[n]=[];for(let t=0;t<e;t++){const e=n<1?null:this.tileGrid[n-1][t],r=t<1?null:this.tileGrid[n][t-1],o=i(l.filter(t=>!(null!==e&&t.name===e.tileType.name||null!==r&&t.name===r.tileType.name)));this.tileGrid[n][t]=this.createTile(o,t,n)}}}create(e){this.tileImageContainer=e.add.container(),this.forEachTile(t=>{t.create(e),this.tileImageContainer.add(t.image)});const t=e.make.graphics();t.fillStyle(16777215,1),t.fillRect(this.offsetX/2,this.offsetY/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize)}update(e){const t=this,n=t.getMatches();let i=[];n.forEach(t=>{i.push(t.destroy(e,this.tileImageContainer))}),i.length>0&&t.queue.push(()=>Promise.all(i));let r=[];t.forEachTile((e,n,i)=>{if(t.tileGrid[i][n].state===o){t.tileGrid[i][n]=null;let e=r.find(e=>e.x===n);void 0===e?r.push({x:n,y:i}):e.y=i}});let l=[];r.forEach(({x:n,y:i})=>{let r=null,o=i;for(;o>=0&&null==(r=t.tileGrid[o][n]);)o--;if(null!=r){let u=i;for(;o>=0;)null!==r?(t.tileGrid[o][n]=null,t.tileGrid[u][n]=r,l.push(this.getTileDrop(e,r,n,u)),u--,--o>=0&&(r=t.tileGrid[o][n])):(u--,o--)}}),l.length>0&&t.queue.push(()=>Promise.all(l))}swapTiles(e,t,n){let i=this;i.queue.push(()=>{let r=t.x,o=t.y,l=t.tileGridX,u=t.tileGridY,s=n.x,c=n.y,a=n.tileGridX,f=n.tileGridY,p=n.updatePosition(e,r,o,l,u);i.tileGrid[u][l]=n;let h=t.updatePosition(e,s,c,a,f);return i.tileGrid[f][a]=t,Promise.all([p,h])})}hasMatches(e,t){return this.getMatches(e,t).length>0}getMatches(e,t){const n=this,i=[];return n.forEachTile((r,o,l)=>{if(void 0!==e&&o!==e&&void 0!==t&&l!==t)return;const u=r.tileType,s=[],c=[];let a=o+1;for(;a<n.tileGridWidth;){const e=n.tileGrid[l][a];if(null==e||u.name!==e.tileType.name)break;s.push(e),a++}for(a=o-1;a>0;){const e=n.tileGrid[l][a];if(null==e||u.name!==e.tileType.name)break;s.push(e),a--}let f=l+1;for(;f<n.tileGridHeight;){const e=n.tileGrid[f][o];if(null==e||u.name!==e.tileType.name)break;c.push(e),f++}for(f=l-1;f>0;){const e=n.tileGrid[f][o];if(null==e||u!==e.tileType)break;c.push(e),f--}c.length>1&&i.push(...c),s.length>1&&i.push(...s),(c.length>1||s.length>1)&&i.push(r)}),i}forEachTile(e){for(let t=0;t<2*this.tileGridHeight;t++)for(let n=0;n<this.tileGridWidth;n++)null!=this.tileGrid[t][n]&&e(this.tileGrid[t][n],n,t)}createTile(e,t,n){return new class{constructor(e,t,n,i,o,l){this.tileType=e,this.x=t,this.y=n,this.tileGridX=i,this.tileGridY=o,this.onTileSelect=l,this.image=null,this.state=r}create(e){this.image=e.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(e,this)})}activate(){this.image.setTintFill(16777215)}deactivate(){this.image.clearTint()}updatePosition(e,t,n,i,r){let o=this;return new Promise((l,u)=>{o.x=t,o.y=n,o.tileGridX=i,o.tileGridY=r,e.tweens.add({targets:o.image,x:t,y:n,ease:"Power1",duration:500,onComplete:()=>{l()}})})}destroy(e,t){let n=this;return new Promise((i,r)=>{e.tweens.add({targets:n.image,alpha:0,ease:"Power1",duration:500,onComplete:()=>{t.remove(n.image),n.image.destroy(),n.state=o,i()}})})}}(e,this.getTileX(t),this.getTileY(n),t,n,this.onTileSelect)}getTileDrop(e,t,n,i){return t.updatePosition(e,this.getTileX(n),this.getTileY(i),n,i)}getTileX(e){return this.offsetX+this.tileSize*e}getTileY(e){return this.offsetY+this.tileSize*e}canSelect(e){return e.tileGridY>this.tileGridHeight-1}}(10,10,50,50,50,function(e,t){if(s.isActionRunning())return;if(!a.canSelect(t))return;if(0===c.length)return c.push(t),void t.activate();if(1===c.length){const n=c[0],i=Math.abs(n.tileGridX-t.tileGridX),r=Math.abs(n.tileGridY-t.tileGridY);if(1===i&&0===r||0===i&&1===r){c.push(t);let n=c[0],i=c[1];a.swapTiles(e,n,i),s.push(()=>(a.hasMatches(n.tileGridX,n.tileGridY)||a.hasMatches(i.tileGridX,i.tileGridY)||a.swapTiles(e,n,i),Promise.resolve())),c.forEach(e=>{e.deactivate()}),c=[]}}},s)},function(e,t,n){(function(e){var i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++)n[t[i]]=Object.getOwnPropertyDescriptor(e,t[i]);return n},r=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(u(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,l=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),s=i[n];n<o;s=i[++n])g(s)||!w(s)?l+=" "+s:l+=" "+u(s);return l},t.deprecate=function(n,i){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),r=!0}return n.apply(this,arguments)}};var o,l={};function u(e,n){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),d(n)?i.showHidden=n:n&&t._extend(i,n),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=s),a(i,e,i.depth)}function s(e,t){var n=u.styles[t];return n?"["+u.colors[n][0]+"m"+e+"["+u.colors[n][1]+"m":e}function c(e,t){return e}function a(e,n,i){if(e.customInspect&&n&&O(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,e);return m(r)||(r=a(e,r,i)),r}var o=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(m(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(y(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(o)return o;var l=Object.keys(n),u=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(l);if(e.showHidden&&(l=Object.getOwnPropertyNames(n)),G(n)&&(l.indexOf("message")>=0||l.indexOf("description")>=0))return f(n);if(0===l.length){if(O(n)){var s=n.name?": "+n.name:"";return e.stylize("[Function"+s+"]","special")}if(v(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(T(n))return e.stylize(Date.prototype.toString.call(n),"date");if(G(n))return f(n)}var c,w="",j=!1,S=["{","}"];(h(n)&&(j=!0,S=["[","]"]),O(n))&&(w=" [Function"+(n.name?": "+n.name:"")+"]");return v(n)&&(w=" "+RegExp.prototype.toString.call(n)),T(n)&&(w=" "+Date.prototype.toUTCString.call(n)),G(n)&&(w=" "+f(n)),0!==l.length||j&&0!=n.length?i<0?v(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=j?function(e,t,n,i,r){for(var o=[],l=0,u=t.length;l<u;++l)P(t,String(l))?o.push(p(e,t,n,i,String(l),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(p(e,t,n,i,r,!0))}),o}(e,n,i,u,l):l.map(function(t){return p(e,n,i,u,t,j)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,w,S)):S[0]+w+S[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,i,r,o){var l,u,s;if((s=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?u=s.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):s.set&&(u=e.stylize("[Setter]","special")),P(i,r)||(l="["+r+"]"),u||(e.seen.indexOf(s.value)<0?(u=g(n)?a(e,s.value,null):a(e,s.value,n-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n")):u=e.stylize("[Circular]","special")),b(l)){if(o&&r.match(/^\d+$/))return u;(l=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=e.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=e.stylize(l,"string"))}return l+": "+u}function h(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function g(e){return null===e}function y(e){return"number"==typeof e}function m(e){return"string"==typeof e}function b(e){return void 0===e}function v(e){return w(e)&&"[object RegExp]"===j(e)}function w(e){return"object"==typeof e&&null!==e}function T(e){return w(e)&&"[object Date]"===j(e)}function G(e){return w(e)&&("[object Error]"===j(e)||e instanceof Error)}function O(e){return"function"==typeof e}function j(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(b(o)&&(o=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!l[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var i=e.pid;l[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,i,e)}}else l[n]=function(){};return l[n]},t.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=d,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=m,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=v,t.isObject=w,t.isDate=T,t.isError=G,t.isFunction=O,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(3);var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(e=new Date,n=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":"),[e.getDate(),x[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(4),t._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e};var E="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function z(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(E&&e[E]){var t;if("function"!=typeof(t=e[E]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,E,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,i=new Promise(function(e,i){t=e,n=i}),r=[],o=0;o<arguments.length;o++)r.push(arguments[o]);r.push(function(e,i){e?n(e):t(i)});try{e.apply(this,r)}catch(e){n(e)}return i}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),E&&Object.defineProperty(t,E,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=E,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],i=0;i<arguments.length;i++)n.push(arguments[i]);var r=n.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var o=this,l=function(){return r.apply(o,arguments)};t.apply(this,n).then(function(t){e.nextTick(l,null,t)},function(t){e.nextTick(z,t,l)})}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,i(t)),n}}).call(this,n(2))},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:l}catch(e){i=l}}();var s,c=[],a=!1,f=-1;function p(){a&&s&&(a=!1,s.length?c=s.concat(c):f=-1,c.length&&h())}function h(){if(!a){var e=u(p);a=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,a=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===l||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||a||u(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}]);
//# sourceMappingURL=bundle.js.map