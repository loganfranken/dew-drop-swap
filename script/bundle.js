!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2)}([function(e,t){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var s=Phaser.Renderer.WebGL.Utils;e.exports=function(e,t,i,r,n){if(0!==t.width&&0!==t.height){var a=t.frame,h=a.width,o=a.height,l=s.getTintAppendFloatAlpha;this.pipeline.batchTexture(t,a.glTexture,h,o,t.x,t.y,h/t.style.resolution,o/t.style.resolution,t.scaleX,t.scaleY,t.rotation,t.flipX,t.flipY,t.scrollFactorX,t.scrollFactorY,t.displayOriginX,t.displayOriginY,0,0,h,o,l(t._tintTL,r.alpha*t._alphaTL),l(t._tintTR,r.alpha*t._alphaTR),l(t._tintBL,r.alpha*t._alphaBL),l(t._tintBR,r.alpha*t._alphaBR),t._isTinted&&t.tintFill,0,0,r,n)}}},function(e,t){e.exports=function(e,t,s,i,r){0!==t.width&&0!==t.height&&e.batchSprite(t,t.frame,i,r)}},function(e,t,s){"use strict";s.r(t);var i=class extends Phaser.Scene{constructor(){super("TitleScene")}preload(){this.load.image("background","assets/background.png"),this.load.image("title","assets/title.png"),this.load.image("start","assets/start.png"),this.load.image("start-active","assets/start_active.png"),this.load.image("tile_01","assets/tile_01.png"),this.load.image("tile_02","assets/tile_02.png"),this.load.image("tile_03","assets/tile_03.png"),this.load.image("tile_04","assets/tile_04.png")}create(){const e=this;this.add.image(400,400,"background");const t=this.add.graphics({fillStyle:{color:16777215}});t.setAlpha(0);const s=new Phaser.Geom.Rectangle(0,0,800,700);t.fillRectShape(s);const i=[];i.push({imageKey:"tile_01",xChange:"+=180",yChange:"+=180",angle:15,scale:.8}),i.push({imageKey:"tile_02",xChange:"+=200",yChange:"-=180",angle:15,scale:1}),i.push({imageKey:"tile_03",xChange:"-=180",yChange:"+=180",angle:-15,scale:.9}),i.push({imageKey:"tile_04",xChange:"-=200",yChange:"-=180",angle:-5,scale:.8}),i.push({imageKey:"tile_01",xChange:"+=0",yChange:"-=180",angle:-15,scale:.7}),i.push({imageKey:"tile_02",xChange:"+=0",yChange:"+=180",angle:-15,scale:1}),i.push({imageKey:"tile_03",xChange:"+=290",yChange:"+=30",angle:15,scale:.8}),i.push({imageKey:"tile_01",xChange:"-=290",yChange:"+=40",angle:-15,scale:.9}),i.forEach(t=>{t.tile=e.add.image(400,230,t.imageKey),t.tile.setAlpha(0),t.tile.setScale(.5,.5)});const r=this.add.image(400,230,"title");r.setAlpha(0),r.setScale(2,2);const n=this.add.image(400,550,"start");n.setInteractive({cursor:"pointer"}),n.setAlpha(0);const a=this.add.image(400,550,"start");a.setAlpha(0),a.setTintFill(16777215);const h=this.add.image(400,550,"start-active");h.setAlpha(0),n.on("pointerover",()=>{e.tweens.add({targets:h,alpha:1,duration:100,ease:"Sine.easeInOut"})}),n.on("pointerout",()=>{e.tweens.add({targets:h,alpha:0,duration:100,ease:"Sine.easeInOut"})}),n.on("pointerdown",()=>{e.scene.start("RoundScene",{level:0})});const o=this.tweens.createTimeline();o.add({delay:400,targets:r,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Quad.easeIn"}),i.forEach((e,t)=>{o.add({targets:e.tile,x:e.xChange,y:e.yChange,scaleX:1,scaleY:1,alpha:1,scaleX:e.scale,scaleY:e.scale,angle:e.angle,duration:300,ease:"Quad.easeOut",offset:0===t?"-=0":"-=300"})}),o.add({targets:t,alpha:1,duration:30,offset:"-=300"}),o.add({targets:t,alpha:0,duration:700,offset:1500,ease:"Quad.easeIn"}),o.add({targets:[n,a],alpha:1,offset:2200,duration:100}),o.add({targets:a,alpha:0,duration:300,offset:2300,ease:"Quad.easeOut"}),o.play()}},r=s(0),n=s.n(r),a=s(1),h=s.n(a),o={renderWebGL:n.a,renderCanvas:h.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const l=Phaser.Display.Canvas.CanvasPool;var d=function(e){var t=l.create(this),s=t.getContext("2d");e.syncFont(t,s);var i=Math.ceil(s.measureText(e.testString).width*e.baselineX),r=i,n=2*r;r=r*e.baselineY|0,t.width=i,t.height=n,s.fillStyle="#f00",s.fillRect(0,0,i,n),s.font=e._font,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(e.testString,0,r);var a={ascent:0,descent:0,fontSize:0};if(!s.getImageData(0,0,i,n))return a.ascent=r,a.descent=r+6,a.fontSize=a.ascent+a.descent,l.remove(t),a;var h,o,d=s.getImageData(0,0,i,n).data,u=d.length,c=4*i,g=0,p=!1;for(h=0;h<r;h++){for(o=0;o<c;o+=4)if(255!==d[g+o]){p=!0;break}if(p)break;g+=c}for(a.ascent=r-h,g=u-c,p=!1,h=n;h>r;h--){for(o=0;o<c;o+=4)if(255!==d[g+o]){p=!0;break}if(p)break;g-=c}return a.descent=h-r,a.fontSize=a.ascent+a.descent,l.remove(t),a},u={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const c=Phaser.Utils.Objects.GetAdvancedValue,g=Phaser.Utils.Objects.GetValue;var p={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const f={none:u.NO_WRAP,word:u.WORD_WRAP,char:u.CHAR_WRAP,character:u.CHAR_WRAP};var y=class{constructor(e,t){this.parent=e,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(t,!1);var s=g(t,"metrics",!1);this.metrics=s?{ascent:g(s,"ascent",0),descent:g(s,"descent",0),fontSize:g(s,"fontSize",0)}:d(this)}setStyle(e,t){if(void 0===t&&(t=!0),e&&e.hasOwnProperty("wrap")){var s=e.wrap;if(s.hasOwnProperty("mode")){var i=s.mode;"string"==typeof i&&(s.mode=f[i])}else s.hasOwnProperty("width")&&(s.mode=1)}for(var r in e&&e.hasOwnProperty("fontSize")&&"number"==typeof e.fontSize&&(e.fontSize=e.fontSize.toString()+"px"),p)this[r]="wrapCallback"===r||"wrapCallbackScope"===r?g(e,p[r][0],p[r][1]):c(e,p[r][0],p[r][1]);var n=g(e,"font",null);this._font=null===n?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:n;var a=g(e,"fill",null);return null!==a&&(this.color=a),t?this.update(!0):this.parent}syncFont(e,t){t.font=this._font}syncStyle(e,t){t.textBaseline="alphabetic",t.fillStyle=this.color,t.strokeStyle=this.stroke,t.lineWidth=this.strokeThickness,t.lineCap="round",t.lineJoin="round"}syncShadow(e,t){t?(e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor=0,e.shadowBlur=0)}update(e){return e&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=d(this)),this.parent.updateText(e)}buildFont(){var e=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return e!==this._font&&(this._font=e),this}setFont(e){return"string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=g(e,"fontFamily","Courier"),this.fontSize=g(e,"fontSize","16px"),this.fontStyle=g(e,"fontStyle","")),this.update(!0)}setFontFamily(e){return this.fontFamily=e,this.update(!0)}setFontStyle(e){return this.fontStyle=e,this.update(!0)}setFontSize(e){return"number"==typeof e&&(e=e.toString()+"px"),this.fontSize=e,this.update(!0)}setTestString(e){return this.testString=e,this.update(!0)}setFixedSize(e,t){return this.fixedWidth=e,this.fixedHeight=t,e&&(this.parent.width=e),t&&(this.parent.height=t),this.update(!1)}setResolution(e){return this.resolution=e,this.update(!1)}setLineSpacing(e){return this.lineSpacing=e,this.update(!1)}setBackgroundColor(e){return this.backgroundColor=e,this.update(!1)}setFill(e){return this.color=e,this.update(!1)}setColor(e){return this.color=e,this.update(!1)}setStroke(e,t){return void 0===e?this.strokeThickness=0:(void 0===t&&(t=this.strokeThickness),this.stroke=e,this.strokeThickness=t),this.update(!0)}setShadow(e,t,s,i,r,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===n&&(n=!0),this.shadowOffsetX=e,this.shadowOffsetY=t,this.shadowColor=s,this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=n,this.update(!1)}setShadowOffset(e,t){return void 0===e&&(e=0),void 0===t&&(t=e),this.shadowOffsetX=e,this.shadowOffsetY=t,this.update(!1)}setShadowColor(e){return void 0===e&&(e="#000"),this.shadowColor=e,this.update(!1)}setShadowBlur(e){return void 0===e&&(e=0),this.shadowBlur=e,this.update(!1)}setShadowStroke(e){return this.shadowStroke=e,this.update(!1)}setShadowFill(e){return this.shadowFill=e,this.update(!1)}setUnderline(e,t,s){return void 0===e&&(e="#000"),void 0===t&&(t=0),void 0===s&&(s=0),this.underlineColor=e,this.underlineThickness=t,this.underlineOffset=s,this.update(!1)}setUnderlineColor(e){return void 0===e&&(e="#000"),this.underlineColor=e,this.update(!1)}setUnderlineThickness(e){return void 0===e&&(e=0),this.underlineThickness=e,this.update(!1)}setUnderlineOffset(e){return void 0===e&&(e=0),this.underlineOffset=e,this.update(!1)}setWrapMode(e){return"string"==typeof e&&(e=f[e.toLowerCase()]||0),this.wrapMode=e,this.update(!0)}setWrapWidth(e){return this.wrapWidth=e,this.update(!1)}setAlign(e,t){return void 0===e&&(e="left"),void 0===t&&(t="top"),this.halign=e,this.valign=t,this.update(!1)}setHAlign(e){return void 0===e&&(e="left"),this.halign=e,this.update(!1)}setVAlign(e){return void 0===e&&(e="top"),this.valign=e,this.update(!1)}setMaxLines(e){return void 0===e&&(e=0),this.maxLines=e,this.update(!1)}getTextMetrics(){var e=this.metrics;return{ascent:e.ascent,descent:e.descent,fontSize:e.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var e={};for(var t in p)e[t]=this[t];return e.metrics=this.getTextMetrics(),e}destroy(){this.parent=void 0}},m={draw(e,t,s,i){var r=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save(),this.drawBackground(this.defatultStyle.backgroundColor);var a=this.defatultStyle;e+=this.startXOffset,t+=this.startYOffset;var h,o,l,d,u,c,g=a.halign,p=a.valign,f=a.lineHeight,y=r.lines,m=y.length,v=a.maxLines;v>0&&m>v?(o=v,l="center"===p?Math.floor((m-o)/2):"bottom"===p?m-o:0):(o=m,l=0),d=l+o,c="center"===p?Math.max((i-o*f)/2,0):"bottom"===p?Math.max(i-o*f-2,0):0,c+=t;for(var x=l;x<d;x++)if(0!==(h=r.getLineWidth(x))){u="center"===g?(s-h)/2:"right"===g?s-h:0,u+=e;for(var w=y[x],T=0,S=w.length;T<S;T++)this.drawPen(w[T],u,c)}n.restore()},drawPen(e,t,s){t+=e.x,s+=e.y;var i=this.canvas,r=this.context;r.save();var n=this.parser.propToContextStyle(this.defatultStyle,e.prop);n.buildFont(),n.syncFont(i,r),n.syncStyle(i,r),n.underlineThickness>0&&e.width>0&&this.drawUnderline(t,s,e.width,n),e.isTextPen&&this.drawText(t,s,e.text,n),e.isImagePen&&this.drawImage(t,s,e.prop.img,n),r.restore(),e.hasAreaMarker&&e.width>0&&this.hitAreaManager.add(e.prop.area,t,s-this.startYOffset,e.width,this.defatultStyle.lineHeight)},clear(){var e=this.canvas;this.context.clearRect(0,0,e.width,e.height)},drawBackground(e){null!==e&&(this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(e,t,s,i){t+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(e=Math.round(e),t=Math.round(t));var r=this.context,n=r.lineCap;r.lineCap="butt",r.beginPath(),r.strokeStyle=i.underlineColor,r.lineWidth=i.underlineThickness,r.moveTo(e,t),r.lineTo(e+s,t),r.stroke(),r.lineCap=n},drawText(e,t,s,i){this.autoRound&&(e=Math.round(e),t=Math.round(t));var r=this.context;i.strokeThickness&&(i.syncShadow(r,i.shadowStroke),r.strokeText(s,e,t)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(s,e,t))},drawImage(e,t,s,i){var r=this.parent.imageManager,n=r.get(s),a=r.getFrame(s);e+=n.left,t+=-this.startYOffset+n.y,this.autoRound&&(e=Math.round(e),t=Math.round(t)),this.context.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,e,t,n.width,n.height)}};var v=class{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(e){return this.items.push(e),this}pushMultiple(e){return this.items.push.apply(this.items,e),e.length=0,this}clear(){return this.items.length=0,this}};const x=Phaser.Utils.Objects.GetValue,w=u.NO_NEWLINE,T=u.RAW_NEWLINE;var S=class{constructor(e){this.prop={},this.resetFromJSON(e)}resetFromJSON(e){this.text=x(e,"text",""),this.x=x(e,"x",0),this.y=x(e,"y",0),this.width=x(e,"width",0);var t=x(e,"prop",null);null===t&&(t={}),this.prop=t,this.newLineMode=x(e,"newLineMode",0),this.startIndex=x(e,"startIndex",0)}get plainText(){var e=this.text;return this.newLineMode===T&&(e+="\n"),e}get wrapText(){var e=this.text;return this.newLineMode!==w&&(e+="\n"),e}get rawTextLength(){var e=this.text.length;return this.newLineMode===T&&(e+=1),e}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},b=function(e){if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]},P=function(e,t){var s=Array.isArray(e);if(void 0===t?t=s?[]:{}:b(t),s){t.length=e.length;for(var i=0,r=e.length;i<r;i++)t[i]=e[i]}else for(var n in e)t[n]=e[n];return t},k=function(){};const M=Phaser.Utils.Objects.GetFastValue,O=u.NO_NEWLINE,C=u.WRAPPED_NEWLINE;var _=new v,G=new v;class L{constructor(e){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=M(e,"pensPool",_),this.LinesPool=M(e,"linesPool",G),this.tagToText=M(e,"tagToText",k),this.tagToTextScope=M(e,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var e=0,t=this.lines.length;e<t;e++)this.lines[e].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(e,t,s,i,r,n){var a=this.PensPool.pop();return null==a&&(a=new S),A.text=e,A.x=t,A.y=s,A.width=i,A.prop=r,A.newLineMode=n,a.resetFromJSON(A),this.addPen(a),this}addImagePen(e,t,s,i){return this.addTextPen("",e,t,s,i,O),this}addNewLinePen(){var e=this.lastPen,t=e?e.lastX:0,s=e?e.y:0,i=e?P(e.prop):null;return this.addTextPen("",t,s,0,i,C),this}addPen(e){var t=this.lastPen;e.startIndex=null==t?0:t.endIndex,this.pens.push(e);var s=this.lastLine;null==s&&(s=this.LinesPool.pop()||[],this.lines.push(s)),s.push(e),e.newLineMode!==O&&(s=this.LinesPool.pop()||[],this.lines.push(s)),this.maxLinesWidth=void 0}clone(e){null==e&&(e=new L),e.freePens();for(var t=0,s=this.lines.length;t<s;t++)for(var i=this.lines[t],r=0,n=i.length;r<n;r++){var a=i[r];e.addPen(a.text,a.x,a.y,a.width,P(a.prop),a.newLineMode)}return e}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(e){if(e>=this.lines.length)return this.getLineEndIndex(e);var t=this.lines[e];return t&&t[0]?t[0].startIndex:0}getLineEndIndex(e){e>=this.lines.length&&(e=this.lines.length-1);var t,s,i=!1;for(t=e;t>=0&&!(i=null!=(s=this.lines[t])&&s.length>0);t--);return i?s[s.length-1].endIndex:0}getLineWidth(e){var t=this.lines[e];if(!t)return 0;var s=t[t.length-1];return null==s?0:s.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var e,t=0,s=0,i=this.lines.length;s<i;s++)(e=this.getLineWidth(s))>t&&(t=e);return this.maxLinesWidth=t,t}getLineWidths(){for(var e=[],t=0,s=this.lines.length;t<s;t++)e.push(this.getLineWidth(t));return e}get linesCount(){return this.lines.length}get plainText(){for(var e="",t=this.pens,s=0,i=t.length;s<i;s++)e+=t[s].plainText;return e}get rawTextLength(){for(var e=0,t=this.pens,s=0,i=this.pens.length;s<i;s++)e+=t[s].rawTextLength;return e}getSliceTagText(e,t,s){if(void 0===e&&(e=0),void 0===t){var i=this.lastPen;if(null==i)return"";t=i.endIndex}void 0===s&&(s=!1);for(var r,n,a,h,o,l,d="",u=0,c=this.pens.length;u<c&&((h=(r=this.pens[u]).endIndex)<=e||(r=this.pens[u],n=s?r.wrapText:r.plainText,o=r.prop,(a=r.startIndex)>=e&&h<=t||(n=n.substring(e-a,t-a)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,n,o,l):d+=this.tagToText(n,o,l),l=o,!(h>=t)));u++);return d}}var A={},E=L;const W=Phaser.Geom.Rectangle;var I=new v;var F=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return I.pushMultiple(this.hitAreas),this}add(e,t,s,i,r){var n=I.pop();return null===n?n=new W(t,s,i,r):n.setTo(t,s,i,r),n.key=e,this.hitAreas.push(n),this}getFirstHitArea(e,t){for(var s,i=this.hitAreas,r=0,n=i.length;r<n;r++)if((s=i[r]).contains(e,t))return s;return null}drawBounds(e,t,s){void 0===t&&(t=16777215),s&&e.save().scaleCanvas(s.scaleX,s.scaleY).rotateCanvas(s.rotation).translateCanvas(s.x,s.y);for(var i,r=this.hitAreas,n=0,a=r.length;n<a;n++)i=r[n],e.lineStyle(1,t).strokeRect(i.x,i.y,i.width,i.height);return s&&e.restore(),this}},R=function(e,t,s,i){var r=this.hitAreaManager.getFirstHitArea(s,i);if(null!==r){var n=r.key;this.parent.emit(`${e}-${n}`,t,s,i),this.parent.emit(e,n,t,s,i)}},z=function(){this.parent.on("pointerdown",(function(e,t,s,i){R.call(this,"areadown",e,t,s)}),this).on("pointerup",(function(e,t,s,i){R.call(this,"areaup",e,t,s)}),this)};const Y=u.NO_NEWLINE,B=u.RAW_NEWLINE,D=u.WRAPPED_NEWLINE,X=u.NO_WRAP,N=u.WORD_WRAP,j=u.SPLITREGEXP;var H=[],q=new v;q.newline=function(e,t,s){var i=this.pop();return null===i&&(i={}),i.text=e,i.width=t,i.newLineMode=s,i};var U=function(e,t,s,i,r){i<=0&&(s=X);var n=H;if(q.pushMultiple(n),!e||!e.length)return n;for(var a,h,o,l=e.split(j),d=0,u=l.length;d<u;d++)if(a=l[d],o=d===u-1?Y:B,s!==X){var c,g;if(h=0===d?i-r:i,a.length<=100)if((w=t(a))<=h){n.push(q.newline(a,w,o));continue}for(var p,f="",y="",m=0,v=0,x=(c=s===N?a.split(" "):a).length;v<x;v++)g=c[v],s===N?(f+=g,v<x-1&&(f+=" ")):f+=g,(p=t(f))>h&&(0===v?n.push(q.newline("",0,D)):(n.push(q.newline(y,m,D)),f=g,s===N&&v<x-1&&(f+=" "),p=t(f)),h=i),y=f,m=p;n.push(q.newline(y,m,o))}else{var w=t(a);n.push(q.newline(a,w,o))}return n};const K=Phaser.Utils.Objects.GetValue,V=u.NO_WRAP,J=u.NO_NEWLINE;class ${constructor(e){this.parent=e.parent,this.context=K(e,"context",null),this.canvas=this.context.canvas,this.parser=K(e,"parser",null),this.defatultStyle=K(e,"style",null),this.autoRound=!0,this.pensPool=K(e,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new F;var t=this.context;this.getTextWidth=function(e){return t.measureText(e).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(e,t,s,i,r){if(void 0===r&&(r=this.penManager),r.freePens(),""===e)return r;for(var n,a,h,o,l,d=this.canvas,u=this.context,c=0,g=0,p=this.parser.splitText(e),f=0,y=p.length;f<y;f++)if(n=(o=this.parser.tagTextToProp(p[f],a)).plainText,(a=o.prop).img){var m=this.imageManager.getOuterWidth(a.img);s>0&&t!==V&&s<c+m&&(r.addNewLinePen(),g+=i,c=0),r.addImagePen(c,g,m,P(a)),c+=m}else if(""!==n){var v;this.context.save(),(h=this.parser.propToContextStyle(this.defatultStyle,a)).buildFont(),h.syncFont(d,u),h.syncStyle(d,u);for(var x=0,w=(l=U(n,this.getTextWidth,t,s,c)).length;x<w;x++)v=l[x],r.addTextPen(v.text,c,g,v.width,P(a),v.newLineMode),v.newLineMode!==J?(c=0,g+=i):c+=v.width;this.context.restore()}return r}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var e=this.defatultStyle;return e.strokeThickness/2+e.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var e=this.penManager.linesCount,t=this.defatultStyle.maxLines;return t>0&&e>t&&(e=t),e}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var e=this.desplayLinesCount,t=this.defatultStyle.lineHeight*e;return e>0&&(t-=this.defatultStyle.lineSpacing),t}get imageManager(){return this.parent.imageManager}newPenManager(){return new E({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(e,t,s){var i;if(null==e)i=this.penManager.plainText;else{var r=this.parser.splitText(e,1);i="";for(var n=0,a=r.length;n<a;n++)i+=r[n]}return null==t&&null==s||(null==t&&(t=0),null==s&&(s=i.length),i=i.substring(t,s)),i}getPenManager(e,t){if(void 0===e)return this.copyPenManager(t,this.penManager);void 0===t&&(t=this.newPenManager());var s=this.defatultStyle;return this.updatePenManager(e,s.wrapMode,s.wrapWidth,s.lineHeight,t),t}getText(e,t,s,i){if(null==e)return this.penManager.getSliceTagText(t,s,i);var r=this.tmpPenManager,n=this.defatultStyle;return this.updatePenManager(e,n.wrapMode,n.wrapWidth,n.lineHeight,r),r.getSliceTagText(t,s,i)}copyPenManager(e,t){return void 0===t&&(t=this.penManager),t.copy(e)}getTextWidth(e){return void 0===e&&(e=this.penManager),e.getMaxLineWidth()}getLastPen(e){return void 0===e&&(e=this.penManager),e.lastPen}}var Q={setInteractive:z};Object.assign($.prototype,m,Q);var Z=$;const ee=Phaser.Utils.Objects.GetValue;var te,se=class{constructor(e){this.textureManager=e,this.images={}}add(e,t){if("string"==typeof e)this._add(e,t);else if(Array.isArray(e))for(var s=0,i=(r=e).length;s<i;s++)this._add(r[s]);else{var r=e;for(var e in r)this._add(e,r[e])}return this}_add(e,t){void 0===t&&(t={key:e});var s=t.key,i=t.frame,r=t.width,n=t.height;if(void 0===r||void 0===n){var a=this.textureManager.getFrame(s,i),h=a?a.cutWidth:0,o=a?a.cutHeight:0;void 0===r&&void 0===n?(r=h,n=o):void 0===r?r=h*(n/o):void 0===n&&(n=o*(r/h))}this.images[e]={key:s,frame:i,width:r,height:n,y:ee(t,"y",0),left:ee(t,"left",0),right:ee(t,"right",0)}}remove(e){return this.images.hasOwnProperty(e)&&delete this.images[e],this}get(e){return this.images.hasOwnProperty(e)||this.textureManager.exists(e)&&this.add(e),this.images[e]}getOuterWidth(e){var t=this.get(e);return t?t.width+t.left+t.right:0}getFrame(e){var t=this.get(e);return t?this.textureManager.getFrame(t.key,t.frame):void 0}hasTexture(e){return!!this.getFrame(e)}};const ie=Phaser.DOM.AddToDOM,re=Phaser.Display.Canvas.CanvasPool,ne=Phaser.GameObjects.GameObject,ae=Phaser.Utils.Objects.GetValue,he=Phaser.DOM.RemoveFromDOM,oe=u.SPLITREGEXP;var le={};class de extends ne{constructor(e,t,s,i,r,n,a){if(void 0===t&&(t=0),void 0===s&&(s=0),super(e,n),this.renderer=e.sys.game.renderer,this.setPosition(t,s),this.setOrigin(0,0),this.initPipeline(),this.canvas=re.create(this),this.context=this.canvas.getContext("2d"),r){if(r.hasOwnProperty("align")){var h=r.align;delete r.align,r.halign=h}r.hasOwnProperty("stroke")&&!r.hasOwnProperty("strokeThickness")&&(r.strokeThickness=1)}this.style=new y(this,r),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=e.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=e.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),le.hasOwnProperty(n)||(le[n]=new v),this.canvasText=new Z({parent:this,context:this.context,parser:a,style:this.style,pensPool:le[n]}),r&&r.padding&&this.setPadding(r.padding),this.setText(i),e.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(e){this.setText(e)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",ie(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(e){return e||0===e||(e=""),Array.isArray(e)&&(e=e.join("\n")),e!==this._text&&(this._text=e.toString(),this.updateText()),this}setStyle(e){return this.style.setStyle(e)}setFont(e){return this.style.setFont(e)}setFontFamily(e){return this.style.setFontFamily(e)}setFontSize(e){return this.style.setFontSize(e)}setFontStyle(e){return this.style.setFontStyle(e)}setFixedSize(e,t){return this.style.setFixedSize(e,t)}setBackgroundColor(e){return this.style.setBackgroundColor(e)}setFill(e){return this.style.setFill(e)}setColor(e){return this.style.setColor(e)}setStroke(e,t){return this.style.setStroke(e,t)}setShadow(e,t,s,i,r,n){return this.style.setShadow(e,t,s,i,r,n)}setShadowOffset(e,t){return this.style.setShadowOffset(e,t)}setShadowColor(e){return this.style.setShadowColor(e)}setShadowBlur(e){return this.style.setShadowBlur(e)}setShadowStroke(e){return this.style.setShadowStroke(e)}setShadowFill(e){return this.style.setShadowFill(e)}setWrapMode(e){return this.style.setWrapMode(e)}setWrapWidth(e){return this.style.setWrapWidth(e)}setAlign(e){return this.style.setHAlign(e)}setLineSpacing(e){return this.style.setLineSpacing(e)}setPadding(e,t,s,i){if("object"==typeof e){var r=e,n=ae(r,"x",null);null!==n?(e=n,s=n):(e=ae(r,"left",0),s=ae(r,"right",e));var a=ae(r,"y",null);null!==a?(t=a,i=a):(t=ae(r,"top",0),i=ae(r,"bottom",t))}else void 0===e&&(e=0),void 0===t&&(t=e),void 0===s&&(s=e),void 0===i&&(i=t);return this.padding.left=e,this.padding.top=t,this.padding.right=s,this.padding.bottom=i,this.updateText(!1)}setResolution(e){return this.style.setResolution(e)}setMaxLines(e){return this.style.setMaxLines(e)}updateText(e){void 0===e&&(e=!0);var t=this.canvasText,s=this.style;e&&t.updatePenManager(this._text,s.wrapMode,s.wrapWidth,s.lineHeight);var i,r,n=this.padding;0===s.fixedWidth?(this.width=t.linesWidth+n.left+n.right,i=t.linesWidth):(this.width=s.fixedWidth,(i=this.width-n.left-n.right)<t.linesWidth&&(i=t.linesWidth)),0===s.fixedHeight?(this.height=t.linesHeight+n.top+n.bottom,r=t.linesHeight):(this.height=s.fixedHeight,(r=this.height-n.top-n.bottom)<t.linesHeight&&(r=t.linesHeight));var a=this.width,h=this.height;this.updateDisplayOrigin();var o=s.resolution;a*=o,h*=o,a=Math.max(Math.ceil(a),1),h=Math.max(Math.ceil(h),1);var l=this.canvas,d=this.context;l.width!==a||l.height!==h?(l.width=a,l.height=h,this.frame.setSize(a,h)):d.clearRect(0,0,a,h),d.save(),d.scale(o,o),t.draw(n.left,n.top,i,r),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var e=ue.ToJSON(this),t={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return e.data=t,e}preDestroy(){this.style.rtl&&he(this.canvas),re.remove(this.canvas),this.canvasText.destroy()}setInteractive(e,t,s){return ne.prototype.setInteractive.call(this,e,t,s),this.canvasText.setInteractive(),this}getWrappedText(e,t,s){return(e=this.canvasText.getText(e,t,s,!0)).split(oe)}getPlainText(e,t,s){return this.canvasText.getPlainText(e,t,s)}getText(e,t,s){return this.canvasText.getText(e,t,s,!1)}getSubString(e,t,s){return this.getText(e,t,s)}copyPenManager(e){return this.canvasText.copyPenManager(e)}getPenManager(e,t){return this.canvasText.getPenManager(e,t)}setSize(e,t){return this.setFixedSize(e,t)}resize(e,t){return this.setFixedSize(e,t)}set lineSpacing(e){this.setLineSpacing(e)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return e=this.scene.textures,void 0===te&&(te=new se(e)),te;var e}addImage(e,t){return this.imageManager.add(e,t),this}drawAreaBounds(e,t){return this.canvasText.hitAreaManager.drawBounds(e,t,this),this}}const ue=Phaser.GameObjects.Components;Phaser.Class.mixin(de,[ue.Alpha,ue.BlendMode,ue.ComputedSize,ue.Crop,ue.Depth,ue.Flip,ue.GetBounds,ue.Mask,ue.Origin,ue.Pipeline,ue.ScrollFactor,ue.Tint,ue.Transform,ue.Visible,o]);var ce=de,ge={plainText:null,prevProp:null},pe=new y;var fe=function(e){for(var t,s,i,r={},n=0,a=(e=e.split(";")).length;n<a;n++)if(s=(t=e[n].split(":"))[0],i=t[1],!ye(s)&&!ye(i)){switch(s){case"stroke":var h=i.split(" ");i={},(l=h.length)>=1&&(i.color=h[0]),l>=2&&(i.thinkness=parseInt(h[1].replace("px","")));break;case"shadow":var o=i.split(" ");i={},(l=o.length)>=1&&(i.color=o[0]),l>=2&&(i.offsetX=parseInt(o[1].replace("px",""))),l>=3&&(i.offsetY=parseInt(o[2].replace("px",""))),l>=4&&(i.blur=parseInt(o[3].replace("px","")));break;case"u":case"underline":var l,d=i.split(" ");i={},(l=d.length)>=1&&(i.color=d[0]),l>=2&&(i.thinkness=parseInt(d[1].replace("px",""))),l>=3&&(i.offset=parseInt(d[2].replace("px","")))}r[s]=i}return r},ye=function(e){return 0===(e=e.replace(Se,"")).length},me=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,ve=/<\s*class=/i,xe=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,we=/<\s*style=/i,Te=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Se=/^\s+|\s+$/,be=class{constructor(e){void 0===e&&(e={}),this.tags=e}addTag(e,t){this.tags[e]=t}splitText(e,t){for(var s,i,r,n=[],a=0,h=e.length,o=h;s=me.exec(e);)i=s[0],a<(o=me.lastIndex-i.length)&&n.push(e.substring(a,o)),void 0===t?n.push(i):1===t&&(ve.test(i)?(r=i.match(xe),n.push(r[2])):we.test(i)&&(r=i.match(Te),n.push(r[2]))),a=me.lastIndex;return a<h&&n.push(e.substring(a,h)),n}tagTextToProp(e,t){var s,i;if(ve.test(e)){if(null!=(a=e.match(xe))){var r=a[1],n=this.tags;(i=n.hasOwnProperty(r)?n[r]:{})._class=r,s=a[2]}}else if(we.test(e)){var a;if(null!=(a=e.match(Te))){var h=a[1];(i=fe(h))._style=h,s=a[2]}}null==s&&(s=e),null==i&&(i={});var o=ge;return o.plainText=s,o.prop=i,o}propToContextStyle(e,t){var s=pe;if(t.hasOwnProperty("img"))s.image=t.img;else{if(s.image=null,t.hasOwnProperty("family")||t.hasOwnProperty("fontFamily")||t.hasOwnProperty("font-family")){var i=t.hasOwnProperty("family")?t.family:t.hasOwnProperty("fontFamily")?t.fontFamily:t["font-family"];s.fontFamily=i}else s.fontFamily=e.fontFamily;if(t.hasOwnProperty("size")||t.hasOwnProperty("fontSize")||t.hasOwnProperty("font-size")){var r=t.hasOwnProperty("size")?t.size:t.hasOwnProperty("fontSize")?t.fontSize:t["font-size"];"number"==typeof r&&(r=r.toString()+"px"),s.fontSize=r}else s.fontSize=e.fontSize;if(t.hasOwnProperty("style")||t.hasOwnProperty("fontStyle")||t.hasOwnProperty("font-style")){var n=t.hasOwnProperty("style")?t.style:t.hasOwnProperty("fontStyle")?t.fontStyle:t["font-style"];s.fontStyle=n}else s.fontStyle=e.fontStyle;if(t.hasOwnProperty("color")||t.hasOwnProperty("font-color")){var a=t.hasOwnProperty("color")?t.color:t["font-color"];s.color=a}else s.color=e.color;if(t.hasOwnProperty("stroke")){var h=t.stroke;s.stroke=h.hasOwnProperty("color")?h.color:e.stroke,s.strokeThickness=h.hasOwnProperty("thinkness")?h.thinkness:e.strokeThickness}else s.stroke=e.stroke,s.strokeThickness=e.strokeThickness}if(t.hasOwnProperty("shadow")){var o=t.shadow;s.shadowColor=o.hasOwnProperty("color")?o.color:e.shadowColor,s.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:e.shadowOffsetX,s.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:e.shadowOffsetY,s.shadowBlur=o.hasOwnProperty("blur")?o.blur:e.shadowBlur,s.shadowStroke=!0,s.shadowFill=!0}else s.shadowColor=e.shadowColor,s.shadowOffsetX=e.shadowOffsetX,s.shadowOffsetY=e.shadowOffsetY,s.shadowBlur=e.shadowBlur,s.shadowStroke=e.shadowStroke,s.shadowFill=e.shadowFill;if(t.hasOwnProperty("u")||t.hasOwnProperty("underline")){var l=t.hasOwnProperty("u")?t.u:t.underline;s.underlineColor=l.hasOwnProperty("color")?l.color:e.underlineColor,s.underlineThickness=l.hasOwnProperty("thinkness")?l.thinkness:e.underlineThickness,s.underlineOffset=l.hasOwnProperty("offset")?l.offset:e.underlineOffset}else s.underlineColor=e.underlineColor,s.underlineThickness=e.underlineThickness,s.underlineOffset=e.underlineOffset;return s}propToTagText(e,t,s){return t.hasOwnProperty("_class")?""===e&&this.isTextTag(t._class)?"":"<class='"+t._class+"'>"+e+"</class>":t.hasOwnProperty("_style")?"<style='"+t._style+"'>"+e+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(e){var t=this.tags[e];return!!t&&null==t.img}};const Pe=Phaser.Utils.Objects.GetValue;var ke=class extends ce{constructor(e,t,s,i,r){var n=Pe(r,"tags",void 0),a=new be(n);super(e,t,s,i,r,"rexTagText",a),this.parser=a}addTag(e,t){return this.parser.addTag(e,t),this.updateText(!0)}addTags(e){for(var t in e)this.parser.addTag(t,e[t]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const Me=Phaser.Utils.Objects.GetAdvancedValue,Oe=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(e,t,s,i){var r=new ke(this.scene,e,t,s,i);return this.scene.add.existing(r),r})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(e,t){var s=Me(e,"text",""),i=Me(e,"style",null),r=Me(e,"padding",null);null!==r&&(i.padding=r),void 0!==t&&(e.add=t);var n=new ke(this.scene,0,0,s,i);return Oe(this.scene,n,e),n.autoRound=Me(e,"autoRound",!0),n.resolution=Me(e,"resolution",1),n}));var Ce=ke,_e={setEventEmitter(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(e){return this._eventEmitter&&e&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const Ge=Phaser.Scene;var Le=function(e){return e instanceof Ge},Ae=function(e){return Le(e)?e:e.scene&&Le(e.scene)?e.scene:e.parent&&e.parent.scene&&Le(e.parent.scene)?e.parent.scene:void 0};const Ee=Phaser.Utils.Objects.GetFastValue,We=Phaser.Utils.Objects.GetValue;class Ie{constructor(e,t){this.gameObject=e,this.scene=Ae(e),this.setEventEmitter(We(t,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(t),this.boot()}resetFromJSON(e){this.setTypeMode(We(e,"typeMode",0)),this.setTypeSpeed(We(e,"speed",333)),this.setTextCallback=Ee(e,"setTextCallback",null),this.setTextCallbackScope=Ee(e,"setTextCallbackScope",null),this.typingIdx=Ee(e,"typingIdx",0),this.text=Fe(Ee(e,"text","")),this.textLen=Ee(e,"textLen",0),this.insertIdx=Ee(e,"insertIdx",null);var t=Ee(e,"elapsed",null);return null!==t&&this.start(void 0,void 0,this.typingIdx,t),this}toJSON(){var e,t=this.getTimer();return e=t?t.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:e}}boot(){return this.gameObject.once&&this.gameObject.on("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(e){return"string"==typeof e&&(e=Re[e]),this.typeMode=e,this}setTypeSpeed(e){return this.speed=e,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(e,t,s,i){return void 0!==e&&this.setTypingContent(e),void 0!==t&&(this.speed=t),void 0===s&&(s=0),this.typingIdx=s+1,0===this.speed?this.stop(!0):this.startTimer(i),this}appendText(e){var t=this.text.concat(Fe(e));return this.isTyping?this.setTypingContent(t):this.start(t,void 0,this.textLen),this}stop(e){return this.getTimer()&&this.freeTimer(),e&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var e=this.getTimer();return e&&(e.paused=!0),this}resume(){var e=this.getTimer();return e&&(e.paused=!1),this}setTypingContent(e){return this.text=Fe(e),this.textLen=this.getTextLength(this.text),this}onTyping(){var e=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(e),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(e,t,s,i){var r;if(0===i){var n=0,a=t;this.insertIdx=a,r=this.getSubString(e,n,a)}else if(1===i){n=(a=s)-t;this.insertIdx=0,r=this.getSubString(e,n,a)}else if(2===i){var h=s/2;a=(n=Math.floor(h-t/2))+t;this.insertIdx=t%2?t:0,r=this.getSubString(e,n,a)}else if(3===i){var o,l=Math.floor(t/2);if(l>0){n=(a=s)-l;o=this.getSubString(e,n,a)}else o="";var d,u=t-l;if(u>0){a=(n=0)+u;this.insertIdx=a,d=this.getSubString(e,n,a)}else d="",this.insertIdx=0;r=d+o}return r}startTimer(e){var t;return this.timer&&this.freeTimer(),void 0===e?(0,t=0):(this.speed,t=e),this.timer=this.scene.time.addEvent({delay:0,startAt:t,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(e){this.setTextCallback&&(e=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,e,this.isLastChar,this.insertIdx):this.setTextCallback(e,this.isLastChar,this.insertIdx)),this.gameObject.setText(e)}getTextLength(e){var t=this.gameObject;return t.getPlainText?t.getPlainText(e).length:e.length}getSubString(e,t,s){var i=this.gameObject;return i.getSubString?i.getSubString(e,t,s):e.slice(t,s)}}Object.assign(Ie.prototype,_e);var Fe=function(e){return Array.isArray(e)?e=e.join("\n"):"number"==typeof e&&(e=e.toString()),e};const Re={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var ze=Ie,Ye=0,Be=1,De=2,Xe=0,Ne=1,je=[{score:100,timer:0,behavior:Ye},{score:200,timer:120,behavior:Ye},{score:300,timer:30,behavior:De},{score:300,timer:120,behavior:Be},{score:400,timer:300,behavior:Be,handler:e=>{e.tileGrid.TileGenerationBehavior!==De&&e.score>je[e.level]/2&&(e.tileGrid.tileGenerationBehavior=De)}},{score:1e3,timer:300,behavior:De},{score:1e3,timer:300,behavior:De},{score:1e3,timer:300,behavior:Be},{score:1e3,timer:300,behavior:Ye}];const He=e=>e[Math.floor(Math.random()*e.length)];var qe=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],Ue=class{constructor(e,t,s,i,r,n,a,h,o){this.offsetX=i,this.offsetY=r,this.tileSize=s,this.tileGridHeight=t,this.tileGridWidth=e,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=n,this.onTileMatch=a,this.tileGenerationBehavior=h,this.queue=o;for(let s=0;s<2*t;s++){this.tileGrid[s]=[];for(let i=0;i<e;i++)this.tileGrid[s][i]=s<t?null:this.createTile(this.getTileType(i,s,Ye),i,s)}}create(e){this.tileImageContainer=e.add.container(),this.forEachTile(t=>{null!==t&&(t.create(e),this.tileImageContainer.add(t.image))});const t=e.make.graphics();t.fillStyle(16777215,1),t.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(e,t)}update(e){const t=this;if(t.queue.length>0)return;const s=t.getMatches();s.length>0&&t.onTileMatch(e,s);let i=[];s.forEach(t=>{i.push(t.destroy(e,this.tileImageContainer))}),i.length>0&&t.queue.push(()=>Promise.all(i)),t.forEachTile((e,s,i)=>{null!==e&&e.state===Ne&&(t.tileGrid[i][s]=null)});let r=[];for(let s=0;s<this.tileGridWidth;s++){let i=2*this.tileGridHeight-1;for(;i>=0;){if(null===t.tileGrid[i][s]){let n=i-1;for(;n>=0;){let a=t.tileGrid[n][s];null!==a&&(t.tileGrid[i][s]=a,t.tileGrid[n][s]=null,r.push(this.getTileDrop(e,a,s,i)),i--),n--}}i--}}t.forEachPlayableTile((s,i,r)=>{if(null===s){const s=r-t.tileGridHeight,n=t.createTile(t.getTileType(i,r,t.tileGenerationBehavior),i,s);t.tileGrid[s][i]=n,n.create(e),t.tileImageContainer.add(n.image)}}),r.length>0&&t.queue.push(()=>Promise.all(r))}swapTiles(e,t,s){let i=this;i.queue.push(()=>{let r=t.x,n=t.y,a=t.tileGridX,h=t.tileGridY,o=s.x,l=s.y,d=s.tileGridX,u=s.tileGridY,c=s.updatePosition(e,r,n,a,h);i.tileGrid[h][a]=s;let g=t.updatePosition(e,o,l,d,u);return i.tileGrid[u][d]=t,Promise.all([c,g])})}hasMatches(e,t){return this.getMatches(e,t).length>0}getMatches(e,t){const s=this,i=[];return s.forEachTile((r,n,a)=>{if(void 0!==e&&n!==e&&void 0!==t&&a!==t)return;if(!this.isPlayable(r))return;const h=r.tileType,o=[],l=[];let d=n+1;for(;d<s.tileGridWidth;){const e=s.tileGrid[a][d];if(null==e||h.name!==e.tileType.name)break;o.push(e),d++}for(d=n-1;d>0;){const e=s.tileGrid[a][d];if(null==e||h.name!==e.tileType.name)break;o.push(e),d--}let u=a+1;for(;u<s.tileGridHeight;){const e=s.tileGrid[u][n];if(null==e||h.name!==e.tileType.name)break;l.push(e),u++}for(u=a-1;u>0;){const e=s.tileGrid[u][n];if(null==e||h!==e.tileType)break;l.push(e),u--}l.length>1&&i.push(...l),o.length>1&&i.push(...o),(l.length>1||o.length>1)&&i.push(r)}),i}forEachTile(e){for(let t=0;t<2*this.tileGridHeight;t++)for(let s=0;s<this.tileGridWidth;s++)e(this.tileGrid[t][s],s,t)}forEachPlayableTile(e){for(let t=this.tileGridHeight;t<2*this.tileGridHeight;t++)for(let s=0;s<this.tileGridWidth;s++)e(this.tileGrid[t][s],s,t)}createTile(e,t,s){return new class{constructor(e,t,s,i,r,n){this.tileType=e,this.x=t,this.y=s,this.tileGridX=i,this.tileGridY=r,this.onTileSelect=n,this.image=null,this.state=Xe,this.isActivated=!1,this.isDestroying=!1}create(e){this.image=e.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(e,this)})}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(e,t,s,i,r){let n=this;return new Promise((a,h)=>{n.x=t,n.y=s,n.tileGridX=i,n.tileGridY=r,e.tweens.add({targets:n.image,x:t,y:s,ease:"Power1",duration:500,onComplete:()=>{a()}})})}destroy(e,t){let s=this;if(s.isDestroying)return;s.isDestroying=!0;const i=e.add.image(s.x,s.y,s.tileType.imageKey);i.setTintFill(16777215),i.alpha=0;const r=[];for(let t=0;t<4;t++){const t=e.add.graphics({fillStyle:{color:16777215},alpha:0}),s=new Phaser.Geom.Circle(this.x,this.y,Phaser.Math.Between(0,10));t.fillCircleShape(s),r.push(t)}return new Promise((n,a)=>{e.tweens.add({targets:i,alpha:1,duration:200,onComplete:()=>{t.remove(s.image),s.image.destroy(),s.state=Ne,t.remove(i),i.destroy(),r.forEach(e=>{t.remove(e),e.destroy()}),n()}}),r.forEach((t,s)=>{let i="",r="";switch(s){case 1:i="-",r="-";break;case 2:i="+",r="+";break;case 3:i="+",r="-";break;case 4:i="-",r="+"}e.tweens.add({targets:t,x:i+"=35",y:r+"=35",alpha:1,duration:200,ease:"Cubic.easeOut"})})})}}(e,this.getTileX(t),this.getTileY(s),t,s,this.onTileSelect)}getTileDrop(e,t,s,i){return t.updatePosition(e,this.getTileX(s),this.getTileY(i),s,i)}getTileX(e){return this.offsetX+this.tileSize*e}getTileY(e){return this.offsetY+this.tileSize*e}canSelect(e){return this.isPlayable(e)}isPlayable(e){return null!=e&&e.tileGridY>this.tileGridHeight-1}getTileType(e,t,s){const i=t<1?null:this.tileGrid[t-1][e],r=t>self.tileGridHeight-1||!this.tileGrid[t+1]?null:this.tileGrid[t+1][e],n=e<1?null:this.tileGrid[t][e-1],a=e>self.tileGridWidth-1?null:this.tileGrid[t][e+1];return He(s!==Be||null==i&&null==r&&null==n&&null==a?s===De?qe.filter(e=>!(null!==r&&e.name===r.tileType.name||null!==a&&e.name===a.tileType.name||null!==n&&e.name===n.tileType.name)):qe.filter(e=>!(null!==i&&e.name===i.tileType.name||null!==n&&e.name===n.tileType.name)):[i,r,n,a].filter(e=>null!=e).map(e=>e.tileType))}},Ke=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.score=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.guide=null,this.level=null,this.comboCount=null,this.totalMatches=null}preload(){this.load.image("tile_01","assets/tile_01.png"),this.load.image("tile_02","assets/tile_02.png"),this.load.image("tile_03","assets/tile_03.png"),this.load.image("tile_04","assets/tile_04.png"),this.load.image("guide_character","assets/guide.png"),this.load.image("background","assets/background.png")}init(e){this.level=e.level}create(){this.isAwaitingRoundTransition=!1,this.score=0,this.comboCount=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(e){var t=this;t.queuedActions.push(()=>{e().then(()=>{t.currentAction=null})})}},this.add.image(400,400,"background");const e=je[this.level].behavior;this.selectedTiles=[],this.tileGrid=new Ue(6,6,80,325,-265,this.onTileSelect,this.onTileMatch,e,this.queue),this.scoreDisplay=new class{constructor(e,t){this.x=e,this.y=t,this.scoreText=null,this.comboText=null,this.score=0}create(e){this.scoreText=e.add.text(this.x,this.y,this.score),this.updateScore(this.score),this.comboText=e.add.text(this.x,this.y+20,"")}updateScore(e){this.score=e,this.scoreText.setText(e+" dew drops")}updateCombo(e){this.comboText.setText(e)}}(100,580);const t=je[this.level].timer;this.timer=t>0?new class{constructor(e,t,s){this.x=e,this.y=t,this.text=null,this.seconds=s,this.isPaused=!0}create(e){this.text=e.add.text(this.x,this.y,this.score),this.tick(),e.time.addEvent({delay:1e3,callback:this.tick,callbackScope:this,loop:!0})}tick(){if(this.seconds<=0||this.isPaused)return;this.seconds--;const e=Math.floor(this.seconds/60);let t=this.seconds%60;t<10&&(t="0"+t),this.text.setText(`${e}:${t}`)}start(){this.isPaused=!1}}(5,570,t):null;const s=(new class{getScript(e){const t=new class{constructor(){this.introMessages=[],this.getDisplayTileMatchMessages=()=>{}}};switch(e){case 0:t.introMessages=["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)","The Dew Drop Kingdom is in trouble!","We lost all of our dew drops and now we'll starve!","But you can help us by collecting as many dew drops as you can!","If you match three or more dew drops of the same color, we can collect them!","To make a match, select two dew drops and swap their places!"],t.getDisplayTileMatchMessages=e=>{if(1===e.totalMatches)return["You got it! That's it!","You collect extra dew drops when you chain together matches in a combo!","See if you can collect 100 dew drops!"]};break;case 1:t.introMessages=["*Oh, doozle!* You're so good at this!","But, we'll have to hurry this time!","We only have two minutes before the sun dries up all the dew drops!","Collect at least 200 dew drops in two minutes!"];break;case 2:t.introMessages=["Wow, we're so proud of you!","This round you'll only have 30 seconds to collect at least 300 dew drops!"],t.getGameOverMessages=()=>["Wait, wait, sorry, hold on.",'It\'s too early for the *"Lose in a Panic"* scenario.',"So sorry about that.","You've been really great so far, honestly.","You know, what, let's just go to the next round and we'll take it from the top."];break;case 3:t.introMessages=["Alright, I think we've got everything figured out.","Okay, for this next round, let me set you up:","Remember, you've been winning the last few rounds and you're gaining confidence.","In this round, it's going to be easy for you to get combos.","So the idea here is that you're going to get a little *too* confident, right?","Like a little full of yourself, alright?","Okay, great! Let's do this:","...","*Oh doozle woozle!*","You're so amazing!","You have two minutes again, but this time you'll have to collect 300 dew drops.","Can you do it?","Who am I kidding? Of course you can!"];break;case 4:t.introMessages=["Okay, okay, great stuff.","For this round, you're bringing all of that pride, all of that hubris.","And, when the round starts, things are still going your way.","But guess what?","Halfway through this round, things start getting a little harder.","So this is where we begin to chip away at your pride as the player.","Alright, that's your set up: now let me get into the right headspace.","...oh doozle woo-","...no, no, it's doozy-woozy here...","...yeah, doozy-woozy, you're our hero, blah, blah...","Alright! Got it!","...","*Doozy-woozy!*","You're our hero!","You've done so much for us, but we still need your help!","We need you to collect 500 dew drops in five minutes!"];break;case 5:t.introMessages=["Wow, such moving work.","It really feels so authentic.","It's been a joy working with you.","Okay, here we go, this is a pivotal scene:","This round will not go your way at all. At all.","This is your fall from grace.","(Ahem)","...","*Doozle!*","*Woozle!*","I can't believe you did it!","We've got a bigger challenge ahead, but I know you can do it!","You can do anything!","We need you to collect 1000 dew drops in five minutes!"];break;case 6:t.introMessages=["Okay, let's move right into the next scene:","Here, you are wallowing, right?","You are in the pit of despair and you can't see a way out.","This round won't be particularly hard, but you can't seem to find any matches.","Got it?","Alright, great: let me find my place here...","Yes, okay, I believed in you, but now my faith is faltering...","I'm keeping a brave face, but I'm really starting to lose confidence...","Okay, I'm ready!","...","Oh no!","*Whoopsie whoozle!*","Don't worry, that was a tough one!","Let's try again! I know you can do it!","We need you to collect 1000 dew drops in five minutes!"],t.getDisplayTileMatchMessages=e=>["(Oh, hey: remember, you're not going to find any matches this round)"];break;case 7:t.introMessages=["Now, you've been wallowing. You've feeling really low.","You're in such despair, that in this round...","There's an obvious combo.","Right there, right in front of your face.","But you can't see it through the despair.","But then, in the last ten seconds of the round, you see it.","Boom, it's the perfect match.","And the pheonix rises once again!"];break;case 8:t.introMessages=["Our hero is back!","This final scene is our victory lap.","However, we don't want too many combos in this round, right?","This is a round the player wins on their own.","No assistance from the game.","A true hero's victory!","Alright, let's do this: I've got an appointment after this."]}return t}}).getScript(this.level);this.guide=new class{constructor(e,t,s){this.x=e,this.y=t,this.script=s,this.queuedMessages=null,this.isPaused=!1,this.isBlockingGameplay=!1,this.endDialogueMarkerGraphics=null}create(e){const t=this,s=e.add.graphics({fillStyle:{color:16777215}}).setAlpha(0);s.fillRoundedRect(this.x,this.y-40,760,130,10),s.fillTriangle(this.x+120,this.y+130+20-40,this.x+105,this.y+130-40,this.x+135,this.y+130-40),this.endDialogueMarkerGraphics=e.add.graphics({fillStyle:{color:13421772}}),this.hideEndDialogueMarker();const i=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(i),e.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const r={color:"#000",fontFamily:'"Baloo Thambi 2"',fontSize:"30px",wrap:{mode:"word",width:760},tags:{exclamation:{fontStyle:"bold"}}};this.speechBubbleText=new Ce(e,this.x+15,this.y+15,"",r),e.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new ze(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{t.onMessageComplete.call(t)}),e.add.image(this.x+125,this.y+130+230,"guide_character"),e.tweens.add({targets:s,props:{y:{value:"+=40",duration:500,ease:"Bounce.easeOut"},alpha:{value:1,duration:300,ease:"Linear"}},onComplete:()=>{t.queueMessages(e,this.script.introMessages)}})}queueMessages(e,t){if(!t)return;const s=this;null===s.queuedMessages&&(s.queuedMessages=[]),s.queuedMessages.push(...t),s.speechBubbleTextTyping.isTyping||(s.isBlockingGameplay=!0,s.progressDialogue())}onMessageComplete(){this.showEndDialogueMarker(),0!==this.queuedMessages.length||(this.isBlockingGameplay=!1)}displayTileMatchMessage(e,t){const s=this.script.getDisplayTileMatchMessages(t);this.queueMessages(e,s)}displayGameOverMessage(e){const t=this.script.getGameOverMessages();t.push(" "),this.queueMessages(e,t)}progressDialogue(){if(this.hideEndDialogueMarker(),this.queuedMessages.length>0){const e=this.convertDialogToTagText(this.queuedMessages.shift());this.speechBubbleTextTyping.start(e)}}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}convertDialogToTagText(e){const t=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let s="",i="";for(let r=0;r<e.length;r++){const n=e[r],a=t.some(e=>e.token===n);if(0!==r||a||(s+='<class="normal">',i="normal"),r!==e.length-1||!a)if(a){const e=t.find(e=>e.token===n);i===e.className?(s+="</class>",s+='<class="normal">',i="normal"):(0!==r&&(s+="</class>"),s+=`<class="${e.className}">`,i=e.className)}else s+=e[r]}return s+="</class>",s}}(20,20,s),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this);const i=this;this.input.on("pointerdown",()=>{i.guide.progressDialogue()})}update(){if(this.isAwaitingRoundTransition)this.guide.isBlockingGameplay||this.scene.start("RoundTransitionScene",{nextLevel:this.level+1});else{if(this.handleSpecialLevelBehavior(),!this.guide.isBlockingGameplay&&this.timer&&this.timer.isPaused&&this.timer.start(),null!=this.timer&&this.timer.seconds<=0)return this.guide.displayGameOverMessage(),void(this.isAwaitingRoundTransition=!0);this.isLevelComplete()?this.scene.start("RoundTransitionScene",{nextLevel:this.level+1}):this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this))}}onTileSelect(e,t){if(!e.queue.isActionRunning()&&!e.guide.isBlockingGameplay&&e.tileGrid.canSelect(t)){if(t.isActivated)return e.selectedTiles=[],void t.deactivate();if(0===e.selectedTiles.length)return e.selectedTiles.push(t),void t.activate();if(1===e.selectedTiles.length){const s=e.selectedTiles[0],i=Math.abs(s.tileGridX-t.tileGridX),r=Math.abs(s.tileGridY-t.tileGridY);if(1===i&&0===r||0===i&&1===r){e.selectedTiles.push(t);let s=e.selectedTiles[0],i=e.selectedTiles[1];e.tileGrid.swapTiles(e,s,i),e.queue.push(()=>(e.tileGrid.hasMatches(s.tileGridX,s.tileGridY)||e.tileGrid.hasMatches(i.tileGridX,i.tileGridY)||e.tileGrid.swapTiles(e,s,i),Promise.resolve())),e.selectedTiles.forEach(e=>{e.deactivate()}),e.selectedTiles=[],e.comboCount=0}}}}onTileMatch(e,t){e.comboCount++,e.totalMatches++,e.score+=t.length*e.comboCount,e.scoreDisplay.updateScore(e.score),e.comboCount>1?e.scoreDisplay.updateCombo(`${e.comboCount}x multiplier!`):e.scoreDisplay.updateCombo("")}isLevelComplete(){return this.score>=je[this.level].score}handleSpecialLevelBehavior(){const e=je[this.level].handler;e&&e({tileGrid:this.tileGrid,score:this.score,level:this.level})}},Ve=class extends Phaser.Scene{constructor(){super("RoundTransitionScene"),this.nextLevel=0}init(e){this.nextLevel=e.nextLevel}create(){const e=this;this.add.text(50,50,`Round ${e.nextLevel}`),this.time.addEvent({delay:1e3,callback:function(){e.scene.start("RoundScene",{level:e.nextLevel})},callbackScope:this})}};const Je={type:Phaser.AUTO,width:800,height:700,scene:[i,Ke,Ve]};new Phaser.Game(Je)}]);
//# sourceMappingURL=bundle.js.map