!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;e.exports=function(e,t,s,n,a){if(0!==t.width&&0!==t.height){var r=t.frame,o=r.width,l=r.height,h=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(t,r.glTexture,o,l,t.x,t.y,o/t.style.resolution,l/t.style.resolution,t.scaleX,t.scaleY,t.rotation,t.flipX,t.flipY,t.scrollFactorX,t.scrollFactorY,t.displayOriginX,t.displayOriginY,0,0,o,l,h(t._tintTL,n.alpha*t._alphaTL),h(t._tintTR,n.alpha*t._alphaTR),h(t._tintBL,n.alpha*t._alphaBL),h(t._tintBR,n.alpha*t._alphaBR),t._isTinted&&t.tintFill,0,0,n,a)}}},function(e,t){e.exports=function(e,t,i,s,n){0!==t.width&&0!==t.height&&e.batchSprite(t,t.frame,s,n)}},function(e,t,i){var s;!function(){function n(e,t,i){return e.call.apply(e.bind,arguments)}function a(e,t,i){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function r(e,t,i){return(r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:a).apply(null,arguments)}var o=Date.now||function(){return+new Date};function l(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var h=!!window.FontFace;function d(e,t,i,s){if(t=e.c.createElement(t),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?t.style.cssText=i[n]:t.setAttribute(n,i[n]));return s&&t.appendChild(e.c.createTextNode(s)),t}function u(e,t,i){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(i,e.lastChild)}function c(e){e.parentNode&&e.parentNode.removeChild(e)}function p(e,t,i){t=t||[],i=i||[];for(var s=e.className.split(/\s+/),n=0;n<t.length;n+=1){for(var a=!1,r=0;r<s.length;r+=1)if(t[n]===s[r]){a=!0;break}a||s.push(t[n])}for(t=[],n=0;n<s.length;n+=1){for(a=!1,r=0;r<i.length;r+=1)if(s[n]===i[r]){a=!0;break}a||t.push(s[n])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function g(e,t){for(var i=e.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==t)return!0;return!1}function f(e,t,i){function s(){o&&n&&a&&(o(r),o=null)}t=d(e,"link",{rel:"stylesheet",href:t,media:"all"});var n=!1,a=!0,r=null,o=i||null;h?(t.onload=function(){n=!0,s()},t.onerror=function(){n=!0,r=Error("Stylesheet failed to load"),s()}):setTimeout((function(){n=!0,s()}),0),u(e,"head",t)}function v(e,t,i,s){var n=e.c.getElementsByTagName("head")[0];if(n){var a=d(e,"script",{src:t}),r=!1;return a.onload=a.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&n.removeChild(a))},n.appendChild(a),setTimeout((function(){r||(r=!0,i&&i(Error("Script load timeout")))}),s||5e3),a}return null}function m(){this.a=0,this.c=null}function y(e){return e.a++,function(){e.a--,w(e)}}function x(e,t){e.c=t,w(e)}function w(e){0==e.a&&e.c&&(e.c(),e.c=null)}function T(e){this.a=e||"-"}function k(e,t){this.c=e,this.f=4,this.a="n";var i=(t||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function b(e){var t=[];e=e.split(/,\s*/);for(var i=0;i<e.length;i++){var s=e[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?t.push("'"+s+"'"):t.push(s)}return t.join(",")}function S(e){return e.a+e.f}function G(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function E(e){var t=4,i="n",s=null;return e&&((s=e.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=e.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?t=7:/[1-9]00/.test(s[1])&&(t=parseInt(s[1].substr(0,1),10)))),i+t}function P(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new T("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function O(e){if(e.g){var t=g(e.f,e.a.c("wf","active")),i=[],s=[e.a.c("wf","loading")];t||i.push(e.a.c("wf","inactive")),p(e.f,i,s)}_(e,"inactive")}function _(e,t,i){e.j&&e.h[t]&&(i?e.h[t](i.c,S(i)):e.h[t]())}function M(){this.c={}}function C(e,t){this.c=e,this.f=t,this.a=d(this.c,"span",{"aria-hidden":"true"},this.f)}function A(e){u(e.c,"body",e.a)}function L(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(e.c)+";font-style:"+G(e)+";font-weight:"+e.f+"00;"}function I(e,t,i,s,n,a){this.g=e,this.j=t,this.a=s,this.c=i,this.f=n||3e3,this.h=a||void 0}function W(e,t,i,s,n,a,r){this.v=e,this.B=t,this.c=i,this.a=s,this.s=r||"BESbswy",this.f={},this.w=n||3e3,this.u=a||null,this.m=this.j=this.h=this.g=null,this.g=new C(this.c,this.s),this.h=new C(this.c,this.s),this.j=new C(this.c,this.s),this.m=new C(this.c,this.s),e=L(e=new k(this.a.c+",serif",S(this.a))),this.g.a.style.cssText=e,e=L(e=new k(this.a.c+",sans-serif",S(this.a))),this.h.a.style.cssText=e,e=L(e=new k("serif",S(this.a))),this.j.a.style.cssText=e,e=L(e=new k("sans-serif",S(this.a))),this.m.a.style.cssText=e,A(this.g),A(this.h),A(this.j),A(this.m)}T.prototype.c=function(e){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},I.prototype.start=function(){var e=this.c.o.document,t=this,i=o(),s=new Promise((function(s,n){!function a(){o()-i>=t.f?n():e.fonts.load(function(e){return G(e)+" "+e.f+"00 300px "+b(e.c)}(t.a),t.h).then((function(e){1<=e.length?s():setTimeout(a,25)}),(function(){n()}))}()})),n=null,a=new Promise((function(e,i){n=setTimeout(i,t.f)}));Promise.race([a,s]).then((function(){n&&(clearTimeout(n),n=null),t.g(t.a)}),(function(){t.j(t.a)}))};var F={D:"serif",C:"sans-serif"},R=null;function B(){if(null===R){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);R=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return R}function z(e,t,i){for(var s in F)if(F.hasOwnProperty(s)&&t===e.f[F[s]]&&i===e.f[F[s]])return!0;return!1}function j(e){var t,i=e.g.a.offsetWidth,s=e.h.a.offsetWidth;(t=i===e.f.serif&&s===e.f["sans-serif"])||(t=B()&&z(e,i,s)),t?o()-e.A>=e.w?B()&&z(e,i,s)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?Y(e,e.v):Y(e,e.B):function(e){setTimeout(r((function(){j(this)}),e),50)}(e):Y(e,e.v)}function Y(e,t){setTimeout(r((function(){c(this.g.a),c(this.h.a),c(this.j.a),c(this.m.a),t(this.a)}),e),0)}function N(e,t,i){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=i}W.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),j(this)};var D=null;function H(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&p(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),_(e,"active")):O(e.a))}function X(e){this.j=e,this.a=new M,this.h=0,this.f=this.g=!0}function q(e,t,i,s,n){var a=0==--e.h;(e.f||e.g)&&setTimeout((function(){var e=n||null,o=s||{};if(0===i.length&&a)O(t.a);else{t.f+=i.length,a&&(t.j=a);var l,h=[];for(l=0;l<i.length;l++){var d=i[l],u=o[d.c],c=t.a,g=d;if(c.g&&p(c.f,[c.a.c("wf",g.c,S(g).toString(),"loading")]),_(c,"fontloading",g),c=null,null===D)if(window.FontFace){g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);D=g?42<parseInt(g[1],10):!f}else D=!1;c=D?new I(r(t.g,t),r(t.h,t),t.c,d,t.s,u):new W(r(t.g,t),r(t.h,t),t.c,d,t.s,e,u),h.push(c)}for(l=0;l<h.length;l++)h[l].start()}}),0)}function U(e,t){this.c=e,this.a=t}function K(e,t){this.c=e,this.a=t}function V(e,t){this.c=e||J,this.a=[],this.f=[],this.g=t||""}N.prototype.g=function(e){var t=this.a;t.g&&p(t.f,[t.a.c("wf",e.c,S(e).toString(),"active")],[t.a.c("wf",e.c,S(e).toString(),"loading"),t.a.c("wf",e.c,S(e).toString(),"inactive")]),_(t,"fontactive",e),this.m=!0,H(this)},N.prototype.h=function(e){var t=this.a;if(t.g){var i=g(t.f,t.a.c("wf",e.c,S(e).toString(),"active")),s=[],n=[t.a.c("wf",e.c,S(e).toString(),"loading")];i||s.push(t.a.c("wf",e.c,S(e).toString(),"inactive")),p(t.f,s,n)}_(t,"fontinactive",e),H(this)},X.prototype.load=function(e){this.c=new l(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,i){var s=[],n=i.timeout;!function(e){e.g&&p(e.f,[e.a.c("wf","loading")]),_(e,"loading")}(t);s=function(e,t,i){var s,n=[];for(s in t)if(t.hasOwnProperty(s)){var a=e.c[s];a&&n.push(a(t[s],i))}return n}(e.a,i,e.c);var a=new N(e.c,t,n);for(e.h=s.length,t=0,i=s.length;t<i;t++)s[t].load((function(t,i,s){q(e,a,t,i,s)}))}(this,new P(this.c,e),e)},U.prototype.load=function(e){var t=this,i=t.a.projectId,s=t.a.version;if(i){var n=t.c.o;v(this.c,(t.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),(function(s){s?e([]):(n["__MonotypeConfiguration__"+i]=function(){return t.a},function t(){if(n["__mti_fntLst"+i]){var s,a=n["__mti_fntLst"+i](),r=[];if(a)for(var o=0;o<a.length;o++){var l=a[o].fontfamily;null!=a[o].fontStyle&&null!=a[o].fontWeight?(s=a[o].fontStyle+a[o].fontWeight,r.push(new k(l,s))):r.push(new k(l))}e(r)}else setTimeout((function(){t()}),50)}())})).id="__MonotypeAPIScript__"+i}else e([])},K.prototype.load=function(e){var t,i,s=this.a.urls||[],n=this.a.families||[],a=this.a.testStrings||{},r=new m;for(t=0,i=s.length;t<i;t++)f(this.c,s[t],y(r));var o=[];for(t=0,i=n.length;t<i;t++)if((s=n[t].split(":"))[1])for(var l=s[1].split(","),h=0;h<l.length;h+=1)o.push(new k(s[0],l[h]));else o.push(new k(s[0]));x(r,(function(){e(o,a)}))};var J="https://fonts.googleapis.com/css";function $(e){this.f=e,this.a=[],this.c={}}var Q={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ee={i:"i",italic:"i",n:"n",normal:"n"},te=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function ie(e,t){this.c=e,this.a=t}var se={Arimo:!0,Cousine:!0,Tinos:!0};function ne(e,t){this.c=e,this.a=t}function ae(e,t){this.c=e,this.f=t,this.a=[]}ie.prototype.load=function(e){var t=new m,i=this.c,s=new V(this.a.api,this.a.text),n=this.a.families;!function(e,t){for(var i=t.length,s=0;s<i;s++){var n=t[s].split(":");3==n.length&&e.f.push(n.pop());var a="";2==n.length&&""!=n[1]&&(a=":"),e.a.push(n.join(a))}}(s,n);var a=new $(n);!function(e){for(var t=e.f.length,i=0;i<t;i++){var s=e.f[i].split(":"),n=s[0].replace(/\+/g," "),a=["n4"];if(2<=s.length){var r;if(r=[],o=s[1])for(var o,l=(o=o.split(",")).length,h=0;h<l;h++){var d;if((d=o[h]).match(/^[\w-]+$/))if(null==(c=te.exec(d.toLowerCase())))d="";else{if(d=null==(d=c[2])||""==d?"n":ee[d],null==(c=c[1])||""==c)c="4";else var u=Z[c],c=u||(isNaN(c)?"4":c.substr(0,1));d=[d,c].join("")}else d="";d&&r.push(d)}0<r.length&&(a=r),3==s.length&&(r=[],0<(s=(s=s[2])?s.split(","):r).length&&(s=Q[s[0]])&&(e.c[n]=s))}for(e.c[n]||(s=Q[n])&&(e.c[n]=s),s=0;s<a.length;s+=1)e.a.push(new k(n,a[s]))}}(a),f(i,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,i=[],s=0;s<t;s++)i.push(e.a[s].replace(/ /g,"+"));return t=e.c+"?family="+i.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(s),y(t)),x(t,(function(){e(a.a,a.c,se)}))},ne.prototype.load=function(e){var t=this.a.id,i=this.c.o;t?v(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",(function(t){if(t)e([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){t=i.Typekit.config.fn;for(var s=[],n=0;n<t.length;n+=2)for(var a=t[n],r=t[n+1],o=0;o<r.length;o++)s.push(new k(a,r[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(s)}}),2e3):e([])},ae.prototype.load=function(e){var t=this.f.id,i=this.c.o,s=this;t?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[t]=function(t,i){for(var n=0,a=i.fonts.length;n<a;++n){var r=i.fonts[n];s.a.push(new k(r.name,E("font-weight:"+r.weight+";font-style:"+r.style)))}e(s.a)},v(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",(function(t){t&&e([])}))):e([])};var re=new X(window);re.a.c.custom=function(e,t){return new K(t,e)},re.a.c.fontdeck=function(e,t){return new ae(t,e)},re.a.c.monotype=function(e,t){return new U(t,e)},re.a.c.typekit=function(e,t){return new ne(t,e)},re.a.c.google=function(e,t){return new ie(t,e)};var oe={load:r(re.load,re)};void 0===(s=function(){return oe}.call(t,i,t,e))||(e.exports=s)}()},function(e,t,i){"use strict";i.r(t);var s=class extends Phaser.Scene{constructor(){super("TitleScene"),this.startingLevel=7}preload(){this.load.image("background","assets/images/background.png"),this.load.image("title","assets/images/title.png"),this.load.image("start","assets/images/start.png"),this.load.image("start-active","assets/images/start_active.png"),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.audio("select","assets/sounds/select.wav")}create(){const e=this;this.add.image(400,330,"background");const t=this.add.graphics({fillStyle:{color:16777215}});t.setAlpha(0);const i=new Phaser.Geom.Rectangle(0,0,800,700);t.fillRectShape(i);const s=[];s.push({imageKey:"tile_01",xChange:"+=180",yChange:"+=180",angle:15,scale:.8}),s.push({imageKey:"tile_02",xChange:"+=200",yChange:"-=180",angle:15,scale:1}),s.push({imageKey:"tile_03",xChange:"-=180",yChange:"+=180",angle:-15,scale:.9}),s.push({imageKey:"tile_04",xChange:"-=200",yChange:"-=180",angle:-5,scale:.8}),s.push({imageKey:"tile_01",xChange:"+=0",yChange:"-=180",angle:-15,scale:.7}),s.push({imageKey:"tile_02",xChange:"+=0",yChange:"+=180",angle:-15,scale:1}),s.push({imageKey:"tile_03",xChange:"+=290",yChange:"+=30",angle:15,scale:.8}),s.push({imageKey:"tile_01",xChange:"-=290",yChange:"+=40",angle:-15,scale:.9}),s.forEach(t=>{t.tile=e.add.image(400,230,t.imageKey),t.tile.setAlpha(0),t.tile.setScale(.5,.5)});const n=this.add.image(400,230,"title");n.setAlpha(0),n.setScale(2,2);const a=this.add.image(400,550,"start");a.setInteractive({cursor:"pointer"}),a.setAlpha(0);const r=this.add.image(400,550,"start");r.setAlpha(0),r.setTintFill(16777215);const o=this.add.image(400,550,"start-active");o.setAlpha(0),a.on("pointerover",()=>{e.tweens.add({targets:o,alpha:1,duration:100,ease:"Sine.easeInOut"})}),a.on("pointerout",()=>{e.tweens.add({targets:o,alpha:0,duration:100,ease:"Sine.easeInOut"})}),this.selectSound=this.sound.add("select"),a.on("pointerdown",()=>{this.selectSound.play(),e.scene.transition({target:"RoundScene",data:{level:this.startingLevel},remove:!0})});const l=this.tweens.createTimeline();l.add({delay:400,targets:n,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Quad.easeIn"}),s.forEach((e,t)=>{l.add({targets:e.tile,x:e.xChange,y:e.yChange,scaleX:1,scaleY:1,alpha:1,scaleX:e.scale,scaleY:e.scale,angle:e.angle,duration:300,ease:"Quad.easeOut",offset:0===t?"-=0":"-=300"})}),l.add({targets:t,alpha:1,duration:30,offset:"-=300"}),l.add({targets:t,alpha:0,duration:700,offset:1500,ease:"Quad.easeIn"}),l.add({targets:[a,r],alpha:1,offset:2200,duration:100}),l.add({targets:r,alpha:0,duration:300,offset:2300,ease:"Quad.easeOut"}),l.play()}},n=0,a=1,r=2,o=3,l=[{score:100,behavior:n},{score:200,timer:120,behavior:n},{score:300,timer:30,behavior:r},{score:300,timer:10,behavior:a},{score:400,timer:10,behavior:a},{score:500,timer:120,behavior:r},{score:100,timer:60,behavior:n,blockMatching:!0},{score:30,timer:40,behavior:o,blockMatching:!0},{score:1e3,timer:300,behavior:n}],h={getScript(e){switch(e){case 0:return["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)",{do:"updateGuideExpression",value:"sadness"},"The Dew Drop Kingdom is in trouble!",{do:"updateGuideExpression",value:"despair"},"We lost all of our dew drops and now we'll starve!",{do:"updateGuideExpression",value:"glee"},{do:"dropTiles"},"But you can help us by collecting as many dew drops as you can!",{do:"updateGuideExpression",value:"default"},"If you match three or more dew drops of the same color, we can collect them!",{do:"unblockTileGrid"},"To make a match, select two dew drops and swap their places!",{on:"match",filter:e=>1===e.matches,actions:[{do:"updateGuideExpression",value:"glee"},"You got it! That's it!",{do:"updateGuideExpression",value:"default"},"See if you can collect *100 dew drops*!"]},{on:"match",filter:e=>5===e.matches,actions:[{do:"updateGuideExpression",value:"glee"},"*Wow!* Look at you go!",{do:"updateGuideExpression",value:"default"}]},{on:"match",filter:e=>e.score>.5*l[0].score,actions:[{do:"updateGuideExpression",value:"glee"},"*Doozle!* You're almost there!",{do:"updateGuideExpression",value:"default"}]},{on:"win",actions:[{do:"endLevel"}]}];case 1:return[{do:"updateGuideExpression",value:"glee"},"*Oh, doozle!* You're so good at this!",{do:"updateGuideExpression",value:"nervous"},"But, we'll have to hurry this time!",{do:"dropTiles"},"We only have two minutes before the sun dries up all the dew drops!",{do:"updateGuideExpression",value:"default"},"Collect at least *200 dew drops* in *two minutes*!",{do:"unblockTileGrid"},{do:"startTimer"},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Uhh?",{do:"updateGuideExpression",value:"neutral"},"I think there's been a mix-up.",{do:"updateGuideExpression",value:"confused"},"Did you get the wrong script?",{do:"updateGuideExpression",value:"neutral"},"You're supposed to win this time.","Well, whatever, I'm sure we can just fix it up in post.","Let's just move onto the next round.",{do:"endLevel"}]},{on:"win",actions:[{do:"endLevel"}]}];case 2:return[{do:"updateGuideExpression",value:"glee"},"Wow, we're so proud of you!","How did you get so goo...",{do:"updateGuideExpression",value:"nervous"},"...",{do:"updateGuideExpression",value:"surprise"},"*Eezle!* That sun is hot!","You're going to have to move even quicker this time!",{do:"dropTiles"},{do:"updateGuideExpression",value:"default"},"But we know you can do it!","This round you'll only have *30 seconds* to collect at least *300 dew drops*!",{do:"unblockTileGrid"},{do:"startTimer"},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Wait, wait, sorry, hold on.",'We\'re not doing the *"Lose in a Panic"* scenario today.',{do:"updateGuideExpression",value:"neutral"},"So sorry about that.",{do:"updateGuideExpression",value:"amused"},"You've been really great so far, honestly.",{do:"updateGuideExpression",value:"neutral"},"Let's just go ahead and take it from the top.",{do:"endLevel"}]},{on:"win",actions:[{do:"updateGuideExpression",value:"confused"},"Wait, is that...",{do:"updateGuideExpression",value:"neutral"},"No, I think you were supposed to lose here.",{do:"updateGuideExpression",value:"thoughtful"},'Yeah, hmm. This was the *"Lose in a Panic"* scenario.',{do:"updateGuideExpression",value:"neutral"},"You know what, that's fine.",{do:"updateGuideExpression",value:"amused"},"Let's roll with it.",{do:"updateGuideExpression",value:"neutral"},"We'll just move to the next round.",{do:"endLevel"}]}];case 3:return[{do:"updateGuideExpression",value:"neutral"},"Alright, I think we've got everything figured out.",{do:"updateGuideExpression",value:"amused"},"Okay, for this next round, let me set you up:",{do:"updateGuideExpression",value:"neutral"},"Remember, you've been winning the last few rounds and you're gaining confidence.",{do:"updateGuideExpression",value:"amused"},"In this round, it's going to be easy for you to get combos.","So the idea here is that you're going to get a little *too* confident, right?",{do:"updateGuideExpression",value:"confused"},"Like a little full of yourself, alright?",{do:"updateGuideExpression",value:"amused"},"Okay, great! Let's do this:",{do:"updateGuideExpression",value:"neutral"},"...","...","...",{do:"updateGuideExpression",value:"default"},"*Oh doozle woozle!*",{do:"updateGuideExpression",value:"surprise"},"You're so amazing!",{do:"updateGuideExpression",value:"default"},{do:"dropTiles"},"You have *two minutes* again, but this time you'll have to collect *300 dew drops*.",{do:"updateGuideExpression",value:"confused"},"Can you do it?",{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},{do:"updateGuideExpression",value:"glee"},"Who am I kidding? Of course you can!",{do:"updateGuideExpression",value:"default"},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Oh, uhh?",{do:"updateGuideExpression",value:"neutral"},"No, you win this round too.",{do:"updateGuideExpression",value:"thoughtful"},"Uhh, hmm...",{do:"updateGuideExpression",value:"amused"},"Okay, here's what we'll do:",{do:"revokeLevelTransition"},{do:"updateTimer",value:1},{do:"stopTimer"},{do:"unblockTileGrid"},"Go ahead and finish out the round and we'll edit it together later."]},{on:"win",actions:[{do:"endLevel"}]}];case 4:return[{do:"updateGuideExpression",value:"amused"},"Okay, okay, great stuff.",{do:"updateGuideExpression",value:"neutral"},"For this round, you're bringing all of that pride, all of that hubris.","And, when the round starts, things are still going your way.",{do:"updateGuideExpression",value:"confused"},"But guess what?",{do:"updateGuideExpression",value:"neutral"},"Halfway through this round, things start getting a little harder.","So this is where we begin to chip away at your pride as the player.",{do:"updateGuideExpression",value:"amused"},"Alright, that's your set up: now let me get into the right headspace.",{do:"updateGuideExpression",value:"thoughtful"},"...oh doozle woo-","...no, no, it's doozy-woozy here...","...yeah, doozy-woozy, you're our hero...",{do:"updateGuideExpression",value:"amused"},"Alright! Got it!",{do:"updateGuideExpression",value:"neutral"},"...","...","...",{do:"updateGuideExpression",value:"surprise"},"*Doozy-woozy!*",{do:"updateGuideExpression",value:"glee"},"You're our hero!",{do:"dropTiles"},{do:"updateGuideExpression",value:"default"},"You've done so much for us, but we still need your help!",{do:"unblockTileGrid"},{do:"startTimer"},"We need you to collect *400 dew drops* in *two minutes*!",{on:"match",filter:e=>e.score>.5*l[0].score,actions:[{do:"updateTileGenerationBehavior",value:r}]},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Oh, a game over?",{do:"updateGuideExpression",value:"neutral"},"We had a win penciled in here.",{do:"updateGuideExpression",value:"thoughtful"},"Maybe a game over could work?",{do:"updateGuideExpression",value:"neutral"},"No, you know what:",{do:"revokeLevelTransition"},{do:"updateTimer",value:1},{do:"stopTimer"},{do:"unblockTileGrid"},"Just go ahead and finish this off as a win."]},{on:"win",actions:[{do:"endLevel"}]}];case 5:return[{do:"updateGuideExpression",value:"amused"},"Wow, great stuff.","I know this is cliché, but it really feels so authentic.","It's been great working with you. You really sell it.",{do:"updateGuideExpression",value:"neutral"},"Okay, here we go, this is a pivotal scene:","This round will not go your way at all. At all.",{do:"updateGuideExpression",value:"amused"},"This is your fall from grace.",{do:"updateGuideExpression",value:"neutral"},"(Ahem)",{do:"updateGuideExpression",value:"thoughtful"},"...","...","...",{do:"updateGuideExpression",value:"glee"},"*Doozle!*","*Woozle!*","I can't believe you did it!",{do:"updateGuideExpression",value:"default"},"We've got a bigger challenge ahead, but I know you can do it!",{do:"dropTiles"},{do:"updateGuideExpression",value:"glee"},"You can do anything!",{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},"We need you to collect *500 dew drops* in *two minutes*!",{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"surprise"},"Oh no!",{do:"updateGuideExpression",value:"sadness"},"*Whoopsie whoozle!*",{do:"updateGuideExpression",value:"despair"},"You didn't make it in time!",{do:"updateGuideExpression",value:"sadness"},"It's okay, though!",{do:"updateGuideExpression",value:"nervous"},"It's okay!",{do:"updateGuideExpression",value:"default"},"You can try again!",{do:"endLevel"}]},{on:"win",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Oh?","A win?",{do:"updateGuideExpression",value:"neutral"},"We had a loss planned, but...","But, yeah, I think a win can work too.",{do:"endLevel"}]}];case 6:return[{do:"updateGuideExpression",value:"neutral"},"Okay, let's move right into the next scene:","Here, you are wallowing, right?","You are in the pit of despair and you can't see a way out.","This round won't be particularly hard, but you can't seem to find any matches.",{do:"updateGuideExpression",value:"amused"},"Got it?",{do:"updateGuideExpression",value:"neutral"},"Alright, great: let me find my place here...",{do:"updateGuideExpression",value:"thoughtful"},"...I believed in you, but my faith is faltering...","...I'm keeping a brave face, but I'm losing confidence...",{do:"updateGuideExpression",value:"amused"},"Okay, I'm ready!","...","...","...",{do:"updateGuideExpression",value:"default"},"Don't worry, that was a tough one!",{do:"dropTiles"},"Let's try again! We believe in you!",{do:"updateGuideExpression",value:"glee"},"We know you can do it!",{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},"This time, you just need to get *100 dew drops* in *one minute!*",{on:"swap",actions:[{do:"updateGuideExpression",value:"neutral"},"Hey, remember: you don't get any matches this round.",{do:"updateGuideExpression",value:"default"}]},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"surprise"},"Oh no!",{do:"updateGuideExpression",value:"despair"},"*Eezle weezle!*",{do:"updateGuideExpression",value:"sadness"},"You didn't collect any dew drops!",{do:"updateGuideExpression",value:"despair"},"We'll starve!",{do:"updateGuideExpression",value:"sadness"},"*Please!* You have to save us!",{do:"endLevel"}]}];case 7:return[{do:"updateGuideExpression",value:"amused"},"Wow, I'm really feeling it.","How about you?",{do:"updateGuideExpression",value:"neutral"},"Alright, next up:","You've been wallowing.","You're feeling really low.",{do:"updateGuideExpression",value:"thoughtful"},"And, you're in such despair, that in this round...",{do:"updateGuideExpression",value:"neutral"},"There's an obvious combo.","Right there, right in front of your face.",{do:"updateGuideExpression",value:"thoughtful"},"But you can't see it through the despair.",{do:"updateGuideExpression",value:"neutral"},"But then, in the last 30 seconds of the round, you see it!",{do:"updateGuideExpression",value:"amused"},"The perfect match.","And the pheonix rises once again!",{do:"updateGuideExpression",value:"neutral"},"Alright! Here we go!","...","...","...",{do:"updateGuideExpression",value:"despair"},"Oh, boozle...","What will we do?",{do:"updateGuideExpression",value:"sadness"},"Please, you're our only hope!",{do:"updateGuideExpression",value:"despair"},"We have one more chance...",{do:"dropTiles"},"Please! Save our kingdom! Just get *30 dew drops* in *two minutes*!",{do:"unblockTileGrid"},{do:"startTimer"},{on:"swap",actions:[{do:"updateGuideExpression",value:"neutral"},"Hold on, it's not time to swap yet.","Wait until there's only *30 seconds* left.",{do:"updateGuideExpression",value:"despair"}]},{on:"tick",filter:e=>e.ticks<=30,actions:[{do:"updateGuideExpression",value:"neutral"},{do:"stopTimer"},"Alright, here we go.","Just to make sure we get this right, we'll stop the timer.",{do:"updateGuideExpression",value:"thoughtful"},"And we'll highlight the match you'll want to make.",{do:"blockTileGrid",value:[[9,2],[9,3]]},{do:"updateGuideExpression",value:"amused"},"And the rest is up to you!",{do:"revokeBlockMatching"}]}]}}},d={color:"#000",fontFamily:'"Baloo Thambi 2"',googleFontName:"Baloo Thambi 2:500;700",fontSize:"30px"},u=class{constructor(){this.subscriptions=[]}on(e,t,i){this.subscriptions.push({eventName:e,filter:t,callback:i})}emit(e){this.subscriptions.filter(t=>t.eventName===e).filter(e=>null===e.filter||e.filter()).forEach(e=>{e.callback&&e.callback(),e.callback=null})}},c=i(0),p=i.n(c),g=i(1),f=i.n(g),v={renderWebGL:p.a,renderCanvas:f.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const m=Phaser.Display.Canvas.CanvasPool;var y=function(e){var t=m.create(this),i=t.getContext("2d");e.syncFont(t,i);var s=Math.ceil(i.measureText(e.testString).width*e.baselineX),n=s,a=2*n;n=n*e.baselineY|0,t.width=s,t.height=a,i.fillStyle="#f00",i.fillRect(0,0,s,a),i.font=e._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(e.testString,0,n);var r={ascent:0,descent:0,fontSize:0};if(!i.getImageData(0,0,s,a))return r.ascent=n,r.descent=n+6,r.fontSize=r.ascent+r.descent,m.remove(t),r;var o,l,h=i.getImageData(0,0,s,a).data,d=h.length,u=4*s,c=0,p=!1;for(o=0;o<n;o++){for(l=0;l<u;l+=4)if(255!==h[c+l]){p=!0;break}if(p)break;c+=u}for(r.ascent=n-o,c=d-u,p=!1,o=a;o>n;o--){for(l=0;l<u;l+=4)if(255!==h[c+l]){p=!0;break}if(p)break;c-=u}return r.descent=o-n,r.fontSize=r.ascent+r.descent,m.remove(t),r},x={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const w=Phaser.Utils.Objects.GetAdvancedValue,T=Phaser.Utils.Objects.GetValue;var k={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const b={none:x.NO_WRAP,word:x.WORD_WRAP,char:x.CHAR_WRAP,character:x.CHAR_WRAP};var S=class{constructor(e,t){this.parent=e,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(t,!1);var i=T(t,"metrics",!1);this.metrics=i?{ascent:T(i,"ascent",0),descent:T(i,"descent",0),fontSize:T(i,"fontSize",0)}:y(this)}setStyle(e,t){if(void 0===t&&(t=!0),e&&e.hasOwnProperty("wrap")){var i=e.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=b[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var n in e&&e.hasOwnProperty("fontSize")&&"number"==typeof e.fontSize&&(e.fontSize=e.fontSize.toString()+"px"),k)this[n]="wrapCallback"===n||"wrapCallbackScope"===n?T(e,k[n][0],k[n][1]):w(e,k[n][0],k[n][1]);var a=T(e,"font",null);this._font=null===a?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:a;var r=T(e,"fill",null);return null!==r&&(this.color=r),t?this.update(!0):this.parent}syncFont(e,t){t.font=this._font}syncStyle(e,t){t.textBaseline="alphabetic",t.fillStyle=this.color,t.strokeStyle=this.stroke,t.lineWidth=this.strokeThickness,t.lineCap="round",t.lineJoin="round"}syncShadow(e,t){t?(e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor=0,e.shadowBlur=0)}update(e){return e&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=y(this)),this.parent.updateText(e)}buildFont(){var e=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return e!==this._font&&(this._font=e),this}setFont(e){return"string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=T(e,"fontFamily","Courier"),this.fontSize=T(e,"fontSize","16px"),this.fontStyle=T(e,"fontStyle","")),this.update(!0)}setFontFamily(e){return this.fontFamily=e,this.update(!0)}setFontStyle(e){return this.fontStyle=e,this.update(!0)}setFontSize(e){return"number"==typeof e&&(e=e.toString()+"px"),this.fontSize=e,this.update(!0)}setTestString(e){return this.testString=e,this.update(!0)}setFixedSize(e,t){return this.fixedWidth=e,this.fixedHeight=t,e&&(this.parent.width=e),t&&(this.parent.height=t),this.update(!1)}setResolution(e){return this.resolution=e,this.update(!1)}setLineSpacing(e){return this.lineSpacing=e,this.update(!1)}setBackgroundColor(e){return this.backgroundColor=e,this.update(!1)}setFill(e){return this.color=e,this.update(!1)}setColor(e){return this.color=e,this.update(!1)}setStroke(e,t){return void 0===e?this.strokeThickness=0:(void 0===t&&(t=this.strokeThickness),this.stroke=e,this.strokeThickness=t),this.update(!0)}setShadow(e,t,i,s,n,a){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===n&&(n=!1),void 0===a&&(a=!0),this.shadowOffsetX=e,this.shadowOffsetY=t,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=n,this.shadowFill=a,this.update(!1)}setShadowOffset(e,t){return void 0===e&&(e=0),void 0===t&&(t=e),this.shadowOffsetX=e,this.shadowOffsetY=t,this.update(!1)}setShadowColor(e){return void 0===e&&(e="#000"),this.shadowColor=e,this.update(!1)}setShadowBlur(e){return void 0===e&&(e=0),this.shadowBlur=e,this.update(!1)}setShadowStroke(e){return this.shadowStroke=e,this.update(!1)}setShadowFill(e){return this.shadowFill=e,this.update(!1)}setUnderline(e,t,i){return void 0===e&&(e="#000"),void 0===t&&(t=0),void 0===i&&(i=0),this.underlineColor=e,this.underlineThickness=t,this.underlineOffset=i,this.update(!1)}setUnderlineColor(e){return void 0===e&&(e="#000"),this.underlineColor=e,this.update(!1)}setUnderlineThickness(e){return void 0===e&&(e=0),this.underlineThickness=e,this.update(!1)}setUnderlineOffset(e){return void 0===e&&(e=0),this.underlineOffset=e,this.update(!1)}setWrapMode(e){return"string"==typeof e&&(e=b[e.toLowerCase()]||0),this.wrapMode=e,this.update(!0)}setWrapWidth(e){return this.wrapWidth=e,this.update(!1)}setAlign(e,t){return void 0===e&&(e="left"),void 0===t&&(t="top"),this.halign=e,this.valign=t,this.update(!1)}setHAlign(e){return void 0===e&&(e="left"),this.halign=e,this.update(!1)}setVAlign(e){return void 0===e&&(e="top"),this.valign=e,this.update(!1)}setMaxLines(e){return void 0===e&&(e=0),this.maxLines=e,this.update(!1)}getTextMetrics(){var e=this.metrics;return{ascent:e.ascent,descent:e.descent,fontSize:e.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var e={};for(var t in k)e[t]=this[t];return e.metrics=this.getTextMetrics(),e}destroy(){this.parent=void 0}},G={draw(e,t,i,s){var n=this.penManager;this.hitAreaManager.clear();var a=this.context;a.save(),this.drawBackground(this.defatultStyle.backgroundColor);var r=this.defatultStyle;e+=this.startXOffset,t+=this.startYOffset;var o,l,h,d,u,c,p=r.halign,g=r.valign,f=r.lineHeight,v=n.lines,m=v.length,y=r.maxLines;y>0&&m>y?(l=y,h="center"===g?Math.floor((m-l)/2):"bottom"===g?m-l:0):(l=m,h=0),d=h+l,c="center"===g?Math.max((s-l*f)/2,0):"bottom"===g?Math.max(s-l*f-2,0):0,c+=t;for(var x=h;x<d;x++)if(0!==(o=n.getLineWidth(x))){u="center"===p?(i-o)/2:"right"===p?i-o:0,u+=e;for(var w=v[x],T=0,k=w.length;T<k;T++)this.drawPen(w[T],u,c)}a.restore()},drawPen(e,t,i){t+=e.x,i+=e.y;var s=this.canvas,n=this.context;n.save();var a=this.parser.propToContextStyle(this.defatultStyle,e.prop);a.buildFont(),a.syncFont(s,n),a.syncStyle(s,n),a.underlineThickness>0&&e.width>0&&this.drawUnderline(t,i,e.width,a),e.isTextPen&&this.drawText(t,i,e.text,a),e.isImagePen&&this.drawImage(t,i,e.prop.img,a),n.restore(),e.hasAreaMarker&&e.width>0&&this.hitAreaManager.add(e.prop.area,t,i-this.startYOffset,e.width,this.defatultStyle.lineHeight)},clear(){var e=this.canvas;this.context.clearRect(0,0,e.width,e.height)},drawBackground(e){null!==e&&(this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(e,t,i,s){t+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(e=Math.round(e),t=Math.round(t));var n=this.context,a=n.lineCap;n.lineCap="butt",n.beginPath(),n.strokeStyle=s.underlineColor,n.lineWidth=s.underlineThickness,n.moveTo(e,t),n.lineTo(e+i,t),n.stroke(),n.lineCap=a},drawText(e,t,i,s){this.autoRound&&(e=Math.round(e),t=Math.round(t));var n=this.context;s.strokeThickness&&(s.syncShadow(n,s.shadowStroke),n.strokeText(i,e,t)),s.color&&"none"!==s.color&&(s.syncShadow(n,s.shadowFill),n.fillText(i,e,t))},drawImage(e,t,i,s){var n=this.parent.imageManager,a=n.get(i),r=n.getFrame(i);e+=a.left,t+=-this.startYOffset+a.y,this.autoRound&&(e=Math.round(e),t=Math.round(t)),this.context.drawImage(r.source.image,r.cutX,r.cutY,r.cutWidth,r.cutHeight,e,t,a.width,a.height)}};var E=class{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(e){return this.items.push(e),this}pushMultiple(e){return this.items.push.apply(this.items,e),e.length=0,this}clear(){return this.items.length=0,this}};const P=Phaser.Utils.Objects.GetValue,O=x.NO_NEWLINE,_=x.RAW_NEWLINE;var M=class{constructor(e){this.prop={},this.resetFromJSON(e)}resetFromJSON(e){this.text=P(e,"text",""),this.x=P(e,"x",0),this.y=P(e,"y",0),this.width=P(e,"width",0);var t=P(e,"prop",null);null===t&&(t={}),this.prop=t,this.newLineMode=P(e,"newLineMode",0),this.startIndex=P(e,"startIndex",0)}get plainText(){var e=this.text;return this.newLineMode===_&&(e+="\n"),e}get wrapText(){var e=this.text;return this.newLineMode!==O&&(e+="\n"),e}get rawTextLength(){var e=this.text.length;return this.newLineMode===_&&(e+=1),e}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},C=function(e){if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]},A=function(e,t){var i=Array.isArray(e);if(void 0===t?t=i?[]:{}:C(t),i){t.length=e.length;for(var s=0,n=e.length;s<n;s++)t[s]=e[s]}else for(var a in e)t[a]=e[a];return t},L=function(){};const I=Phaser.Utils.Objects.GetFastValue,W=x.NO_NEWLINE,F=x.WRAPPED_NEWLINE;var R=new E,B=new E;class z{constructor(e){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=I(e,"pensPool",R),this.LinesPool=I(e,"linesPool",B),this.tagToText=I(e,"tagToText",L),this.tagToTextScope=I(e,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var e=0,t=this.lines.length;e<t;e++)this.lines[e].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(e,t,i,s,n,a){var r=this.PensPool.pop();return null==r&&(r=new M),j.text=e,j.x=t,j.y=i,j.width=s,j.prop=n,j.newLineMode=a,r.resetFromJSON(j),this.addPen(r),this}addImagePen(e,t,i,s){return this.addTextPen("",e,t,i,s,W),this}addNewLinePen(){var e=this.lastPen,t=e?e.lastX:0,i=e?e.y:0,s=e?A(e.prop):null;return this.addTextPen("",t,i,0,s,F),this}addPen(e){var t=this.lastPen;e.startIndex=null==t?0:t.endIndex,this.pens.push(e);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(e),e.newLineMode!==W&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(e){null==e&&(e=new z),e.freePens();for(var t=0,i=this.lines.length;t<i;t++)for(var s=this.lines[t],n=0,a=s.length;n<a;n++){var r=s[n];e.addPen(r.text,r.x,r.y,r.width,A(r.prop),r.newLineMode)}return e}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(e){if(e>=this.lines.length)return this.getLineEndIndex(e);var t=this.lines[e];return t&&t[0]?t[0].startIndex:0}getLineEndIndex(e){e>=this.lines.length&&(e=this.lines.length-1);var t,i,s=!1;for(t=e;t>=0&&!(s=null!=(i=this.lines[t])&&i.length>0);t--);return s?i[i.length-1].endIndex:0}getLineWidth(e){var t=this.lines[e];if(!t)return 0;var i=t[t.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var e,t=0,i=0,s=this.lines.length;i<s;i++)(e=this.getLineWidth(i))>t&&(t=e);return this.maxLinesWidth=t,t}getLineWidths(){for(var e=[],t=0,i=this.lines.length;t<i;t++)e.push(this.getLineWidth(t));return e}get linesCount(){return this.lines.length}get plainText(){for(var e="",t=this.pens,i=0,s=t.length;i<s;i++)e+=t[i].plainText;return e}get rawTextLength(){for(var e=0,t=this.pens,i=0,s=this.pens.length;i<s;i++)e+=t[i].rawTextLength;return e}getSliceTagText(e,t,i){if(void 0===e&&(e=0),void 0===t){var s=this.lastPen;if(null==s)return"";t=s.endIndex}void 0===i&&(i=!1);for(var n,a,r,o,l,h,d="",u=0,c=this.pens.length;u<c&&((o=(n=this.pens[u]).endIndex)<=e||(n=this.pens[u],a=i?n.wrapText:n.plainText,l=n.prop,(r=n.startIndex)>=e&&o<=t||(a=a.substring(e-r,t-r)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,a,l,h):d+=this.tagToText(a,l,h),h=l,!(o>=t)));u++);return d}}var j={},Y=z;const N=Phaser.Geom.Rectangle;var D=new E;var H=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return D.pushMultiple(this.hitAreas),this}add(e,t,i,s,n){var a=D.pop();return null===a?a=new N(t,i,s,n):a.setTo(t,i,s,n),a.key=e,this.hitAreas.push(a),this}getFirstHitArea(e,t){for(var i,s=this.hitAreas,n=0,a=s.length;n<a;n++)if((i=s[n]).contains(e,t))return i;return null}drawBounds(e,t,i){void 0===t&&(t=16777215),i&&e.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,n=this.hitAreas,a=0,r=n.length;a<r;a++)s=n[a],e.lineStyle(1,t).strokeRect(s.x,s.y,s.width,s.height);return i&&e.restore(),this}},X=function(e,t,i,s){var n=this.hitAreaManager.getFirstHitArea(i,s);if(null!==n){var a=n.key;this.parent.emit(`${e}-${a}`,t,i,s),this.parent.emit(e,a,t,i,s)}},q=function(){this.parent.on("pointerdown",(function(e,t,i,s){X.call(this,"areadown",e,t,i)}),this).on("pointerup",(function(e,t,i,s){X.call(this,"areaup",e,t,i)}),this)};const U=x.NO_NEWLINE,K=x.RAW_NEWLINE,V=x.WRAPPED_NEWLINE,J=x.NO_WRAP,$=x.WORD_WRAP,Q=x.SPLITREGEXP;var Z=[],ee=new E;ee.newline=function(e,t,i){var s=this.pop();return null===s&&(s={}),s.text=e,s.width=t,s.newLineMode=i,s};var te=function(e,t,i,s,n){s<=0&&(i=J);var a=Z;if(ee.pushMultiple(a),!e||!e.length)return a;for(var r,o,l,h=e.split(Q),d=0,u=h.length;d<u;d++)if(r=h[d],l=d===u-1?U:K,i!==J){var c,p;if(o=0===d?s-n:s,r.length<=100)if((w=t(r))<=o){a.push(ee.newline(r,w,l));continue}for(var g,f="",v="",m=0,y=0,x=(c=i===$?r.split(" "):r).length;y<x;y++)p=c[y],i===$?(f+=p,y<x-1&&(f+=" ")):f+=p,(g=t(f))>o&&(0===y?a.push(ee.newline("",0,V)):(a.push(ee.newline(v,m,V)),f=p,i===$&&y<x-1&&(f+=" "),g=t(f)),o=s),v=f,m=g;a.push(ee.newline(v,m,l))}else{var w=t(r);a.push(ee.newline(r,w,l))}return a};const ie=Phaser.Utils.Objects.GetValue,se=x.NO_WRAP,ne=x.NO_NEWLINE;class ae{constructor(e){this.parent=e.parent,this.context=ie(e,"context",null),this.canvas=this.context.canvas,this.parser=ie(e,"parser",null),this.defatultStyle=ie(e,"style",null),this.autoRound=!0,this.pensPool=ie(e,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new H;var t=this.context;this.getTextWidth=function(e){return t.measureText(e).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(e,t,i,s,n){if(void 0===n&&(n=this.penManager),n.freePens(),""===e)return n;for(var a,r,o,l,h,d=this.canvas,u=this.context,c=0,p=0,g=this.parser.splitText(e),f=0,v=g.length;f<v;f++)if(a=(l=this.parser.tagTextToProp(g[f],r)).plainText,(r=l.prop).img){var m=this.imageManager.getOuterWidth(r.img);i>0&&t!==se&&i<c+m&&(n.addNewLinePen(),p+=s,c=0),n.addImagePen(c,p,m,A(r)),c+=m}else if(""!==a){var y;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,r)).buildFont(),o.syncFont(d,u),o.syncStyle(d,u);for(var x=0,w=(h=te(a,this.getTextWidth,t,i,c)).length;x<w;x++)y=h[x],n.addTextPen(y.text,c,p,y.width,A(r),y.newLineMode),y.newLineMode!==ne?(c=0,p+=s):c+=y.width;this.context.restore()}return n}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var e=this.defatultStyle;return e.strokeThickness/2+e.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var e=this.penManager.linesCount,t=this.defatultStyle.maxLines;return t>0&&e>t&&(e=t),e}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var e=this.desplayLinesCount,t=this.defatultStyle.lineHeight*e;return e>0&&(t-=this.defatultStyle.lineSpacing),t}get imageManager(){return this.parent.imageManager}newPenManager(){return new Y({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(e,t,i){var s;if(null==e)s=this.penManager.plainText;else{var n=this.parser.splitText(e,1);s="";for(var a=0,r=n.length;a<r;a++)s+=n[a]}return null==t&&null==i||(null==t&&(t=0),null==i&&(i=s.length),s=s.substring(t,i)),s}getPenManager(e,t){if(void 0===e)return this.copyPenManager(t,this.penManager);void 0===t&&(t=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(e,i.wrapMode,i.wrapWidth,i.lineHeight,t),t}getText(e,t,i,s){if(null==e)return this.penManager.getSliceTagText(t,i,s);var n=this.tmpPenManager,a=this.defatultStyle;return this.updatePenManager(e,a.wrapMode,a.wrapWidth,a.lineHeight,n),n.getSliceTagText(t,i,s)}copyPenManager(e,t){return void 0===t&&(t=this.penManager),t.copy(e)}getTextWidth(e){return void 0===e&&(e=this.penManager),e.getMaxLineWidth()}getLastPen(e){return void 0===e&&(e=this.penManager),e.lastPen}}var re={setInteractive:q};Object.assign(ae.prototype,G,re);var oe=ae;const le=Phaser.Utils.Objects.GetValue;var he,de=class{constructor(e){this.textureManager=e,this.images={}}add(e,t){if("string"==typeof e)this._add(e,t);else if(Array.isArray(e))for(var i=0,s=(n=e).length;i<s;i++)this._add(n[i]);else{var n=e;for(var e in n)this._add(e,n[e])}return this}_add(e,t){void 0===t&&(t={key:e});var i=t.key,s=t.frame,n=t.width,a=t.height;if(void 0===n||void 0===a){var r=this.textureManager.getFrame(i,s),o=r?r.cutWidth:0,l=r?r.cutHeight:0;void 0===n&&void 0===a?(n=o,a=l):void 0===n?n=o*(a/l):void 0===a&&(a=l*(n/o))}this.images[e]={key:i,frame:s,width:n,height:a,y:le(t,"y",0),left:le(t,"left",0),right:le(t,"right",0)}}remove(e){return this.images.hasOwnProperty(e)&&delete this.images[e],this}get(e){return this.images.hasOwnProperty(e)||this.textureManager.exists(e)&&this.add(e),this.images[e]}getOuterWidth(e){var t=this.get(e);return t?t.width+t.left+t.right:0}getFrame(e){var t=this.get(e);return t?this.textureManager.getFrame(t.key,t.frame):void 0}hasTexture(e){return!!this.getFrame(e)}};const ue=Phaser.DOM.AddToDOM,ce=Phaser.Display.Canvas.CanvasPool,pe=Phaser.GameObjects.GameObject,ge=Phaser.Utils.Objects.GetValue,fe=Phaser.DOM.RemoveFromDOM,ve=x.SPLITREGEXP;var me={};class ye extends pe{constructor(e,t,i,s,n,a,r){if(void 0===t&&(t=0),void 0===i&&(i=0),super(e,a),this.renderer=e.sys.game.renderer,this.setPosition(t,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=ce.create(this),this.context=this.canvas.getContext("2d"),n){if(n.hasOwnProperty("align")){var o=n.align;delete n.align,n.halign=o}n.hasOwnProperty("stroke")&&!n.hasOwnProperty("strokeThickness")&&(n.strokeThickness=1)}this.style=new S(this,n),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=e.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=e.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),me.hasOwnProperty(a)||(me[a]=new E),this.canvasText=new oe({parent:this,context:this.context,parser:r,style:this.style,pensPool:me[a]}),n&&n.padding&&this.setPadding(n.padding),this.setText(s),e.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(e){this.setText(e)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",ue(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(e){return e||0===e||(e=""),Array.isArray(e)&&(e=e.join("\n")),e!==this._text&&(this._text=e.toString(),this.updateText()),this}setStyle(e){return this.style.setStyle(e)}setFont(e){return this.style.setFont(e)}setFontFamily(e){return this.style.setFontFamily(e)}setFontSize(e){return this.style.setFontSize(e)}setFontStyle(e){return this.style.setFontStyle(e)}setFixedSize(e,t){return this.style.setFixedSize(e,t)}setBackgroundColor(e){return this.style.setBackgroundColor(e)}setFill(e){return this.style.setFill(e)}setColor(e){return this.style.setColor(e)}setStroke(e,t){return this.style.setStroke(e,t)}setShadow(e,t,i,s,n,a){return this.style.setShadow(e,t,i,s,n,a)}setShadowOffset(e,t){return this.style.setShadowOffset(e,t)}setShadowColor(e){return this.style.setShadowColor(e)}setShadowBlur(e){return this.style.setShadowBlur(e)}setShadowStroke(e){return this.style.setShadowStroke(e)}setShadowFill(e){return this.style.setShadowFill(e)}setWrapMode(e){return this.style.setWrapMode(e)}setWrapWidth(e){return this.style.setWrapWidth(e)}setAlign(e){return this.style.setHAlign(e)}setLineSpacing(e){return this.style.setLineSpacing(e)}setPadding(e,t,i,s){if("object"==typeof e){var n=e,a=ge(n,"x",null);null!==a?(e=a,i=a):(e=ge(n,"left",0),i=ge(n,"right",e));var r=ge(n,"y",null);null!==r?(t=r,s=r):(t=ge(n,"top",0),s=ge(n,"bottom",t))}else void 0===e&&(e=0),void 0===t&&(t=e),void 0===i&&(i=e),void 0===s&&(s=t);return this.padding.left=e,this.padding.top=t,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}setResolution(e){return this.style.setResolution(e)}setMaxLines(e){return this.style.setMaxLines(e)}updateText(e){void 0===e&&(e=!0);var t=this.canvasText,i=this.style;e&&t.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,n,a=this.padding;0===i.fixedWidth?(this.width=t.linesWidth+a.left+a.right,s=t.linesWidth):(this.width=i.fixedWidth,(s=this.width-a.left-a.right)<t.linesWidth&&(s=t.linesWidth)),0===i.fixedHeight?(this.height=t.linesHeight+a.top+a.bottom,n=t.linesHeight):(this.height=i.fixedHeight,(n=this.height-a.top-a.bottom)<t.linesHeight&&(n=t.linesHeight));var r=this.width,o=this.height;this.updateDisplayOrigin();var l=i.resolution;r*=l,o*=l,r=Math.max(Math.ceil(r),1),o=Math.max(Math.ceil(o),1);var h=this.canvas,d=this.context;h.width!==r||h.height!==o?(h.width=r,h.height=o,this.frame.setSize(r,o)):d.clearRect(0,0,r,o),d.save(),d.scale(l,l),t.draw(a.left,a.top,s,n),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(h,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var e=xe.ToJSON(this),t={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return e.data=t,e}preDestroy(){this.style.rtl&&fe(this.canvas),ce.remove(this.canvas),this.canvasText.destroy()}setInteractive(e,t,i){return pe.prototype.setInteractive.call(this,e,t,i),this.canvasText.setInteractive(),this}getWrappedText(e,t,i){return(e=this.canvasText.getText(e,t,i,!0)).split(ve)}getPlainText(e,t,i){return this.canvasText.getPlainText(e,t,i)}getText(e,t,i){return this.canvasText.getText(e,t,i,!1)}getSubString(e,t,i){return this.getText(e,t,i)}copyPenManager(e){return this.canvasText.copyPenManager(e)}getPenManager(e,t){return this.canvasText.getPenManager(e,t)}setSize(e,t){return this.setFixedSize(e,t)}resize(e,t){return this.setFixedSize(e,t)}set lineSpacing(e){this.setLineSpacing(e)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return e=this.scene.textures,void 0===he&&(he=new de(e)),he;var e}addImage(e,t){return this.imageManager.add(e,t),this}drawAreaBounds(e,t){return this.canvasText.hitAreaManager.drawBounds(e,t,this),this}}const xe=Phaser.GameObjects.Components;Phaser.Class.mixin(ye,[xe.Alpha,xe.BlendMode,xe.ComputedSize,xe.Crop,xe.Depth,xe.Flip,xe.GetBounds,xe.Mask,xe.Origin,xe.Pipeline,xe.ScrollFactor,xe.Tint,xe.Transform,xe.Visible,v]);var we=ye,Te={plainText:null,prevProp:null},ke=new S;var be=function(e){for(var t,i,s,n={},a=0,r=(e=e.split(";")).length;a<r;a++)if(i=(t=e[a].split(":"))[0],s=t[1],!Se(i)&&!Se(s)){switch(i){case"stroke":var o=s.split(" ");s={},(h=o.length)>=1&&(s.color=o[0]),h>=2&&(s.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var l=s.split(" ");s={},(h=l.length)>=1&&(s.color=l[0]),h>=2&&(s.offsetX=parseInt(l[1].replace("px",""))),h>=3&&(s.offsetY=parseInt(l[2].replace("px",""))),h>=4&&(s.blur=parseInt(l[3].replace("px","")));break;case"u":case"underline":var h,d=s.split(" ");s={},(h=d.length)>=1&&(s.color=d[0]),h>=2&&(s.thinkness=parseInt(d[1].replace("px",""))),h>=3&&(s.offset=parseInt(d[2].replace("px","")))}n[i]=s}return n},Se=function(e){return 0===(e=e.replace(Me,"")).length},Ge=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Ee=/<\s*class=/i,Pe=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Oe=/<\s*style=/i,_e=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Me=/^\s+|\s+$/,Ce=class{constructor(e){void 0===e&&(e={}),this.tags=e}addTag(e,t){this.tags[e]=t}splitText(e,t){for(var i,s,n,a=[],r=0,o=e.length,l=o;i=Ge.exec(e);)s=i[0],r<(l=Ge.lastIndex-s.length)&&a.push(e.substring(r,l)),void 0===t?a.push(s):1===t&&(Ee.test(s)?(n=s.match(Pe),a.push(n[2])):Oe.test(s)&&(n=s.match(_e),a.push(n[2]))),r=Ge.lastIndex;return r<o&&a.push(e.substring(r,o)),a}tagTextToProp(e,t){var i,s;if(Ee.test(e)){if(null!=(r=e.match(Pe))){var n=r[1],a=this.tags;(s=a.hasOwnProperty(n)?a[n]:{})._class=n,i=r[2]}}else if(Oe.test(e)){var r;if(null!=(r=e.match(_e))){var o=r[1];(s=be(o))._style=o,i=r[2]}}null==i&&(i=e),null==s&&(s={});var l=Te;return l.plainText=i,l.prop=s,l}propToContextStyle(e,t){var i=ke;if(t.hasOwnProperty("img"))i.image=t.img;else{if(i.image=null,t.hasOwnProperty("family")||t.hasOwnProperty("fontFamily")||t.hasOwnProperty("font-family")){var s=t.hasOwnProperty("family")?t.family:t.hasOwnProperty("fontFamily")?t.fontFamily:t["font-family"];i.fontFamily=s}else i.fontFamily=e.fontFamily;if(t.hasOwnProperty("size")||t.hasOwnProperty("fontSize")||t.hasOwnProperty("font-size")){var n=t.hasOwnProperty("size")?t.size:t.hasOwnProperty("fontSize")?t.fontSize:t["font-size"];"number"==typeof n&&(n=n.toString()+"px"),i.fontSize=n}else i.fontSize=e.fontSize;if(t.hasOwnProperty("style")||t.hasOwnProperty("fontStyle")||t.hasOwnProperty("font-style")){var a=t.hasOwnProperty("style")?t.style:t.hasOwnProperty("fontStyle")?t.fontStyle:t["font-style"];i.fontStyle=a}else i.fontStyle=e.fontStyle;if(t.hasOwnProperty("color")||t.hasOwnProperty("font-color")){var r=t.hasOwnProperty("color")?t.color:t["font-color"];i.color=r}else i.color=e.color;if(t.hasOwnProperty("stroke")){var o=t.stroke;i.stroke=o.hasOwnProperty("color")?o.color:e.stroke,i.strokeThickness=o.hasOwnProperty("thinkness")?o.thinkness:e.strokeThickness}else i.stroke=e.stroke,i.strokeThickness=e.strokeThickness}if(t.hasOwnProperty("shadow")){var l=t.shadow;i.shadowColor=l.hasOwnProperty("color")?l.color:e.shadowColor,i.shadowOffsetX=l.hasOwnProperty("offsetX")?l.offsetX:e.shadowOffsetX,i.shadowOffsetY=l.hasOwnProperty("offsetY")?l.offsetY:e.shadowOffsetY,i.shadowBlur=l.hasOwnProperty("blur")?l.blur:e.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=e.shadowColor,i.shadowOffsetX=e.shadowOffsetX,i.shadowOffsetY=e.shadowOffsetY,i.shadowBlur=e.shadowBlur,i.shadowStroke=e.shadowStroke,i.shadowFill=e.shadowFill;if(t.hasOwnProperty("u")||t.hasOwnProperty("underline")){var h=t.hasOwnProperty("u")?t.u:t.underline;i.underlineColor=h.hasOwnProperty("color")?h.color:e.underlineColor,i.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:e.underlineThickness,i.underlineOffset=h.hasOwnProperty("offset")?h.offset:e.underlineOffset}else i.underlineColor=e.underlineColor,i.underlineThickness=e.underlineThickness,i.underlineOffset=e.underlineOffset;return i}propToTagText(e,t,i){return t.hasOwnProperty("_class")?""===e&&this.isTextTag(t._class)?"":"<class='"+t._class+"'>"+e+"</class>":t.hasOwnProperty("_style")?"<style='"+t._style+"'>"+e+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(e){var t=this.tags[e];return!!t&&null==t.img}};const Ae=Phaser.Utils.Objects.GetValue;var Le=class extends we{constructor(e,t,i,s,n){var a=Ae(n,"tags",void 0),r=new Ce(a);super(e,t,i,s,n,"rexTagText",r),this.parser=r}addTag(e,t){return this.parser.addTag(e,t),this.updateText(!0)}addTags(e){for(var t in e)this.parser.addTag(t,e[t]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const Ie=Phaser.Utils.Objects.GetAdvancedValue,We=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(e,t,i,s){var n=new Le(this.scene,e,t,i,s);return this.scene.add.existing(n),n})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(e,t){var i=Ie(e,"text",""),s=Ie(e,"style",null),n=Ie(e,"padding",null);null!==n&&(s.padding=n),void 0!==t&&(e.add=t);var a=new Le(this.scene,0,0,i,s);return We(this.scene,a,e),a.autoRound=Ie(e,"autoRound",!0),a.resolution=Ie(e,"resolution",1),a}));var Fe=Le,Re={setEventEmitter(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(e){return this._eventEmitter&&e&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const Be=Phaser.Scene;var ze=function(e){return e instanceof Be},je=function(e){return ze(e)?e:e.scene&&ze(e.scene)?e.scene:e.parent&&e.parent.scene&&ze(e.parent.scene)?e.parent.scene:void 0};const Ye=Phaser.Utils.Objects.GetFastValue,Ne=Phaser.Utils.Objects.GetValue;class De{constructor(e,t){this.gameObject=e,this.scene=je(e),this.setEventEmitter(Ne(t,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(t),this.boot()}resetFromJSON(e){this.setTypeMode(Ne(e,"typeMode",0)),this.setTypeSpeed(Ne(e,"speed",333)),this.setTextCallback=Ye(e,"setTextCallback",null),this.setTextCallbackScope=Ye(e,"setTextCallbackScope",null),this.typingIdx=Ye(e,"typingIdx",0),this.text=He(Ye(e,"text","")),this.textLen=Ye(e,"textLen",0),this.insertIdx=Ye(e,"insertIdx",null);var t=Ye(e,"elapsed",null);return null!==t&&this.start(void 0,void 0,this.typingIdx,t),this}toJSON(){var e,t=this.getTimer();return e=t?t.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:e}}boot(){return this.gameObject.once&&this.gameObject.on("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(e){return"string"==typeof e&&(e=Xe[e]),this.typeMode=e,this}setTypeSpeed(e){return this.speed=e,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(e,t,i,s){return void 0!==e&&this.setTypingContent(e),void 0!==t&&(this.speed=t),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(s),this}appendText(e){var t=this.text.concat(He(e));return this.isTyping?this.setTypingContent(t):this.start(t,void 0,this.textLen),this}stop(e){return this.getTimer()&&this.freeTimer(),e&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var e=this.getTimer();return e&&(e.paused=!0),this}resume(){var e=this.getTimer();return e&&(e.paused=!1),this}setTypingContent(e){return this.text=He(e),this.textLen=this.getTextLength(this.text),this}onTyping(){var e=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(e),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(e,t,i,s){var n;if(0===s){var a=0,r=t;this.insertIdx=r,n=this.getSubString(e,a,r)}else if(1===s){a=(r=i)-t;this.insertIdx=0,n=this.getSubString(e,a,r)}else if(2===s){var o=i/2;r=(a=Math.floor(o-t/2))+t;this.insertIdx=t%2?t:0,n=this.getSubString(e,a,r)}else if(3===s){var l,h=Math.floor(t/2);if(h>0){a=(r=i)-h;l=this.getSubString(e,a,r)}else l="";var d,u=t-h;if(u>0){r=(a=0)+u;this.insertIdx=r,d=this.getSubString(e,a,r)}else d="",this.insertIdx=0;n=d+l}return n}startTimer(e){var t;return this.timer&&this.freeTimer(),void 0===e?(0,t=0):(this.speed,t=e),this.timer=this.scene.time.addEvent({delay:0,startAt:t,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(e){this.setTextCallback&&(e=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,e,this.isLastChar,this.insertIdx):this.setTextCallback(e,this.isLastChar,this.insertIdx)),this.gameObject.setText(e)}getTextLength(e){var t=this.gameObject;return t.getPlainText?t.getPlainText(e).length:e.length}getSubString(e,t,i){var s=this.gameObject;return s.getSubString?s.getSubString(e,t,i):e.slice(t,i)}}Object.assign(De.prototype,Re);var He=function(e){return Array.isArray(e)?e=e.join("\n"):"number"==typeof e&&(e=e.toString()),e};const Xe={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var qe=De,Ue=class extends u{constructor(e,t,i){super(),this.x=e,this.y=t,this.isIntro=i,this.hideEndDialogueMarkerOnMessageComplete=!1,this.endDialogueMarkerGraphics=null,this.characterExpression=null,this.expressions={},this.expressions.default={y:-90},this.expressions.surprise={y:-105},this.expressions.sadness={y:-80},this.expressions.despair={y:-70},this.expressions.glee={y:-100},this.expressions.nervous={y:-85},this.expressions.confused={y:-100},this.expressions.neutral={y:-90},this.expressions.amused={y:-95},this.expressions.thoughtful={y:-70},this.isTalking=!1}create(e){const t=this,i=e.add.graphics({fillStyle:{color:16777215}});this.isIntro&&i.setAlpha(0);const s=this.isIntro?this.y-40:this.y,n=this.isIntro?this.y+130+20-40:this.y+130+20,a=this.isIntro?this.y+130-40:this.y+130;i.setDepth(1),i.fillRoundedRect(this.x,s,760,130,10),i.fillTriangle(this.x+120,n,this.x+105,a,this.x+135,a),this.endDialogueMarkerGraphics=e.add.graphics({fillStyle:{color:13421772}}),this.endDialogueMarkerGraphics.setDepth(1),this.hideEndDialogueMarker();const r=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(r),e.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const o=d;o.wrap={mode:"word",width:730},o.tags={exclamation:{fontStyle:"bold"}},this.speechBubbleText=new Fe(e,this.x+15,this.y+15,"",o),this.speechBubbleText.setDepth(1),e.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new qe(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{t.messageCompleted.call(t)});const l=this.isIntro?this.x-250:this.x+125,h=e.add.container(l,this.y+130+230),u=e.add.image(0,0,"guide_character");h.add(u);const c=this.isIntro?"expression_surprise":"expression_default",p=this.isIntro?this.expressions.surprise.y:this.expressions.default.y;this.characterExpression=e.add.sprite(-10,p,c),h.add(this.characterExpression);e.tweens.addCounter({duration:100,yoyo:!0,loop:-1,loopDelay:2e3,from:0,to:1,onUpdate:e=>{const i=15*e.getValue();this.characterExpression.setCrop(0,i,t.characterExpression.width,t.characterExpression.height)}});const g=e.tweens.createTimeline();this.isIntro?(g.add({delay:200,targets:h,x:this.x+125,duration:400,angle:15,ease:"Power1"}),g.add({targets:h,duration:400,angle:-7,ease:"Power1"}),g.add({targets:h,duration:400,angle:0,ease:"Power1"}),g.add({offset:"-=300",targets:i,props:{y:{value:"+=40",duration:500,ease:"Bounce.easeOut"},alpha:{value:1,duration:300,ease:"Linear"}},onComplete:()=>{this.emit("ready")}})):g.add({targets:i,duration:100,onComplete:()=>{this.emit("ready")}}),g.play()}displayMessage(e,t){this.isTalking=!0,this.hideEndDialogueMarker();const i=this.convertDialogToTagText(e);this.speechBubbleTextTyping.start(i),this.hideEndDialogueMarkerOnMessageComplete=t}messageCompleted(){this.isTalking=!1,this.hideEndDialogueMarkerOnMessageComplete||this.showEndDialogueMarker()}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}updateExpression(e,t){this.characterExpression.setTexture("expression_"+e),this.characterExpression.isCropped=!1;const i=this.expressions[e];t.tweens.add({targets:this.characterExpression,y:i.y,duration:200,ease:"Power1"})}convertDialogToTagText(e){const t=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let i="",s="";for(let n=0;n<e.length;n++){const a=e[n],r=t.some(e=>e.token===a);if(0!==n||r||(i+='<class="normal">',s="normal"),n!==e.length-1||!r)if(r){const e=t.find(e=>e.token===a);s===e.className?(i+="</class>",i+='<class="normal">',s="normal"):(0!==n&&(i+="</class>"),i+=`<class="${e.className}">`,s=e.className)}else i+=e[n]}return i+="</class>",i}};const Ke=e=>e[Math.floor(Math.random()*e.length)];var Ve=0,Je=1,$e=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],Qe=class extends u{constructor(e,t,i,s,n,a,r,o,l){super(),this.isInitialized=!1,this.isBlocked=!0,this.offsetX=s,this.offsetY=n,this.tileSize=i,this.tileGridHeight=t,this.tileGridWidth=e,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=a,this.onTileMatch=r,this.tileGenerationBehavior=o,this.matchSound=null,this.swapSound=null,this.queue=l,this.matches=0,this.preSetTileGrid=[[0,0,2,3,0,0],[3,2,2,3,3,2],[3,2,1,0,3,2],[1,1,0,1,0,0],[3,2,1,0,3,2],[3,2,2,3,3,2]];for(let i=0;i<2*t;i++){this.tileGrid[i]=[];for(let t=0;t<e;t++)this.tileGrid[i][t]=null}}create(e){this.tileImageContainer=e.add.container();const t=e.make.graphics();t.fillStyle(16777215,1),t.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(e,t),this.matchSound=e.sound.add("match"),this.swapSound=e.sound.add("swap")}update(e){const t=this;if(!t.isInitialized)return;const i=t.getMatches();i.length>0&&(t.matches++,t.onTileMatch(e,i),t.emit("match"));let s=[];if(i.forEach(t=>{s.push(t.destroy(e,this.tileImageContainer))}),s.length>0&&(t.matchSound.play(),t.queue.push(()=>Promise.all(s))),t.forEachTile((e,i,s)=>{null!==e&&e.state===Je&&(t.tileGrid[s][i]=null)}),s.length>0)return;let n=[];for(let i=0;i<this.tileGridWidth;i++){let s=2*this.tileGridHeight-1;for(;s>=0;){if(null===t.tileGrid[s][i]){let a=s-1;for(;a>=0;){let r=t.tileGrid[a][i];null!==r&&(t.tileGrid[s][i]=r,t.tileGrid[a][i]=null,n.push(this.getTileDrop(e,r,i,s)),s--),a--}}s--}}t.forEachPlayableTile((i,s,n)=>{if(null===i){const i=n-t.tileGridHeight,a=t.createTile(t.getTileType(s,n,t.tileGenerationBehavior),s,i,!1);t.tileGrid[i][s]=a,a.create(e),t.tileImageContainer.add(a.image)}}),n.length>0&&t.queue.push(()=>Promise.all(n))}swapTiles(e,t,i){let s=this;s.swapSound.play(),s.queue.push(()=>{let n=t.x,a=t.y,r=t.tileGridX,o=t.tileGridY,l=i.x,h=i.y,d=i.tileGridX,u=i.tileGridY,c=i.updatePosition(e,n,a,r,o);s.tileGrid[o][r]=i;let p=t.updatePosition(e,l,h,d,u);return s.tileGrid[u][d]=t,Promise.all([c,p])})}hasMatches(e,t){return this.getMatches(e,t).length>0}getMatches(e,t){const i=this,s=[];return i.forEachTile((n,a,r)=>{if(void 0!==e&&a!==e&&void 0!==t&&r!==t)return;if(!this.isPlayable(n))return;const o=n.tileType,l=[],h=[];let d=a+1;for(;d<i.tileGridWidth;){const e=i.tileGrid[r][d];if(null==e||o.name!==e.tileType.name)break;l.push(e),d++}for(d=a-1;d>0;){const e=i.tileGrid[r][d];if(null==e||o.name!==e.tileType.name)break;l.push(e),d--}let u=r+1;for(;u<i.tileGridHeight;){const e=i.tileGrid[u][a];if(null==e||o.name!==e.tileType.name)break;h.push(e),u++}for(u=r-1;u>0;){const e=i.tileGrid[u][a];if(null==e||o!==e.tileType)break;h.push(e),u--}h.length>1&&s.push(...h),l.length>1&&s.push(...l),(h.length>1||l.length>1)&&s.push(n)}),s}forEachTile(e){for(let t=0;t<2*this.tileGridHeight;t++)for(let i=0;i<this.tileGridWidth;i++)e(this.tileGrid[t][i],i,t)}forEachPlayableTile(e){for(let t=this.tileGridHeight;t<2*this.tileGridHeight;t++)for(let i=0;i<this.tileGridWidth;i++)e(this.tileGrid[t][i],i,t)}createTile(e,t,i,s){return new class{constructor(e,t,i,s,n,a,r){this.tileType=e,this.x=t,this.y=i,this.tileGridX=s,this.tileGridY=n,this.onTileSelect=r,this.image=null,this.state=Ve,this.isActivated=!1,this.isBlocked=a}create(e){this.image=e.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(e,this)}),this.isBlocked&&this.image.setAlpha(.5)}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(e,t,i,s,n,a){const r=this,o=Math.abs(r.y-i);return new Promise((l,h)=>{r.x=t,r.y=i,r.tileGridX=s,r.tileGridY=n,e.tweens.add({targets:r.image,x:t,y:i,ease:a?"Linear":"Power1",duration:a?Math.max(o,150):500,onComplete:()=>{l()}})})}destroy(e,t){let i=this;if(i.state===Je)return;i.state=Je;const s=e.add.image(i.x,i.y,i.tileType.imageKey);s.setTintFill(16777215),s.alpha=0;const n=[];for(let t=0;t<8;t++){const t=e.add.graphics({fillStyle:{color:16777215},alpha:0}),i=new Phaser.Geom.Circle(this.x,this.y,Phaser.Math.Between(0,10));t.fillCircleShape(i),n.push(t)}return new Promise((a,r)=>{t.remove(i.image),i.image.destroy(),s.setAlpha(1),e.tweens.add({targets:s,alpha:0,duration:250,ease:"Cubic.easeOut",onComplete:()=>{t.remove(s),s.destroy(),n.forEach(e=>{t.remove(e),e.destroy()}),a()}}),n.forEach((t,i)=>{t.setAlpha(1);let s=null,n=null;switch(i){case 0:n="-";case 1:s="+",n="-";break;case 2:s="+";break;case 3:s="+",n="+";break;case 4:n="+";break;case 5:n="+",s="-";case 6:s="-";break;case 7:n="-",s="-"}const a={targets:t,alpha:0,duration:250,ease:"Cubic.easeOut"};null!=s&&(a.x=s+"=45"),null!=n&&(a.y=n+"=45"),e.tweens.add(a)})})}block(e){this.isBlocked=!0,e.tweens.add({targets:this.image,alpha:.5,duration:100})}unblock(e){this.isBlocked=!1,e.tweens.add({targets:this.image,alpha:1,duration:100})}}(e,this.getTileX(t),this.getTileY(i),t,i,s,this.onTileSelect)}getTileDrop(e,t,i,s){return t.updatePosition(e,this.getTileX(i),this.getTileY(s),i,s,!0)}getTileX(e){return this.offsetX+this.tileSize*e}getTileY(e){return this.offsetY+this.tileSize*e}canSelect(e){return!this.isBlocked&&this.isPlayable(e)}isPlayable(e){return null!=e&&e.tileGridY>this.tileGridHeight-1}getTileType(e,t,i){const s=t<1?null:this.tileGrid[t-1][e],n=t>=this.tileGridHeight-1||!this.tileGrid[t+1]?null:this.tileGrid[t+1][e],o=e<1?null:this.tileGrid[t][e-1],l=e>=this.tileGridWidth-1||!this.tileGrid[t]?null:this.tileGrid[t][e+1];return Ke(i!==a||null==s&&null==n&&null==o&&null==l?i===r?$e.filter(e=>!(null!==n&&e.name===n.tileType.name||null!==l&&e.name===l.tileType.name||null!==o&&e.name===o.tileType.name)):$e.filter(e=>!(null!==s&&e.name===s.tileType.name||null!==o&&e.name===o.tileType.name)):[s,n,o,l].filter(e=>null!=e).map(e=>e.tileType))}block(e,t){this.isBlocked=!0,this.forEachTile((i,s,n)=>i&&(void 0===t||!t.some(e=>e[1]===s&&e[0]===n))&&i.block(e))}unblock(e){this.isBlocked=!1,this.forEachTile(t=>t&&t.unblock(e))}fill(e){for(let t=0;t<this.tileGridHeight;t++)for(let i=0;i<this.tileGridWidth;i++){const s=this.tileGenerationBehavior===o?this.getPreSetTileType(i,t):this.getTileType(i,t,n),a=this.createTile(s,i,t,!0);a.create(e),this.tileGrid[t][i]=a}this.isBlocked=!0,this.isInitialized=!0}updateTileGenerationBehavior(e){this.tileGenerationBehavior=e}getPreSetTileType(e,t){return $e[this.preSetTileGrid[t][e]]}},Ze=class extends u{constructor(e,t,i){super(),this.x=e,this.y=t,this.text=null,this.ticks=i,this.isPaused=!0}create(e){e.add.image(this.x+15,this.y+15,"icon_timer").setAlpha(.7),this.text=e.add.text(this.x+40,this.y,this.getTimeOutput(this.ticks),d),this.tick(),e.time.addEvent({delay:1e3,callback:this.tick,callbackScope:this,loop:!0})}tick(){this.ticks<=0||this.isPaused||(this.emit("tick"),this.ticks--,this.text.setText(this.getTimeOutput(this.ticks)))}start(){this.isPaused=!1}stop(){this.isPaused=!0}getTimeOutput(e){let t=e%60;return t<10&&(t="0"+t),`${Math.floor(e/60)}:${t}`}},et=i(2),tt=i.n(et),it=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.isReadyForRoundTransition=!1,this.isTransitioningRounds=!1,this.isBlockingMatches=!1,this.score=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.levelClearMessage=null,this.levelClearMessageHighlight=null,this.director=null,this.guide=null,this.level=null,this.emitter=null,this.totalMatches=null,this.tileSelectSound=null}preload(){tt.a.load({google:{families:[d.googleFontName]}}),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.image("guide_character","assets/images/guide.png"),this.load.image("background","assets/images/background.png"),this.load.image("round_clear","assets/images/round_clear.png"),this.load.image("icon_tile","assets/images/icon_tile.png"),this.load.image("icon_timer","assets/images/icon_timer.png"),this.load.image("expression_default","assets/images/expression_default.png"),this.load.image("expression_surprise","assets/images/expression_surprise.png"),this.load.image("expression_sadness","assets/images/expression_sadness.png"),this.load.image("expression_despair","assets/images/expression_despair.png"),this.load.image("expression_glee","assets/images/expression_glee.png"),this.load.image("expression_nervous","assets/images/expression_nervous.png"),this.load.image("expression_confused","assets/images/expression_confused.png"),this.load.image("expression_neutral","assets/images/expression_neutral.png"),this.load.image("expression_amused","assets/images/expression_amused.png"),this.load.image("expression_thoughtful","assets/images/expression_thoughtful.png"),this.load.audio("match","assets/sounds/match.wav"),this.load.audio("swap","assets/sounds/swap.wav"),this.load.audio("tile_select","assets/sounds/tile_select.wav")}init(e){this.level=e.level||0}create(){this.isTransitioningRounds=!1,this.isRoundTransitionComplete=!1,this.isBlockingMatches=l[this.level].blockMatching,this.score=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(e){var t=this;t.queuedActions.push(()=>{e().then(()=>{t.currentAction=null})})}},this.add.image(400,330,"background");const e=l[this.level].behavior;this.selectedTiles=[],this.tileGrid=new Qe(6,6,80,325,-265,this.onTileSelect,this.onTileMatch,e,this.queue),this.scoreDisplay=new class{constructor(e,t){this.x=e,this.y=t,this.scoreText=null,this.score=0}create(e){e.add.graphics({fillStyle:{color:14414079}}).setAlpha(.5).fillRoundedRect(this.x-150,this.y-10,300,90,10),e.add.image(this.x+15,this.y+15,"icon_tile").setAlpha(.7),this.scoreText=e.add.text(this.x+40,this.y,this.score,d),this.updateScore(this.score)}updateScore(e){this.score=e,this.scoreText.setText(e)}}(110,585);const t=l[this.level].timer;this.timer=t>0?new Ze(110,625,t):null,this.guide=new Ue(20,20,0===this.level),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this),this.emitter=new u,this.levelClearMessage=this.add.image(400,400,"round_clear"),this.levelClearMessage.setAlpha(0),this.levelClearMessage.setDepth(1),this.levelClearMessageHighlight=this.add.image(400,400,"round_clear"),this.levelClearMessageHighlight.setAlpha(0),this.levelClearMessageHighlight.setDepth(1),this.levelClearMessageHighlight.setTintFill(16777215);const i=h.getScript(this.level);this.director=new class{constructor(e,t,i,s,n,a){this.guide=t,this.timer=i,this.tileGrid=s,this.scene=n,this.gameOverSubscriptions=[],this.queuedActions=null,this.isGuideReady=!1;const r=this;this.guide.on("ready",()=>{r.isGuideReady=!0,r.next(a)}),this.queueActions(e)}queueActions(e,t){if(!e)return;const i=this;null===i.queuedActions&&(i.queuedActions=[]),i.queuedActions.push(...e),i.next(t)}next(e){if(!this.isGuideReady)return;if(this.guide.isTalking)return;if(0===this.queuedActions.length)return;const t=this.queuedActions.shift();if("string"==typeof t){const e=this.queuedActions.every(e=>"string"!=typeof e);this.handleMessage(t,e)}else t.hasOwnProperty("do")?(this.handleAction(t.do,t.value,e),this.next(e)):t.hasOwnProperty("on")&&(this.handleEvent(t.on,t.actions,t.filter,e),this.next(e))}handleMessage(e,t){this.guide.displayMessage(e,t)}handleAction(e,t,i){switch(e){case"dropTiles":this.tileGrid.fill(i);break;case"unblockTileGrid":this.tileGrid.unblock(i);break;case"blockTileGrid":this.tileGrid.block(i,t);break;case"updateTileGenerationBehavior":this.tileGrid.updateTileGenerationBehavior(t);break;case"updateGuideExpression":this.guide.updateExpression(t,i);break;case"startTimer":this.timer.start();break;case"updateTimer":this.timer.ticks=t;break;case"stopTimer":this.timer.stop();break;case"endLevel":this.scene.endLevel();break;case"revokeLevelTransition":this.scene.isTransitioningRounds=!1;break;case"revokeBlockMatching":this.scene.isBlockingMatches=!1}}handleEvent(e,t,i,s){let n=null;switch(e){case"match":n=this.tileGrid;break;case"swap":case"win":case"gameOver":n=this.scene.emitter;break;case"tick":n=this.timer}this.setUpEvent(n,e,t,i,s)}setUpEvent(e,t,i,s,n){const a=this;e.on(t,this.wrapFilter(s),()=>a.queueActions(i,n))}wrapFilter(e){const t=this;return void 0===e?null:()=>e(t.getCurrentState())}getCurrentState(){return{matches:this.tileGrid.matches,score:this.scene.score,ticks:this.timer.ticks}}}(i,this.guide,this.timer,this.tileGrid,this,this);const s=this;this.input.on("pointerdown",()=>{s.director.next(s)}),this.tileSelectSound=this.sound.add("tile_select")}update(){if(!this.isTransitioningRounds){if(!this.isRoundTransitionComplete)return null!=this.timer&&this.timer.ticks<=0?(this.isTransitioningRounds=!0,void this.emitter.emit("gameOver")):this.isLevelComplete()?(this.isTransitioningRounds=!0,this.tileGrid.block(this),void this.emitter.emit("win")):void(this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this)));this.nextLevel()}}onTileSelect(e,t){if(!e.queue.isActionRunning()&&!e.guide.isBlockingGameplay&&e.tileGrid.canSelect(t)){if(t.isActivated)return e.selectedTiles=[],void t.deactivate();if(0===e.selectedTiles.length)return e.tileSelectSound.play(),e.selectedTiles.push(t),void t.activate();if(1===e.selectedTiles.length){const i=e.selectedTiles[0],s=Math.abs(i.tileGridX-t.tileGridX),n=Math.abs(i.tileGridY-t.tileGridY);if(1===s&&0===n||0===s&&1===n){e.selectedTiles.push(t);let i=e.selectedTiles[0],s=e.selectedTiles[1];e.tileGrid.swapTiles(e,i,s),e.emitter.emit("swap"),e.queue.push(()=>((e.isBlockingMatches||!e.tileGrid.hasMatches(i.tileGridX,i.tileGridY)&&!e.tileGrid.hasMatches(s.tileGridX,s.tileGridY))&&e.tileGrid.swapTiles(e,i,s),Promise.resolve())),e.selectedTiles.forEach(e=>{e.deactivate()}),e.selectedTiles=[]}}}}onTileMatch(e,t){e.totalMatches++,e.score+=t.length,e.scoreDisplay.updateScore(e.score)}isLevelComplete(){return this.score>=l[this.level].score}endLevel(){const e=this;e.levelClearMessageHighlight.setAlpha(1),e.tweens.add({targets:e.levelClearMessageHighlight,alpha:0,duration:1e3}),e.tweens.add({targets:e.levelClearMessage,alpha:1,duration:1e3,completeDelay:2e3,onComplete:()=>{e.isRoundTransitionComplete=!0,e.isTransitioningRounds=!1}})}nextLevel(){this.scene.restart({level:this.level+1})}};const st={type:Phaser.AUTO,width:800,height:700,scene:[s,it]};new Phaser.Game(st)}]);
//# sourceMappingURL=bundle.js.map