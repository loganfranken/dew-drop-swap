!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,a,n){if(0!==e.width&&0!==e.height){var r=e.frame,o=r.width,h=r.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,r.glTexture,o,h,e.x,e.y,o/e.style.resolution,h/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,h,l(e._tintTL,a.alpha*e._alphaTL),l(e._tintTR,a.alpha*e._alphaTR),l(e._tintBL,a.alpha*e._alphaBL),l(e._tintBR,a.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,a,n)}}},function(t,e){t.exports=function(t,e,i,s,a){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,s,a)}},function(t,e,i){var s;!function(){function a(t,e,i){return t.call.apply(t.bind,arguments)}function n(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function r(t,e,i){return(r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:n).apply(null,arguments)}var o=Date.now||function(){return+new Date};function h(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var l=!!window.FontFace;function d(t,e,i,s){if(e=t.c.createElement(e),i)for(var a in i)i.hasOwnProperty(a)&&("style"==a?e.style.cssText=i[a]:e.setAttribute(a,i[a]));return s&&e.appendChild(t.c.createTextNode(s)),e}function c(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function p(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),a=0;a<e.length;a+=1){for(var n=!1,r=0;r<s.length;r+=1)if(e[a]===s[r]){n=!0;break}n||s.push(e[a])}for(e=[],a=0;a<s.length;a+=1){for(n=!1,r=0;r<i.length;r+=1)if(s[a]===i[r]){n=!0;break}n||e.push(s[a])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function g(t,e){for(var i=t.className.split(/\s+/),s=0,a=i.length;s<a;s++)if(i[s]==e)return!0;return!1}function f(t,e,i){function s(){o&&a&&n&&(o(r),o=null)}e=d(t,"link",{rel:"stylesheet",href:e,media:"all"});var a=!1,n=!0,r=null,o=i||null;l?(e.onload=function(){a=!0,s()},e.onerror=function(){a=!0,r=Error("Stylesheet failed to load"),s()}):setTimeout((function(){a=!0,s()}),0),c(t,"head",e)}function m(t,e,i,s){var a=t.c.getElementsByTagName("head")[0];if(a){var n=d(t,"script",{src:e}),r=!1;return n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&a.removeChild(n))},a.appendChild(n),setTimeout((function(){r||(r=!0,i&&i(Error("Script load timeout")))}),s||5e3),n}return null}function v(){this.a=0,this.c=null}function y(t){return t.a++,function(){t.a--,w(t)}}function x(t,e){t.c=e,w(t)}function w(t){0==t.a&&t.c&&(t.c(),t.c=null)}function T(t){this.a=t||"-"}function b(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function S(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function k(t){return t.a+t.f}function _(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function P(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function M(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new T("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function O(t){if(t.g){var e=g(t.f,t.a.c("wf","active")),i=[],s=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),p(t.f,i,s)}G(t,"inactive")}function G(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,k(i)):t.h[e]())}function C(){this.c={}}function E(t,e){this.c=t,this.f=e,this.a=d(this.c,"span",{"aria-hidden":"true"},this.f)}function A(t){c(t.c,"body",t.a)}function I(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+S(t.c)+";font-style:"+_(t)+";font-weight:"+t.f+"00;"}function L(t,e,i,s,a,n){this.g=t,this.j=e,this.a=s,this.c=i,this.f=a||3e3,this.h=n||void 0}function B(t,e,i,s,a,n,r){this.v=t,this.B=e,this.c=i,this.a=s,this.s=r||"BESbswy",this.f={},this.w=a||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new E(this.c,this.s),this.h=new E(this.c,this.s),this.j=new E(this.c,this.s),this.m=new E(this.c,this.s),t=I(t=new b(this.a.c+",serif",k(this.a))),this.g.a.style.cssText=t,t=I(t=new b(this.a.c+",sans-serif",k(this.a))),this.h.a.style.cssText=t,t=I(t=new b("serif",k(this.a))),this.j.a.style.cssText=t,t=I(t=new b("sans-serif",k(this.a))),this.m.a.style.cssText=t,A(this.g),A(this.h),A(this.j),A(this.m)}T.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},L.prototype.start=function(){var t=this.c.o.document,e=this,i=o(),s=new Promise((function(s,a){!function n(){o()-i>=e.f?a():t.fonts.load(function(t){return _(t)+" "+t.f+"00 300px "+S(t.c)}(e.a),e.h).then((function(t){1<=t.length?s():setTimeout(n,25)}),(function(){a()}))}()})),a=null,n=new Promise((function(t,i){a=setTimeout(i,e.f)}));Promise.race([n,s]).then((function(){a&&(clearTimeout(a),a=null),e.g(e.a)}),(function(){e.j(e.a)}))};var W={D:"serif",C:"sans-serif"},F=null;function R(){if(null===F){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);F=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return F}function D(t,e,i){for(var s in W)if(W.hasOwnProperty(s)&&e===t.f[W[s]]&&i===t.f[W[s]])return!0;return!1}function Y(t){var e,i=t.g.a.offsetWidth,s=t.h.a.offsetWidth;(e=i===t.f.serif&&s===t.f["sans-serif"])||(e=R()&&D(t,i,s)),e?o()-t.A>=t.w?R()&&D(t,i,s)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?j(t,t.v):j(t,t.B):function(t){setTimeout(r((function(){Y(this)}),t),50)}(t):j(t,t.v)}function j(t,e){setTimeout(r((function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),e(this.a)}),t),0)}function z(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}B.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),Y(this)};var N=null;function X(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&p(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),G(t,"active")):O(t.a))}function H(t){this.j=t,this.a=new C,this.h=0,this.f=this.g=!0}function q(t,e,i,s,a){var n=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=a||null,o=s||{};if(0===i.length&&n)O(e.a);else{e.f+=i.length,n&&(e.j=n);var h,l=[];for(h=0;h<i.length;h++){var d=i[h],c=o[d.c],u=e.a,g=d;if(u.g&&p(u.f,[u.a.c("wf",g.c,k(g).toString(),"loading")]),G(u,"fontloading",g),u=null,null===N)if(window.FontFace){g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);N=g?42<parseInt(g[1],10):!f}else N=!1;u=N?new L(r(e.g,e),r(e.h,e),e.c,d,e.s,c):new B(r(e.g,e),r(e.h,e),e.c,d,e.s,t,c),l.push(u)}for(h=0;h<l.length;h++)l[h].start()}}),0)}function U(t,e){this.c=t,this.a=e}function K(t,e){this.c=t,this.a=e}function V(t,e){this.c=t||J,this.a=[],this.f=[],this.g=e||""}z.prototype.g=function(t){var e=this.a;e.g&&p(e.f,[e.a.c("wf",t.c,k(t).toString(),"active")],[e.a.c("wf",t.c,k(t).toString(),"loading"),e.a.c("wf",t.c,k(t).toString(),"inactive")]),G(e,"fontactive",t),this.m=!0,X(this)},z.prototype.h=function(t){var e=this.a;if(e.g){var i=g(e.f,e.a.c("wf",t.c,k(t).toString(),"active")),s=[],a=[e.a.c("wf",t.c,k(t).toString(),"loading")];i||s.push(e.a.c("wf",t.c,k(t).toString(),"inactive")),p(e.f,s,a)}G(e,"fontinactive",t),X(this)},H.prototype.load=function(t){this.c=new h(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var s=[],a=i.timeout;!function(t){t.g&&p(t.f,[t.a.c("wf","loading")]),G(t,"loading")}(e);s=function(t,e,i){var s,a=[];for(s in e)if(e.hasOwnProperty(s)){var n=t.c[s];n&&a.push(n(e[s],i))}return a}(t.a,i,t.c);var n=new z(t.c,e,a);for(t.h=s.length,e=0,i=s.length;e<i;e++)s[e].load((function(e,i,s){q(t,n,e,i,s)}))}(this,new M(this.c,t),t)},U.prototype.load=function(t){var e=this,i=e.a.projectId,s=e.a.version;if(i){var a=e.c.o;m(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),(function(s){s?t([]):(a["__MonotypeConfiguration__"+i]=function(){return e.a},function e(){if(a["__mti_fntLst"+i]){var s,n=a["__mti_fntLst"+i](),r=[];if(n)for(var o=0;o<n.length;o++){var h=n[o].fontfamily;null!=n[o].fontStyle&&null!=n[o].fontWeight?(s=n[o].fontStyle+n[o].fontWeight,r.push(new b(h,s))):r.push(new b(h))}t(r)}else setTimeout((function(){e()}),50)}())})).id="__MonotypeAPIScript__"+i}else t([])},K.prototype.load=function(t){var e,i,s=this.a.urls||[],a=this.a.families||[],n=this.a.testStrings||{},r=new v;for(e=0,i=s.length;e<i;e++)f(this.c,s[e],y(r));var o=[];for(e=0,i=a.length;e<i;e++)if((s=a[e].split(":"))[1])for(var h=s[1].split(","),l=0;l<h.length;l+=1)o.push(new b(s[0],h[l]));else o.push(new b(s[0]));x(r,(function(){t(o,n)}))};var J="https://fonts.googleapis.com/css";function Q(t){this.f=t,this.a=[],this.c={}}var $={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},tt={i:"i",italic:"i",n:"n",normal:"n"},et=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function it(t,e){this.c=t,this.a=e}var st={Arimo:!0,Cousine:!0,Tinos:!0};function at(t,e){this.c=t,this.a=e}function nt(t,e){this.c=t,this.f=e,this.a=[]}it.prototype.load=function(t){var e=new v,i=this.c,s=new V(this.a.api,this.a.text),a=this.a.families;!function(t,e){for(var i=e.length,s=0;s<i;s++){var a=e[s].split(":");3==a.length&&t.f.push(a.pop());var n="";2==a.length&&""!=a[1]&&(n=":"),t.a.push(a.join(n))}}(s,a);var n=new Q(a);!function(t){for(var e=t.f.length,i=0;i<e;i++){var s=t.f[i].split(":"),a=s[0].replace(/\+/g," "),n=["n4"];if(2<=s.length){var r;if(r=[],o=s[1])for(var o,h=(o=o.split(",")).length,l=0;l<h;l++){var d;if((d=o[l]).match(/^[\w-]+$/))if(null==(u=et.exec(d.toLowerCase())))d="";else{if(d=null==(d=u[2])||""==d?"n":tt[d],null==(u=u[1])||""==u)u="4";else var c=Z[u],u=c||(isNaN(u)?"4":u.substr(0,1));d=[d,u].join("")}else d="";d&&r.push(d)}0<r.length&&(n=r),3==s.length&&(r=[],0<(s=(s=s[2])?s.split(","):r).length&&(s=$[s[0]])&&(t.c[a]=s))}for(t.c[a]||(s=$[a])&&(t.c[a]=s),s=0;s<n.length;s+=1)t.a.push(new b(a,n[s]))}}(n),f(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],s=0;s<e;s++)i.push(t.a[s].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(s),y(e)),x(e,(function(){t(n.a,n.c,st)}))},at.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],a=0;a<e.length;a+=2)for(var n=e[a],r=e[a+1],o=0;o<r.length;o++)s.push(new b(n,r[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(s)}}),2e3):t([])},nt.prototype.load=function(t){var e=this.f.id,i=this.c.o,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var a=0,n=i.fonts.length;a<n;++a){var r=i.fonts[a];s.a.push(new b(r.name,P("font-weight:"+r.weight+";font-style:"+r.style)))}t(s.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var rt=new H(window);rt.a.c.custom=function(t,e){return new K(e,t)},rt.a.c.fontdeck=function(t,e){return new nt(e,t)},rt.a.c.monotype=function(t,e){return new U(e,t)},rt.a.c.typekit=function(t,e){return new at(e,t)},rt.a.c.google=function(t,e){return new it(e,t)};var ot={load:r(rt.load,rt)};void 0===(s=function(){return ot}.call(e,i,e,t))||(t.exports=s)}()},function(t,e,i){"use strict";i.r(e);const s=t=>t[Math.floor(Math.random()*t.length)];var a=class{constructor(t,e){this.x=t,this.y=e,this.muteIcon=null,this.isMuted=!1}create(t){const e=t.add.image(this.x,this.y,"icon_audio");e.setAlpha(.7),e.setInteractive({cursor:"pointer"}),this.muteIcon=t.add.image(this.x,this.y,"icon_audio_mute"),this.muteIcon.setAlpha(0);const i=this;e.on("pointerdown",()=>{i.toggleMute(t)}),t.sound.mute&&(this.isMuted=!0,this.muteIcon.setAlpha(.7))}toggleMute(t){this.isMuted?(t.sound.mute=!1,this.isMuted=!1,t.tweens.add({targets:this.muteIcon,alpha:0,duration:100})):(t.sound.mute=!0,this.isMuted=!0,t.tweens.add({targets:this.muteIcon,alpha:.7,duration:100}))}},n=class extends Phaser.Scene{constructor(){super("TitleScene"),this.startingLevel=0,this.isExiting=!1,this.tileInfos=[],this.title=null,this.startBtn=null,this.startBtnOverlay=null}preload(){this.load.image("background",["assets/images/background.png","assets/images/background_n.png"]),this.load.image("title","assets/images/title.png"),this.load.image("start","assets/images/start.png"),this.load.image("start-active","assets/images/start_active.png"),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.image("icon_audio","assets/images/icon_audio.png"),this.load.image("icon_audio_mute","assets/images/icon_audio_mute.png"),this.load.audio("background_music","assets/sounds/background_music.wav"),this.load.audio("select","assets/sounds/select.wav"),this.load.audio("intro_slide","assets/sounds/intro_slide.wav")}create(){const t=this;this.add.image(400,330,"background");const e=this.add.graphics({fillStyle:{color:16777215}});e.setAlpha(0);const i=new Phaser.Geom.Rectangle(0,0,800,700);e.fillRectShape(i),this.tileInfos=[],this.tileInfos.push({imageKey:"tile_01",xChange:"+=180",yChange:"+=180",angle:15,scale:.8}),this.tileInfos.push({imageKey:"tile_03",xChange:"-=180",yChange:"+=180",angle:-15,scale:.9}),this.tileInfos.push({imageKey:"tile_04",xChange:"-=200",yChange:"-=180",angle:-5,scale:.8}),this.tileInfos.push({imageKey:"tile_01",xChange:"+=0",yChange:"-=180",angle:-15,scale:.7}),this.tileInfos.push({imageKey:"tile_02",xChange:"+=200",yChange:"-=180",angle:15,scale:1}),this.tileInfos.push({imageKey:"tile_02",xChange:"+=0",yChange:"+=180",angle:-15,scale:1}),this.tileInfos.push({imageKey:"tile_03",xChange:"+=290",yChange:"+=30",angle:15,scale:.8}),this.tileInfos.push({imageKey:"tile_01",xChange:"-=290",yChange:"+=40",angle:-15,scale:.9}),this.tileInfos.forEach(e=>{e.tile=t.add.image(400,230,e.imageKey),e.tile.setAlpha(0),e.tile.setScale(.5,.5),e.tileFlash=t.add.image(400,230,e.imageKey),e.tileFlash.setTintFill(16777215),e.tileFlash.setAlpha(0)}),this.title=this.add.image(400,230,"title"),this.title.setAlpha(0),this.title.setScale(2,2),this.startBtn=this.add.image(400,540,"start"),this.startBtn.setInteractive({cursor:"pointer"}),this.startBtn.setAlpha(0);const s=this.add.image(400,540,"start");s.setAlpha(0),s.setTintFill(16777215),this.startBtnOverlay=this.add.image(400,540,"start-active"),this.startBtnOverlay.setAlpha(0),new a(40,640).create(this),this.startBtn.on("pointerover",()=>{t.tweens.add({targets:t.startBtnOverlay,alpha:1,duration:100,ease:"Sine.easeInOut"})}),this.startBtn.on("pointerout",()=>{t.tweens.add({targets:t.startBtnOverlay,alpha:0,duration:100,ease:"Sine.easeInOut"})}),this.selectSound=this.sound.add("select"),this.startBtn.on("pointerdown",()=>{t.transitionToNextScene()});const n=this.tweens.createTimeline();n.add({delay:800,targets:this.title,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Quad.easeIn"}),this.tileInfos.forEach((t,e)=>{n.add({targets:t.tile,x:t.xChange,y:t.yChange,scaleX:1,scaleY:1,alpha:1,scaleX:t.scale,scaleY:t.scale,angle:t.angle,duration:300,ease:"Quad.easeOut",offset:0===e?"-=0":"-=300"})});const r=this.sound.add("intro_slide");this.game.backgroundMusic=this.sound.add("background_music"),this.game.backgroundMusic.play(),n.add({targets:e,alpha:1,duration:30,offset:"-=300",onComplete:()=>{r.play()}}),n.add({targets:e,alpha:0,duration:700,offset:1500,ease:"Quad.easeIn"}),n.add({targets:[this.startBtn,s],alpha:1,offset:2200,duration:100}),n.add({targets:s,alpha:0,duration:300,offset:2300,ease:"Quad.easeOut",onComplete:this.flashTiles.apply(t)}),n.add({targets:this.title,scaleX:1.02,scaleY:1.02,yoyo:!0,repeat:-1,duration:500,offset:2600,ease:"Quad"}),n.play()}flashTiles(){const t=this;t.time.addEvent({delay:3e3,callback:()=>{if(t.isExiting)return;const e=s(t.tileInfos);e.tileFlash.x=e.tile.x,e.tileFlash.y=e.tile.y,e.tileFlash.angle=e.tile.angle,e.tileFlash.scaleX=e.tile.scaleX,e.tileFlash.scaleY=e.tile.scaleY,t.tweens.add({targets:e.tileFlash,alpha:1,duration:10}),t.tweens.add({targets:e.tileFlash,alpha:0,duration:1e3,ease:"Power1",delay:10}),t.tweens.add({targets:[e.tile,e.tileFlash],scaleX:"*=1.1",scaleY:"*=1.1",duration:500,yoyo:!0,ease:"Power1"})},callbackScope:this,loop:!0})}transitionToNextScene(){const t=this;this.isExiting=!0,this.selectSound.play(),this.startBtn.setAlpha(0);const e=this.tweens.createTimeline();this.tileInfos.forEach((t,i)=>{e.add({targets:[t.tile,t.tileFlash],x:t.xChange,y:t.yChange,alpha:0,duration:500,offset:0===i?"-=0":"-=1000",ease:"Quad.easeOut"})}),e.add({targets:this.title,scaleX:1.1,scaleY:1.1,duration:700,offset:"-=1000",alpha:0,ease:"Quad.easeOut"}),e.add({targets:this.startBtnOverlay,y:"+=300",duration:500,offset:"-=1000",ease:"Quad.easeOut",completeDelay:300,onComplete:()=>{t.scene.transition({target:"RoundScene",data:{level:t.startingLevel},remove:!0})}}),e.play()}},r=0,o=1,h=2,l=3,d=[{score:50,behavior:r},{score:100,timer:120,behavior:r},{score:300,timer:30,behavior:h},{score:300,timer:120,behavior:o},{score:400,timer:120,behavior:o},{score:500,timer:120,behavior:h},{score:100,timer:60,behavior:r,blockMatching:!0},{score:50,timer:120,behavior:l,blockMatching:!0},{score:300,timer:180,behavior:r},{score:Math.Infinity,behavior:r}],c={getScript(t){switch(t){case 0:return["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)",{do:"updateGuideExpression",value:"sadness"},"The Dew Drop Kingdom is in trouble!",{do:"updateGuideExpression",value:"despair"},"We lost all of our dew drops and now we'll starve!",{do:"updateGuideExpression",value:"glee"},{do:"dropTiles"},"But you can help us by collecting as many dew drops as you can!",{do:"updateGuideExpression",value:"default"},"If you match three or more dew drops of the same color, we can collect them!",{do:"unblockTileGrid"},"To make a match, select two dew drops and swap their places!",{on:"match",filter:t=>1===t.matches,actions:[{do:"updateGuideExpression",value:"glee"},"You got it! That's it!",{do:"updateGuideExpression",value:"default"},{do:"showScoreDisplay"},"See if you can collect *50 dew drops*!"]},{on:"match",filter:t=>t.matches>1,actions:[{do:"showScoreDisplay"}]},{on:"match",filter:t=>5===t.matches,actions:[{do:"updateGuideExpression",value:"glee"},"*Wow!* Look at you go!",{do:"updateGuideExpression",value:"default"}]},{on:"match",filter:t=>t.score>.5*d[0].score,actions:[{do:"updateGuideExpression",value:"glee"},"*Doozle!* You're almost there!",{do:"updateGuideExpression",value:"default"}]},{on:"win",actions:[{do:"endLevel"}]}];case 1:return[{do:"updateGuideExpression",value:"glee"},"*Oh, doozle!* You're so good at this!",{do:"updateGuideExpression",value:"nervous"},"But, we'll have to hurry this time!",{do:"dropTiles"},"We only have two minutes before the sun dries up all the dew drops!",{do:"showTimerDisplay"},{do:"updateGuideExpression",value:"default"},{do:"unblockTileGrid"},{do:"startTimer"},"Collect at least *100 dew drops* in *two minutes*!",{on:"match",filter:t=>5===t.matches,actions:[{do:"updateGuideExpression",value:"glee"},"*Doozle!* What a match!",{do:"updateGuideExpression",value:"default"}]},{on:"match",filter:t=>t.score>.5*d[1].score,actions:[{do:"updateGuideExpression",value:"glee"},"You're halfway there! You can do it!",{do:"updateGuideExpression",value:"default"}]},{on:"tick",filter:t=>t.ticks<30,actions:[{do:"updateGuideExpression",value:"nervous"},"Only *30 seconds* left! You can do this!",{do:"updateGuideExpression",value:"default"}]},{on:"gameOver",actions:[{do:"blockTileGrid"},{do:"updateGuideExpression",value:"confused"},"Uhh?",{do:"updateGuideExpression",value:"neutral"},"I think there's been a mix-up.",{do:"updateGuideExpression",value:"confused"},"Did you get the wrong script?",{do:"updateGuideExpression",value:"neutral"},"You're supposed to win this time.","Well, whatever, I'm sure we can just fix it up in post.","Let's just move onto the next round.",{do:"endLevel"}]},{on:"win",actions:[{do:"endLevel"}]}]}}},u={color:"#000",fontFamily:'"Baloo Thambi 2"',googleFontName:"Baloo Thambi 2:500;700",fontSize:"30px"},p=class{constructor(){this.subscriptions=[]}on(t,e,i,s){this.subscriptions.push({eventName:t,filter:e,callback:i,persist:s})}emit(t){this.subscriptions.filter(e=>e.eventName===t).filter(t=>null===t.filter||t.filter()).forEach(t=>{t.callback&&t.callback(),t.persist||(t.callback=null)})}},g=i(0),f=i.n(g),m=i(1),v=i.n(m),y=function(){},x={renderWebGL:f.a,renderCanvas:v.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const w=Phaser.Display.Canvas.CanvasPool;var T=function(t){var e=w.create(this),i=e.getContext("2d");t.syncFont(e,i);var s=Math.ceil(i.measureText(t.testString).width*t.baselineX),a=s,n=2*a;a=a*t.baselineY|0,e.width=s,e.height=n,i.fillStyle="#f00",i.fillRect(0,0,s,n),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,a);var r={ascent:0,descent:0,fontSize:0};if(!i.getImageData(0,0,s,n))return r.ascent=a,r.descent=a+6,r.fontSize=r.ascent+r.descent,w.remove(e),r;var o,h,l=i.getImageData(0,0,s,n).data,d=l.length,c=4*s,u=0,p=!1;for(o=0;o<a;o++){for(h=0;h<c;h+=4)if(255!==l[u+h]){p=!0;break}if(p)break;u+=c}for(r.ascent=a-o,u=d-c,p=!1,o=n;o>a;o--){for(h=0;h<c;h+=4)if(255!==l[u+h]){p=!0;break}if(p)break;u-=c}return r.descent=o-a,r.fontSize=r.ascent+r.descent,w.remove(e),r},b={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const S=Phaser.Utils.Objects.GetAdvancedValue,k=Phaser.Utils.Objects.GetValue;var _={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const P={none:b.NO_WRAP,word:b.WORD_WRAP,char:b.CHAR_WRAP,character:b.CHAR_WRAP};var M=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=k(e,"metrics",!1);this.metrics=i?{ascent:k(i,"ascent",0),descent:k(i,"descent",0),fontSize:k(i,"fontSize",0)}:T(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=P[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var a in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),_)this[a]="wrapCallback"===a||"wrapCallbackScope"===a?k(t,_[a][0],_[a][1]):S(t,_[a][0],_[a][1]);var n=k(t,"font",null);this._font=null===n?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:n;var r=k(t,"fill",null);return null!==r&&(this.color=r),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=T(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=k(t,"fontFamily","Courier"),this.fontSize=k(t,"fontSize","16px"),this.fontStyle=k(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,s,a,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===a&&(a=!1),void 0===n&&(n=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=a,this.shadowFill=n,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=P[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in _)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}},O={draw(t,e,i,s){var a=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save(),this.drawBackground(this.defatultStyle.backgroundColor);var r=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var o,h,l,d,c,u,p=r.halign,g=r.valign,f=r.lineHeight,m=a.lines,v=m.length,y=r.maxLines;y>0&&v>y?(h=y,l="center"===g?Math.floor((v-h)/2):"bottom"===g?v-h:0):(h=v,l=0),d=l+h,u="center"===g?Math.max((s-h*f)/2,0):"bottom"===g?Math.max(s-h*f-2,0):0,u+=e;for(var x=l;x<d;x++)if(0!==(o=a.getLineWidth(x))){c="center"===p?(i-o)/2:"right"===p?i-o:0,c+=t;for(var w=m[x],T=0,b=w.length;T<b;T++)this.drawPen(w[T],c,u)}n.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var s=this.canvas,a=this.context;a.save();var n=this.parser.propToContextStyle(this.defatultStyle,t.prop);n.buildFont(),n.syncFont(s,a),n.syncStyle(s,a),n.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,n),t.isTextPen&&this.drawText(e,i,t.text,n),t.isImagePen&&this.drawImage(e,i,t.prop.img,n),a.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,s){e+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context,n=a.lineCap;a.lineCap="butt",a.beginPath(),a.strokeStyle=s.underlineColor,a.lineWidth=s.underlineThickness,a.moveTo(t,e),a.lineTo(t+i,e),a.stroke(),a.lineCap=n},drawText(t,e,i,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context;s.strokeThickness&&(s.syncShadow(a,s.shadowStroke),a.strokeText(i,t,e)),s.color&&"none"!==s.color&&(s.syncShadow(a,s.shadowFill),a.fillText(i,t,e))},drawImage(t,e,i,s){var a=this.parent.imageManager,n=a.get(i),r=a.getFrame(i);t+=n.left,e+=-this.startYOffset+n.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(r.source.image,r.cutX,r.cutY,r.cutWidth,r.cutHeight,t,e,n.width,n.height)}};var G=class{constructor(){this.items=[]}destroy(){this.items.length=0,this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}};const C=Phaser.Utils.Objects.GetValue,E=b.NO_NEWLINE,A=b.RAW_NEWLINE;var I=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=C(t,"text",""),this.x=C(t,"x",0),this.y=C(t,"y",0),this.width=C(t,"width",0);var e=C(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=C(t,"newLineMode",0),this.startIndex=C(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===A&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==E&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===A&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},L=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]},B=function(t,e){var i=Array.isArray(t);for(var s in void 0===e?e=i?[]:{}:L(e),i&&(e.length=t.length),t)e[s]=t[s];return e};const W=Phaser.Utils.Objects.GetFastValue,F=b.NO_NEWLINE,R=b.WRAPPED_NEWLINE;var D=new G,Y=new G;class j{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=W(t,"pensPool",D),this.LinesPool=W(t,"linesPool",Y),this.tagToText=W(t,"tagToText",y),this.tagToTextScope=W(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,s,a,n){var r=this.PensPool.pop();return null==r&&(r=new I),z.text=t,z.x=e,z.y=i,z.width=s,z.prop=a,z.newLineMode=n,r.resetFromJSON(z),this.addPen(r),this}addImagePen(t,e,i,s){return this.addTextPen("",t,e,i,s,F),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,s=t?B(t.prop):null;return this.addTextPen("",e,i,0,s,R),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==F&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new j),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var s=this.lines[e],a=0,n=s.length;a<n;a++){var r=s[a];t.addPen(r.text,r.x,r.y,r.width,B(r.prop),r.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,s=!1;for(e=t;e>=0&&!(s=null!=(i=this.lines[e])&&i.length>0);e--);return s?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,s=this.lines.length;i<s;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,s=e.length;i<s;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,s=this.pens.length;i<s;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var s=this.lastPen;if(null==s)return"";e=s.endIndex}void 0===i&&(i=!1);for(var a,n,r,o,h,l,d="",c=0,u=this.pens.length;c<u&&((o=(a=this.pens[c]).endIndex)<=t||(a=this.pens[c],n=i?a.wrapText:a.plainText,h=a.prop,(r=a.startIndex)>=t&&o<=e||(n=n.substring(t-r,e-r)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,n,h,l):d+=this.tagToText(n,h,l),l=h,!(o>=e)));c++);return d}}var z={},N=j;const X=Phaser.Geom.Rectangle;var H=new G;var q=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return H.pushMultiple(this.hitAreas),this}add(t,e,i,s,a){var n=H.pop();return null===n?n=new X(e,i,s,a):n.setTo(e,i,s,a),n.key=t,this.hitAreas.push(n),this}contains(t,e){for(var i,s=this.hitAreas,a=0,n=s.length;a<n;a++)if((i=s[a]).contains(t,e))return i.key;return!1}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,a=this.hitAreas,n=0,r=a.length;n<r;n++)s=a[n],t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height);return i&&t.restore(),this}},U=function(t,e,i,s){var a=this.hitAreaManager.contains(i,s);!1!==a&&(this.parent.emit(`${t}-${a}`,e,i,s),this.parent.emit(t,a,e,i,s))},K=function(){this.parent.on("pointerdown",(function(t,e,i,s){U.call(this,"areadown",t,e,i)}),this).on("pointerup",(function(t,e,i,s){U.call(this,"areaup",t,e,i)}),this)};const V=b.NO_NEWLINE,J=b.RAW_NEWLINE,Q=b.WRAPPED_NEWLINE,$=b.NO_WRAP,Z=b.WORD_WRAP,tt=b.SPLITREGEXP;var et=[],it=new G;it.newline=function(t,e,i){var s=this.pop();return null===s&&(s={}),s.text=t,s.width=e,s.newLineMode=i,s};var st=function(t,e,i,s,a){s<=0&&(i=$);var n=et;if(it.pushMultiple(n),!t||!t.length)return n;for(var r,o,h,l=t.split(tt),d=0,c=l.length;d<c;d++)if(r=l[d],h=d===c-1?V:J,i!==$){var u,p;if(o=0===d?s-a:s,r.length<=100)if((w=e(r))<=o){n.push(it.newline(r,w,h));continue}for(var g,f="",m="",v=0,y=0,x=(u=i===Z?r.split(" "):r).length;y<x;y++)p=u[y],i===Z?(f+=p,y<x-1&&(f+=" ")):f+=p,(g=e(f))>o&&(0===y?n.push(it.newline("",0,Q)):(n.push(it.newline(m,v,Q)),f=p,i===Z&&y<x-1&&(f+=" "),g=e(f)),o=s),m=f,v=g;n.push(it.newline(m,v,h))}else{var w=e(r);n.push(it.newline(r,w,h))}return n};const at=Phaser.Utils.Objects.GetValue,nt=b.NO_WRAP,rt=b.NO_NEWLINE;class ot{constructor(t){this.parent=t.parent,this.context=at(t,"context",null),this.canvas=this.context.canvas,this.parser=at(t,"parser",null),this.defatultStyle=at(t,"style",null),this.autoRound=!0,this.pensPool=at(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new q;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,s,a){if(void 0===a&&(a=this.penManager),a.freePens(),""===t)return a;for(var n,r,o,h,l,d=this.canvas,c=this.context,u=0,p=0,g=this.parser.splitText(t),f=0,m=g.length;f<m;f++)if(n=(h=this.parser.tagTextToProp(g[f],r)).plainText,(r=h.prop).img){var v=this.imageManager.getOuterWidth(r.img);i>0&&e!==nt&&i<u+v&&(a.addNewLinePen(),p+=s,u=0),a.addImagePen(u,p,v,B(r)),u+=v}else if(""!==n){var y;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,r)).buildFont(),o.syncFont(d,c),o.syncStyle(d,c);for(var x=0,w=(l=st(n,this.getTextWidth,e,i,u)).length;x<w;x++)y=l[x],a.addTextPen(y.text,u,p,y.width,B(r),y.newLineMode),y.newLineMode!==rt?(u=0,p+=s):u+=y.width;this.context.restore()}return a}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new N({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var s;if(null==t)s=this.penManager.plainText;else{var a=this.parser.splitText(t,1);s="";for(var n=0,r=a.length;n<r;n++)s+=a[n]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=s.length),s=s.substring(e,i)),s}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,s){if(null==t)return this.penManager.getSliceTagText(e,i,s);var a=this.tmpPenManager,n=this.defatultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,a),a.getSliceTagText(e,i,s)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var ht={setInteractive:K};Object.assign(ot.prototype,O,ht);var lt=ot;const dt=Phaser.Utils.Objects.GetValue;var ct,ut=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,s=(a=t).length;i<s;i++)this._add(a[i]);else{var a=t;for(var t in a)this._add(t,a[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,s=e.frame,a=e.width,n=e.height;if(void 0===a||void 0===n){var r=this.textureManager.getFrame(i,s),o=r?r.cutWidth:0,h=r?r.cutHeight:0;void 0===a&&void 0===n?(a=o,n=h):void 0===a?a=o*(n/h):void 0===n&&(n=h*(a/o))}this.images[t]={key:i,frame:s,width:a,height:n,y:dt(e,"y",0),left:dt(e,"left",0),right:dt(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}};const pt=Phaser.DOM.AddToDOM,gt=Phaser.Display.Canvas.CanvasPool,ft=Phaser.GameObjects.GameObject,mt=Phaser.Utils.Objects.GetValue,vt=Phaser.DOM.RemoveFromDOM,yt=b.SPLITREGEXP;var xt={};class wt extends ft{constructor(t,e,i,s,a,n,r){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,n),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=gt.create(this),this.context=this.canvas.getContext("2d"),a&&a.hasOwnProperty("align")){var o=a.align;delete a.align,a.halign=o}this.style=new M(this,a),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),xt.hasOwnProperty(n)||(xt[n]=new G),this.canvasText=new lt({parent:this,context:this.context,parser:r,style:this.style,pensPool:xt[n]}),a&&a.padding&&this.setPadding(a.padding),this.setText(s),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",pt(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,s,a,n){return this.style.setShadow(t,e,i,s,a,n)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,s){if("object"==typeof t){var a=t,n=mt(a,"x",null);null!==n?(t=n,i=n):(t=mt(a,"left",0),i=mt(a,"right",t));var r=mt(a,"y",null);null!==r?(e=r,s=r):(e=mt(a,"top",0),s=mt(a,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===s&&(s=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,a,n=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+n.left+n.right,s=e.linesWidth):(this.width=i.fixedWidth,(s=this.width-n.left-n.right)<e.linesWidth&&(s=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+n.top+n.bottom,a=e.linesHeight):(this.height=i.fixedHeight,(a=this.height-n.top-n.bottom)<e.linesHeight&&(a=e.linesHeight));var r=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;r*=h,o*=h,r=Math.max(Math.ceil(r),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,d=this.context;l.width!==r||l.height!==o?(l.width=r,l.height=o,this.frame.setSize(r,o)):d.clearRect(0,0,r,o),d.save(),d.scale(h,h),e.draw(n.left,n.top,s,a),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var c=this.input;return c&&!c.customHitArea&&(c.hitArea.width=this.width,c.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=Tt.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&vt(this.canvas),gt.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return ft.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(yt)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return t=this.scene.textures,void 0===ct&&(ct=new ut(t)),ct;var t}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const Tt=Phaser.GameObjects.Components;Phaser.Class.mixin(wt,[Tt.Alpha,Tt.BlendMode,Tt.ComputedSize,Tt.Crop,Tt.Depth,Tt.Flip,Tt.GetBounds,Tt.Mask,Tt.Origin,Tt.Pipeline,Tt.ScrollFactor,Tt.Tint,Tt.Transform,Tt.Visible,x]);var bt=wt,St={plainText:null,prevProp:null},kt=new M;var _t=function(t){for(var e,i,s,a={},n=0,r=(t=t.split(";")).length;n<r;n++)if(i=(e=t[n].split(":"))[0],s=e[1],!Pt(i)&&!Pt(s)){switch(i){case"stroke":var o=s.split(" ");s={},(l=o.length)>=1&&(s.color=o[0]),l>=2&&(s.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var h=s.split(" ");s={},(l=h.length)>=1&&(s.color=h[0]),l>=2&&(s.offsetX=parseInt(h[1].replace("px",""))),l>=3&&(s.offsetY=parseInt(h[2].replace("px",""))),l>=4&&(s.blur=parseInt(h[3].replace("px","")));break;case"u":case"underline":var l,d=s.split(" ");s={},(l=d.length)>=1&&(s.color=d[0]),l>=2&&(s.thinkness=parseInt(d[1].replace("px",""))),l>=3&&(s.offset=parseInt(d[2].replace("px","")))}a[i]=s}return a},Pt=function(t){return 0===(t=t.replace(At,"")).length},Mt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Ot=/<\s*class=/i,Gt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Ct=/<\s*style=/i,Et=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,At=/^\s+|\s+$/,It=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,s,a,n=[],r=0,o=t.length,h=o;i=Mt.exec(t);)s=i[0],r<(h=Mt.lastIndex-s.length)&&n.push(t.substring(r,h)),void 0===e?n.push(s):1===e&&(Ot.test(s)?(a=s.match(Gt),n.push(a[2])):Ct.test(s)&&(a=s.match(Et),n.push(a[2]))),r=Mt.lastIndex;return r<o&&n.push(t.substring(r,o)),n}tagTextToProp(t,e){var i,s;if(Ot.test(t)){if(null!=(r=t.match(Gt))){var a=r[1],n=this.tags;(s=n.hasOwnProperty(a)?n[a]:{})._class=a,i=r[2]}}else if(Ct.test(t)){var r;if(null!=(r=t.match(Et))){var o=r[1];(s=_t(o))._style=o,i=r[2]}}null==i&&(i=t),null==s&&(s={});var h=St;return h.plainText=i,h.prop=s,h}propToContextStyle(t,e){var i=kt;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var s=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=s}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var a=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof a&&(a=a.toString()+"px"),i.fontSize=a}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var n=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=n}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){e.hasOwnProperty("color")?e.color:e["font-color"];i.color=e.color}else i.color=t.color;if(e.hasOwnProperty("stroke")){var r=e.stroke;i.stroke=r.hasOwnProperty("color")?r.color:t.stroke,i.strokeThickness=r.hasOwnProperty("thinkness")?r.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var o=e.shadow;i.shadowColor=o.hasOwnProperty("color")?o.color:t.shadowColor,i.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:t.shadowOffsetX,i.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:t.shadowOffsetY,i.shadowBlur=o.hasOwnProperty("blur")?o.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var h=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=h.hasOwnProperty("color")?h.color:t.underlineColor,i.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.underlineThickness,i.underlineOffset=h.hasOwnProperty("offset")?h.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const Lt=Phaser.Utils.Objects.GetValue;var Bt=class extends bt{constructor(t,e,i,s,a){var n=Lt(a,"tags",void 0),r=new It(n);super(t,e,i,s,a,"rexTagText",r),this.parser=r}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const Wt=Phaser.Utils.Objects.GetAdvancedValue,Ft=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(t,e,i,s){var a=new Bt(this.scene,t,e,i,s);return this.scene.add.existing(a),a})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(t,e){var i=Wt(t,"text",""),s=Wt(t,"style",null),a=Wt(t,"padding",null);null!==a&&(s.padding=a),void 0!==e&&(t.add=e);var n=new Bt(this.scene,0,0,i,s);return Ft(this.scene,n,t),n.autoRound=Wt(t,"autoRound",!0),n.resolution=Wt(t,"resolution",1),n}));var Rt=Bt,Dt={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const Yt=Phaser.Scene;var jt=function(t){return t instanceof Yt},zt=function(t){return jt(t)?t:t.scene&&jt(t.scene)?t.scene:t.parent&&t.parent.scene&&jt(t.parent.scene)?t.parent.scene:void 0};const Nt=Phaser.Utils.Objects.GetFastValue,Xt=Phaser.Utils.Objects.GetValue;class Ht{constructor(t,e){this.gameObject=t,this.scene=zt(t),this.setEventEmitter(Xt(e,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(Xt(t,"typeMode",0)),this.setTypeSpeed(Xt(t,"speed",333)),this.setTextCallback=Nt(t,"setTextCallback",null),this.setTextCallbackScope=Nt(t,"setTextCallbackScope",null),this.typingIdx=Nt(t,"typingIdx",0),this.text=qt(Nt(t,"text","")),this.textLen=Nt(t,"textLen",0),this.insertIdx=Nt(t,"insertIdx",null);var e=Nt(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=Ut[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,i,s){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(s),this}appendText(t){var e=this.text.concat(qt(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=qt(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,i,s){var a;if(0===s){var n=0,r=e;this.insertIdx=r,a=this.getSubString(t,n,r)}else if(1===s){n=(r=i)-e;this.insertIdx=0,a=this.getSubString(t,n,r)}else if(2===s){var o=i/2;r=(n=Math.floor(o-e/2))+e;this.insertIdx=e%2?e:0,a=this.getSubString(t,n,r)}else if(3===s){var h,l=Math.floor(e/2);if(l>0){n=(r=i)-l;h=this.getSubString(t,n,r)}else h="";var d,c=e-l;if(c>0){r=(n=0)+c;this.insertIdx=r,d=this.getSubString(t,n,r)}else d="",this.insertIdx=0;a=d+h}return a}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?(0,e=0):(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,i){var s=this.gameObject;return s.getSubString?s.getSubString(t,e,i):t.slice(e,i)}}Object.assign(Ht.prototype,Dt);var qt=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const Ut={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var Kt=Ht,Vt=class extends p{constructor(t,e,i){super(),this.x=t,this.y=e,this.isIntro=i,this.hideEndDialogueMarkerOnMessageComplete=!1,this.endDialogueMarkerGraphics=null,this.character=null,this.characterWidth=null,this.characterExpression=null,this.speechBubbleGraphics=null,this.speechBubbleText=null,this.expressions={},this.expressions.default={faceY:-90,bodyAngle:0},this.expressions.surprise={faceY:-105,bodyAngle:-4},this.expressions.sadness={faceY:-80,bodyAngle:5},this.expressions.despair={faceY:-70,bodyAngle:7},this.expressions.glee={faceY:-100,bodyAngle:-4},this.expressions.nervous={faceY:-85,bodyAngle:0},this.expressions.confused={faceY:-100,bodyAngle:-2},this.expressions.neutral={faceY:-90,bodyAngle:0},this.expressions.amused={faceY:-95,bodyAngle:0},this.expressions.thoughtful={faceY:-70,bodyAngle:0},this.isTalking=!1}create(t){const e=this;this.characterWidth=250;this.speechBubbleGraphics=t.add.graphics({fillStyle:{color:16777215}}),this.isIntro&&this.speechBubbleGraphics.setAlpha(0);const i=this.isIntro?this.y-40:this.y,s=this.isIntro?this.y+130+20-40:this.y+130+20,a=this.isIntro?this.y+130-40:this.y+130;this.speechBubbleGraphics.setDepth(1),this.speechBubbleGraphics.fillRoundedRect(this.x,i,760,130,10),this.speechBubbleGraphics.fillTriangle(this.x+120,s,this.x+105,a,this.x+135,a),this.endDialogueMarkerGraphics=t.add.graphics({fillStyle:{color:13421772}}),this.endDialogueMarkerGraphics.setDepth(1),this.hideEndDialogueMarker();const n=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(n),t.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const r=u;r.wrap={mode:"word",width:730},r.tags={exclamation:{fontStyle:"bold"}},this.speechBubbleText=new Rt(t,this.x+15,this.y+15,"",r),this.speechBubbleText.setDepth(1),t.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new Kt(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{e.messageCompleted.call(e)});const o=this.isIntro?this.x-this.characterWidth:this.x+this.characterWidth/2;this.character=t.add.container(o,this.y+130+230);const h=t.add.image(0,0,"guide_character");this.character.add(h);const l=this.isIntro?"expression_surprise":"expression_default",d=this.isIntro?this.expressions.surprise.faceY:this.expressions.default.faceY;this.characterExpression=t.add.sprite(-10,d,l),this.character.add(this.characterExpression);t.tweens.addCounter({duration:100,yoyo:!0,loop:-1,loopDelay:2e3,from:0,to:1,onUpdate:t=>{const i=15*t.getValue();this.characterExpression.setCrop(0,i,e.characterExpression.width,e.characterExpression.height)}});const c=t.tweens.createTimeline();this.isIntro?(c.add({delay:200,targets:this.character,x:this.x+this.characterWidth/2,duration:400,angle:15,ease:"Power1"}),c.add({targets:this.character,duration:400,angle:-7,ease:"Power1"}),c.add({targets:this.character,duration:400,angle:0,ease:"Power1"}),c.add({offset:"-=300",targets:this.speechBubbleGraphics,props:{y:{value:"+=40",duration:500,ease:"Bounce.easeOut"},alpha:{value:1,duration:300,ease:"Linear"}},onComplete:()=>{this.emit("ready")}})):c.add({targets:this.speechBubbleGraphics,duration:100,onComplete:()=>{this.emit("ready")}}),c.play()}displayMessage(t,e){this.isTalking=!0,this.hideEndDialogueMarker();const i=this.convertDialogToTagText(t);this.speechBubbleTextTyping.start(i),this.hideEndDialogueMarkerOnMessageComplete=e}messageCompleted(){this.isTalking=!1,this.hideEndDialogueMarkerOnMessageComplete||this.showEndDialogueMarker()}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}updateExpression(t,e){this.characterExpression.setTexture("expression_"+t),this.characterExpression.isCropped=!1;const i=this.expressions[t];e.tweens.add({targets:this.characterExpression,y:i.faceY,duration:200,ease:"Power1"}),e.tweens.add({targets:this.character,angle:i.bodyAngle,duration:600,ease:"Power2"})}hide(t){t.tweens.add({targets:this.character,x:this.x-this.characterWidth,duration:800,angle:-15,ease:"Power1"}),t.tweens.add({targets:[this.speechBubbleGraphics,this.speechBubbleText],alpha:0,duration:200})}convertDialogToTagText(t){const e=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let i="",s="";for(let a=0;a<t.length;a++){const n=t[a],r=e.some(t=>t.token===n);if(0!==a||r||(i+='<class="normal">',s="normal"),a!==t.length-1||!r)if(r){const t=e.find(t=>t.token===n);s===t.className?(i+="</class>",i+='<class="normal">',s="normal"):(0!==a&&(i+="</class>"),i+=`<class="${t.className}">`,s=t.className)}else i+=t[a]}return i+="</class>",i}},Jt=0,Qt=1,$t=[{name:"Red",imageKey:"tile_01"},{name:"Blue",imageKey:"tile_02"},{name:"Green",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],Zt=class extends p{constructor(t,e,i,s,a,n,r,o,h){super(),this.isInitialized=!1,this.isBlocked=!0,this.offsetX=s,this.offsetY=a,this.tileSize=i,this.tileGridHeight=e,this.tileGridWidth=t,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.gridBackground=null,this.onTileSelect=n,this.onTileMatch=r,this.tileGenerationBehavior=o,this.matchSound=null,this.swapSound=null,this.queue=h,this.matches=0,this.preSetTileGrid=[[0,0,2,3,0,0],[3,2,2,3,3,2],[3,2,1,0,3,2],[1,1,0,1,0,0],[3,2,1,0,3,2],[3,2,2,3,3,2]];for(let i=0;i<2*e;i++){this.tileGrid[i]=[];for(let e=0;e<t;e++)this.tileGrid[i][e]=null}}create(t){this.tileImageContainer=t.add.container(),this.tileImageContainer.setDepth(1);const e=t.make.graphics();e.fillStyle(16777215,1),e.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(t,e),this.gridBackground=t.add.graphics({fillStyle:{color:74752}}).setAlpha(.4),this.gridBackground.fillRoundedRect(this.offsetX-this.tileSize/2-5,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2-5,this.tileGridWidth*this.tileSize+10,this.tileGridHeight*this.tileSize+10,6),this.gridBackground.setAlpha(0),this.gridBackground.setDepth(0),this.matchSounds=[t.sound.add("match"),t.sound.add("match_combo_01"),t.sound.add("match_combo_02"),t.sound.add("match_combo_03"),t.sound.add("match_combo_04"),t.sound.add("match_combo_05")],this.matchSound=this.matchSounds[0],this.swapSound=t.sound.add("swap")}update(t){const e=this;if(!e.isInitialized)return;const i=e.getMatches();i.length>0&&(e.matches++,e.onTileMatch(t,i),i.forEach(t=>{t.hasMatched=!0}),e.emit("match"));let s=[];if(i.forEach(e=>{s.push(e.destroy(t,this.tileImageContainer))}),s.length>0&&(e.matchSound.play(),e.queue.push(()=>Promise.all(s))),e.forEachTile((t,i,s)=>{null!==t&&t.state===Qt&&(e.tileGrid[s][i]=null)}),s.length>0)return;let a=[];for(let i=0;i<this.tileGridWidth;i++){let s=2*this.tileGridHeight-1;for(;s>=0;){if(null===e.tileGrid[s][i]){let n=s-1;for(;n>=0;){let r=e.tileGrid[n][i];null!==r&&(e.tileGrid[s][i]=r,e.tileGrid[n][i]=null,a.push(this.getTileDrop(t,r,i,s)),s--),n--}}s--}}e.forEachPlayableTile((i,s,a)=>{if(null===i){const i=a-e.tileGridHeight,n=e.createTile(e.getTileType(s,a,e.tileGenerationBehavior),s,i,!1);e.tileGrid[i][s]=n,n.create(t),e.tileImageContainer.add(n.image)}}),a.length>0&&e.queue.push(()=>Promise.all(a))}swapTiles(t,e,i){let s=this;s.swapSound.play(),s.queue.push(()=>{let a=e.x,n=e.y,r=e.tileGridX,o=e.tileGridY,h=i.x,l=i.y,d=i.tileGridX,c=i.tileGridY,u=i.updatePosition(t,a,n,r,o);s.tileGrid[o][r]=i;let p=e.updatePosition(t,h,l,d,c);return s.tileGrid[c][d]=e,Promise.all([u,p])})}hasMatches(t,e){return this.getMatches(t,e).length>0}getMatches(t,e){const i=this,s=[];i.forEachTile((a,n,r)=>{if(void 0!==t&&n!==t&&void 0!==e&&r!==e)return;if(!this.isPlayable(a))return;if(a.hasMatched)return;const o=a.tileType,h=[],l=[];let d=n+1;for(;d<i.tileGridWidth;){const t=i.tileGrid[r][d];if(null==t||o.name!==t.tileType.name)break;h.push(t),d++}for(d=n-1;d>0;){const t=i.tileGrid[r][d];if(null==t||o.name!==t.tileType.name)break;h.push(t),d--}let c=r+1;for(;c<i.tileGridHeight;){const t=i.tileGrid[c][n];if(null==t||o.name!==t.tileType.name)break;l.push(t),c++}for(c=r-1;c>0;){const t=i.tileGrid[c][n];if(null==t||o.name!==t.tileType.name)break;l.push(t),c--}l.length>1&&s.push(...l),h.length>1&&s.push(...h),(l.length>1||h.length>1)&&s.push(a)});const a=[];return s.forEach(t=>{a.some(e=>e.x===t.x&&e.y===t.y)||a.push(t)}),a}forEachTile(t){for(let e=0;e<2*this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++)t(this.tileGrid[e][i],i,e)}forEachPlayableTile(t){for(let e=this.tileGridHeight;e<2*this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++)t(this.tileGrid[e][i],i,e)}createTile(t,e,i,s,a){return new class{constructor(t,e,i,s,a,n,r,o){this.tileType=t,this.x=e,this.y=i,this.tileGridX=s,this.tileGridY=a,this.onTileSelect=o,this.image=null,this.state=Jt,this.isActivated=!1,this.isBlocked=r,this.hasMatched=!1,this.initialDrag=void 0===n?1:n,this.hasDragged=void 0===n}create(t){this.image=t.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(t,this)}),this.isBlocked&&this.image.setAlpha(0)}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(t,e,i,s,a,n){const r=this,o=Math.abs(r.y-i);return new Promise((h,l)=>{r.x=e,r.y=i,r.tileGridX=s,r.tileGridY=a;const d={targets:r.image,x:e,y:i,ease:n?"Linear":"Power1",duration:n?Math.max(o,150):500,onComplete:()=>{h()}};this.hasDragged||(d.delay=200-200*r.initialDrag,d.alpha=.5,d.ease="Sine",this.hasDragged=!0),t.tweens.add(d)})}destroy(t,e){let i=this;if(i.state===Qt)return;i.state=Qt;const s=t.add.image(i.x,i.y,i.tileType.imageKey);s.setTintFill(16777215),s.alpha=0;const a=[];for(let e=0;e<8;e++){const e=t.add.graphics({fillStyle:{color:16777215},alpha:0}),i=new Phaser.Geom.Circle(this.x,this.y,Phaser.Math.Between(0,10));e.fillCircleShape(i),a.push(e)}return new Promise((n,r)=>{e.remove(i.image),i.image.destroy(),s.setAlpha(1),t.tweens.add({targets:s,alpha:0,duration:250,ease:"Cubic.easeOut",onComplete:()=>{e.remove(s),s.destroy(),a.forEach(t=>{e.remove(t),t.destroy()}),n()}}),a.forEach((e,i)=>{e.setAlpha(1);let s=null,a=null;switch(i){case 0:a="-";case 1:s="+",a="-";break;case 2:s="+";break;case 3:s="+",a="+";break;case 4:a="+";break;case 5:a="+",s="-";case 6:s="-";break;case 7:a="-",s="-"}const n={targets:e,alpha:0,duration:250,ease:"Cubic.easeOut"};null!=s&&(n.x=s+"=45"),null!=a&&(n.y=a+"=45"),t.tweens.add(n)})})}disappear(t){t.tweens.add({targets:this.image,duration:500,y:"-=50",angle:Phaser.Math.Between(-15,15),alpha:0,delay:Phaser.Math.Between(0,500),ease:"Power1"})}block(t){this.isBlocked=!0,t.tweens.add({targets:this.image,alpha:.5,duration:100})}unblock(t){this.isBlocked=!1,t.tweens.add({targets:this.image,alpha:1,duration:100})}}(t,this.getTileX(e),this.getTileY(i),e,i,a,s,this.onTileSelect)}getTileDrop(t,e,i,s){return e.updatePosition(t,this.getTileX(i),this.getTileY(s),i,s,!0)}getTileX(t){return this.offsetX+this.tileSize*t}getTileY(t){return this.offsetY+this.tileSize*t}canSelect(t){return this.isPlayable(t)}isPlayable(t){return null!=t&&!t.isBlocked&&t.tileGridY>this.tileGridHeight-1}getTileType(t,e,i){const a=e<1?null:this.tileGrid[e-1][t],n=e>=this.tileGridHeight-1||!this.tileGrid[e+1]?null:this.tileGrid[e+1][t],r=t<1?null:this.tileGrid[e][t-1],l=t>=this.tileGridWidth-1||!this.tileGrid[e]?null:this.tileGrid[e][t+1];return s(i!==o||null==a&&null==n&&null==r&&null==l?i===h?$t.filter(t=>!(null!==n&&t.name===n.tileType.name||null!==l&&t.name===l.tileType.name||null!==r&&t.name===r.tileType.name)):$t.filter(t=>!(null!==a&&t.name===a.tileType.name||null!==r&&t.name===r.tileType.name)):[a,n,r,l].filter(t=>null!=t).map(t=>t.tileType))}block(t,e){this.isBlocked=!0,this.forEachTile((i,s,a)=>i&&(void 0===e||!e.some(t=>t[1]===s&&t[0]===a))&&i.block(t))}unblock(t){this.isBlocked=!1,this.forEachTile(e=>e&&e.unblock(t))}fill(t){for(let e=0;e<this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++){const s=this.tileGenerationBehavior===l?this.getPreSetTileType(i,e):this.getTileType(i,e,r),a=this.createTile(s,i,e,!0,(this.tileGridWidth-i)/this.tileGridWidth);a.create(t),this.tileGrid[e][i]=a}this.isBlocked=!0,this.isInitialized=!0,t.tweens.add({targets:this.gridBackground,alpha:.5,duration:200})}updateTileGenerationBehavior(t){this.tileGenerationBehavior=t}getPreSetTileType(t,e){return $t[this.preSetTileGrid[e][t]]}updateMatchSound(t){const e=t>=this.matchSounds.length?this.matchSounds.length-1:t;this.matchSound=this.matchSounds[e]}},te=class extends p{constructor(t,e,i,s){super(),this.x=t,this.y=e,this.isIntro=s,this.text=null,this.icon=null,this.warningTweens=null,this.warningIcon=null,this.warningSound=null,this.timerRunOutSound=null,this.ticks=i,this.isPaused=!0,this.isDisplayingWarning=!1}create(t){this.icon=t.add.image(this.x+15,this.y+15,"icon_timer"),this.icon.setAlpha(this.isIntro?0:.7),this.warningIcon=t.add.image(this.x+15,this.y+15,"icon_timer_warning").setAlpha(0),this.warningSound=t.sound.add("warning_tick"),this.timerRunOutSound=t.sound.add("timer_run_out"),this.text=t.add.text(this.x+40,this.y,this.getTimeOutput(this.ticks),u),this.isIntro&&this.text.setAlpha(0),this.tick(t);const e=this;t.time.addEvent({delay:1e3,callback:()=>{e.tick(t)},callbackScope:this,loop:!0})}show(t){t.tweens.add({targets:this.icon,duration:250,alpha:.7}),t.tweens.add({targets:this.text,duration:250,alpha:1})}tick(t){this.ticks<=0||this.isPaused||(this.ticks<=30&&!this.isDisplayingWarning&&this.displayWarning(t),this.ticks<=10&&this.warningSound.play(),1===this.ticks&&(this.timerRunOutSound.play(),this.warningTweens.forEach(t=>{t.stop(0)})),this.emit("tick"),this.ticks--,this.output())}update(t){this.ticks=t,this.output()}start(){this.isPaused=!1}stop(){this.isPaused=!0}getTimeOutput(t){let e=t%60;return e<10&&(e="0"+e),`${Math.floor(t/60)}:${e}`}output(){this.text.setText(this.getTimeOutput(this.ticks))}displayWarning(t){this.isDisplayingWarning=!0,this.warningTweens=[],this.warningTweens.push(t.tweens.add({targets:[this.icon,this.warningIcon],angle:-60,duration:400,yoyo:!0,repeat:-1})),this.warningTweens.push(t.tweens.add({targets:this.warningIcon,alpha:.6,duration:300,repeatDelay:100,yoyo:!0,repeat:-1}))}},ee=i(2),ie=i.n(ee),se=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.isReadyForRoundTransition=!1,this.isTransitioningRounds=!1,this.isBlockingMatches=!1,this.score=null,this.comboCount=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.background=null,this.levelClearMessage=null,this.levelClearMessageHighlight=null,this.director=null,this.guide=null,this.level=null,this.emitter=null,this.totalMatches=null,this.tileSelectSound=null}preload(){ie.a.load({google:{families:[u.googleFontName]}}),this.load.image("tile_01","assets/images/tile_01.png"),this.load.image("tile_02","assets/images/tile_02.png"),this.load.image("tile_03","assets/images/tile_03.png"),this.load.image("tile_04","assets/images/tile_04.png"),this.load.image("guide_character","assets/images/guide.png"),this.load.image("background",["assets/images/background.png","assets/images/background_n.png"]),this.load.image("round_clear","assets/images/round_clear.png"),this.load.image("round_clear_backdrop","assets/images/round_clear_backdrop.png"),this.load.image("icon_tile","assets/images/icon_tile.png"),this.load.image("icon_timer","assets/images/icon_timer.png"),this.load.image("icon_timer_warning","assets/images/icon_timer_warning.png"),this.load.image("icon_audio","assets/images/icon_audio.png"),this.load.image("icon_audio_mute","assets/images/icon_audio_mute.png"),this.load.image("expression_default","assets/images/expression_default.png"),this.load.image("expression_surprise","assets/images/expression_surprise.png"),this.load.image("expression_sadness","assets/images/expression_sadness.png"),this.load.image("expression_despair","assets/images/expression_despair.png"),this.load.image("expression_glee","assets/images/expression_glee.png"),this.load.image("expression_nervous","assets/images/expression_nervous.png"),this.load.image("expression_confused","assets/images/expression_confused.png"),this.load.image("expression_neutral","assets/images/expression_neutral.png"),this.load.image("expression_amused","assets/images/expression_amused.png"),this.load.image("expression_thoughtful","assets/images/expression_thoughtful.png"),this.load.audio("match","assets/sounds/match.wav"),this.load.audio("match_combo_01","assets/sounds/match_combo_01.wav"),this.load.audio("match_combo_02","assets/sounds/match_combo_02.wav"),this.load.audio("match_combo_03","assets/sounds/match_combo_03.wav"),this.load.audio("match_combo_04","assets/sounds/match_combo_04.wav"),this.load.audio("match_combo_05","assets/sounds/match_combo_05.wav"),this.load.audio("swap","assets/sounds/swap.wav"),this.load.audio("tile_select","assets/sounds/tile_select.wav"),this.load.audio("warning_tick","assets/sounds/warning_tick.wav"),this.load.audio("timer_run_out","assets/sounds/timer_run_out.wav")}init(t){this.level=t.level||0}create(){this.isTransitioningRounds=!1,this.isRoundTransitionComplete=!1,this.isBlockingMatches=d[this.level].blockMatching,this.score=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(t){var e=this;e.queuedActions.push(()=>{t().then(()=>{e.currentAction=null})})}},this.background=this.add.image(400,330,"background");const t=d[this.level].behavior;this.selectedTiles=[],this.tileGrid=new Zt(6,6,80,335,-260,this.onTileSelect,this.onTileMatch,t,this.queue),this.scoreDisplay=new class{constructor(t,e,i){this.x=t,this.y=e,this.isIntro=i,this.scoreBackground=null,this.scoreIcon=null,this.scoreText=null,this.score=0}create(t){this.scoreBackground=t.add.graphics({fillStyle:{color:8781693}}),this.scoreBackground.setAlpha(this.isIntro?0:.25),this.scoreBackground.fillRoundedRect(this.x-150,this.y-10,300,90,10),this.scoreIcon=t.add.image(this.x+15,this.y+15,"icon_tile"),this.scoreIcon.setAlpha(this.isIntro?0:.7),this.scoreText=t.add.text(this.x+40,this.y,this.score,u),this.isIntro&&this.scoreText.setAlpha(0),this.updateScore(this.score)}updateScore(t){this.score=t,this.scoreText.setText(t)}show(t){t.tweens.add({targets:this.scoreBackground,duration:250,alpha:.25}),t.tweens.add({targets:this.scoreIcon,duration:250,alpha:.7}),t.tweens.add({targets:this.scoreText,duration:250,alpha:1})}hide(t){t.tweens.add({targets:[this.scoreBackground,this.scoreIcon,this.scoreText],x:"-=300",duration:300})}}(110,585,0===this.level);const e=d[this.level].timer;this.timer=e>0?new te(110,625,e,1===this.level):null,this.guide=new Vt(20,20,0===this.level),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this),this.emitter=new p;const i=c.getScript(this.level);this.director=new class{constructor(t,e,i,s,a,n,r){this.guide=e,this.timer=i,this.scoreDisplay=s,this.tileGrid=a,this.scene=n,this.gameOverSubscriptions=[],this.queuedActions=null,this.isGuideReady=!1,this.isWaiting=!1;const o=this;this.guide.on("ready",()=>{o.isGuideReady=!0,o.next(r)}),this.queueActions(t)}queueActions(t,e){if(!t)return;const i=this;null===i.queuedActions&&(i.queuedActions=[]),i.queuedActions.push(...t),i.next(e)}next(t){if(!this.isGuideReady)return;if(this.guide.isTalking)return;if(this.isWaiting)return;if(0===this.queuedActions.length)return;const e=this.queuedActions.shift();if("string"==typeof e){const i=this.queuedActions.every(t=>"string"!=typeof t);this.handleMessage(e,i),this.next(t)}else e.hasOwnProperty("do")?(this.handleAction(e.do,e.value,t),this.next(t)):e.hasOwnProperty("on")?(this.handleEvent(e.on,e.actions,e.filter,t,e.persist),this.next(t)):e.hasOwnProperty("wait")&&(this.isWaiting=!0,t.time.addEvent({delay:e.wait,callback:()=>{this.isWaiting=!1,this.next(t)},callbackScope:this,loop:!1}))}handleMessage(t,e){this.guide.displayMessage(t,e)}handleAction(t,e,i){switch(t){case"dropTiles":this.tileGrid.fill(i);break;case"unblockTileGrid":this.tileGrid.unblock(i);break;case"blockTileGrid":this.tileGrid.block(i,e);break;case"updateTileGenerationBehavior":this.tileGrid.updateTileGenerationBehavior(e);break;case"updateGuideExpression":this.guide.updateExpression(e,i);break;case"hideGuide":this.guide.hide(i);break;case"startTimer":this.timer.start();break;case"updateTimer":this.timer.ticks=e;break;case"stopTimer":this.timer.stop();break;case"updateTimerRelativeToScore":const t=d[this.scene.level];this.timer.update(this.getScoreRelativeTicks(t.timer,this.scene.score,t.score));break;case"showTimerDisplay":this.timer.show(i);break;case"hideScoreDisplay":this.scoreDisplay.hide(i);break;case"showScoreDisplay":this.scoreDisplay.show(i);break;case"endLevel":this.scene.endLevel();break;case"revokeLevelTransition":this.scene.isTransitioningRounds=!1;break;case"revokeBlockMatching":this.scene.isBlockingMatches=!1;break;case"turnOffLights":this.scene.turnOffLights();break;case"turnOffBackgroundMusic":this.scene.turnOffBackgroundMusic()}}handleEvent(t,e,i,s,a){let n=null;switch(t){case"match":n=this.tileGrid;break;case"swap":case"win":case"gameOver":n=this.scene.emitter;break;case"tick":n=this.timer}this.setUpEvent(n,t,e,i,s,a)}setUpEvent(t,e,i,s,a,n){const r=this;t.on(e,this.wrapFilter(s),()=>{r.queuedActions=[],r.queueActions(i,a)},n)}wrapFilter(t){const e=this;return void 0===t?null:()=>t(e.getCurrentState())}getCurrentState(){return{matches:this.tileGrid.matches,score:this.scene.score,ticks:this.timer?this.timer.ticks:null,isBlockingMatches:this.scene.isBlockingMatches}}getScoreRelativeTicks(t,e,i){return Math.max(Math.trunc(t-e/i*t),1)}}(i,this.guide,this.timer,this.scoreDisplay,this.tileGrid,this,this);const s=this;this.input.on("pointerdown",()=>{s.director.next(s)}),this.tileSelectSound=this.sound.add("tile_select"),new a(40,640).create(this)}update(){if(!this.isTransitioningRounds){if(!this.isRoundTransitionComplete)return null!=this.timer&&this.timer.ticks<=0?(this.isTransitioningRounds=!0,void this.emitter.emit("gameOver")):this.isLevelComplete()?(this.isTransitioningRounds=!0,this.tileGrid.block(this),void this.emitter.emit("win")):void(this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this)));this.nextLevel()}}onTileSelect(t,e){if(!t.queue.isActionRunning()&&!t.queue.hasActions()&&!t.guide.isBlockingGameplay&&t.tileGrid.canSelect(e)){if(t.comboCount=0,t.tileGrid.updateMatchSound(t.comboCount),e.isActivated)return t.selectedTiles=[],void e.deactivate();if(0===t.selectedTiles.length)return t.tileSelectSound.play(),t.selectedTiles.push(e),void e.activate();if(1===t.selectedTiles.length){const i=t.selectedTiles[0],s=Math.abs(i.tileGridX-e.tileGridX),a=Math.abs(i.tileGridY-e.tileGridY);if(1===s&&0===a||0===s&&1===a){t.selectedTiles.push(e);let i=t.selectedTiles[0],s=t.selectedTiles[1];t.tileGrid.swapTiles(t,i,s),t.emitter.emit("swap"),t.queue.push(()=>((t.isBlockingMatches||!t.tileGrid.hasMatches(i.tileGridX,i.tileGridY)&&!t.tileGrid.hasMatches(s.tileGridX,s.tileGridY))&&t.tileGrid.swapTiles(t,i,s),Promise.resolve())),t.clearSelectedTiles(t)}}}}clearSelectedTiles(t){t.selectedTiles.forEach(t=>{t.deactivate()}),t.selectedTiles=[]}onTileMatch(t,e){e.some(t=>t.isActivated)&&t.clearSelectedTiles(t),t.totalMatches++,t.comboCount++,t.tileGrid.updateMatchSound(t.comboCount),t.score+=e.length,t.scoreDisplay.updateScore(t.score)}isLevelComplete(){return this.score>=d[this.level].score}endLevel(){const t=this,e=this.tweens.createTimeline(),i=this.add.image(400,400,"round_clear");i.setAlpha(0),i.setDepth(1),i.setScale(.75,.75);const s=this.add.graphics({fillStyle:{color:16777215}});s.setAlpha(0);const a=new Phaser.Geom.Rectangle(0,0,800,700);s.fillRectShape(a);const n=this.add.image(400,400,"round_clear_backdrop");n.setAlpha(0),e.add({targets:[n,s],alpha:1,duration:30}),e.add({targets:n,alpha:.7,duration:1e3,ease:"Quad.easeIn"}),e.add({targets:s,alpha:0,duration:1e3,offset:"-=1000"}),e.add({targets:i,alpha:1,duration:500,scaleX:1,scaleY:1,offset:"-=2000",ease:"Back",completeDelay:100,onComplete:()=>{this.tileGrid.forEachPlayableTile(e=>e&&e.disappear(t)),t.tweens.add({targets:this.tileGrid.gridBackground,alpha:0,duration:200})}}),e.add({targets:i,alpha:0,duration:500,scaleX:.75,scaleY:.75,ease:"Quad.easeOut"}),e.add({targets:n,alpha:0,duration:500,offset:"-=500",ease:"Quad.easeOut",onComplete:()=>{t.isRoundTransitionComplete=!0,t.isTransitioningRounds=!1}}),e.play()}nextLevel(){this.scene.restart({level:this.level+1})}turnOffLights(){this.lights.enable().setAmbientColor(5592405),this.background.setPipeline("Light2D"),this.lights.addLight(550,900,500).setColor(16777215).setIntensity(2)}turnOffBackgroundMusic(){this.game.backgroundMusic.pause()}};const ae={type:Phaser.AUTO,width:800,height:700,scene:[n,se]};new Phaser.Game(ae)}]);
//# sourceMappingURL=bundle.js.map