!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var s=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,i,r,n){if(0!==e.width&&0!==e.height){var a=e.frame,h=a.width,o=a.height,l=s.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,a.glTexture,h,o,e.x,e.y,h/e.style.resolution,o/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,h,o,l(e._tintTL,r.alpha*e._alphaTL),l(e._tintTR,r.alpha*e._alphaTR),l(e._tintBL,r.alpha*e._alphaBL),l(e._tintBR,r.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,r,n)}}},function(t,e){t.exports=function(t,e,s,i,r){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,i,r)}},function(t,e,s){"use strict";s.r(e);var i=class extends Phaser.Scene{constructor(){super("TitleScene")}preload(){this.load.image("background","assets/background.png"),this.load.image("title","assets/title.png"),this.load.image("start","assets/start.png")}create(){const t=this;this.add.image(400,400,"background"),this.add.image(400,200,"title");const e=this.add.image(400,600,"start");e.setInteractive(),e.on("pointerover",()=>{e.setTintFill(16777215)}),e.on("pointerout",()=>{e.clearTint()}),e.on("pointerdown",()=>{t.scene.start("RoundScene",{level:0})})}},r=s(0),n=s.n(r),a=s(1),h=s.n(a),o=function(){},l={renderWebGL:n.a,renderCanvas:h.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const d=Phaser.Display.Canvas.CanvasPool;var u=function(t){var e=d.create(this),s=e.getContext("2d");t.syncFont(e,s);var i=Math.ceil(s.measureText(t.testString).width*t.baselineX),r=i,n=2*r;r=r*t.baselineY|0,e.width=i,e.height=n,s.fillStyle="#f00",s.fillRect(0,0,i,n),s.font=t._font,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(t.testString,0,r);var a={ascent:0,descent:0,fontSize:0};if(!s.getImageData(0,0,i,n))return a.ascent=r,a.descent=r+6,a.fontSize=a.ascent+a.descent,d.remove(e),a;var h,o,l=s.getImageData(0,0,i,n).data,u=l.length,c=4*i,g=0,p=!1;for(h=0;h<r;h++){for(o=0;o<c;o+=4)if(255!==l[g+o]){p=!0;break}if(p)break;g+=c}for(a.ascent=r-h,g=u-c,p=!1,h=n;h>r;h--){for(o=0;o<c;o+=4)if(255!==l[g+o]){p=!0;break}if(p)break;g-=c}return a.descent=h-r,a.fontSize=a.ascent+a.descent,d.remove(e),a},c={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const g=Phaser.Utils.Objects.GetAdvancedValue,p=Phaser.Utils.Objects.GetValue;var f={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const y={none:c.NO_WRAP,word:c.WORD_WRAP,char:c.CHAR_WRAP,character:c.CHAR_WRAP};var v=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var s=p(e,"metrics",!1);this.metrics=s?{ascent:p(s,"ascent",0),descent:p(s,"descent",0),fontSize:p(s,"fontSize",0)}:u(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("wrap")){var s=t.wrap;if(s.hasOwnProperty("mode")){var i=s.mode;"string"==typeof i&&(s.mode=y[i])}else s.hasOwnProperty("width")&&(s.mode=1)}for(var r in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),f)this[r]="wrapCallback"===r||"wrapCallbackScope"===r?p(t,f[r][0],f[r][1]):g(t,f[r][0],f[r][1]);var n=p(t,"font",null);this._font=null===n?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:n;var a=p(t,"fill",null);return null!==a&&(this.color=a),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=u(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=p(t,"fontFamily","Courier"),this.fontSize=p(t,"fontSize","16px"),this.fontStyle=p(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,s,i,r,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===s&&(s="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===n&&(n=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=s,this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=n,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,s){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===s&&(s=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=s,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=y[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in f)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}},m={draw(t,e,s,i){var r=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save(),this.drawBackground(this.defatultStyle.backgroundColor);var a=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var h,o,l,d,u,c,g=a.halign,p=a.valign,f=a.lineHeight,y=r.lines,v=y.length,m=a.maxLines;m>0&&v>m?(o=m,l="center"===p?Math.floor((v-o)/2):"bottom"===p?v-o:0):(o=v,l=0),d=l+o,c="center"===p?Math.max((i-o*f)/2,0):"bottom"===p?Math.max(i-o*f-2,0):0,c+=e;for(var x=l;x<d;x++)if(0!==(h=r.getLineWidth(x))){u="center"===g?(s-h)/2:"right"===g?s-h:0,u+=t;for(var w=y[x],T=0,S=w.length;T<S;T++)this.drawPen(w[T],u,c)}n.restore()},drawPen(t,e,s){e+=t.x,s+=t.y;var i=this.canvas,r=this.context;r.save();var n=this.parser.propToContextStyle(this.defatultStyle,t.prop);n.buildFont(),n.syncFont(i,r),n.syncStyle(i,r),n.underlineThickness>0&&t.width>0&&this.drawUnderline(e,s,t.width,n),t.isTextPen&&this.drawText(e,s,t.text,n),t.isImagePen&&this.drawImage(e,s,t.prop.img,n),r.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,s-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,s,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context,n=r.lineCap;r.lineCap="butt",r.beginPath(),r.strokeStyle=i.underlineColor,r.lineWidth=i.underlineThickness,r.moveTo(t,e),r.lineTo(t+s,e),r.stroke(),r.lineCap=n},drawText(t,e,s,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;i.strokeThickness&&(i.syncShadow(r,i.shadowStroke),r.strokeText(s,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(s,t,e))},drawImage(t,e,s,i){var r=this.parent.imageManager,n=r.get(s),a=r.getFrame(s);t+=n.left,e+=-this.startYOffset+n.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,t,e,n.width,n.height)}};var x=class{constructor(){this.items=[]}destroy(){this.items.length=0,this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}};const w=Phaser.Utils.Objects.GetValue,T=c.NO_NEWLINE,S=c.RAW_NEWLINE;var P=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=w(t,"text",""),this.x=w(t,"x",0),this.y=w(t,"y",0),this.width=w(t,"width",0);var e=w(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=w(t,"newLineMode",0),this.startIndex=w(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===S&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==T&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===S&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},b=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]},M=function(t,e){var s=Array.isArray(t);for(var i in void 0===e?e=s?[]:{}:b(e),s&&(e.length=t.length),t)e[i]=t[i];return e};const k=Phaser.Utils.Objects.GetFastValue,O=c.NO_NEWLINE,C=c.WRAPPED_NEWLINE;var G=new x,_=new x;class L{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=k(t,"pensPool",G),this.LinesPool=k(t,"linesPool",_),this.tagToText=k(t,"tagToText",o),this.tagToTextScope=k(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,s,i,r,n){var a=this.PensPool.pop();return null==a&&(a=new P),E.text=t,E.x=e,E.y=s,E.width=i,E.prop=r,E.newLineMode=n,a.resetFromJSON(E),this.addPen(a),this}addImagePen(t,e,s,i){return this.addTextPen("",t,e,s,i,O),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,s=t?t.y:0,i=t?M(t.prop):null;return this.addTextPen("",e,s,0,i,C),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var s=this.lastLine;null==s&&(s=this.LinesPool.pop()||[],this.lines.push(s)),s.push(t),t.newLineMode!==O&&(s=this.LinesPool.pop()||[],this.lines.push(s)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new L),t.freePens();for(var e=0,s=this.lines.length;e<s;e++)for(var i=this.lines[e],r=0,n=i.length;r<n;r++){var a=i[r];t.addPen(a.text,a.x,a.y,a.width,M(a.prop),a.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,s,i=!1;for(e=t;e>=0&&!(i=null!=(s=this.lines[e])&&s.length>0);e--);return i?s[s.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var s=e[e.length-1];return null==s?0:s.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,s=0,i=this.lines.length;s<i;s++)(t=this.getLineWidth(s))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,s=this.lines.length;e<s;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,s=0,i=e.length;s<i;s++)t+=e[s].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,s=0,i=this.pens.length;s<i;s++)t+=e[s].rawTextLength;return t}getSliceTagText(t,e,s){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===s&&(s=!1);for(var r,n,a,h,o,l,d="",u=0,c=this.pens.length;u<c&&((h=(r=this.pens[u]).endIndex)<=t||(r=this.pens[u],n=s?r.wrapText:r.plainText,o=r.prop,(a=r.startIndex)>=t&&h<=e||(n=n.substring(t-a,e-a)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,n,o,l):d+=this.tagToText(n,o,l),l=o,!(h>=e)));u++);return d}}var E={},W=L;const A=Phaser.Geom.Rectangle;var I=new x;var F=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return I.pushMultiple(this.hitAreas),this}add(t,e,s,i,r){var n=I.pop();return null===n?n=new A(e,s,i,r):n.setTo(e,s,i,r),n.key=t,this.hitAreas.push(n),this}contains(t,e){for(var s,i=this.hitAreas,r=0,n=i.length;r<n;r++)if((s=i[r]).contains(t,e))return s.key;return!1}drawBounds(t,e,s){void 0===e&&(e=16777215),s&&t.save().scaleCanvas(s.scaleX,s.scaleY).rotateCanvas(s.rotation).translateCanvas(s.x,s.y);for(var i,r=this.hitAreas,n=0,a=r.length;n<a;n++)i=r[n],t.lineStyle(1,e).strokeRect(i.x,i.y,i.width,i.height);return s&&t.restore(),this}},R=function(t,e,s,i){var r=this.hitAreaManager.contains(s,i);!1!==r&&(this.parent.emit(`${t}-${r}`,e,s,i),this.parent.emit(t,r,e,s,i))},z=function(){this.parent.on("pointerdown",(function(t,e,s,i){R.call(this,"areadown",t,e,s)}),this).on("pointerup",(function(t,e,s,i){R.call(this,"areaup",t,e,s)}),this)};const Y=c.NO_NEWLINE,B=c.RAW_NEWLINE,N=c.WRAPPED_NEWLINE,D=c.NO_WRAP,X=c.WORD_WRAP,j=c.SPLITREGEXP;var H=[],q=new x;q.newline=function(t,e,s){var i=this.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=s,i};var U=function(t,e,s,i,r){i<=0&&(s=D);var n=H;if(q.pushMultiple(n),!t||!t.length)return n;for(var a,h,o,l=t.split(j),d=0,u=l.length;d<u;d++)if(a=l[d],o=d===u-1?Y:B,s!==D){var c,g;if(h=0===d?i-r:i,a.length<=100)if((w=e(a))<=h){n.push(q.newline(a,w,o));continue}for(var p,f="",y="",v=0,m=0,x=(c=s===X?a.split(" "):a).length;m<x;m++)g=c[m],s===X?(f+=g,m<x-1&&(f+=" ")):f+=g,(p=e(f))>h&&(0===m?n.push(q.newline("",0,N)):(n.push(q.newline(y,v,N)),f=g,s===X&&m<x-1&&(f+=" "),p=e(f)),h=i),y=f,v=p;n.push(q.newline(y,v,o))}else{var w=e(a);n.push(q.newline(a,w,o))}return n};const V=Phaser.Utils.Objects.GetValue,J=c.NO_WRAP,$=c.NO_NEWLINE;class K{constructor(t){this.parent=t.parent,this.context=V(t,"context",null),this.canvas=this.context.canvas,this.parser=V(t,"parser",null),this.defatultStyle=V(t,"style",null),this.autoRound=!0,this.pensPool=V(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new F;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,s,i,r){if(void 0===r&&(r=this.penManager),r.freePens(),""===t)return r;for(var n,a,h,o,l,d=this.canvas,u=this.context,c=0,g=0,p=this.parser.splitText(t),f=0,y=p.length;f<y;f++)if(n=(o=this.parser.tagTextToProp(p[f],a)).plainText,(a=o.prop).img){var v=this.imageManager.getOuterWidth(a.img);s>0&&e!==J&&s<c+v&&(r.addNewLinePen(),g+=i,c=0),r.addImagePen(c,g,v,M(a)),c+=v}else if(""!==n){var m;this.context.save(),(h=this.parser.propToContextStyle(this.defatultStyle,a)).buildFont(),h.syncFont(d,u),h.syncStyle(d,u);for(var x=0,w=(l=U(n,this.getTextWidth,e,s,c)).length;x<w;x++)m=l[x],r.addTextPen(m.text,c,g,m.width,M(a),m.newLineMode),m.newLineMode!==$?(c=0,g+=i):c+=m.width;this.context.restore()}return r}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new W({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,s){var i;if(null==t)i=this.penManager.plainText;else{var r=this.parser.splitText(t,1);i="";for(var n=0,a=r.length;n<a;n++)i+=r[n]}return null==e&&null==s||(null==e&&(e=0),null==s&&(s=i.length),i=i.substring(e,s)),i}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var s=this.defatultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,e),e}getText(t,e,s,i){if(null==t)return this.penManager.getSliceTagText(e,s,i);var r=this.tmpPenManager,n=this.defatultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,r),r.getSliceTagText(e,s,i)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var Q={setInteractive:z};Object.assign(K.prototype,m,Q);var Z=K;const tt=Phaser.Utils.Objects.GetValue;var et,st=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var s=0,i=(r=t).length;s<i;s++)this._add(r[s]);else{var r=t;for(var t in r)this._add(t,r[t])}return this}_add(t,e){void 0===e&&(e={key:t});var s=e.key,i=e.frame,r=e.width,n=e.height;if(void 0===r||void 0===n){var a=this.textureManager.getFrame(s,i),h=a?a.cutWidth:0,o=a?a.cutHeight:0;void 0===r&&void 0===n?(r=h,n=o):void 0===r?r=h*(n/o):void 0===n&&(n=o*(r/h))}this.images[t]={key:s,frame:i,width:r,height:n,y:tt(e,"y",0),left:tt(e,"left",0),right:tt(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}};const it=Phaser.DOM.AddToDOM,rt=Phaser.Display.Canvas.CanvasPool,nt=Phaser.GameObjects.GameObject,at=Phaser.Utils.Objects.GetValue,ht=Phaser.DOM.RemoveFromDOM,ot=c.SPLITREGEXP;var lt={};class dt extends nt{constructor(t,e,s,i,r,n,a){if(void 0===e&&(e=0),void 0===s&&(s=0),super(t,n),this.renderer=t.sys.game.renderer,this.setPosition(e,s),this.setOrigin(0,0),this.initPipeline(),this.canvas=rt.create(this),this.context=this.canvas.getContext("2d"),r&&r.hasOwnProperty("align")){var h=r.align;delete r.align,r.halign=h}this.style=new v(this,r),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),lt.hasOwnProperty(n)||(lt[n]=new x),this.canvasText=new Z({parent:this,context:this.context,parser:a,style:this.style,pensPool:lt[n]}),r&&r.padding&&this.setPadding(r.padding),this.setText(i),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",it(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,s,i,r,n){return this.style.setShadow(t,e,s,i,r,n)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,s,i){if("object"==typeof t){var r=t,n=at(r,"x",null);null!==n?(t=n,s=n):(t=at(r,"left",0),s=at(r,"right",t));var a=at(r,"y",null);null!==a?(e=a,i=a):(e=at(r,"top",0),i=at(r,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===s&&(s=t),void 0===i&&(i=e);return this.padding.left=t,this.padding.top=e,this.padding.right=s,this.padding.bottom=i,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,s=this.style;t&&e.updatePenManager(this._text,s.wrapMode,s.wrapWidth,s.lineHeight);var i,r,n=this.padding;0===s.fixedWidth?(this.width=e.linesWidth+n.left+n.right,i=e.linesWidth):(this.width=s.fixedWidth,(i=this.width-n.left-n.right)<e.linesWidth&&(i=e.linesWidth)),0===s.fixedHeight?(this.height=e.linesHeight+n.top+n.bottom,r=e.linesHeight):(this.height=s.fixedHeight,(r=this.height-n.top-n.bottom)<e.linesHeight&&(r=e.linesHeight));var a=this.width,h=this.height;this.updateDisplayOrigin();var o=s.resolution;a*=o,h*=o,a=Math.max(Math.ceil(a),1),h=Math.max(Math.ceil(h),1);var l=this.canvas,d=this.context;l.width!==a||l.height!==h?(l.width=a,l.height=h,this.frame.setSize(a,h)):d.clearRect(0,0,a,h),d.save(),d.scale(o,o),e.draw(n.left,n.top,i,r),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=ut.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&ht(this.canvas),rt.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,s){return nt.prototype.setInteractive.call(this,t,e,s),this.canvasText.setInteractive(),this}getWrappedText(t,e,s){return(t=this.canvasText.getText(t,e,s,!0)).split(ot)}getPlainText(t,e,s){return this.canvasText.getPlainText(t,e,s)}getText(t,e,s){return this.canvasText.getText(t,e,s,!1)}getSubString(t,e,s){return this.getText(t,e,s)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return t=this.scene.textures,void 0===et&&(et=new st(t)),et;var t}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const ut=Phaser.GameObjects.Components;Phaser.Class.mixin(dt,[ut.Alpha,ut.BlendMode,ut.ComputedSize,ut.Crop,ut.Depth,ut.Flip,ut.GetBounds,ut.Mask,ut.Origin,ut.Pipeline,ut.ScrollFactor,ut.Tint,ut.Transform,ut.Visible,l]);var ct=dt,gt={plainText:null,prevProp:null},pt=new v;var ft=function(t){for(var e,s,i,r={},n=0,a=(t=t.split(";")).length;n<a;n++)if(s=(e=t[n].split(":"))[0],i=e[1],!yt(s)&&!yt(i)){switch(s){case"stroke":var h=i.split(" ");i={},(l=h.length)>=1&&(i.color=h[0]),l>=2&&(i.thinkness=parseInt(h[1].replace("px","")));break;case"shadow":var o=i.split(" ");i={},(l=o.length)>=1&&(i.color=o[0]),l>=2&&(i.offsetX=parseInt(o[1].replace("px",""))),l>=3&&(i.offsetY=parseInt(o[2].replace("px",""))),l>=4&&(i.blur=parseInt(o[3].replace("px","")));break;case"u":case"underline":var l,d=i.split(" ");i={},(l=d.length)>=1&&(i.color=d[0]),l>=2&&(i.thinkness=parseInt(d[1].replace("px",""))),l>=3&&(i.offset=parseInt(d[2].replace("px","")))}r[s]=i}return r},yt=function(t){return 0===(t=t.replace(St,"")).length},vt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,mt=/<\s*class=/i,xt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,wt=/<\s*style=/i,Tt=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,St=/^\s+|\s+$/,Pt=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var s,i,r,n=[],a=0,h=t.length,o=h;s=vt.exec(t);)i=s[0],a<(o=vt.lastIndex-i.length)&&n.push(t.substring(a,o)),void 0===e?n.push(i):1===e&&(mt.test(i)?(r=i.match(xt),n.push(r[2])):wt.test(i)&&(r=i.match(Tt),n.push(r[2]))),a=vt.lastIndex;return a<h&&n.push(t.substring(a,h)),n}tagTextToProp(t,e){var s,i;if(mt.test(t)){if(null!=(a=t.match(xt))){var r=a[1],n=this.tags;(i=n.hasOwnProperty(r)?n[r]:{})._class=r,s=a[2]}}else if(wt.test(t)){var a;if(null!=(a=t.match(Tt))){var h=a[1];(i=ft(h))._style=h,s=a[2]}}null==s&&(s=t),null==i&&(i={});var o=gt;return o.plainText=s,o.prop=i,o}propToContextStyle(t,e){var s=pt;if(e.hasOwnProperty("img"))s.image=e.img;else{if(s.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var i=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];s.fontFamily=i}else s.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var r=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof r&&(r=r.toString()+"px"),s.fontSize=r}else s.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var n=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];s.fontStyle=n}else s.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){e.hasOwnProperty("color")?e.color:e["font-color"];s.color=e.color}else s.color=t.color;if(e.hasOwnProperty("stroke")){var a=e.stroke;s.stroke=a.hasOwnProperty("color")?a.color:t.stroke,s.strokeThickness=a.hasOwnProperty("thinkness")?a.thinkness:t.strokeThickness}else s.stroke=t.stroke,s.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var h=e.shadow;s.shadowColor=h.hasOwnProperty("color")?h.color:t.shadowColor,s.shadowOffsetX=h.hasOwnProperty("offsetX")?h.offsetX:t.shadowOffsetX,s.shadowOffsetY=h.hasOwnProperty("offsetY")?h.offsetY:t.shadowOffsetY,s.shadowBlur=h.hasOwnProperty("blur")?h.blur:t.shadowBlur,s.shadowStroke=!0,s.shadowFill=!0}else s.shadowColor=t.shadowColor,s.shadowOffsetX=t.shadowOffsetX,s.shadowOffsetY=t.shadowOffsetY,s.shadowBlur=t.shadowBlur,s.shadowStroke=t.shadowStroke,s.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var o=e.hasOwnProperty("u")?e.u:e.underline;s.underlineColor=o.hasOwnProperty("color")?o.color:t.underlineColor,s.underlineThickness=o.hasOwnProperty("thinkness")?o.thinkness:t.underlineThickness,s.underlineOffset=o.hasOwnProperty("offset")?o.offset:t.underlineOffset}else s.underlineColor=t.underlineColor,s.underlineThickness=t.underlineThickness,s.underlineOffset=t.underlineOffset;return s}propToTagText(t,e,s){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const bt=Phaser.Utils.Objects.GetValue;var Mt=class extends ct{constructor(t,e,s,i,r){var n=bt(r,"tags",void 0),a=new Pt(n);super(t,e,s,i,r,"rexTagText",a),this.parser=a}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const kt=Phaser.Utils.Objects.GetAdvancedValue,Ot=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(t,e,s,i){var r=new Mt(this.scene,t,e,s,i);return this.scene.add.existing(r),r})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(t,e){var s=kt(t,"text",""),i=kt(t,"style",null),r=kt(t,"padding",null);null!==r&&(i.padding=r),void 0!==e&&(t.add=e);var n=new Mt(this.scene,0,0,s,i);return Ot(this.scene,n,t),n.autoRound=kt(t,"autoRound",!0),n.resolution=kt(t,"resolution",1),n}));var Ct=Mt,Gt={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const _t=Phaser.Scene;var Lt=function(t){return t instanceof _t},Et=function(t){return Lt(t)?t:t.scene&&Lt(t.scene)?t.scene:t.parent&&t.parent.scene&&Lt(t.parent.scene)?t.parent.scene:void 0};const Wt=Phaser.Utils.Objects.GetFastValue,At=Phaser.Utils.Objects.GetValue;class It{constructor(t,e){this.gameObject=t,this.scene=Et(t),this.setEventEmitter(At(e,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(At(t,"typeMode",0)),this.setTypeSpeed(At(t,"speed",333)),this.setTextCallback=Wt(t,"setTextCallback",null),this.setTextCallbackScope=Wt(t,"setTextCallbackScope",null),this.typingIdx=Wt(t,"typingIdx",0),this.text=Ft(Wt(t,"text","")),this.textLen=Wt(t,"textLen",0),this.insertIdx=Wt(t,"insertIdx",null);var e=Wt(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=Rt[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,s,i){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===s&&(s=0),this.typingIdx=s+1,0===this.speed?this.stop(!0):this.startTimer(i),this}appendText(t){var e=this.text.concat(Ft(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=Ft(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,s,i){var r;if(0===i){var n=0,a=e;this.insertIdx=a,r=this.getSubString(t,n,a)}else if(1===i){n=(a=s)-e;this.insertIdx=0,r=this.getSubString(t,n,a)}else if(2===i){var h=s/2;a=(n=Math.floor(h-e/2))+e;this.insertIdx=e%2?e:0,r=this.getSubString(t,n,a)}else if(3===i){var o,l=Math.floor(e/2);if(l>0){n=(a=s)-l;o=this.getSubString(t,n,a)}else o="";var d,u=e-l;if(u>0){a=(n=0)+u;this.insertIdx=a,d=this.getSubString(t,n,a)}else d="",this.insertIdx=0;r=d+o}return r}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?(0,e=0):(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,s){var i=this.gameObject;return i.getSubString?i.getSubString(t,e,s):t.slice(e,s)}}Object.assign(It.prototype,Gt);var Ft=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const Rt={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var zt=It;const Yt=t=>t[Math.floor(Math.random()*t.length)];var Bt=0,Nt=1,Dt=0,Xt=1,jt=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],Ht=class{constructor(t,e,s,i,r,n,a,h,o){this.offsetX=i,this.offsetY=r,this.tileSize=s,this.tileGridHeight=e,this.tileGridWidth=t,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=n,this.onTileMatch=a,this.tileGenerationBehavior=h,this.queue=o;for(let s=0;s<2*e;s++){this.tileGrid[s]=[];for(let i=0;i<t;i++)this.tileGrid[s][i]=s<e?null:this.createTile(this.getTileType(i,s,Dt),i,s)}}create(t){this.tileImageContainer=t.add.container(),this.forEachTile(e=>{null!==e&&(e.create(t),this.tileImageContainer.add(e.image))});const e=t.make.graphics();e.fillStyle(16777215,1),e.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(t,e)}update(t){const e=this;if(e.queue.length>0)return;const s=e.getMatches();s.length>0&&e.onTileMatch(t,s);let i=[];s.forEach(e=>{i.push(e.destroy(t,this.tileImageContainer))}),i.length>0&&e.queue.push(()=>Promise.all(i)),e.forEachTile((t,s,i)=>{null!==t&&t.state===Nt&&(e.tileGrid[i][s]=null)});let r=[];for(let s=0;s<this.tileGridWidth;s++){let i=2*this.tileGridHeight-1;for(;i>=0;){if(null===e.tileGrid[i][s]){let n=i-1;for(;n>=0;){let a=e.tileGrid[n][s];null!==a&&(e.tileGrid[i][s]=a,e.tileGrid[n][s]=null,r.push(this.getTileDrop(t,a,s,i)),i--),n--}}i--}}e.forEachPlayableTile((s,i,r)=>{if(null===s){const s=r-e.tileGridHeight,n=e.createTile(e.getTileType(i,r,e.tileGenerationBehavior),i,s);e.tileGrid[s][i]=n,n.create(t),e.tileImageContainer.add(n.image)}}),r.length>0&&e.queue.push(()=>Promise.all(r))}swapTiles(t,e,s){let i=this;i.queue.push(()=>{let r=e.x,n=e.y,a=e.tileGridX,h=e.tileGridY,o=s.x,l=s.y,d=s.tileGridX,u=s.tileGridY,c=s.updatePosition(t,r,n,a,h);i.tileGrid[h][a]=s;let g=e.updatePosition(t,o,l,d,u);return i.tileGrid[u][d]=e,Promise.all([c,g])})}hasMatches(t,e){return this.getMatches(t,e).length>0}getMatches(t,e){const s=this,i=[];return s.forEachTile((r,n,a)=>{if(void 0!==t&&n!==t&&void 0!==e&&a!==e)return;if(!this.isPlayable(r))return;const h=r.tileType,o=[],l=[];let d=n+1;for(;d<s.tileGridWidth;){const t=s.tileGrid[a][d];if(null==t||h.name!==t.tileType.name)break;o.push(t),d++}for(d=n-1;d>0;){const t=s.tileGrid[a][d];if(null==t||h.name!==t.tileType.name)break;o.push(t),d--}let u=a+1;for(;u<s.tileGridHeight;){const t=s.tileGrid[u][n];if(null==t||h.name!==t.tileType.name)break;l.push(t),u++}for(u=a-1;u>0;){const t=s.tileGrid[u][n];if(null==t||h!==t.tileType)break;l.push(t),u--}l.length>1&&i.push(...l),o.length>1&&i.push(...o),(l.length>1||o.length>1)&&i.push(r)}),i}forEachTile(t){for(let e=0;e<2*this.tileGridHeight;e++)for(let s=0;s<this.tileGridWidth;s++)t(this.tileGrid[e][s],s,e)}forEachPlayableTile(t){for(let e=this.tileGridHeight;e<2*this.tileGridHeight;e++)for(let s=0;s<this.tileGridWidth;s++)t(this.tileGrid[e][s],s,e)}createTile(t,e,s){return new class{constructor(t,e,s,i,r,n){this.tileType=t,this.x=e,this.y=s,this.tileGridX=i,this.tileGridY=r,this.onTileSelect=n,this.image=null,this.state=Bt,this.isActivated=!1}create(t){this.image=t.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(t,this)})}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(t,e,s,i,r){let n=this;return new Promise((a,h)=>{n.x=e,n.y=s,n.tileGridX=i,n.tileGridY=r,t.tweens.add({targets:n.image,x:e,y:s,ease:"Power1",duration:500,onComplete:()=>{a()}})})}destroy(t,e){let s=this;return new Promise((i,r)=>{t.tweens.add({targets:s.image,alpha:0,ease:"Power1",duration:500,onComplete:()=>{e.remove(s.image),s.image.destroy(),s.state=Nt,i()}})})}}(t,this.getTileX(e),this.getTileY(s),e,s,this.onTileSelect)}getTileDrop(t,e,s,i){return e.updatePosition(t,this.getTileX(s),this.getTileY(i),s,i)}getTileX(t){return this.offsetX+this.tileSize*t}getTileY(t){return this.offsetY+this.tileSize*t}canSelect(t){return this.isPlayable(t)}isPlayable(t){return null!=t&&t.tileGridY>this.tileGridHeight-1}getTileType(t,e,s){const i=e<1?null:this.tileGrid[e-1][t],r=e>self.tileGridHeight-1||!this.tileGrid[e+1]?null:this.tileGrid[e+1][t],n=t<1?null:this.tileGrid[e][t-1],a=t>self.tileGridWidth-1?null:this.tileGrid[e][t+1];return Yt(s!=Xt||null==i&&null==r&&null==n&&null==a?jt.filter(t=>!(null!==i&&t.name===i.tileType.name||null!==n&&t.name===n.tileType.name)):[i,r,n,a].filter(t=>null!=t).map(t=>t.tileType))}},qt=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.score=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.guide=null,this.level=null,this.comboCount=null,this.totalMatches=null}preload(){this.load.image("tile_01","assets/tile_01.png"),this.load.image("tile_02","assets/tile_02.png"),this.load.image("tile_03","assets/tile_03.png"),this.load.image("tile_04","assets/tile_04.png"),this.load.image("guide_character","assets/guide.png"),this.load.image("background","assets/background.png")}init(t){this.level=t.level}create(){this.isAwaitingRoundTransition=!1,this.score=0,this.comboCount=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(t){var e=this;e.queuedActions.push(()=>{t().then(()=>{e.currentAction=null})})}},this.add.image(400,400,"background");const t=this.getTileGenerationBehavior(this.level);this.selectedTiles=[],this.tileGrid=new Ht(6,6,80,325,-265,this.onTileSelect,this.onTileMatch,t,this.queue),this.scoreDisplay=new class{constructor(t,e){this.x=t,this.y=e,this.scoreText=null,this.comboText=null,this.score=0}create(t){this.scoreText=t.add.text(this.x,this.y,this.score),this.updateScore(this.score),this.comboText=t.add.text(this.x,this.y+20,"")}updateScore(t){this.score=t,this.scoreText.setText(t+" dew drops")}updateCombo(t){this.comboText.setText(t)}}(100,580);const e=this.getTimerSeconds(this.level);this.timer=e>0?new class{constructor(t,e,s){this.x=t,this.y=e,this.text=null,this.seconds=s,this.isPaused=!0}create(t){this.text=t.add.text(this.x,this.y,this.score),this.tick(),t.time.addEvent({delay:1e3,callback:this.tick,callbackScope:this,loop:!0})}tick(){if(this.seconds<=0||this.isPaused)return;this.seconds--;const t=Math.floor(this.seconds/60);let e=this.seconds%60;e<10&&(e="0"+e),this.text.setText(`${t}:${e}`)}start(){this.isPaused=!1}}(5,570,e):null;const s=(new class{getScript(t){const e=new class{constructor(){this.introMessages=[],this.getDisplayTileMatchMessages=()=>{}}};switch(t){case 0:e.introMessages=["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)","The Dew Drop Kingdom is in trouble!","We lost all of our dew drops and now we'll starve!","But you can help us by collecting as many dew drops as you can!","If you match three or more dew drops of the same color, we can collect them!","To make a match, select two dew drops and swap their places!"],e.getDisplayTileMatchMessages=t=>{if(1===t.totalMatches)return["You got it! That's it!","You collect extra dew drops when you chain together matches in a combo!","See if you can collect 100 dew drops!"]};break;case 1:e.introMessages=["*Oh, doozle!* You're so good at this!","But, we'll have to hurry this time!","We only have two minutes before the sun dries up all the dew drops!","Collect at least 200 dew drops in two minutes!"];break;case 2:e.introMessages=["Wow, we're so proud of you!","This round you'll only have 30 seconds to collect at least 300 dew drops!"],e.getGameOverMessages=()=>["Wait, wait, sorry, hold on.",'It\'s too early for the *"Lose in a Panic"* scenario.',"So sorry about that.","You've been really great so far, honestly.","You know, what, let's just go to the next round and we'll take it from the top."];break;case 3:e.introMessages=["Alright, I think we've got everything figured out.","Okay, for this next round, let me set you up:","Remember, you've been winning the last few rounds and you're gaining confidence.","In this round, it's going to be easy for you to get combos.","So the idea here is that you're going to get a little *too* confident, right?","Like a little full of yourself, alright?","Okay, great! Let's do this:","...","*Oh doozle woozle!*","You're so amazing!","You have two minutes again, but this time you'll have to collect 300 dew drops.","Can you do it?","Who am I kidding? Of course you can!"];break;case 4:e.introMessages=["Okay, okay, great stuff.","For this round, you're bringing all of that pride, all of that hubris.","And, when the round starts, things are still going your way.","But guess what?","Halfway through this round, things start getting a little harder.","This is where we to start your chip away at your pride as the player."];break;case 5:e.introMessages=["Wow, really moving work. It feels so authentic.","It's been a joy working with you.","Okay, here we go, this is a pivotal scene:","This round will not go your way at all. At all.","This is your fall from grace."];break;case 6:e.introMessages=["Okay, let's move right into the next scene:","Here, you are wallowing, right?","You are in the pit of despair and you can't see a way out.","This round won't be particularly hard, but you can't seem to find any matches."];break;case 7:e.introMessages=["Now, you've been wallowing. You've feeling really low.","You're in such despair, that in this round...","There's an obvious combo.","Right there, right in front of your face.","But you can't see it through the despair.","But then, in the last ten seconds of the round, you see it.","Boom, it's the perfect match.","And the pheonix rises once again!"];break;case 8:e.introMessages=["Our hero is back!","This final scene is our victory lap.","However, we don't want too many combos in this round, right?","This is a round the player wins on their own.","No assistance from the game.","A true hero's victory!","Alright, let's do this: I've got an appointment after this."]}return e}}).getScript(this.level);this.guide=new class{constructor(t,e,s){this.x=t,this.y=e,this.script=s,this.queuedMessages=null,this.isPaused=!1,this.isBlockingGameplay=!1,this.endDialogueMarkerGraphics=null}create(t){const e=this,s=t.add.graphics({fillStyle:{color:16777215}});s.fillRoundedRect(this.x,this.y,760,130,10),s.fillTriangle(this.x+120,this.y+130+20,this.x+105,this.y+130,this.x+135,this.y+130),this.endDialogueMarkerGraphics=t.add.graphics({fillStyle:{color:13421772}}),this.hideEndDialogueMarker();const i=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(i),t.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const r={color:"#000",wrap:{mode:"word",width:760},tags:{exclamation:{fontStyle:"bold"}}};this.speechBubbleText=new Ct(t,this.x+15,this.y+15,"",r),t.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new zt(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{e.onMessageComplete.call(e)}),t.add.image(this.x+125,this.y+130+230,"guide_character"),e.queueMessages(t,this.script.introMessages)}queueMessages(t,e){if(!e)return;const s=this;null===s.queuedMessages&&(s.queuedMessages=[]),s.queuedMessages.push(...e),s.speechBubbleTextTyping.isTyping||(s.isBlockingGameplay=!0,s.progressDialogue())}onMessageComplete(){this.showEndDialogueMarker(),0!==this.queuedMessages.length||(this.isBlockingGameplay=!1)}displayTileMatchMessage(t,e){const s=this.script.getDisplayTileMatchMessages(e);this.queueMessages(t,s)}displayGameOverMessage(t){const e=this.script.getGameOverMessages();this.queueMessages(t,e)}progressDialogue(){if(this.hideEndDialogueMarker(),this.queuedMessages.length>0){const t=this.convertDialogToTagText(this.queuedMessages.shift());this.speechBubbleTextTyping.start(t)}}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}convertDialogToTagText(t){const e=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let s="",i="";for(let r=0;r<t.length;r++){const n=t[r],a=e.some(t=>t.token===n);if(0!==r||a||(s+='<class="normal">',i="normal"),r!==t.length-1||!a)if(a){const t=e.find(t=>t.token===n);i===t.className?(s+="</class>",s+='<class="normal">',i="normal"):(0!==r&&(s+="</class>"),s+=`<class="${t.className}">`,i=t.className)}else s+=t[r]}return s+="</class>",s}}(20,20,s),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this);const i=this;this.input.on("pointerdown",()=>{i.guide.progressDialogue()})}update(){if(this.isAwaitingRoundTransition)this.guide.isBlockingGameplay||this.scene.start("RoundTransitionScene",{nextLevel:this.level+1});else{if(!this.guide.isBlockingGameplay&&this.timer&&this.timer.isPaused&&this.timer.start(),null!=this.timer&&this.timer.seconds<=0)return this.guide.displayGameOverMessage(),void(this.isAwaitingRoundTransition=!0);this.isLevelComplete()?this.scene.start("RoundTransitionScene",{nextLevel:this.level+1}):this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this))}}onTileSelect(t,e){if(!t.queue.isActionRunning()&&!t.guide.isBlockingGameplay&&t.tileGrid.canSelect(e)){if(e.isActivated)return t.selectedTiles=[],void e.deactivate();if(0===t.selectedTiles.length)return t.selectedTiles.push(e),void e.activate();if(1===t.selectedTiles.length){const s=t.selectedTiles[0],i=Math.abs(s.tileGridX-e.tileGridX),r=Math.abs(s.tileGridY-e.tileGridY);if(1===i&&0===r||0===i&&1===r){t.selectedTiles.push(e);let s=t.selectedTiles[0],i=t.selectedTiles[1];t.tileGrid.swapTiles(t,s,i),t.queue.push(()=>(t.tileGrid.hasMatches(s.tileGridX,s.tileGridY)||t.tileGrid.hasMatches(i.tileGridX,i.tileGridY)||t.tileGrid.swapTiles(t,s,i),Promise.resolve())),t.selectedTiles.forEach(t=>{t.deactivate()}),t.selectedTiles=[],t.comboCount=0}}}}onTileMatch(t,e){t.comboCount++,t.totalMatches++,t.score+=e.length*t.comboCount,t.scoreDisplay.updateScore(t.score),t.guide.displayTileMatchMessage(t,{comboCount:t.comboCount,totalMatches:t.totalMatches}),t.comboCount>1?t.scoreDisplay.updateCombo(`${t.comboCount}x multiplier!`):t.scoreDisplay.updateCombo("")}isLevelComplete(){return 0===this.level&&this.score>=100||1===this.level&&this.score>=200||2===this.level&&this.score>=300||3===this.level&&this.score>=300}getTimerSeconds(t){switch(t){case 1:return 120;case 2:return 30;case 3:return 120;default:return 0}}getTileGenerationBehavior(t){switch(t){case 3:return Xt;default:return Dt}}},Ut=class extends Phaser.Scene{constructor(){super("RoundTransitionScene"),this.nextLevel=0}init(t){this.nextLevel=t.nextLevel}create(){const t=this;this.add.text(50,50,`Round ${t.nextLevel}`),this.time.addEvent({delay:1e3,callback:function(){t.scene.start("RoundScene",{level:t.nextLevel})},callbackScope:this})}},Vt=class extends Phaser.Scene{constructor(){super("GameOverScene"),this.finalScore=0}init(t){this.finalScore=t.score}create(){const t=this;this.add.text(50,50,"Game Over!"),this.add.text(50,100,`Final Score: ${this.finalScore}`);const e=this.add.text(50,150,"Return to Main Menu");e.setInteractive(),e.on("pointerdown",()=>{t.scene.start("TitleScene")})}};const Jt={type:Phaser.AUTO,width:800,height:800,scene:[i,qt,Ut,Vt]};new Phaser.Game(Jt)}]);
//# sourceMappingURL=bundle.js.map