!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,n,r){if(0!==e.width&&0!==e.height){var a=e.frame,o=a.width,h=a.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,a.glTexture,o,h,e.x,e.y,o/e.style.resolution,h/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,h,l(e._tintTL,n.alpha*e._alphaTL),l(e._tintTR,n.alpha*e._alphaTR),l(e._tintBL,n.alpha*e._alphaBL),l(e._tintBR,n.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,n,r)}}},function(t,e){t.exports=function(t,e,i,s,n){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,s,n)}},function(t,e,i){var s;!function(){function n(t,e,i){return t.call.apply(t.bind,arguments)}function r(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function a(t,e,i){return(a=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:r).apply(null,arguments)}var o=Date.now||function(){return+new Date};function h(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var l=!!window.FontFace;function d(t,e,i,s){if(e=t.c.createElement(e),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return s&&e.appendChild(t.c.createTextNode(s)),e}function u(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function c(t){t.parentNode&&t.parentNode.removeChild(t)}function g(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var r=!1,a=0;a<s.length;a+=1)if(e[n]===s[a]){r=!0;break}r||s.push(e[n])}for(e=[],n=0;n<s.length;n+=1){for(r=!1,a=0;a<i.length;a+=1)if(s[n]===i[a]){r=!0;break}r||e.push(s[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function p(t,e){for(var i=t.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==e)return!0;return!1}function f(t,e,i){function s(){o&&n&&r&&(o(a),o=null)}e=d(t,"link",{rel:"stylesheet",href:e,media:"all"});var n=!1,r=!0,a=null,o=i||null;l?(e.onload=function(){n=!0,s()},e.onerror=function(){n=!0,a=Error("Stylesheet failed to load"),s()}):setTimeout((function(){n=!0,s()}),0),u(t,"head",e)}function y(t,e,i,s){var n=t.c.getElementsByTagName("head")[0];if(n){var r=d(t,"script",{src:e}),a=!1;return r.onload=r.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,i&&i(null),r.onload=r.onreadystatechange=null,"HEAD"==r.parentNode.tagName&&n.removeChild(r))},n.appendChild(r),setTimeout((function(){a||(a=!0,i&&i(Error("Script load timeout")))}),s||5e3),r}return null}function v(){this.a=0,this.c=null}function m(t){return t.a++,function(){t.a--,x(t)}}function w(t,e){t.c=e,x(t)}function x(t){0==t.a&&t.c&&(t.c(),t.c=null)}function T(t){this.a=t||"-"}function S(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function b(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function k(t){return t.a+t.f}function P(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function M(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function O(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new T("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function _(t){if(t.g){var e=p(t.f,t.a.c("wf","active")),i=[],s=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),g(t.f,i,s)}C(t,"inactive")}function C(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,k(i)):t.h[e]())}function G(){this.c={}}function A(t,e){this.c=t,this.f=e,this.a=d(this.c,"span",{"aria-hidden":"true"},this.f)}function L(t){u(t.c,"body",t.a)}function E(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(t.c)+";font-style:"+P(t)+";font-weight:"+t.f+"00;"}function I(t,e,i,s,n,r){this.g=t,this.j=e,this.a=s,this.c=i,this.f=n||3e3,this.h=r||void 0}function W(t,e,i,s,n,r,a){this.v=t,this.B=e,this.c=i,this.a=s,this.s=a||"BESbswy",this.f={},this.w=n||3e3,this.u=r||null,this.m=this.j=this.h=this.g=null,this.g=new A(this.c,this.s),this.h=new A(this.c,this.s),this.j=new A(this.c,this.s),this.m=new A(this.c,this.s),t=E(t=new S(this.a.c+",serif",k(this.a))),this.g.a.style.cssText=t,t=E(t=new S(this.a.c+",sans-serif",k(this.a))),this.h.a.style.cssText=t,t=E(t=new S("serif",k(this.a))),this.j.a.style.cssText=t,t=E(t=new S("sans-serif",k(this.a))),this.m.a.style.cssText=t,L(this.g),L(this.h),L(this.j),L(this.m)}T.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},I.prototype.start=function(){var t=this.c.o.document,e=this,i=o(),s=new Promise((function(s,n){!function r(){o()-i>=e.f?n():t.fonts.load(function(t){return P(t)+" "+t.f+"00 300px "+b(t.c)}(e.a),e.h).then((function(t){1<=t.length?s():setTimeout(r,25)}),(function(){n()}))}()})),n=null,r=new Promise((function(t,i){n=setTimeout(i,e.f)}));Promise.race([r,s]).then((function(){n&&(clearTimeout(n),n=null),e.g(e.a)}),(function(){e.j(e.a)}))};var F={D:"serif",C:"sans-serif"},R=null;function z(){if(null===R){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);R=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return R}function B(t,e,i){for(var s in F)if(F.hasOwnProperty(s)&&e===t.f[F[s]]&&i===t.f[F[s]])return!0;return!1}function j(t){var e,i=t.g.a.offsetWidth,s=t.h.a.offsetWidth;(e=i===t.f.serif&&s===t.f["sans-serif"])||(e=z()&&B(t,i,s)),e?o()-t.A>=t.w?z()&&B(t,i,s)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?N(t,t.v):N(t,t.B):function(t){setTimeout(a((function(){j(this)}),t),50)}(t):N(t,t.v)}function N(t,e){setTimeout(a((function(){c(this.g.a),c(this.h.a),c(this.j.a),c(this.m.a),e(this.a)}),t),0)}function Y(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}W.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),j(this)};var D=null;function H(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&g(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),C(t,"active")):_(t.a))}function X(t){this.j=t,this.a=new G,this.h=0,this.f=this.g=!0}function q(t,e,i,s,n){var r=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=n||null,o=s||{};if(0===i.length&&r)_(e.a);else{e.f+=i.length,r&&(e.j=r);var h,l=[];for(h=0;h<i.length;h++){var d=i[h],u=o[d.c],c=e.a,p=d;if(c.g&&g(c.f,[c.a.c("wf",p.c,k(p).toString(),"loading")]),C(c,"fontloading",p),c=null,null===D)if(window.FontFace){p=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);D=p?42<parseInt(p[1],10):!f}else D=!1;c=D?new I(a(e.g,e),a(e.h,e),e.c,d,e.s,u):new W(a(e.g,e),a(e.h,e),e.c,d,e.s,t,u),l.push(c)}for(h=0;h<l.length;h++)l[h].start()}}),0)}function U(t,e){this.c=t,this.a=e}function K(t,e){this.c=t,this.a=e}function V(t,e){this.c=t||J,this.a=[],this.f=[],this.g=e||""}Y.prototype.g=function(t){var e=this.a;e.g&&g(e.f,[e.a.c("wf",t.c,k(t).toString(),"active")],[e.a.c("wf",t.c,k(t).toString(),"loading"),e.a.c("wf",t.c,k(t).toString(),"inactive")]),C(e,"fontactive",t),this.m=!0,H(this)},Y.prototype.h=function(t){var e=this.a;if(e.g){var i=p(e.f,e.a.c("wf",t.c,k(t).toString(),"active")),s=[],n=[e.a.c("wf",t.c,k(t).toString(),"loading")];i||s.push(e.a.c("wf",t.c,k(t).toString(),"inactive")),g(e.f,s,n)}C(e,"fontinactive",t),H(this)},X.prototype.load=function(t){this.c=new h(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var s=[],n=i.timeout;!function(t){t.g&&g(t.f,[t.a.c("wf","loading")]),C(t,"loading")}(e);s=function(t,e,i){var s,n=[];for(s in e)if(e.hasOwnProperty(s)){var r=t.c[s];r&&n.push(r(e[s],i))}return n}(t.a,i,t.c);var r=new Y(t.c,e,n);for(t.h=s.length,e=0,i=s.length;e<i;e++)s[e].load((function(e,i,s){q(t,r,e,i,s)}))}(this,new O(this.c,t),t)},U.prototype.load=function(t){var e=this,i=e.a.projectId,s=e.a.version;if(i){var n=e.c.o;y(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),(function(s){s?t([]):(n["__MonotypeConfiguration__"+i]=function(){return e.a},function e(){if(n["__mti_fntLst"+i]){var s,r=n["__mti_fntLst"+i](),a=[];if(r)for(var o=0;o<r.length;o++){var h=r[o].fontfamily;null!=r[o].fontStyle&&null!=r[o].fontWeight?(s=r[o].fontStyle+r[o].fontWeight,a.push(new S(h,s))):a.push(new S(h))}t(a)}else setTimeout((function(){e()}),50)}())})).id="__MonotypeAPIScript__"+i}else t([])},K.prototype.load=function(t){var e,i,s=this.a.urls||[],n=this.a.families||[],r=this.a.testStrings||{},a=new v;for(e=0,i=s.length;e<i;e++)f(this.c,s[e],m(a));var o=[];for(e=0,i=n.length;e<i;e++)if((s=n[e].split(":"))[1])for(var h=s[1].split(","),l=0;l<h.length;l+=1)o.push(new S(s[0],h[l]));else o.push(new S(s[0]));w(a,(function(){t(o,r)}))};var J="https://fonts.googleapis.com/css";function $(t){this.f=t,this.a=[],this.c={}}var Q={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},tt={i:"i",italic:"i",n:"n",normal:"n"},et=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function it(t,e){this.c=t,this.a=e}var st={Arimo:!0,Cousine:!0,Tinos:!0};function nt(t,e){this.c=t,this.a=e}function rt(t,e){this.c=t,this.f=e,this.a=[]}it.prototype.load=function(t){var e=new v,i=this.c,s=new V(this.a.api,this.a.text),n=this.a.families;!function(t,e){for(var i=e.length,s=0;s<i;s++){var n=e[s].split(":");3==n.length&&t.f.push(n.pop());var r="";2==n.length&&""!=n[1]&&(r=":"),t.a.push(n.join(r))}}(s,n);var r=new $(n);!function(t){for(var e=t.f.length,i=0;i<e;i++){var s=t.f[i].split(":"),n=s[0].replace(/\+/g," "),r=["n4"];if(2<=s.length){var a;if(a=[],o=s[1])for(var o,h=(o=o.split(",")).length,l=0;l<h;l++){var d;if((d=o[l]).match(/^[\w-]+$/))if(null==(c=et.exec(d.toLowerCase())))d="";else{if(d=null==(d=c[2])||""==d?"n":tt[d],null==(c=c[1])||""==c)c="4";else var u=Z[c],c=u||(isNaN(c)?"4":c.substr(0,1));d=[d,c].join("")}else d="";d&&a.push(d)}0<a.length&&(r=a),3==s.length&&(a=[],0<(s=(s=s[2])?s.split(","):a).length&&(s=Q[s[0]])&&(t.c[n]=s))}for(t.c[n]||(s=Q[n])&&(t.c[n]=s),s=0;s<r.length;s+=1)t.a.push(new S(n,r[s]))}}(r),f(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],s=0;s<e;s++)i.push(t.a[s].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(s),m(e)),w(e,(function(){t(r.a,r.c,st)}))},nt.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?y(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],n=0;n<e.length;n+=2)for(var r=e[n],a=e[n+1],o=0;o<a.length;o++)s.push(new S(r,a[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(s)}}),2e3):t([])},rt.prototype.load=function(t){var e=this.f.id,i=this.c.o,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,r=i.fonts.length;n<r;++n){var a=i.fonts[n];s.a.push(new S(a.name,M("font-weight:"+a.weight+";font-style:"+a.style)))}t(s.a)},y(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var at=new X(window);at.a.c.custom=function(t,e){return new K(e,t)},at.a.c.fontdeck=function(t,e){return new rt(e,t)},at.a.c.monotype=function(t,e){return new U(e,t)},at.a.c.typekit=function(t,e){return new nt(e,t)},at.a.c.google=function(t,e){return new it(e,t)};var ot={load:a(at.load,at)};void 0===(s=function(){return ot}.call(e,i,e,t))||(t.exports=s)}()},function(t,e,i){"use strict";i.r(e);var s=class extends Phaser.Scene{constructor(){super("TitleScene")}preload(){this.load.image("background","assets/background.png"),this.load.image("title","assets/title.png"),this.load.image("start","assets/start.png"),this.load.image("start-active","assets/start_active.png"),this.load.image("tile_01","assets/tile_01.png"),this.load.image("tile_02","assets/tile_02.png"),this.load.image("tile_03","assets/tile_03.png"),this.load.image("tile_04","assets/tile_04.png")}create(){const t=this;this.add.image(400,400,"background");const e=this.add.graphics({fillStyle:{color:16777215}});e.setAlpha(0);const i=new Phaser.Geom.Rectangle(0,0,800,700);e.fillRectShape(i);const s=[];s.push({imageKey:"tile_01",xChange:"+=180",yChange:"+=180",angle:15,scale:.8}),s.push({imageKey:"tile_02",xChange:"+=200",yChange:"-=180",angle:15,scale:1}),s.push({imageKey:"tile_03",xChange:"-=180",yChange:"+=180",angle:-15,scale:.9}),s.push({imageKey:"tile_04",xChange:"-=200",yChange:"-=180",angle:-5,scale:.8}),s.push({imageKey:"tile_01",xChange:"+=0",yChange:"-=180",angle:-15,scale:.7}),s.push({imageKey:"tile_02",xChange:"+=0",yChange:"+=180",angle:-15,scale:1}),s.push({imageKey:"tile_03",xChange:"+=290",yChange:"+=30",angle:15,scale:.8}),s.push({imageKey:"tile_01",xChange:"-=290",yChange:"+=40",angle:-15,scale:.9}),s.forEach(e=>{e.tile=t.add.image(400,230,e.imageKey),e.tile.setAlpha(0),e.tile.setScale(.5,.5)});const n=this.add.image(400,230,"title");n.setAlpha(0),n.setScale(2,2);const r=this.add.image(400,550,"start");r.setInteractive({cursor:"pointer"}),r.setAlpha(0);const a=this.add.image(400,550,"start");a.setAlpha(0),a.setTintFill(16777215);const o=this.add.image(400,550,"start-active");o.setAlpha(0),r.on("pointerover",()=>{t.tweens.add({targets:o,alpha:1,duration:100,ease:"Sine.easeInOut"})}),r.on("pointerout",()=>{t.tweens.add({targets:o,alpha:0,duration:100,ease:"Sine.easeInOut"})}),r.on("pointerdown",()=>{t.scene.transition({target:"RoundScene",data:{level:0},remove:!0})});const h=this.tweens.createTimeline();h.add({delay:400,targets:n,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Quad.easeIn"}),s.forEach((t,e)=>{h.add({targets:t.tile,x:t.xChange,y:t.yChange,scaleX:1,scaleY:1,alpha:1,scaleX:t.scale,scaleY:t.scale,angle:t.angle,duration:300,ease:"Quad.easeOut",offset:0===e?"-=0":"-=300"})}),h.add({targets:e,alpha:1,duration:30,offset:"-=300"}),h.add({targets:e,alpha:0,duration:700,offset:1500,ease:"Quad.easeIn"}),h.add({targets:[r,a],alpha:1,offset:2200,duration:100}),h.add({targets:a,alpha:0,duration:300,offset:2300,ease:"Quad.easeOut"}),h.play()}},n={color:"#000",fontFamily:'"Baloo Thambi 2"',googleFontName:"Baloo Thambi 2:500;700",fontSize:"30px"},r=i(0),a=i.n(r),o=i(1),h=i.n(o),l={renderWebGL:a.a,renderCanvas:h.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const d=Phaser.Display.Canvas.CanvasPool;var u=function(t){var e=d.create(this),i=e.getContext("2d");t.syncFont(e,i);var s=Math.ceil(i.measureText(t.testString).width*t.baselineX),n=s,r=2*n;n=n*t.baselineY|0,e.width=s,e.height=r,i.fillStyle="#f00",i.fillRect(0,0,s,r),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,n);var a={ascent:0,descent:0,fontSize:0};if(!i.getImageData(0,0,s,r))return a.ascent=n,a.descent=n+6,a.fontSize=a.ascent+a.descent,d.remove(e),a;var o,h,l=i.getImageData(0,0,s,r).data,u=l.length,c=4*s,g=0,p=!1;for(o=0;o<n;o++){for(h=0;h<c;h+=4)if(255!==l[g+h]){p=!0;break}if(p)break;g+=c}for(a.ascent=n-o,g=u-c,p=!1,o=r;o>n;o--){for(h=0;h<c;h+=4)if(255!==l[g+h]){p=!0;break}if(p)break;g-=c}return a.descent=o-n,a.fontSize=a.ascent+a.descent,d.remove(e),a},c={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const g=Phaser.Utils.Objects.GetAdvancedValue,p=Phaser.Utils.Objects.GetValue;var f={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const y={none:c.NO_WRAP,word:c.WORD_WRAP,char:c.CHAR_WRAP,character:c.CHAR_WRAP};var v=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=p(e,"metrics",!1);this.metrics=i?{ascent:p(i,"ascent",0),descent:p(i,"descent",0),fontSize:p(i,"fontSize",0)}:u(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=y[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var n in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),f)this[n]="wrapCallback"===n||"wrapCallbackScope"===n?p(t,f[n][0],f[n][1]):g(t,f[n][0],f[n][1]);var r=p(t,"font",null);this._font=null===r?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:r;var a=p(t,"fill",null);return null!==a&&(this.color=a),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=u(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=p(t,"fontFamily","Courier"),this.fontSize=p(t,"fontSize","16px"),this.fontStyle=p(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,s,n,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===n&&(n=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=n,this.shadowFill=r,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=y[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in f)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}},m={draw(t,e,i,s){var n=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save(),this.drawBackground(this.defatultStyle.backgroundColor);var a=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var o,h,l,d,u,c,g=a.halign,p=a.valign,f=a.lineHeight,y=n.lines,v=y.length,m=a.maxLines;m>0&&v>m?(h=m,l="center"===p?Math.floor((v-h)/2):"bottom"===p?v-h:0):(h=v,l=0),d=l+h,c="center"===p?Math.max((s-h*f)/2,0):"bottom"===p?Math.max(s-h*f-2,0):0,c+=e;for(var w=l;w<d;w++)if(0!==(o=n.getLineWidth(w))){u="center"===g?(i-o)/2:"right"===g?i-o:0,u+=t;for(var x=y[w],T=0,S=x.length;T<S;T++)this.drawPen(x[T],u,c)}r.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var s=this.canvas,n=this.context;n.save();var r=this.parser.propToContextStyle(this.defatultStyle,t.prop);r.buildFont(),r.syncFont(s,n),r.syncStyle(s,n),r.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,r),t.isTextPen&&this.drawText(e,i,t.text,r),t.isImagePen&&this.drawImage(e,i,t.prop.img,r),n.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,s){e+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context,r=n.lineCap;n.lineCap="butt",n.beginPath(),n.strokeStyle=s.underlineColor,n.lineWidth=s.underlineThickness,n.moveTo(t,e),n.lineTo(t+i,e),n.stroke(),n.lineCap=r},drawText(t,e,i,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context;s.strokeThickness&&(s.syncShadow(n,s.shadowStroke),n.strokeText(i,t,e)),s.color&&"none"!==s.color&&(s.syncShadow(n,s.shadowFill),n.fillText(i,t,e))},drawImage(t,e,i,s){var n=this.parent.imageManager,r=n.get(i),a=n.getFrame(i);t+=r.left,e+=-this.startYOffset+r.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,t,e,r.width,r.height)}};var w=class{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}};const x=Phaser.Utils.Objects.GetValue,T=c.NO_NEWLINE,S=c.RAW_NEWLINE;var b=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=x(t,"text",""),this.x=x(t,"x",0),this.y=x(t,"y",0),this.width=x(t,"width",0);var e=x(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=x(t,"newLineMode",0),this.startIndex=x(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===S&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==T&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===S&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},k=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]},P=function(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:k(e),i){e.length=t.length;for(var s=0,n=t.length;s<n;s++)e[s]=t[s]}else for(var r in t)e[r]=t[r];return e},M=function(){};const O=Phaser.Utils.Objects.GetFastValue,_=c.NO_NEWLINE,C=c.WRAPPED_NEWLINE;var G=new w,A=new w;class L{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=O(t,"pensPool",G),this.LinesPool=O(t,"linesPool",A),this.tagToText=O(t,"tagToText",M),this.tagToTextScope=O(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,s,n,r){var a=this.PensPool.pop();return null==a&&(a=new b),E.text=t,E.x=e,E.y=i,E.width=s,E.prop=n,E.newLineMode=r,a.resetFromJSON(E),this.addPen(a),this}addImagePen(t,e,i,s){return this.addTextPen("",t,e,i,s,_),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,s=t?P(t.prop):null;return this.addTextPen("",e,i,0,s,C),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==_&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new L),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var s=this.lines[e],n=0,r=s.length;n<r;n++){var a=s[n];t.addPen(a.text,a.x,a.y,a.width,P(a.prop),a.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,s=!1;for(e=t;e>=0&&!(s=null!=(i=this.lines[e])&&i.length>0);e--);return s?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,s=this.lines.length;i<s;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,s=e.length;i<s;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,s=this.pens.length;i<s;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var s=this.lastPen;if(null==s)return"";e=s.endIndex}void 0===i&&(i=!1);for(var n,r,a,o,h,l,d="",u=0,c=this.pens.length;u<c&&((o=(n=this.pens[u]).endIndex)<=t||(n=this.pens[u],r=i?n.wrapText:n.plainText,h=n.prop,(a=n.startIndex)>=t&&o<=e||(r=r.substring(t-a,e-a)),this.tagToTextScope?d+=this.tagToText.call(this.tagToTextScope,r,h,l):d+=this.tagToText(r,h,l),l=h,!(o>=e)));u++);return d}}var E={},I=L;const W=Phaser.Geom.Rectangle;var F=new w;var R=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return F.pushMultiple(this.hitAreas),this}add(t,e,i,s,n){var r=F.pop();return null===r?r=new W(e,i,s,n):r.setTo(e,i,s,n),r.key=t,this.hitAreas.push(r),this}getFirstHitArea(t,e){for(var i,s=this.hitAreas,n=0,r=s.length;n<r;n++)if((i=s[n]).contains(t,e))return i;return null}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,n=this.hitAreas,r=0,a=n.length;r<a;r++)s=n[r],t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height);return i&&t.restore(),this}},z=function(t,e,i,s){var n=this.hitAreaManager.getFirstHitArea(i,s);if(null!==n){var r=n.key;this.parent.emit(`${t}-${r}`,e,i,s),this.parent.emit(t,r,e,i,s)}},B=function(){this.parent.on("pointerdown",(function(t,e,i,s){z.call(this,"areadown",t,e,i)}),this).on("pointerup",(function(t,e,i,s){z.call(this,"areaup",t,e,i)}),this)};const j=c.NO_NEWLINE,N=c.RAW_NEWLINE,Y=c.WRAPPED_NEWLINE,D=c.NO_WRAP,H=c.WORD_WRAP,X=c.SPLITREGEXP;var q=[],U=new w;U.newline=function(t,e,i){var s=this.pop();return null===s&&(s={}),s.text=t,s.width=e,s.newLineMode=i,s};var K=function(t,e,i,s,n){s<=0&&(i=D);var r=q;if(U.pushMultiple(r),!t||!t.length)return r;for(var a,o,h,l=t.split(X),d=0,u=l.length;d<u;d++)if(a=l[d],h=d===u-1?j:N,i!==D){var c,g;if(o=0===d?s-n:s,a.length<=100)if((x=e(a))<=o){r.push(U.newline(a,x,h));continue}for(var p,f="",y="",v=0,m=0,w=(c=i===H?a.split(" "):a).length;m<w;m++)g=c[m],i===H?(f+=g,m<w-1&&(f+=" ")):f+=g,(p=e(f))>o&&(0===m?r.push(U.newline("",0,Y)):(r.push(U.newline(y,v,Y)),f=g,i===H&&m<w-1&&(f+=" "),p=e(f)),o=s),y=f,v=p;r.push(U.newline(y,v,h))}else{var x=e(a);r.push(U.newline(a,x,h))}return r};const V=Phaser.Utils.Objects.GetValue,J=c.NO_WRAP,$=c.NO_NEWLINE;class Q{constructor(t){this.parent=t.parent,this.context=V(t,"context",null),this.canvas=this.context.canvas,this.parser=V(t,"parser",null),this.defatultStyle=V(t,"style",null),this.autoRound=!0,this.pensPool=V(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new R;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,s,n){if(void 0===n&&(n=this.penManager),n.freePens(),""===t)return n;for(var r,a,o,h,l,d=this.canvas,u=this.context,c=0,g=0,p=this.parser.splitText(t),f=0,y=p.length;f<y;f++)if(r=(h=this.parser.tagTextToProp(p[f],a)).plainText,(a=h.prop).img){var v=this.imageManager.getOuterWidth(a.img);i>0&&e!==J&&i<c+v&&(n.addNewLinePen(),g+=s,c=0),n.addImagePen(c,g,v,P(a)),c+=v}else if(""!==r){var m;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,a)).buildFont(),o.syncFont(d,u),o.syncStyle(d,u);for(var w=0,x=(l=K(r,this.getTextWidth,e,i,c)).length;w<x;w++)m=l[w],n.addTextPen(m.text,c,g,m.width,P(a),m.newLineMode),m.newLineMode!==$?(c=0,g+=s):c+=m.width;this.context.restore()}return n}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new I({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var s;if(null==t)s=this.penManager.plainText;else{var n=this.parser.splitText(t,1);s="";for(var r=0,a=n.length;r<a;r++)s+=n[r]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=s.length),s=s.substring(e,i)),s}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,s){if(null==t)return this.penManager.getSliceTagText(e,i,s);var n=this.tmpPenManager,r=this.defatultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,n),n.getSliceTagText(e,i,s)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var Z={setInteractive:B};Object.assign(Q.prototype,m,Z);var tt=Q;const et=Phaser.Utils.Objects.GetValue;var it,st=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,s=(n=t).length;i<s;i++)this._add(n[i]);else{var n=t;for(var t in n)this._add(t,n[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,s=e.frame,n=e.width,r=e.height;if(void 0===n||void 0===r){var a=this.textureManager.getFrame(i,s),o=a?a.cutWidth:0,h=a?a.cutHeight:0;void 0===n&&void 0===r?(n=o,r=h):void 0===n?n=o*(r/h):void 0===r&&(r=h*(n/o))}this.images[t]={key:i,frame:s,width:n,height:r,y:et(e,"y",0),left:et(e,"left",0),right:et(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}};const nt=Phaser.DOM.AddToDOM,rt=Phaser.Display.Canvas.CanvasPool,at=Phaser.GameObjects.GameObject,ot=Phaser.Utils.Objects.GetValue,ht=Phaser.DOM.RemoveFromDOM,lt=c.SPLITREGEXP;var dt={};class ut extends at{constructor(t,e,i,s,n,r,a){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,r),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=rt.create(this),this.context=this.canvas.getContext("2d"),n){if(n.hasOwnProperty("align")){var o=n.align;delete n.align,n.halign=o}n.hasOwnProperty("stroke")&&!n.hasOwnProperty("strokeThickness")&&(n.strokeThickness=1)}this.style=new v(this,n),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),dt.hasOwnProperty(r)||(dt[r]=new w),this.canvasText=new tt({parent:this,context:this.context,parser:a,style:this.style,pensPool:dt[r]}),n&&n.padding&&this.setPadding(n.padding),this.setText(s),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",nt(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,s,n,r){return this.style.setShadow(t,e,i,s,n,r)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,s){if("object"==typeof t){var n=t,r=ot(n,"x",null);null!==r?(t=r,i=r):(t=ot(n,"left",0),i=ot(n,"right",t));var a=ot(n,"y",null);null!==a?(e=a,s=a):(e=ot(n,"top",0),s=ot(n,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===s&&(s=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,n,r=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+r.left+r.right,s=e.linesWidth):(this.width=i.fixedWidth,(s=this.width-r.left-r.right)<e.linesWidth&&(s=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,n=e.linesHeight):(this.height=i.fixedHeight,(n=this.height-r.top-r.bottom)<e.linesHeight&&(n=e.linesHeight));var a=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;a*=h,o*=h,a=Math.max(Math.ceil(a),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,d=this.context;l.width!==a||l.height!==o?(l.width=a,l.height=o,this.frame.setSize(a,o)):d.clearRect(0,0,a,o),d.save(),d.scale(h,h),e.draw(r.left,r.top,s,n),d.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=ct.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&ht(this.canvas),rt.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return at.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(lt)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return t=this.scene.textures,void 0===it&&(it=new st(t)),it;var t}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const ct=Phaser.GameObjects.Components;Phaser.Class.mixin(ut,[ct.Alpha,ct.BlendMode,ct.ComputedSize,ct.Crop,ct.Depth,ct.Flip,ct.GetBounds,ct.Mask,ct.Origin,ct.Pipeline,ct.ScrollFactor,ct.Tint,ct.Transform,ct.Visible,l]);var gt=ut,pt={plainText:null,prevProp:null},ft=new v;var yt=function(t){for(var e,i,s,n={},r=0,a=(t=t.split(";")).length;r<a;r++)if(i=(e=t[r].split(":"))[0],s=e[1],!vt(i)&&!vt(s)){switch(i){case"stroke":var o=s.split(" ");s={},(l=o.length)>=1&&(s.color=o[0]),l>=2&&(s.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var h=s.split(" ");s={},(l=h.length)>=1&&(s.color=h[0]),l>=2&&(s.offsetX=parseInt(h[1].replace("px",""))),l>=3&&(s.offsetY=parseInt(h[2].replace("px",""))),l>=4&&(s.blur=parseInt(h[3].replace("px","")));break;case"u":case"underline":var l,d=s.split(" ");s={},(l=d.length)>=1&&(s.color=d[0]),l>=2&&(s.thinkness=parseInt(d[1].replace("px",""))),l>=3&&(s.offset=parseInt(d[2].replace("px","")))}n[i]=s}return n},vt=function(t){return 0===(t=t.replace(bt,"")).length},mt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,wt=/<\s*class=/i,xt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Tt=/<\s*style=/i,St=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,bt=/^\s+|\s+$/,kt=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,s,n,r=[],a=0,o=t.length,h=o;i=mt.exec(t);)s=i[0],a<(h=mt.lastIndex-s.length)&&r.push(t.substring(a,h)),void 0===e?r.push(s):1===e&&(wt.test(s)?(n=s.match(xt),r.push(n[2])):Tt.test(s)&&(n=s.match(St),r.push(n[2]))),a=mt.lastIndex;return a<o&&r.push(t.substring(a,o)),r}tagTextToProp(t,e){var i,s;if(wt.test(t)){if(null!=(a=t.match(xt))){var n=a[1],r=this.tags;(s=r.hasOwnProperty(n)?r[n]:{})._class=n,i=a[2]}}else if(Tt.test(t)){var a;if(null!=(a=t.match(St))){var o=a[1];(s=yt(o))._style=o,i=a[2]}}null==i&&(i=t),null==s&&(s={});var h=pt;return h.plainText=i,h.prop=s,h}propToContextStyle(t,e){var i=ft;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var s=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=s}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var n=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof n&&(n=n.toString()+"px"),i.fontSize=n}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var r=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=r}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){var a=e.hasOwnProperty("color")?e.color:e["font-color"];i.color=a}else i.color=t.color;if(e.hasOwnProperty("stroke")){var o=e.stroke;i.stroke=o.hasOwnProperty("color")?o.color:t.stroke,i.strokeThickness=o.hasOwnProperty("thinkness")?o.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var h=e.shadow;i.shadowColor=h.hasOwnProperty("color")?h.color:t.shadowColor,i.shadowOffsetX=h.hasOwnProperty("offsetX")?h.offsetX:t.shadowOffsetX,i.shadowOffsetY=h.hasOwnProperty("offsetY")?h.offsetY:t.shadowOffsetY,i.shadowBlur=h.hasOwnProperty("blur")?h.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var l=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=l.hasOwnProperty("color")?l.color:t.underlineColor,i.underlineThickness=l.hasOwnProperty("thinkness")?l.thinkness:t.underlineThickness,i.underlineOffset=l.hasOwnProperty("offset")?l.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const Pt=Phaser.Utils.Objects.GetValue;var Mt=class extends gt{constructor(t,e,i,s,n){var r=Pt(n,"tags",void 0),a=new kt(r);super(t,e,i,s,n,"rexTagText",a),this.parser=a}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};const Ot=Phaser.Utils.Objects.GetAdvancedValue,_t=Phaser.GameObjects.BuildGameObject;Phaser.GameObjects.GameObjectFactory.register("rexTagText",(function(t,e,i,s){var n=new Mt(this.scene,t,e,i,s);return this.scene.add.existing(n),n})),Phaser.GameObjects.GameObjectCreator.register("rexTagText",(function(t,e){var i=Ot(t,"text",""),s=Ot(t,"style",null),n=Ot(t,"padding",null);null!==n&&(s.padding=n),void 0!==e&&(t.add=e);var r=new Mt(this.scene,0,0,i,s);return _t(this.scene,r,t),r.autoRound=Ot(t,"autoRound",!0),r.resolution=Ot(t,"resolution",1),r}));var Ct=Mt,Gt={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}};const At=Phaser.Scene;var Lt=function(t){return t instanceof At},Et=function(t){return Lt(t)?t:t.scene&&Lt(t.scene)?t.scene:t.parent&&t.parent.scene&&Lt(t.parent.scene)?t.parent.scene:void 0};const It=Phaser.Utils.Objects.GetFastValue,Wt=Phaser.Utils.Objects.GetValue;class Ft{constructor(t,e){this.gameObject=t,this.scene=Et(t),this.setEventEmitter(Wt(e,"eventEmitter",void 0)),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(Wt(t,"typeMode",0)),this.setTypeSpeed(Wt(t,"speed",333)),this.setTextCallback=It(t,"setTextCallback",null),this.setTextCallbackScope=It(t,"setTextCallbackScope",null),this.typingIdx=It(t,"typingIdx",0),this.text=Rt(It(t,"text","")),this.textLen=It(t,"textLen",0),this.insertIdx=It(t,"insertIdx",null);var e=It(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.on("destroy",this.destroy,this),this}shutdown(){return this.destroyEventEmitter(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=zt[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,i,s){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(s),this}appendText(t){var e=this.text.concat(Rt(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=Rt(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,i,s){var n;if(0===s){var r=0,a=e;this.insertIdx=a,n=this.getSubString(t,r,a)}else if(1===s){r=(a=i)-e;this.insertIdx=0,n=this.getSubString(t,r,a)}else if(2===s){var o=i/2;a=(r=Math.floor(o-e/2))+e;this.insertIdx=e%2?e:0,n=this.getSubString(t,r,a)}else if(3===s){var h,l=Math.floor(e/2);if(l>0){r=(a=i)-l;h=this.getSubString(t,r,a)}else h="";var d,u=e-l;if(u>0){a=(r=0)+u;this.insertIdx=a,d=this.getSubString(t,r,a)}else d="",this.insertIdx=0;n=d+h}return n}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?(0,e=0):(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,i){var s=this.gameObject;return s.getSubString?s.getSubString(t,e,i):t.slice(e,i)}}Object.assign(Ft.prototype,Gt);var Rt=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const zt={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var Bt=Ft,jt=0,Nt=1,Yt=2,Dt=0,Ht=1,Xt=[{score:100,timer:300,behavior:jt},{score:200,timer:120,behavior:jt},{score:300,timer:30,behavior:Yt},{score:300,timer:120,behavior:Nt},{score:400,timer:300,behavior:Nt,handler:t=>{t.tileGrid.TileGenerationBehavior!==Yt&&t.score>Xt[t.level]/2&&(t.tileGrid.tileGenerationBehavior=Yt)}},{score:1e3,timer:300,behavior:Yt},{score:1e3,timer:300,behavior:Yt},{score:1e3,timer:300,behavior:Nt},{score:1e3,timer:300,behavior:jt}];const qt=t=>t[Math.floor(Math.random()*t.length)];var Ut=[{name:"Blue",imageKey:"tile_01"},{name:"Green",imageKey:"tile_02"},{name:"Red",imageKey:"tile_03"},{name:"Yellow",imageKey:"tile_04"}],Kt=class{constructor(t,e,i,s,n,r,a,o,h){this.isInitialized=!1,this.isBlocked=!0,this.offsetX=s,this.offsetY=n,this.tileSize=i,this.tileGridHeight=e,this.tileGridWidth=t,this.tileGrid=[],this.tileImageContainer=null,this.playAreaOffset=this.tileGridHeight*this.tileSize,this.onTileSelect=r,this.onTileMatch=a,this.tileGenerationBehavior=o,this.queue=h;for(let i=0;i<2*e;i++){this.tileGrid[i]=[];for(let e=0;e<t;e++)this.tileGrid[i][e]=null}}create(t){this.tileImageContainer=t.add.container();const e=t.make.graphics();e.fillStyle(16777215,1),e.fillRect(this.offsetX-this.tileSize/2,this.offsetY+this.tileGridHeight*this.tileSize-this.tileSize/2,this.tileGridWidth*this.tileSize,this.tileGridHeight*this.tileSize),this.tileImageContainer.mask=new Phaser.Display.Masks.GeometryMask(t,e)}update(t){const e=this;if(!e.isInitialized)return;if(e.queue.length>0)return;const i=e.getMatches();i.length>0&&e.onTileMatch(t,i);let s=[];i.forEach(e=>{s.push(e.destroy(t,this.tileImageContainer))}),s.length>0&&e.queue.push(()=>Promise.all(s)),e.forEachTile((t,i,s)=>{null!==t&&t.state===Ht&&(e.tileGrid[s][i]=null)});let n=[];for(let i=0;i<this.tileGridWidth;i++){let s=2*this.tileGridHeight-1;for(;s>=0;){if(null===e.tileGrid[s][i]){let r=s-1;for(;r>=0;){let a=e.tileGrid[r][i];null!==a&&(e.tileGrid[s][i]=a,e.tileGrid[r][i]=null,n.push(this.getTileDrop(t,a,i,s)),s--),r--}}s--}}e.forEachPlayableTile((i,s,n)=>{if(null===i){const i=n-e.tileGridHeight,r=e.createTile(e.getTileType(s,n,e.tileGenerationBehavior),s,i);e.tileGrid[i][s]=r,r.create(t),e.tileImageContainer.add(r.image)}}),n.length>0&&e.queue.push(()=>Promise.all(n))}swapTiles(t,e,i){let s=this;s.queue.push(()=>{let n=e.x,r=e.y,a=e.tileGridX,o=e.tileGridY,h=i.x,l=i.y,d=i.tileGridX,u=i.tileGridY,c=i.updatePosition(t,n,r,a,o);s.tileGrid[o][a]=i;let g=e.updatePosition(t,h,l,d,u);return s.tileGrid[u][d]=e,Promise.all([c,g])})}hasMatches(t,e){return this.getMatches(t,e).length>0}getMatches(t,e){const i=this,s=[];return i.forEachTile((n,r,a)=>{if(void 0!==t&&r!==t&&void 0!==e&&a!==e)return;if(!this.isPlayable(n))return;const o=n.tileType,h=[],l=[];let d=r+1;for(;d<i.tileGridWidth;){const t=i.tileGrid[a][d];if(null==t||o.name!==t.tileType.name)break;h.push(t),d++}for(d=r-1;d>0;){const t=i.tileGrid[a][d];if(null==t||o.name!==t.tileType.name)break;h.push(t),d--}let u=a+1;for(;u<i.tileGridHeight;){const t=i.tileGrid[u][r];if(null==t||o.name!==t.tileType.name)break;l.push(t),u++}for(u=a-1;u>0;){const t=i.tileGrid[u][r];if(null==t||o!==t.tileType)break;l.push(t),u--}l.length>1&&s.push(...l),h.length>1&&s.push(...h),(l.length>1||h.length>1)&&s.push(n)}),s}forEachTile(t){for(let e=0;e<2*this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++)t(this.tileGrid[e][i],i,e)}forEachPlayableTile(t){for(let e=this.tileGridHeight;e<2*this.tileGridHeight;e++)for(let i=0;i<this.tileGridWidth;i++)t(this.tileGrid[e][i],i,e)}createTile(t,e,i){return new class{constructor(t,e,i,s,n,r){this.tileType=t,this.x=e,this.y=i,this.tileGridX=s,this.tileGridY=n,this.onTileSelect=r,this.image=null,this.state=Dt,this.isActivated=!1,this.isDestroying=!1}create(t){this.image=t.add.image(this.x,this.y,this.tileType.imageKey),this.image.setInteractive(),this.image.on("pointerdown",()=>{this.onTileSelect(t,this)})}activate(){this.isActivated=!0,this.image.setTintFill(16777215)}deactivate(){this.isActivated=!1,this.image.clearTint()}updatePosition(t,e,i,s,n){let r=this;return new Promise((a,o)=>{r.x=e,r.y=i,r.tileGridX=s,r.tileGridY=n,t.tweens.add({targets:r.image,x:e,y:i,ease:"Power1",duration:500,onComplete:()=>{a()}})})}destroy(t,e){let i=this;if(i.isDestroying)return;i.isDestroying=!0;const s=t.add.image(i.x,i.y,i.tileType.imageKey);s.setTintFill(16777215),s.alpha=0;const n=[];for(let e=0;e<4;e++){const e=t.add.graphics({fillStyle:{color:16777215},alpha:0}),i=new Phaser.Geom.Circle(this.x,this.y,Phaser.Math.Between(0,10));e.fillCircleShape(i),n.push(e)}return new Promise((r,a)=>{t.tweens.add({targets:s,alpha:1,duration:200,onComplete:()=>{e.remove(i.image),i.image.destroy(),i.state=Ht,e.remove(s),s.destroy(),n.forEach(t=>{e.remove(t),t.destroy()}),r()}}),n.forEach((e,i)=>{let s="",n="";switch(i){case 1:s="-",n="-";break;case 2:s="+",n="+";break;case 3:s="+",n="-";break;case 4:s="-",n="+"}t.tweens.add({targets:e,x:s+"=35",y:n+"=35",alpha:1,duration:200,ease:"Cubic.easeOut"})})})}block(t){this.isBlocked=!0,t.tweens.add({targets:this.image,alpha:.5,duration:100})}unblock(t){this.isBlocked=!1,t.tweens.add({targets:this.image,alpha:1,duration:100})}}(t,this.getTileX(e),this.getTileY(i),e,i,this.onTileSelect)}getTileDrop(t,e,i,s){return e.updatePosition(t,this.getTileX(i),this.getTileY(s),i,s)}getTileX(t){return this.offsetX+this.tileSize*t}getTileY(t){return this.offsetY+this.tileSize*t}canSelect(t){return this.isPlayable(t)}isPlayable(t){return null!=t&&t.tileGridY>this.tileGridHeight-1}getTileType(t,e,i){const s=e<1?null:this.tileGrid[e-1][t],n=e>self.tileGridHeight-1||!this.tileGrid[e+1]?null:this.tileGrid[e+1][t],r=t<1?null:this.tileGrid[e][t-1],a=t>self.tileGridWidth-1?null:this.tileGrid[e][t+1];return qt(i!==Nt||null==s&&null==n&&null==r&&null==a?i===Yt?Ut.filter(t=>!(null!==n&&t.name===n.tileType.name||null!==a&&t.name===a.tileType.name||null!==r&&t.name===r.tileType.name)):Ut.filter(t=>!(null!==s&&t.name===s.tileType.name||null!==r&&t.name===r.tileType.name)):[s,n,r,a].filter(t=>null!=t).map(t=>t.tileType))}block(t){this.isBlocked=!0,this.forEachTile(e=>e&&e.block(t))}unblock(t){this.isBlocked=!1,this.forEachTile(e=>e&&e.unblock(t))}fill(){for(let t=this.tileGridHeight;t<2*this.tileGridHeight;t++)for(let e=0;e<this.tileGridWidth;e++)this.createTile(this.getTileType(e,t,jt),e,t);this.isInitialized=!0}},Vt=i(2),Jt=i.n(Vt),$t=class extends Phaser.Scene{constructor(){super("RoundScene"),this.isAwaitingRoundTransition=!1,this.isReadyForRoundTransition=!1,this.isTransitioningRounds=!1,this.score=null,this.queue=null,this.selectedTiles=null,this.tileGrid=null,this.scoreDisplay=null,this.timer=null,this.levelClearMessage=null,this.levelClearMessageHighlight=null,this.guide=null,this.level=null,this.totalMatches=null}preload(){Jt.a.load({google:{families:[n.googleFontName]}}),this.load.image("tile_01","assets/tile_01.png"),this.load.image("tile_02","assets/tile_02.png"),this.load.image("tile_03","assets/tile_03.png"),this.load.image("tile_04","assets/tile_04.png"),this.load.image("guide_character","assets/guide.png"),this.load.image("background","assets/background.png"),this.load.image("round_clear","assets/round_clear.png"),this.load.image("icon_tile","assets/icon_tile.png"),this.load.image("icon_timer","assets/icon_timer.png")}init(t){this.level=t.level||0}create(){this.isAwaitingRoundTransition=!1,this.isReadyForRoundTransition=!1,this.isTransitioningRounds=!1,this.score=0,this.totalMatches=0,this.queue=new class{constructor(){this.queuedActions=[],this.currentAction=null}isActionRunning(){return null!=this.currentAction}hasActions(){return this.queuedActions.length>0}next(){this.currentAction=this.queuedActions.shift(),this.currentAction()}push(t){var e=this;e.queuedActions.push(()=>{t().then(()=>{e.currentAction=null})})}},this.add.image(400,400,"background");const t=Xt[this.level].behavior;this.selectedTiles=[],this.tileGrid=new Kt(6,6,80,325,-265,this.onTileSelect,this.onTileMatch,t,this.queue),this.scoreDisplay=new class{constructor(t,e){this.x=t,this.y=e,this.scoreText=null,this.score=0}create(t){t.add.graphics({fillStyle:{color:14414079}}).setAlpha(.5).fillRoundedRect(this.x-150,this.y-10,300,90,10),t.add.image(this.x+15,this.y+15,"icon_tile").setAlpha(.7),this.scoreText=t.add.text(this.x+40,this.y,this.score,n),this.updateScore(this.score)}updateScore(t){this.score=t,this.scoreText.setText(t)}}(110,585);const e=Xt[this.level].timer;this.timer=e>0?new class{constructor(t,e,i){this.x=t,this.y=e,this.text=null,this.seconds=i,this.isPaused=!0}create(t){t.add.image(this.x+15,this.y+15,"icon_timer").setAlpha(.7),this.text=t.add.text(this.x+40,this.y,this.score,n),this.tick(),t.time.addEvent({delay:1e3,callback:this.tick,callbackScope:this,loop:!0})}tick(){if(this.seconds<=0||this.isPaused)return;this.seconds--;const t=Math.floor(this.seconds/60);let e=this.seconds%60;e<10&&(e="0"+e),this.text.setText(`${t}:${e}`)}start(){this.isPaused=!1}}(110,625,e):null;const i=(new class{getScript(t){const e=new class{constructor(){this.introMessages=[],this.getDisplayTileMatchMessages=()=>{}}};switch(t){case 0:e.introMessages=["*Oh, doozle, you made it!* You're here! (Click or tap anywhere!)","The Dew Drop Kingdom is in trouble!","We lost all of our dew drops and now we'll starve!","But you can help us by collecting as many dew drops as you can!","If you match three or more dew drops of the same color, we can collect them!","To make a match, select two dew drops and swap their places!"],e.getDisplayTileMatchMessages=t=>{if(1===t.totalMatches)return["You got it! That's it!","See if you can collect 100 dew drops!"]};break;case 1:e.introMessages=["*Oh, doozle!* You're so good at this!","But, we'll have to hurry this time!","We only have two minutes before the sun dries up all the dew drops!","Collect at least 200 dew drops in two minutes!"];break;case 2:e.introMessages=["Wow, we're so proud of you!","This round you'll only have 30 seconds to collect at least 300 dew drops!"],e.getGameOverMessages=()=>["Wait, wait, sorry, hold on.",'It\'s too early for the *"Lose in a Panic"* scenario.',"So sorry about that.","You've been really great so far, honestly.","You know, what, let's just go to the next round and we'll take it from the top."];break;case 3:e.introMessages=["Alright, I think we've got everything figured out.","Okay, for this next round, let me set you up:","Remember, you've been winning the last few rounds and you're gaining confidence.","In this round, it's going to be easy for you to get combos.","So the idea here is that you're going to get a little *too* confident, right?","Like a little full of yourself, alright?","Okay, great! Let's do this:","...","*Oh doozle woozle!*","You're so amazing!","You have two minutes again, but this time you'll have to collect 300 dew drops.","Can you do it?","Who am I kidding? Of course you can!"];break;case 4:e.introMessages=["Okay, okay, great stuff.","For this round, you're bringing all of that pride, all of that hubris.","And, when the round starts, things are still going your way.","But guess what?","Halfway through this round, things start getting a little harder.","So this is where we begin to chip away at your pride as the player.","Alright, that's your set up: now let me get into the right headspace.","...oh doozle woo-","...no, no, it's doozy-woozy here...","...yeah, doozy-woozy, you're our hero, blah, blah...","Alright! Got it!","...","*Doozy-woozy!*","You're our hero!","You've done so much for us, but we still need your help!","We need you to collect 500 dew drops in five minutes!"];break;case 5:e.introMessages=["Wow, such moving work.","It really feels so authentic.","It's been a joy working with you.","Okay, here we go, this is a pivotal scene:","This round will not go your way at all. At all.","This is your fall from grace.","(Ahem)","...","*Doozle!*","*Woozle!*","I can't believe you did it!","We've got a bigger challenge ahead, but I know you can do it!","You can do anything!","We need you to collect 1000 dew drops in five minutes!"];break;case 6:e.introMessages=["Okay, let's move right into the next scene:","Here, you are wallowing, right?","You are in the pit of despair and you can't see a way out.","This round won't be particularly hard, but you can't seem to find any matches.","Got it?","Alright, great: let me find my place here...","Yes, okay, I believed in you, but now my faith is faltering...","I'm keeping a brave face, but I'm really starting to lose confidence...","Okay, I'm ready!","...","Oh no!","*Whoopsie whoozle!*","Don't worry, that was a tough one!","Let's try again! I know you can do it!","We need you to collect 1000 dew drops in five minutes!"],e.getDisplayTileMatchMessages=t=>["(Oh, hey: remember, you're not going to find any matches this round)"];break;case 7:e.introMessages=["Now, you've been wallowing. You've feeling really low.","You're in such despair, that in this round...","There's an obvious combo.","Right there, right in front of your face.","But you can't see it through the despair.","But then, in the last ten seconds of the round, you see it.","Boom, it's the perfect match.","And the pheonix rises once again!"];break;case 8:e.introMessages=["Our hero is back!","This final scene is our victory lap.","However, we don't want too many combos in this round, right?","This is a round the player wins on their own.","No assistance from the game.","A true hero's victory!","Alright, let's do this: I've got an appointment after this."]}return e}}).getScript(this.level);this.guide=new class{constructor(t,e,i){this.x=t,this.y=e,this.script=i,this.queuedMessages=null,this.isPaused=!1,this.isBlockingGameplay=!1,this.endDialogueMarkerGraphics=null}create(t){const e=this,i=t.add.graphics({fillStyle:{color:16777215}}).setAlpha(0);i.fillRoundedRect(this.x,this.y-40,760,130,10),i.fillTriangle(this.x+120,this.y+130+20-40,this.x+105,this.y+130-40,this.x+135,this.y+130-40),this.endDialogueMarkerGraphics=t.add.graphics({fillStyle:{color:13421772}}),this.hideEndDialogueMarker();const s=new Phaser.Geom.Circle(this.x+760-10-15,this.y+130-10-15,10);this.endDialogueMarkerGraphics.fillCircleShape(s),t.tweens.add({targets:this.endDialogueMarkerGraphics,alpha:0,duration:500,repeat:-1,yoyo:!0});const r=n;r.wrap={mode:"word",width:760},r.tags={exclamation:{fontStyle:"bold"}},this.speechBubbleText=new Ct(t,this.x+15,this.y+15,"",r),t.add.existing(this.speechBubbleText),this.speechBubbleTextTyping=new Bt(this.speechBubbleText,{speed:30}),this.speechBubbleTextTyping.on("complete",()=>{e.onMessageComplete.call(e)});const a=t.add.image(this.x-250,this.y+130+230,"guide_character"),o=t.tweens.createTimeline();o.add({delay:200,targets:a,x:this.x+125,duration:400,angle:15,ease:"Power1"}),o.add({targets:a,duration:400,angle:-7,ease:"Power1"}),o.add({targets:a,duration:400,angle:0,ease:"Power1"}),o.add({offset:"-=300",targets:i,props:{y:{value:"+=40",duration:500,ease:"Bounce.easeOut"},alpha:{value:1,duration:300,ease:"Linear"}},onComplete:()=>{e.queueMessages(t,this.script.introMessages)}}),o.play()}queueMessages(t,e){if(!e)return;const i=this;null===i.queuedMessages&&(i.queuedMessages=[]),i.queuedMessages.push(...e),i.speechBubbleTextTyping.isTyping||(i.isBlockingGameplay=!0,i.progressDialogue())}onMessageComplete(){this.showEndDialogueMarker(),0!==this.queuedMessages.length||(this.isBlockingGameplay=!1)}displayTileMatchMessage(t,e){const i=this.script.getDisplayTileMatchMessages(e);this.queueMessages(t,i)}displayGameOverMessage(t){const e=this.script.getGameOverMessages();e.push(" "),this.queueMessages(t,e)}progressDialogue(){if(this.hideEndDialogueMarker(),this.queuedMessages.length>0){const t=this.convertDialogToTagText(this.queuedMessages.shift());this.speechBubbleTextTyping.start(t)}}showEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!0)}hideEndDialogueMarker(){this.endDialogueMarkerGraphics.setVisible(!1)}convertDialogToTagText(t){const e=[{token:"*",className:"exclamation"},{token:"_",className:"underline"}];let i="",s="";for(let n=0;n<t.length;n++){const r=t[n],a=e.some(t=>t.token===r);if(0!==n||a||(i+='<class="normal">',s="normal"),n!==t.length-1||!a)if(a){const t=e.find(t=>t.token===r);s===t.className?(i+="</class>",i+='<class="normal">',s="normal"):(0!==n&&(i+="</class>"),i+=`<class="${t.className}">`,s=t.className)}else i+=t[n]}return i+="</class>",i}}(20,20,i),this.tileGrid.create(this),this.scoreDisplay.create(this),this.timer&&this.timer.create(this),this.guide.create(this),this.levelClearMessage=this.add.image(400,400,"round_clear"),this.levelClearMessage.setAlpha(0),this.levelClearMessageHighlight=this.add.image(400,400,"round_clear"),this.levelClearMessageHighlight.setAlpha(0),this.levelClearMessageHighlight.setTintFill(16777215);const s=this;this.input.on("pointerdown",()=>{s.guide.progressDialogue()})}update(){if(this.tileGrid.isInitialized||this.tileGrid.fill(),this.guide.isBlockingGameplay&&!this.tileGrid.isBlocked?this.tileGrid.block(this):!this.guide.isBlockingGameplay&&this.tileGrid.isBlocked&&this.tileGrid.isInitialized&&this.tileGrid.unblock(this),!this.isAwaitingRoundTransition)return this.handleSpecialLevelBehavior(),!this.guide.isBlockingGameplay&&this.timer&&this.timer.isPaused&&this.timer.start(),null!=this.timer&&this.timer.seconds<=0?(this.guide.displayGameOverMessage(),void(this.isAwaitingRoundTransition=!0)):this.isLevelComplete()?(this.endLevel(),void(this.isAwaitingRoundTransition=!0)):void(this.queue.isActionRunning()||(this.queue.hasActions()?this.queue.next():this.tileGrid.update(this)));this.isReadyForRoundTransition&&!this.isTransitioningRounds&&this.nextLevel()}onTileSelect(t,e){if(!t.queue.isActionRunning()&&!t.guide.isBlockingGameplay&&t.tileGrid.canSelect(e)){if(e.isActivated)return t.selectedTiles=[],void e.deactivate();if(0===t.selectedTiles.length)return t.selectedTiles.push(e),void e.activate();if(1===t.selectedTiles.length){const i=t.selectedTiles[0],s=Math.abs(i.tileGridX-e.tileGridX),n=Math.abs(i.tileGridY-e.tileGridY);if(1===s&&0===n||0===s&&1===n){t.selectedTiles.push(e);let i=t.selectedTiles[0],s=t.selectedTiles[1];t.tileGrid.swapTiles(t,i,s),t.queue.push(()=>(t.tileGrid.hasMatches(i.tileGridX,i.tileGridY)||t.tileGrid.hasMatches(s.tileGridX,s.tileGridY)||t.tileGrid.swapTiles(t,i,s),Promise.resolve())),t.selectedTiles.forEach(t=>{t.deactivate()}),t.selectedTiles=[]}}}}onTileMatch(t,e){t.totalMatches++,t.score+=e.length,t.scoreDisplay.updateScore(t.score)}isLevelComplete(){return this.score>=Xt[this.level].score}handleSpecialLevelBehavior(){const t=Xt[this.level].handler;t&&t({tileGrid:this.tileGrid,score:this.score,level:this.level})}endLevel(){const t=this;t.isTransitioningRounds=!0,this.levelClearMessageHighlight.setAlpha(1),t.tweens.add({targets:this.levelClearMessageHighlight,alpha:0,duration:1e3}),t.tweens.add({targets:this.levelClearMessage,alpha:1,duration:1e3,completeDelay:2e3,onComplete:()=>{t.isReadyForRoundTransition=!0,t.isTransitioningRounds=!1}})}nextLevel(){this.scene.restart({level:this.level+1})}};const Qt={type:Phaser.AUTO,width:800,height:700,scene:[s,$t]};new Phaser.Game(Qt)}]);
//# sourceMappingURL=bundle.js.map